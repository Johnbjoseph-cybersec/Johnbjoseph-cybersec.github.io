
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>GRC Practice Lab | John Bommeraveni Joseph | Cybersecurity GRC Portfolio</title>
    <meta name="description" content="Interactive GRC simulation lab for practicing cybersecurity governance, risk & compliance concepts. 200+ controls from ISO 27001, NIST CSF, PCI DSS, HIPAA, SOC 2.">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    
    <!-- Custom CSS -->
    <style>
:root {
            /* Professional color palette */
            --bg-primary: #0a0e17;
            --bg-secondary: #0f172a;
            --bg-card: rgba(30, 41, 59, 0.7);
            --bg-surface: rgba(255, 255, 255, 0.05);
            
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            
            --border-light: rgba(255, 255, 255, 0.1);
            --border-medium: rgba(255, 255, 255, 0.15);
            
            --accent-primary: #3b82f6;
            --accent-success: #10b981;
            --accent-warning: #f59e0b;
            --accent-danger: #ef4444;
            --accent-info: #06b6d4;
            
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
            
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.2);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 10px 30px rgba(0, 0, 0, 0.4);
            --shadow-xl: 0 20px 50px rgba(0, 0, 0, 0.5);
            
            --transition-fast: 150ms ease;
            --transition-normal: 250ms ease;
            --transition-slow: 350ms ease;
        }
        
        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            scroll-behavior: smooth;
            height: 100%;
        }
        
        body {
            font-family: 'Manrope', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, 
                var(--bg-primary) 0%,
                var(--bg-secondary) 100%);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Professional Typography */
        h1, h2, h3, h4, h5, h6 {
            font-weight: 700;
            line-height: 1.2;
            margin-bottom: 1rem;
        }
        
        h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-info));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        h2 {
            font-size: 1.75rem;
            margin-top: 2rem;
        }
        
        h3 {
            font-size: 1.5rem;
        }
        
        .lead {
            font-size: 1.125rem;
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
        }
        
        .text-muted {
            color: var(--text-muted) !important;
        }
        
        /* Layout Components */
        .container-glass {
            background: var(--bg-surface);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            padding: 2rem;
            box-shadow: var(--shadow-lg);
        }
        
        .card-glass {
            background: var(--bg-card);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-md);
            padding: 1.5rem;
            transition: all var(--transition-normal);
        }
        
        .card-glass:hover {
            border-color: var(--border-medium);
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        }
        
        /* Navigation */
        .main-nav {
            background: rgba(10, 14, 23, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-light);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .nav-brand {
            font-weight: 800;
            font-size: 1.25rem;
            color: var(--text-primary);
            text-decoration: none;
        }
        
        .nav-brand .subtitle {
            font-size: 0.875rem;
            color: var(--text-muted);
            font-weight: 500;
        }
        
        .nav-link {
            color: var(--text-secondary);
            font-weight: 600;
            padding: 0.5rem 1rem;
            border-radius: var(--radius-md);
            transition: all var(--transition-fast);
        }
        
        .nav-link:hover,
        .nav-link.active {
            color: var(--text-primary);
            background: var(--bg-surface);
        }
        
        /* Tabs System */
        .tab-nav {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;           /* show all tabs */
            overflow-x: visible;       /* no horizontal scrollbar */
            padding: 1rem 0;
            margin-bottom: 2rem;
            scrollbar-width: thin;
        }
        
        .tab-nav::-webkit-scrollbar {
            height: 4px;
        }
        
        .tab-nav::-webkit-scrollbar-thumb {
            background: var(--border-medium);
            border-radius: 2px;
        }
        
        .tab-btn {
            background: var(--bg-surface);
            border: 1px solid var(--border-light);
            color: var(--text-secondary);
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-md);
            font-weight: 600;
            white-space: nowrap;
            transition: all var(--transition-fast);
        }
        
        .tab-btn:hover {
            background: rgba(59, 130, 246, 0.1);
            border-color: var(--accent-primary);
            color: var(--accent-primary);
        }
        
        .tab-btn.active {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Forms */
        .form-control, .form-select {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-light);
            color: var(--text-primary);
            border-radius: var(--radius-sm);
            padding: 0.75rem 1rem;
            transition: all var(--transition-fast);
        }
        
        .form-control:focus, .form-select:focus {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            color: var(--text-primary);
        }
        
        .form-label {
            color: var(--text-secondary);
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }
        
        /* Tables */
        .table-container {
            background: var(--bg-surface);
            border-radius: var(--radius-md);
            overflow: hidden;
        }
        
        .table-dark {
            --bs-table-bg: transparent;
            --bs-table-color: var(--text-primary);
            --bs-table-border-color: var(--border-light);
        }
        
        .table-dark thead th {
            background: rgba(30, 41, 59, 0.8);
            border-bottom: 2px solid var(--border-medium);
            font-weight: 700;
            color: var(--text-secondary);
            padding: 1rem;
        }
        
        .table-dark tbody tr {
            transition: background-color var(--transition-fast);
        }
        
        .table-dark tbody tr:hover {
            background: rgba(59, 130, 246, 0.05);
        }
        
        .table-dark td {
            padding: 1rem;
            vertical-align: middle;
            border-color: var(--border-light);
        }
        
        /* Buttons */
        .btn {
            font-weight: 600;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-md);
            transition: all var(--transition-fast);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--accent-primary), #1d4ed8);
            border: none;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.3);
        }
        
        .btn-outline-light {
            border-color: var(--border-medium);
            color: var(--text-secondary);
        }
        
        .btn-outline-light:hover {
            background: var(--bg-surface);
            border-color: var(--accent-primary);
            color: var(--text-primary);
        }
        
        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }
        
        /* Status Indicators */
        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 100px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .status-open { background: rgba(239, 68, 68, 0.15); color: #fca5a5; }
        .status-in-progress { background: rgba(245, 158, 11, 0.15); color: #fcd34d; }
        .status-closed { background: rgba(16, 185, 129, 0.15); color: #6ee7b7; }
        .status-mitigated { background: rgba(6, 182, 212, 0.15); color: #67e8f9; }
        .status-detected { background: rgba(239, 68, 68, 0.15); color: #fca5a5; }
        .status-investigating { background: rgba(245, 158, 11, 0.15); color: #fcd34d; }
        .status-contained { background: rgba(6, 182, 212, 0.15); color: #67e8f9; }
        .status-resolved { background: rgba(16, 185, 129, 0.15); color: #6ee7b7; }
        
        .severity-high { background: rgba(239, 68, 68, 0.15); color: #fca5a5; }
        .severity-medium { background: rgba(245, 158, 11, 0.15); color: #fcd34d; }
        .severity-low { background: rgba(16, 185, 129, 0.15); color: #6ee7b7; }
        
        /* Risk Matrix */
        .matrix-container {
            background: var(--bg-surface);
            border-radius: var(--radius-md);
            padding: 2rem;
            position: relative;
            overflow: hidden;
        }
        
        .matrix-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(5, 1fr);
            gap: 2px;
            height: 400px;
            margin: 2rem auto;
        }
        
        .matrix-cell {
            position: relative;
            border: 1px solid var(--border-light);
            transition: all var(--transition-fast);
        }
        
        .matrix-cell.high { background: rgba(239, 68, 68, 0.3); }
        .matrix-cell.medium { background: rgba(245, 158, 11, 0.3); }
        .matrix-cell.low { background: rgba(16, 185, 129, 0.3); }
        
        .matrix-cell:hover {
            transform: scale(1.05);
            z-index: 10;
        }
        
        /* Dashboard Cards */
        .metric-card {
            background: var(--bg-card);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-md);
            padding: 1.5rem;
            text-align: center;
            transition: all var(--transition-normal);
        }
        
        .metric-card:hover {
            border-color: var(--accent-primary);
            transform: translateY(-4px);
        }
        
        .metric-value {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-info));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .metric-label {
            color: var(--text-muted);
            font-size: 0.875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        /* Progress Bars */
        .progress {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 100px;
            height: 8px;
            overflow: hidden;
        }
        
        .progress-bar {
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-info));
        }
        
        /* Tooltips */
        [data-tooltip] {
            position: relative;
            cursor: help;
        }
        
        [data-tooltip]:before {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-secondary);
            border: 1px solid var(--border-light);
            color: var(--text-primary);
            padding: 0.5rem 0.75rem;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-fast);
            z-index: 1000;
        }
        
        [data-tooltip]:hover:before {
            opacity: 1;
            visibility: visible;
            bottom: calc(100% + 8px);
        }
        
        /* Loading States */
        .loading {
            position: relative;
            pointer-events: none;
            opacity: 0.7;
        }
        
        .loading:after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-light);
            border-top-color: var(--accent-primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }
        
        /* Framework Badges */
        .framework-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 100px;
            font-size: 0.75rem;
            font-weight: 600;
            margin: 0.125rem;
        }
        
        .badge-iso { background: rgba(59, 130, 246, 0.15); color: #93c5fd; }
        .badge-nist { background: rgba(16, 185, 129, 0.15); color: #6ee7b7; }
        .badge-pci { background: rgba(245, 158, 11, 0.15); color: #fcd34d; }
        .badge-hipaa { background: rgba(236, 72, 153, 0.15); color: #f9a8d4; }
        .badge-soc2 { background: rgba(139, 92, 246, 0.15); color: #c4b5fd; }
        .badge-iso42001 { background: rgba(168, 85, 247, 0.15); color: #d6bcfa; }
        .badge-gdpr { background: rgba(236, 72, 153, 0.15); color: #f9a8d4; }
        
        /* Alert Messages */
        .alert-glass {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-md);
            padding: 1rem 1.25rem;
        }
        
        /* Treatment type badges */
        .badge-mitigate { background: rgba(16, 185, 129, 0.15); color: #6ee7b7; }
        .badge-transfer { background: rgba(59, 130, 246, 0.15); color: #93c5fd; }
        .badge-accept { background: rgba(245, 158, 11, 0.15); color: #fcd34d; }
        .badge-avoid { background: rgba(139, 92, 246, 0.15); color: #c4b5fd; }
        
        /* Additional metric cards */
        .metric-card.small {
            padding: 1rem;
        }
        .metric-card.small .metric-value {
            font-size: 1.75rem;
        }
        .metric-card.small .metric-label {
            font-size: 0.75rem;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            h1 { font-size: 2rem; }
            h2 { font-size: 1.5rem; }
            
            .container-glass {
                padding: 1.5rem;
            }
            
            .tab-nav {
                padding: 0.5rem 0;
            }
            
            .tab-btn {
                padding: 0.5rem 1rem;
                font-size: 0.875rem;
            }
            
            .table-responsive {
                font-size: 0.875rem;
            }
            
            /* Stack table rows on mobile */
            .stack-table tbody tr {
                display: block;
                border: 1px solid var(--border-light);
                border-radius: var(--radius-sm);
                margin-bottom: 1rem;
                padding: 1rem;
            }
            
            .stack-table thead {
                display: none;
            }
            
            .stack-table td {
                display: block;
                border: none;
                padding: 0.5rem 0;
            }
            
            .stack-table td:before {
                content: attr(data-label);
                display: block;
                font-weight: 600;
                color: var(--text-muted);
                font-size: 0.75rem;
                text-transform: uppercase;
                margin-bottom: 0.25rem;
            }
            
            .matrix-grid {
                height: 300px;
            }
        }
        
        /* Print Styles */
        @media print {
            .no-print {
                display: none !important;
            }
            
            body {
                background: white;
                color: black;
            }
            
            .container-glass {
                box-shadow: none;
                border: 1px solid #ddd;
            }
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-surface);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--border-medium);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-primary);
        }
    
/* ===== Unified background + topbar (match index + cyber-readiness) ===== */
:root{
  --bg0:#070A12;
  --bg1:#0B1226;
  --card: rgba(255,255,255,.06);
  --card2: rgba(255,255,255,.085);
  --stroke: rgba(255,255,255,.10);
  --text: rgba(255,255,255,.92);
  --muted: rgba(255,255,255,.62);
  --muted2: rgba(255,255,255,.44);
  --brand:#7C3AED;
  --brand2:#22D3EE;
  --shadow2: 0 14px 40px rgba(0,0,0,.35);
  --radius2: 26px;
  --ease: cubic-bezier(.2,.8,.2,1);
}

/* Background */
body{
  background:
    radial-gradient(1200px 800px at 20% 10%, rgba(124,58,237,.28), transparent 60%),
    radial-gradient(900px 600px at 80% 20%, rgba(34,211,238,.18), transparent 55%),
    radial-gradient(800px 600px at 50% 90%, rgba(251,113,133,.12), transparent 55%),
    linear-gradient(180deg, var(--bg0), var(--bg1)) !important;
}

/* Subtle animated grid */
.gridfx{
  position:fixed; inset:0;
  background-image:
    linear-gradient(to right, rgba(255,255,255,.045) 1px, transparent 1px),
    linear-gradient(to bottom, rgba(255,255,255,.045) 1px, transparent 1px);
  background-size: 42px 42px;
  mask-image: radial-gradient(800px 600px at 50% 20%, black 35%, transparent 85%);
  pointer-events:none;
  opacity:.55;
  animation: drift 14s var(--ease) infinite alternate;
  z-index: 0;
}
@keyframes drift{ from{ transform: translate3d(0,0,0);} to{ transform: translate3d(0,-14px,0);} }

/* Floating orbs */
.orb{
  position:fixed; width:520px; height:520px; border-radius:999px;
  filter: blur(18px);
  opacity:.55;
  pointer-events:none;
  mix-blend-mode: screen;
  animation: float 9s var(--ease) infinite alternate;
  z-index: 0;
}
.orb.one{ left:-140px; top:-140px; background: radial-gradient(circle at 35% 30%, rgba(124,58,237,.75), transparent 55%); }
.orb.two{ right:-180px; top:80px; background: radial-gradient(circle at 40% 35%, rgba(34,211,238,.55), transparent 60%); animation-duration: 11s; }
.orb.three{ left:40%; bottom:-220px; background: radial-gradient(circle at 45% 45%, rgba(251,113,133,.45), transparent 62%); animation-duration: 13s; }
@keyframes float { from{ transform: translate3d(0,0,0) scale(1);} to{ transform: translate3d(0,24px,0) scale(1.02);} }

.wrap{
  max-width: 1200px;
  margin: 0 auto;
  padding: 28px 18px 60px;
  position: relative;
  z-index: 1;
}

/* Topbar */
.topbar{
  display:flex; align-items:center; justify-content:space-between; gap:14px;
  position:sticky; top:0; z-index:50;
  padding: 14px 12px;
  margin: -8px -6px 18px;
  border-radius: var(--radius2);
  background: rgba(10,14,26,.62);
  border: 1px solid rgba(255,255,255,.10);
  backdrop-filter: blur(12px);
  box-shadow: 0 10px 32px rgba(0,0,0,.35);
}
.brandRow{ display:flex; align-items:center; gap:10px; user-select:none; min-width: 240px; text-decoration:none; color: inherit; }
.logo{
  width:38px; height:38px; border-radius:12px;
  background: conic-gradient(from 210deg, rgba(124,58,237,.9), rgba(34,211,238,.9), rgba(251,113,133,.7), rgba(124,58,237,.9));
  box-shadow: 0 12px 26px rgba(124,58,237,.25);
  position:relative; overflow:hidden;
}
.logo:after{
  content:""; position:absolute; inset:-40%;
  background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.55), transparent 60%);
  transform: rotate(18deg);
}
.brandTitle{ margin:0; font-size:14px; letter-spacing:.2px; line-height:1.05; font-weight:800; }
.brandSub{ margin-top:2px; font-size:12px; color: var(--muted); }

.navlinks{ display:flex; align-items:center; gap:10px; flex-wrap:wrap; justify-content:flex-end; }
.pill{
  display:flex; align-items:center; gap:8px;
  padding: 10px 12px;
  border-radius: 999px;
  background: rgba(255,255,255,.06);
  border: 1px solid rgba(255,255,255,.10);
  color: var(--text);
  cursor:pointer;
  transition: transform .18s var(--ease), background .18s var(--ease), border-color .18s var(--ease);
  user-select:none;
  text-decoration:none;
  font-weight:800;
  font-size:13px;
  line-height:1;
}
.pill:hover{ transform: translateY(-1px); background: rgba(255,255,255,.085); border-color: rgba(255,255,255,.16); }
.pill:active{ transform: translateY(0px) scale(.99); }
.pill.primary{
  background: linear-gradient(135deg, rgba(124,58,237,.92), rgba(34,211,238,.65));
  border: 1px solid rgba(255,255,255,.12);
  box-shadow: 0 20px 55px rgba(124,58,237,.25);
}
.pill.muted{ color: rgba(255,255,255,.88); }

/* Glassify existing lab containers without breaking Bootstrap layout */
.container-glass{
  background: rgba(255,255,255,.05) !important;
  border: 1px solid rgba(255,255,255,.10) !important;
  backdrop-filter: blur(12px);
}
.card-glass{
  background: rgba(255,255,255,.055) !important;
  border: 1px solid rgba(255,255,255,.10) !important;
}


.btn-reset-lab{
  min-width:140px;
  margin-left:12px;
}

.reset-lab-btn{
  font-size:0.85rem;
  font-weight:600;
}


        /* Tabs: make pills compact on smaller screens */
        @media (max-width: 992px){
            .tab-btn{
                padding: 0.55rem 1.0rem;
                font-size: 0.9rem;
            }
        }
        @media (max-width: 520px){
            .tab-btn{
                padding: 0.5rem 0.9rem;
                font-size: 0.85rem;
            }
        }

/* ===== Tabs (aligned to glass/pill design) ===== */
.tab-nav{
  align-items:center;
  justify-content:flex-start;
}

/* default tab button */
.tab-btn{
  border-radius: 999px !important;
  padding: 0.62rem 1.05rem !important;
  border: 1px solid rgba(255,255,255,.12) !important;
  background: rgba(255,255,255,.06) !important;
  color: rgba(255,255,255,.86) !important;
  font-weight: 800 !important;
  letter-spacing: .1px;
  transition: transform .18s var(--ease), background .18s var(--ease), border-color .18s var(--ease), box-shadow .18s var(--ease);
  box-shadow: 0 10px 26px rgba(0,0,0,.18);
}

/* hover */
.tab-btn:hover{
  transform: translateY(-1px);
  background: rgba(255,255,255,.085) !important;
  border-color: rgba(255,255,255,.18) !important;
}

/* active tab */
.tab-btn.active,
.tab-btn[aria-current="page"]{
  background: linear-gradient(135deg, rgba(124,58,237,.92), rgba(34,211,238,.65)) !important;
  border-color: rgba(255,255,255,.14) !important;
  color: rgba(255,255,255,.96) !important;
  box-shadow: 0 18px 46px rgba(124,58,237,.22);
}

/* keep wrapped rows looking intentional */
.tab-nav::before{
  content:"";
  display:block;
  width:100%;
  height:0;
}

/* compact on smaller screens */
@media (max-width: 992px){
  .tab-btn{ padding: 0.58rem 0.95rem !important; font-size: 0.9rem !important; }
}
@media (max-width: 520px){
  .tab-btn{ padding: 0.54rem 0.9rem !important; font-size: 0.85rem !important; }
}



/* ===== Dark form controls (ensure inputs are readable on dark UI) ===== */
.form-control, .form-select, textarea, input[type="text"], input[type="date"], input[type="number"]{
  background: rgba(255,255,255,.06) !important;
  border: 1px solid rgba(255,255,255,.12) !important;
  color: rgba(255,255,255,.92) !important;
}
.form-control::placeholder, textarea::placeholder{
  color: rgba(255,255,255,.45) !important;
}
.form-select option{
  color: #111 !important; /* options list in native dropdown */
}
.modal-content{
  background: rgba(10,14,26,.92) !important;
  border: 1px solid rgba(255,255,255,.12) !important;
}
.modal-header, .modal-footer{
  border-color: rgba(255,255,255,.10) !important;
}


/* ===== Hard fix: prevent stuck modal backdrops from blocking UI ===== */
.modal-backdrop{ pointer-events: none !important; }
.modal{ pointer-events: auto !important; }
.modal{ z-index: 1055 !important; }
.modal-backdrop{ z-index: 1050 !important; }


/* ===== Ultra fix: never allow backdrop to black out UI ===== */
.modal-backdrop{
  display:none !important;
  opacity:0 !important;
  visibility:hidden !important;
}
body.modal-open{
  overflow:auto !important;
  padding-right:0 !important;
}

</style>


</head>
<body>
<div class="gridfx"></div>
<div class="orb one"></div>
<div class="orb two"></div>
<div class="orb three"></div>
<div class="wrap">

    <!-- Navigation -->
    
<header class="topbar">
  <a class="brandRow" href="index.html">
    <div class="logo" aria-hidden="true"></div>
    <div>
      <div class="brandTitle">John Bommeraveni Joseph</div>
      <div class="brandSub">Cybersecurity • GRC • AI Governance • ISO/IEC 27001 &amp; 42001 Lead Auditor</div>
    </div>
  </a>

  <nav class="navlinks" aria-label="Primary navigation">
    <a class="pill muted" href="index.html">Home</a>
    <a class="pill primary" href="grc-lab.html" aria-current="page">GRC Lab</a>
<a class="pill muted" href="cyber-readiness-tool.html">Cyber Readiness Tool</a>
    <a class="pill muted" href="terms.html">Terms</a>
    <a class="pill muted" href="https://www.youtube.com/@GRCMadeSimple" target="_blank" rel="noopener noreferrer">YouTube</a>
  </nav>
</header>
<!-- Hero Section -->
    <section class="py-5">
        <div class="container">
            <div class="container-glass">
                <div class="row align-items-center">
                    <div class="col-lg-8">
                        <h1>GRC Practice Lab</h1>
                        <p class="lead">Interactive simulation environment for practicing Governance, Risk & Compliance concepts. Everything runs locally in your browser - no data leaves your device.</p>
                        
                        <div class="alert alert-glass d-inline-block mb-4" style="background: rgba(245, 158, 11, 0.1); border-color: rgba(245, 158, 11, 0.3);">
                            <small class="d-flex align-items-center">
                                <i class="bi bi-book me-2"></i>
                                <span><strong>Educational Use Only:</strong> Controls are paraphrased for practice & portfolio demonstration.</span>
                            </small>
                        </div>
                        
                        <div class="d-flex flex-wrap gap-2 mt-4">
                            <span class="framework-badge badge-iso">ISO 27001:2022</span>
                            <span class="framework-badge badge-nist">NIST CSF 2.0</span>
                            <span class="framework-badge badge-pci">PCI DSS v4.0</span>
                            <span class="framework-badge badge-hipaa">HIPAA</span>
                            <span class="framework-badge badge-soc2">SOC 2</span>
                            <span class="framework-badge badge-iso42001">ISO 42001</span>
                            <span class="framework-badge badge-gdpr">GDPR</span>
                            <span class="badge bg-secondary">125+ Controls</span>
                        </div>
                    </div>
                    <div class="col-lg-4 text-lg-end">
                        <div class="mt-4 mt-lg-0">
                            <button class="btn btn-primary me-2" onclick="app.loadDemoScenario()">
                                <i class="bi bi-rocket-takeoff me-2"></i> Load Demo
                            </button>
                            <button class="btn btn-outline-light" onclick="app.exportAllData()">
                                <i class="bi bi-download me-2"></i> Export All
                            </button>
</div>
                    </div>
                </div>
            </div>
        </div>
    </section>
        <!-- Main Content -->
    <section class="py-4">
        <div class="container">
            <!-- Tab Navigation -->
            <div class="tab-nav no-print">
                <button class="tab-btn active" onclick="app.switchTab('dashboard')">
                    <i class="bi bi-speedometer2 me-2"></i> Dashboard
                </button>
                <button class="tab-btn" onclick="app.switchTab('frameworks')">
                    <i class="bi bi-building me-2"></i> Frameworks
                </button>
                <button class="tab-btn" onclick="app.switchTab('assets')">
                    <i class="bi bi-hdd-stack me-2"></i> Assets
                </button>
                <button class="tab-btn" onclick="app.switchTab('vendors')">
                    <i class="bi bi-people me-2"></i> Vendors
                </button>
                <button class="tab-btn" onclick="app.switchTab('risks')">
                    <i class="bi bi-exclamation-triangle me-2"></i> Risks
                </button>
                <button class="tab-btn" onclick="app.switchTab('controls')">
                    <i class="bi bi-shield-check me-2"></i> Controls
                </button>
                <button class="tab-btn" onclick="app.switchTab('issues')">
                    <i class="bi bi-bug me-2"></i> Issues
                </button>
                <button class="tab-btn" onclick="app.switchTab('incidents')">
                    <i class="bi bi-exclamation-octagon me-2"></i> Incidents
                </button>
                <button class="tab-btn" onclick="app.switchTab('treatments')">
                    <i class="bi bi-clipboard-check me-2"></i> Treatments
                </button>
                <button class="tab-btn" onclick="app.switchTab('soa')">
                    <i class="bi bi-file-text me-2"></i> SoA
                </button>
                <button class="tab-btn" onclick="app.switchTab('matrix')">
                    <i class="bi bi-grid-3x3 me-2"></i> Risk Matrix
                </button>
                <button class="tab-btn" onclick="app.switchTab('reports')">
                    <i class="bi bi-file-earmark-text me-2"></i> Reports
                </button>
                <button class="tab-btn" onclick="app.switchTab('challenges')">
                    <i class="bi bi-trophy me-2"></i> Challenges
                </button>
            </div>

            <!-- Tab Contents -->
            <div id="tabDashboard" class="tab-content active">
                <div class="container-glass">
                    <h2>Dashboard Overview</h2>
                    <div class="row g-4 mb-5">
                        <div class="col-md-3 col-6">
                            <div class="metric-card">
                                <div class="metric-value" id="metricAssets">0</div>
                                <div class="metric-label">Assets</div>
                            </div>
                        </div>
                        <div class="col-md-3 col-6">
                            <div class="metric-card">
                                <div class="metric-value" id="metricRisks">0</div>
                                <div class="metric-label">Risks</div>
                            </div>
                        </div>
                        <div class="col-md-3 col-6">
                            <div class="metric-card">
                                <div class="metric-value" id="metricControls">0</div>
                                <div class="metric-label">Controls</div>
                            </div>
                        </div>
                        <div class="col-md-3 col-6">
                            <div class="metric-card">
                                <div class="metric-value" id="metricCoverage">0%</div>
                                <div class="metric-label">Compliance</div>
                            </div>
                        </div>
                    </div>

                    <div class="row g-4">
                        <div class="col-lg-8">
                            <div class="card-glass">
                                <h4>Recent Risks</h4>
                                <div class="table-responsive">
                                    <table class="table table-dark">
                                        <thead>
                                            <tr>
                                                <th>Risk</th>
                                                <th>Severity</th>
                                                <th>Status</th>
                                                <th>Action</th>
                                            </tr>
                                        </thead>
                                        <tbody id="recentRisks">
                                            <tr>
                                                <td colspan="4" class="text-center text-muted">No risks yet. Add some to get started!</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="card-glass">
                                <h4>Quick Actions</h4>

<div class="mt-3">
  <button class="btn btn-outline-warning w-100 reset-lab-btn" onclick="resetLabData()">
    <i class="bi bi-arrow-counterclockwise me-2"></i> Reset Lab (Clear all local data)
  </button>
  <div class="small text-muted mt-2">
    This clears demo/entered data stored locally in your browser and resets the dashboard counters.
  </div>
</div>


                                <div class="d-grid gap-2">
                                    <button class="btn btn-outline-light" onclick="app.switchTab('risks'); app.showRiskForm()">
                                        <i class="bi bi-plus-circle me-2"></i> Add New Risk
                                    </button>
                                    <button class="btn btn-outline-light" onclick="app.generateReport()">
                                        <i class="bi bi-file-earmark-text me-2"></i> Generate Report
                                    </button>
                                    <button class="btn btn-outline-light" onclick="app.loadDemoScenario()">
                                        <i class="bi bi-play-circle me-2"></i> Practice Scenario
                                    </button>
                                    <button class="btn btn-outline-light" onclick="app.exportAllData()">
                                        <i class="bi bi-box-arrow-up me-2"></i> Export Data
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Risks Tab -->
            <div id="tabRisks" class="tab-content">
                <div class="container-glass">
                    <h2>Risk Register</h2>
                    <div class="row mb-4">
                        <div class="col-md-8">
                            <div class="input-group">
                                <input type="text" class="form-control" id="riskSearch" placeholder="Search risks...">
                                <select class="form-select" style="max-width: 150px;" id="riskFilter">
                                    <option value="all">All Status</option>
                                    <option value="open">Open</option>
                                    <option value="in-progress">In Progress</option>
                                    <option value="mitigated">Mitigated</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4 text-end">
                            <button class="btn btn-primary" onclick="app.showRiskForm()">
                                <i class="bi bi-plus-circle me-2"></i> Add Risk
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-dark stack-table">
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Category</th>
                                    <th>Likelihood</th>
                                    <th>Impact</th>
                                    <th>Severity</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="riskTableBody">
                                <tr>
                                    <td colspan="7" class="text-center text-muted">No risks recorded yet. Add your first risk!</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Assets Tab -->
            <div id="tabAssets" class="tab-content">
                <div class="container-glass">
                    <h2>Asset Inventory</h2>
                    <div class="row mb-4">
                        <div class="col-md-8">
                            <input type="text" class="form-control" id="assetSearch" placeholder="Search assets...">
                        </div>
                        <div class="col-md-4 text-end">
                            <button class="btn btn-primary" onclick="app.showAssetForm()">
                                <i class="bi bi-plus-circle me-2"></i> Add Asset
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-dark stack-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Type</th>
                                    <th>Criticality</th>
                                    <th>Data Types</th>
                                    <th>Owner</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="assetTableBody">
                                <tr>
                                    <td colspan="6" class="text-center text-muted">No assets recorded yet.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Controls Tab -->
            <div id="tabControls" class="tab-content">
                <div class="container-glass">
                    <h2>Control Library</h2>
                    <div class="row mb-4">
                        <div class="col-md-8">
                            <div class="input-group">
                                <input type="text" class="form-control" id="controlSearch" placeholder="Search controls...">
                                <select class="form-select" style="max-width: 150px;" id="controlStatusFilter">
                                    <option value="all">All Status</option>
                                    <option value="implemented">Implemented</option>
                                    <option value="planned">Planned</option>
                                    <option value="not-implemented">Not Implemented</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4 text-end">
                            <button class="btn btn-primary" onclick="app.showControlForm()">
                                <i class="bi bi-plus-circle me-2"></i> Add Control
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-dark stack-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Type</th>
                                    <th>Framework</th>
                                    <th>Status</th>
                                    <th>Owner</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="controlTableBody">
                                <tr>
                                    <td colspan="6" class="text-center text-muted">No controls recorded yet.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Frameworks Tab -->
            <div id="tabFrameworks" class="tab-content">
                <div class="container-glass">
                    <h2>Framework Library</h2>
                    <div class="row mb-4">
                        <div class="col-md-4">
                            <select class="form-select" id="frameworkSelect">
                                <option value="all">All Frameworks</option>
                                <option value="iso">ISO 27001</option>
                                <option value="nist">NIST CSF</option>
                                <option value="pci">PCI DSS</option>
                                <option value="hipaa">HIPAA</option>
                                <option value="soc2">SOC 2</option>
                                <option value="iso42001">ISO 42001</option>
                                <option value="gdpr">GDPR</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <select class="form-select" id="categorySelect">
                                <option value="all">All Categories</option>
                                <option value="access">Access Control</option>
                                <option value="crypto">Encryption</option>
                                <option value="monitoring">Monitoring</option>
                                <option value="incident">Incident Response</option>
                                <option value="governance">Governance</option>
                                <option value="physical">Physical Security</option>
                                <option value="continuity">Business Continuity</option>
                                <option value="supplier">Supplier Relationships</option>
                                <option value="ai">AI Management</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <input type="text" class="form-control" id="frameworkSearch" placeholder="Search controls...">
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-dark stack-table">
                            <thead>
                                <tr>
                                    <th>Control ID</th>
                                    <th>Name</th>
                                    <th>Category</th>
                                    <th>Framework</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody id="frameworkTableBody">
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Vendors Tab -->
            <div id="tabVendors" class="tab-content">
                <div class="container-glass">
                    <h2>Vendor Management</h2>
                    <div class="row mb-4">
                        <div class="col-md-8">
                            <div class="input-group">
                                <input type="text" class="form-control" id="vendorSearch" placeholder="Search vendors...">
                                <select class="form-select" style="max-width: 150px;" id="vendorRiskFilter">
                                    <option value="all">All Risk Levels</option>
                                    <option value="high">High Risk</option>
                                    <option value="medium">Medium Risk</option>
                                    <option value="low">Low Risk</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4 text-end">
                            <button class="btn btn-primary" onclick="app.showVendorForm()">
                                <i class="bi bi-plus-circle me-2"></i> Add Vendor
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-dark stack-table">
                            <thead>
                                <tr>
                                    <th>Vendor Name</th>
                                    <th>Service Type</th>
                                    <th>Risk Level</th>
                                    <th>Contract Status</th>
                                    <th>Next Review</th>
                                    <th>Compliance</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="vendorTableBody">
                                <tr>
                                    <td colspan="7" class="text-center text-muted">No vendors recorded yet. Add your first vendor!</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Issues Tab -->
            <div id="tabIssues" class="tab-content">
                <div class="container-glass">
                    <h2>Security Issues & Findings</h2>
                    <div class="row mb-4">
                        <div class="col-md-8">
                            <div class="input-group">
                                <input type="text" class="form-control" id="issueSearch" placeholder="Search issues...">
                                <select class="form-select" style="max-width: 150px;" id="issueStatusFilter">
                                    <option value="all">All Status</option>
                                    <option value="open">Open</option>
                                    <option value="in-progress">In Progress</option>
                                    <option value="resolved">Resolved</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4 text-end">
                            <button class="btn btn-primary" onclick="app.showIssueForm()">
                                <i class="bi bi-plus-circle me-2"></i> Add Issue
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-dark stack-table">
                            <thead>
                                <tr>
                                    <th>Issue Title</th>
                                    <th>Source</th>
                                    <th>Severity</th>
                                    <th>Status</th>
                                    <th>Due Date</th>
                                    <th>Owner</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="issueTableBody">
                                <tr>
                                    <td colspan="7" class="text-center text-muted">No issues recorded yet.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Incidents Tab -->
            <div id="tabIncidents" class="tab-content">
                <div class="container-glass">
                    <h2>Incident Management</h2>
                    <div class="row mb-4">
                        <div class="col-md-8">
                            <div class="input-group">
                                <input type="text" class="form-control" id="incidentSearch" placeholder="Search incidents...">
                                <select class="form-select" style="max-width: 150px;" id="incidentSeverityFilter">
                                    <option value="all">All Severities</option>
                                    <option value="critical">Critical</option>
                                    <option value="high">High</option>
                                    <option value="medium">Medium</option>
                                    <option value="low">Low</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4 text-end">
                            <button class="btn btn-primary" onclick="app.showIncidentForm()">
                                <i class="bi bi-plus-circle me-2"></i> Log Incident
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-dark stack-table">
                            <thead>
                                <tr>
                                    <th>Incident ID</th>
                                    <th>Title</th>
                                    <th>Type</th>
                                    <th>Severity</th>
                                    <th>Status</th>
                                    <th>Detected</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="incidentTableBody">
                                <tr>
                                    <td colspan="7" class="text-center text-muted">No incidents recorded yet.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
                        <!-- Treatments Tab -->
            <div id="tabTreatments" class="tab-content">
                <div class="container-glass">
                    <h2>Risk Treatments & Actions</h2>
                    <div class="row mb-4">
                        <div class="col-md-8">
                            <div class="input-group">
                                <input type="text" class="form-control" id="treatmentSearch" placeholder="Search treatments...">
                                <select class="form-select" style="max-width: 150px;" id="treatmentStatusFilter">
                                    <option value="all">All Status</option>
                                    <option value="planned">Planned</option>
                                    <option value="in-progress">In Progress</option>
                                    <option value="completed">Completed</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4 text-end">
                            <button class="btn btn-primary" onclick="app.showTreatmentForm()">
                                <i class="bi bi-plus-circle me-2"></i> Add Treatment
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-dark stack-table">
                            <thead>
                                <tr>
                                    <th>Treatment Plan</th>
                                    <th>Risk</th>
                                    <th>Type</th>
                                    <th>Status</th>
                                    <th>Due Date</th>
                                    <th>Owner</th>
                                    <th>Progress</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="treatmentTableBody">
                                <tr>
                                    <td colspan="8" class="text-center text-muted">No treatment plans recorded yet.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Risk Matrix Tab -->
            <div id="tabMatrix" class="tab-content">
                <div class="container-glass">
                    <h2>Risk Matrix</h2>
                    <div class="row mb-4">
                        <div class="col-md-8">
                            <div class="btn-group" role="group">
                                <input type="radio" class="btn-check" name="matrixView" id="inherentView" autocomplete="off" checked>
                                <label class="btn btn-outline-light" for="inherentView">Inherent Risk</label>
                                
                                <input type="radio" class="btn-check" name="matrixView" id="residualView" autocomplete="off">
                                <label class="btn btn-outline-light" for="residualView">Residual Risk</label>
                            </div>
                        </div>
                        <div class="col-md-4 text-end">
                            <button class="btn btn-outline-light" onclick="app.exportMatrix()">
                                <i class="bi bi-download me-2"></i> Export
                            </button>
                        </div>
                    </div>
                    
                    <div class="matrix-container">
                        <div class="matrix-grid" id="riskMatrix">
                            <!-- 5x5 grid will be generated by JavaScript -->
                        </div>
                        <div class="text-center mt-4">
                            <div class="d-inline-flex gap-4">
                                <div><span class="badge bg-danger me-2">High</span> ≥ 15</div>
                                <div><span class="badge bg-warning me-2">Medium</span> 6-14</div>
                                <div><span class="badge bg-success me-2">Low</span> ≤ 5</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SoA Tab -->
            <div id="tabSoa" class="tab-content">
                <div class="container-glass">
                    <h2>Statement of Applicability</h2>
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <select class="form-select" id="soaFrameworkFilter">
                                <option value="all">All Frameworks</option>
                                <option value="iso">ISO 27001</option>
                                <option value="nist">NIST CSF</option>
                                <option value="pci">PCI DSS</option>
                                <option value="hipaa">HIPAA</option>
                                <option value="soc2">SOC 2</option>
                                <option value="iso42001">ISO 42001</option>
                                <option value="gdpr">GDPR</option>
                            </select>
                        </div>
                        <div class="col-md-6 text-end">
                            <button class="btn btn-primary" onclick="app.exportSoA()">
                                <i class="bi bi-download me-2"></i> Export SoA
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-dark stack-table">
                            <thead>
                                <tr>
                                    <th>Control ID</th>
                                    <th>Control Name</th>
                                    <th>Framework</th>
                                    <th>Applicability</th>
                                    <th>Implementation</th>
                                    <th>Rationale</th>
                                    <th>Evidence</th>
                                </tr>
                            </thead>
                            <tbody id="soaTableBody">
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Reports Tab -->
            <div id="tabReports" class="tab-content">
                <div class="container-glass">
                    <h2>Reports & Analytics</h2>
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <select class="form-select" id="reportType">
                                <option value="executive">Executive Summary</option>
                                <option value="risk">Risk Register</option>
                                <option value="compliance">Compliance Gap</option>
                                <option value="vendor">Vendor Risk</option>
                                <option value="incident">Incident Report</option>
                            </select>
                        </div>
                        <div class="col-md-6 text-end">
                            <button class="btn btn-primary me-2" onclick="app.generateReport()">
                                <i class="bi bi-file-earmark-text me-2"></i> Generate
                            </button>
                            <button class="btn btn-outline-light" onclick="app.exportReport()">
                                <i class="bi bi-download me-2"></i> Export PDF
                            </button>
                        </div>
                    </div>
                    
                    <div class="card-glass">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="mb-0" id="reportTitle">Report Preview</h5>
                            <button class="btn btn-sm btn-outline-light" onclick="app.copyReport()">
                                <i class="bi bi-clipboard me-1"></i> Copy
                            </button>
                        </div>
                        <div class="p-3 bg-dark rounded" style="min-height: 300px;">
                            <pre id="reportContent" class="text-light mb-0">Select a report type and click Generate to create a report.</pre>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Challenges Tab -->
            <div id="tabChallenges" class="tab-content">
                <div class="container-glass">
                    <h2>GRC Challenges</h2>
                    <p class="lead mb-4">Test your GRC skills with these hands-on challenges. Complete tasks to earn points!</p>
                    
                    <div class="row g-4">
                        <div class="col-md-6">
                            <div class="card-glass">
                                <div class="d-flex justify-content-between align-items-start mb-3">
                                    <h5 class="mb-0">Beginner Challenge</h5>
                                    <span class="badge bg-success">100 Points</span>
                                </div>
                                <p>Complete a basic risk assessment for a small e-commerce company.</p>
                                <ul class="mb-3">
                                    <li>Add 3 assets</li>
                                    <li>Identify 5 risks</li>
                                    <li>Add 3 controls</li>
                                    <li>Generate a report</li>
                                </ul>
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="text-muted">Status: <span i...(truncated 151897 characters)...ss="col-md-6 mb-3">
                                <label class="form-label">Owner</label>
                                <input type="text" class="form-control" id="treatmentOwner" 
                                       value="${treatment?.owner || ''}" placeholder="e.g., Security Team">
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Due Date</label>
                                <input type="date" class="form-control" id="treatmentDueDate" 
                                       value="${treatment?.dueDate || ''}">
                            </div>
                            
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Progress (%)</label>
                                <input type="range" class="form-range" id="treatmentProgress" min="0" max="100" step="5"
                                       value="${treatment?.progress || 0}">
                                <div class="d-flex justify-content-between">
                                    <small>0%</small>
                                    <span id="progressValue" class="fw-bold">${treatment?.progress || 0}%</span>
                                    <small>100%</small>
                                </div>
                            </div>
                            
                            <div class="col-md-8 mb-3">
                                <label class="form-label">Cost Estimate</label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input type="number" class="form-control" id="treatmentCost" 
                                           value="${treatment?.cost || ''}" placeholder="Estimated cost">
                                    <span class="input-group-text">.00</span>
                                </div>
                            </div>
                            
                            <div class="col-md-12 mb-3">
                                <label class="form-label">Action Steps</label>
                                <textarea class="form-control" id="treatmentActions" rows="3"
                                          placeholder="Detailed steps to implement this treatment...">${treatment?.actions || ''}</textarea>
                            </div>
                            
                            <div class="col-md-12 mb-3">
                                <label class="form-label">Success Criteria</label>
                                <textarea class="form-control" id="treatmentCriteria" rows="2"
                                          placeholder="How will you know when this treatment is successful?...">${treatment?.criteria || ''}</textarea>
                            </div>
                        </div>
                        
                        <div class="text-end mt-4">
                            <button type="button" class="btn btn-outline-light me-2" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-primary">${treatment ? 'Update' : 'Save'} Treatment</button>
                        </div>
                    </form>
                `;
                
                document.getElementById('treatmentModalBody').innerHTML = formHTML;
                
                // Update progress value display
                const progressSlider = document.getElementById('treatmentProgress');
                const progressValue = document.getElementById('progressValue');
                if (progressSlider && progressValue) {
                    progressSlider.addEventListener('input', function() {
                        progressValue.textContent = this.value + '%';
                    });
                }
                
                const modal = new bootstrap.Modal(document.getElementById('treatmentModal'));
                modal.show();
            }

            saveTreatment(event) {
                event.preventDefault();
                
                const treatmentData = {
                    id: document.getElementById('treatmentId').value || 'TRT_' + Date.now(),
                    title: document.getElementById('treatmentTitle').value.trim(),
                    type: document.getElementById('treatmentType').value,
                    riskId: document.getElementById('treatmentRisk').value,
                    status: document.getElementById('treatmentStatus').value,
                    owner: document.getElementById('treatmentOwner').value.trim(),
                    dueDate: document.getElementById('treatmentDueDate').value,
                    progress: parseInt(document.getElementById('treatmentProgress').value) || 0,
                    cost: parseFloat(document.getElementById('treatmentCost').value) || 0,
                    actions: document.getElementById('treatmentActions').value.trim(),
                    criteria: document.getElementById('treatmentCriteria').value.trim(),
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                const index = this.data.treatments.findIndex(t => t.id === treatmentData.id);
                if (index > -1) {
                    this.data.treatments[index] = treatmentData;
                    this.showToast('Treatment updated successfully', 'success');
                } else {
                    this.data.treatments.push(treatmentData);
                    this.showToast('Treatment added successfully', 'success');
                }
                
                this.saveData('treatments', this.data.treatments);
                this.renderTreatments();
                
                safeHideModal('treatmentModal');
            }

            renderTreatments() {
                const tableBody = document.getElementById('treatmentTableBody');
                if (!tableBody) return;

                const searchTerm = document.getElementById('treatmentSearch')?.value.toLowerCase() || '';
                const statusFilter = document.getElementById('treatmentStatusFilter')?.value || 'all';
                
                let filteredTreatments = this.data.treatments;
                
                if (searchTerm) {
                    filteredTreatments = filteredTreatments.filter(treatment =>
                        treatment.title.toLowerCase().includes(searchTerm) ||
                        treatment.actions?.toLowerCase().includes(searchTerm)
                    );
                }
                
                if (statusFilter !== 'all') {
                    filteredTreatments = filteredTreatments.filter(treatment => 
                        treatment.status.toLowerCase().replace(' ', '-') === statusFilter
                    );
                }
                
                if (filteredTreatments.length === 0) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="8" class="text-center text-muted">
                                <div class="py-4">
                                    <i class="bi bi-clipboard-check fs-4 d-block mb-2"></i>
                                    No treatment plans found. ${searchTerm ? 'Try a different search term.' : 'Add your first treatment plan!'}
                                </div>
                            </td>
                        </tr>
                    `;
                } else {
                    tableBody.innerHTML = filteredTreatments.map(treatment => {
                        const risk = treatment.riskId ? this.data.risks.find(r => r.id === treatment.riskId) : null;
                        const progressClass = treatment.progress < 30 ? 'bg-danger' : 
                                            treatment.progress < 70 ? 'bg-warning' : 'bg-success';
                        
                        return `
                            <tr>
                                <td data-label="Treatment Plan">
                                    <strong>${treatment.title}</strong><br>
                                    <small class="text-muted">${treatment.type}</small>
                                </td>
                                <td data-label="Risk">
                                    ${risk ? risk.title : 'Not linked'}
                                </td>
                                <td data-label="Type">
                                    <span class="badge bg-info">${treatment.type}</span>
                                </td>
                                <td data-label="Status">
                                    <span class="status-badge status-${treatment.status.toLowerCase().replace(' ', '-')}">
                                        ${treatment.status}
                                    </span>
                                </td>
                                <td data-label="Due Date">
                                    ${treatment.dueDate ? new Date(treatment.dueDate).toLocaleDateString() : 'Not set'}
                                    ${treatment.dueDate && new Date(treatment.dueDate) < new Date() && treatment.status !== 'Completed' ? 
                                        '<br><small class="text-danger"><i class="bi bi-exclamation-triangle"></i> Overdue</small>' : ''}
                                </td>
                                <td data-label="Owner">${treatment.owner || 'Unassigned'}</td>
                                <td data-label="Progress">
                                    <div class="d-flex align-items-center">
                                        <div class="progress flex-grow-1 me-2" style="height: 8px;">
                                            <div class="progress-bar ${progressClass}" style="width: ${treatment.progress}%"></div>
                                        </div>
                                        <small>${treatment.progress}%</small>
                                    </div>
                                </td>
                                <td data-label="Actions">
                                    <div class="btn-group btn-group-sm">
                                        <button class="btn btn-outline-light" onclick="app.showTreatmentForm('${treatment.id}')">
                                            <i class="bi bi-pencil"></i>
                                        </button>
                                        <button class="btn btn-outline-danger" onclick="app.deleteItem('treatment', '${treatment.id}')">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        `;
                    }).join('');
                }
            }

            // ===== FRAMEWORK LIBRARY =====
            renderFrameworks() {
                const tableBody = document.getElementById('frameworkTableBody');
                if (!tableBody) return;

                const searchTerm = document.getElementById('frameworkSearch')?.value.toLowerCase() || '';
                const frameworkFilter = document.getElementById('frameworkSelect')?.value || 'all';
                const categoryFilter = document.getElementById('categorySelect')?.value || 'all';
                
                let allControls = [];
                
                // Combine all framework controls
                Object.values(this.frameworks).forEach(framework => {
                    framework.controls.forEach(control => {
                        allControls.push({
                            ...control,
                            framework: framework.name,
                            frameworkKey: Object.keys(this.frameworks).find(k => this.frameworks[k].name === framework.name)
                        });
                    });
                });
                
                // Apply filters
                let filteredControls = allControls;
                
                if (searchTerm) {
                    filteredControls = filteredControls.filter(control =>
                        control.name.toLowerCase().includes(searchTerm) ||
                        control.description.toLowerCase().includes(searchTerm) ||
                        control.id.toLowerCase().includes(searchTerm)
                    );
                }
                
                if (frameworkFilter !== 'all') {
                    filteredControls = filteredControls.filter(control => 
                        control.frameworkKey === frameworkFilter
                    );
                }
                
                if (categoryFilter !== 'all') {
                    filteredControls = filteredControls.filter(control => 
                        control.category.toLowerCase().includes(categoryFilter.toLowerCase())
                    );
                }
                
                if (filteredControls.length === 0) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="5" class="text-center text-muted">
                                <div class="py-4">
                                    <i class="bi bi-search fs-4 d-block mb-2"></i>
                                    No controls match your filters. Try adjusting your search.
                                </div>
                            </td>
                        </tr>
                    `;
                } else {
                    tableBody.innerHTML = filteredControls.map(control => `
                        <tr>
                            <td data-label="Control ID">
                                <code>${control.id}</code>
                            </td>
                            <td data-label="Name">
                                <strong>${control.name}</strong><br>
                                <small class="text-muted">${control.category}</small>
                            </td>
                            <td data-label="Category">
                                <span class="badge bg-info">${control.category}</span>
                            </td>
                            <td data-label="Framework">
                                <span class="framework-badge badge-${control.frameworkKey}">${control.framework}</span>
                            </td>
                            <td data-label="Description">
                                <small>${control.description}</small>
                            </td>
                        </tr>
                    `).join('');
                }
            }

            // ===== RISK MATRIX =====
            renderRiskMatrix() {
                const container = document.getElementById('riskMatrix');
                if (!container) return;
                
                // Clear and create 5x5 grid
                container.innerHTML = '';
                
                for (let i = 5; i >= 1; i--) { // Likelihood (5 to 1)
                    for (let j = 1; j <= 5; j++) { // Impact (1 to 5)
                        const score = i * j;
                        const severity = this.calculateRiskSeverity(score);
                        
                        const cell = document.createElement('div');
                        cell.className = `matrix-cell ${severity.toLowerCase()}`;
                        cell.style.gridColumn = j;
                        cell.style.gridRow = 6 - i; // Reverse for visual display
                        cell.innerHTML = `
                            <div class="text-center p-2">
                                <small class="d-block text-muted">${this.getLikelihoodLabel(i)}/${this.getImpactLabel(j)}</small>
                                <strong class="d-block">${score}</strong>
                            </div>
                        `;
                        
                        // Add risk dots if any
                        const risksInCell = this.data.risks.filter(r => r.likelihood === i && r.impact === j);
                        if (risksInCell.length > 0) {
                            const dotContainer = document.createElement('div');
                            dotContainer.className = 'position-absolute top-0 start-0 w-100 h-100 p-1';
                            dotContainer.style.pointerEvents = 'none';
                            
                            risksInCell.forEach((risk, index) => {
                                const dot = document.createElement('div');
                                dot.className = 'position-absolute top-0 start-0 rounded-circle';
                                dot.style.width = '12px';
                                dot.style.height = '12px';
                                dot.style.background = risk.severity === 'High' ? '#ef4444' : 
                                                     risk.severity === 'Medium' ? '#f59e0b' : '#10b981';
                                dot.style.border = '2px solid white';
                                
                                // Position dots in a grid within the cell
                                const row = Math.floor(index / 3);
                                const col = index % 3;
                                dot.style.top = `${20 + row * 25}%`;
                                dot.style.left = `${20 + col * 25}%`;
                                
                                dotContainer.appendChild(dot);
                            });
                            
                            cell.appendChild(dotContainer);
                        }
                        
                        cell.addEventListener('click', () => this.showRisksInCell(i, j));
                        container.appendChild(cell);
                    }
                }
                
                // Add labels
                const labels = `
                    <div class="position-absolute top-0 start-0 w-100 d-flex justify-content-between px-4">
                        <div class="text-center">
                            <small class="text-muted">Impact →</small>
                        </div>
                    </div>
                    <div class="position-absolute bottom-0 start-0 w-100 d-flex justify-content-between px-4">
                        ${[1,2,3,4,5].map(n => `<div><small class="text-muted">${n}</small></div>`).join('')}
                    </div>
                    <div class="position-absolute top-0 left-0 h-100 d-flex flex-column justify-content-between py-4">
                        <div class="text-center" style="transform: rotate(-90deg); transform-origin: center;">
                            <small class="text-muted">Likelihood →</small>
                        </div>
                    </div>
                    <div class="position-absolute top-0 left-0 h-100 d-flex flex-column justify-content-between py-4">
                        ${[5,4,3,2,1].map(n => `<div class="text-center"><small class="text-muted">${n}</small></div>`).join('')}
                    </div>
                `;
                
                container.insertAdjacentHTML('beforeend', labels);
            }

            showRisksInCell(likelihood, impact) {
                const risks = this.data.risks.filter(r => r.likelihood === likelihood && r.impact === impact);
                
                if (risks.length === 0) {
                    this.showToast(`No risks in this cell (Likelihood: ${likelihood}, Impact: ${impact})`, 'info');
                    return;
                }
                
                let message = `Risks in cell (Likelihood: ${likelihood}, Impact: ${impact}):\n\n`;
                risks.forEach(risk => {
                    message += `• ${risk.title} (${risk.severity})\n`;
                });
                
                alert(message);
            }

            toggleMatrixView(view) {
                // For now, just show inherent risk
                // Could be extended to show residual risk with controls applied
                this.renderRiskMatrix();
            }

            // ===== STATEMENT OF APPLICABILITY =====
            renderSOA() {
                const tableBody = document.getElementById('soaTableBody');
                if (!tableBody) return;

                // Build base SoA items from frameworks library
                let soaItems = [];
                Object.values(this.frameworks).forEach(framework => {
                    (framework.controls || []).forEach(control => {
                        // Determine implementation from Local Controls
                        const isImplemented = this.data.controls.some(c =>
                            c.framework === framework.name &&
                            c.controlId === control.id &&
                            c.status === 'Implemented'
                        );
                        const isPlanned = this.data.controls.some(c =>
                            c.framework === framework.name &&
                            c.controlId === control.id &&
                            c.status === 'Planned'
                        );

                        let implementationStatus = 'Not Implemented';
                        if (isImplemented) implementationStatus = 'Implemented';
                        else if (isPlanned) implementationStatus = 'Planned';

                        soaItems.push({
                            id: control.id,
                            name: control.name,
                            framework: framework.name,
                            category: control.category || '',
                            applicability: 'Applicable',
                            implementation: implementationStatus,
                            owner: '',
                            rationale: '',
                            evidence: ''
                        });
                    });
                });

                // Merge saved SoA edits (persisted locally)
                const keyOf = (fw, id) => `${fw}||${id}`;
                const saved = Array.isArray(this.data.soa) ? this.data.soa : [];
                const byKey = new Map(saved.map(r => [r.key || keyOf(r.framework, r.id), r]));
                soaItems = soaItems.map(item => {
                    const k = keyOf(item.framework, item.id);
                    const r = byKey.get(k);
                    if (!r) return item;
                    return {
                        ...item,
                        applicability: (r.applicability ?? item.applicability),
                        implementation: (r.implementation ?? item.implementation),
                        owner: (r.owner ?? item.owner),
                        rationale: (r.rationale ?? item.rationale),
                        evidence: (r.evidence ?? item.evidence)
                    };
                });

                // Apply framework filter
                const frameworkFilter = document.getElementById('soaFrameworkFilter')?.value || 'all';
                if (frameworkFilter !== 'all') {
                    const f = frameworkFilter.toLowerCase();
                    soaItems = soaItems.filter(item => item.framework.toLowerCase().includes(f));
                }

                if (soaItems.length === 0) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="7" class="text-center text-muted">
                                <div class="py-4">
                                    <i class="bi bi-file-text fs-4 d-block mb-2"></i>
                                    No SoA items found for the selected framework.
                                </div>
                            </td>
                        </tr>
                    `;
                    return;
                }

                // Render editable rows
                tableBody.innerHTML = soaItems.map(item => {
                    const k = keyOf(item.framework, item.id);
                    const implBadge = item.implementation === 'Implemented' ? 'success'
                      : item.implementation === 'Planned' ? 'warning'
                      : 'danger';

                    return `
                        <tr data-soa-key="${this.escapeHtml(k)}">
                            <td data-label="Control ID"><code>${this.escapeHtml(item.id)}</code></td>
                            <td data-label="Control Name">
                                <strong>${this.escapeHtml(item.name)}</strong><br>
                                <small class="text-muted">${this.escapeHtml(item.category)}</small>
                            </td>
                            <td data-label="Framework">
                                <span class="badge bg-primary">${this.escapeHtml(item.framework)}</span>
                            </td>
                            <td data-label="Applicability">
                                <select class="form-select form-select-sm soa-app">
                                    <option value="Applicable" ${item.applicability === 'Applicable' ? 'selected' : ''}>Applicable</option>
                                    <option value="Not Applicable" ${item.applicability === 'Not Applicable' ? 'selected' : ''}>Not Applicable</option>
                                </select>
                            </td>
                            <td data-label="Implementation">
                                <select class="form-select form-select-sm soa-impl">
                                    <option value="Implemented" ${item.implementation === 'Implemented' ? 'selected' : ''}>Implemented</option>
                                    <option value="Planned" ${item.implementation === 'Planned' ? 'selected' : ''}>Planned</option>
                                    <option value="Not Implemented" ${item.implementation === 'Not Implemented' ? 'selected' : ''}>Not Implemented</option>
                                </select>
                                <div class="mt-1"><span class="badge bg-${implBadge}">${this.escapeHtml(item.implementation)}</span></div>
                            </td>
                            <td data-label="Rationale">
                                <textarea class="form-control form-control-sm soa-rat" rows="2" placeholder="Why applicable / not applicable...">${this.escapeHtml(item.rationale || '')}</textarea>
                                <input class="form-control form-control-sm mt-2 soa-owner" placeholder="Owner (optional)" value="${this.escapeHtml(item.owner || '')}">
                            </td>
                            <td data-label="Evidence">
                                <textarea class="form-control form-control-sm soa-evd" rows="2" placeholder="URLs, ticket IDs, policies, screenshots...">${this.escapeHtml(item.evidence || '')}</textarea>
                                <div class="small text-muted mt-1">Autosaved locally</div>
                            </td>
                        </tr>
                    `;
                }).join('');

                const upsert = (key, patch) => {
                    const [fw, id] = key.split('||');
                    const arr = Array.isArray(this.data.soa) ? [...this.data.soa] : [];
                    const idx = arr.findIndex(r => (r.key || `${r.framework}||${r.id}`) === key);
                    const base = {
                        key,
                        framework: fw,
                        id,
                        applicability: 'Applicable',
                        implementation: 'Not Implemented',
                        owner: '',
                        rationale: '',
                        evidence: '',
                        updatedAt: new Date().toISOString()
                    };
                    const next = { ...(idx >= 0 ? arr[idx] : base), ...patch, updatedAt: new Date().toISOString() };
                    if (idx >= 0) arr[idx] = next;
                    else arr.push(next);
                    this.saveData('soa', arr);
                };

                // bind once (delegated)
                if (!this._soaBound) {
                    tableBody.addEventListener('change', (e) => {
                        const tr = e.target.closest('tr[data-soa-key]');
                        if (!tr) return;
                        const key = tr.getAttribute('data-soa-key');
                        if (e.target.classList.contains('soa-app')) upsert(key, { applicability: e.target.value });
                        if (e.target.classList.contains('soa-impl')) upsert(key, { implementation: e.target.value });
                    });

                    let t;
                    tableBody.addEventListener('input', (e) => {
                        const tr = e.target.closest('tr[data-soa-key]');
                        if (!tr) return;
                        const key = tr.getAttribute('data-soa-key');
                        clearTimeout(t);
                        t = setTimeout(() => {
                            const rat = tr.querySelector('.soa-rat')?.value || '';
                            const evd = tr.querySelector('.soa-evd')?.value || '';
                            const owner = tr.querySelector('.soa-owner')?.value || '';
                            upsert(key, { rationale: rat, evidence: evd, owner });
                        }, 220);
                    });

                    this._soaBound = true;
                }
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            // ===== REPORTS =====
            renderReports() {
                // Initialize report preview
                document.getElementById('reportContent').textContent = 
                    'Select a report type and click Generate to create a report.';
            }

            generateReport() {
                const reportType = document.getElementById('reportType')?.value || 'executive';
                let reportContent = '';
                let reportTitle = '';
                
                switch(reportType) {
                    case 'executive':
                        reportTitle = 'Executive Summary Report';
                        reportContent = this.generateExecutiveReport();
                        break;
                    case 'risk':
                        reportTitle = 'Risk Register Report';
                        reportContent = this.generateRiskReport();
                        break;
                    case 'compliance':
                        reportTitle = 'Compliance Gap Report';
                        reportContent = this.generateComplianceReport();
                        break;
                    case 'vendor':
                        reportTitle = 'Vendor Risk Report';
                        reportContent = this.generateVendorReport();
                        break;
                    case 'incident':
                        reportTitle = 'Incident Report';
                        reportContent = this.generateIncidentReport();
                        break;
                }
                
                document.getElementById('reportTitle').textContent = reportTitle;
                document.getElementById('reportContent').textContent = reportContent;
                this.showToast(`${reportTitle} generated successfully`, 'success');
            }

            generateExecutiveReport() {
                const totalRisks = this.data.risks.length;
                const highRisks = this.data.risks.filter(r => r.severity === 'High').length;
                const mediumRisks = this.data.risks.filter(r => r.severity === 'Medium').length;
                const implementedControls = this.data.controls.filter(c => c.status === 'Implemented').length;
                const totalControls = this.data.controls.length;
                const complianceRate = totalControls > 0 ? Math.round((implementedControls / totalControls) * 100) : 0;
                
                return `EXECUTIVE SUMMARY REPORT
Generated: ${new Date().toLocaleDateString()}

OVERVIEW
--------
Total Assets: ${this.data.assets.length}
Total Risks: ${totalRisks}
Total Controls: ${totalControls}
Compliance Rate: ${complianceRate}%

RISK SUMMARY
------------
• High Risks: ${highRisks}
• Medium Risks: ${mediumRisks}
• Low Risks: ${totalRisks - highRisks - mediumRisks}

TOP RISKS
---------
${this.data.risks
    .sort((a, b) => b.score - a.score)
    .slice(0, 5)
    .map((risk, i) => `${i + 1}. ${risk.title} (Score: ${risk.score}, Severity: ${risk.severity})`)
    .join('\n')}

RECOMMENDATIONS
---------------
1. Address high-risk items immediately
2. Implement planned controls
3. Regular risk assessments
4. Continuous monitoring

NEXT STEPS
----------
• Review and update risk register
• Implement control improvements
• Schedule next assessment
• Report to stakeholders`;
            }

            generateRiskReport() {
                return `RISK REGISTER REPORT
Generated: ${new Date().toLocaleDateString()}

TOTAL RISKS: ${this.data.risks.length}

RISK DETAILS
------------
${this.data.risks.map(risk => `
RISK: ${risk.title}
ID: ${risk.id}
Category: ${risk.category}
Severity: ${risk.severity} (Score: ${risk.score})
Status: ${risk.status}
Owner: ${risk.owner || 'Not assigned'}
Due Date: ${risk.dueDate || 'Not set'}
Description: ${risk.description || 'No description'}

`).join('---\n')}`;
            }

            copyReport() {
                const reportContent = document.getElementById('reportContent').textContent;
                navigator.clipboard.writeText(reportContent)
                    .then(() => this.showToast('Report copied to clipboard', 'success'))
                    .catch(() => this.showToast('Failed to copy report', 'error'));
            }

            exportReport() {
                const reportContent = document.getElementById('reportContent').textContent;
                const reportTitle = document.getElementById('reportTitle').textContent;
                
                const blob = new Blob([reportContent], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${reportTitle.toLowerCase().replace(/ /g, '_')}_${new Date().toISOString().slice(0,10)}.txt`;
                a.click();
                URL.revokeObjectURL(url);
                
                this.showToast('Report exported successfully', 'success');
            }

            // ===== CHALLENGES =====
            renderChallenges() {
                // Update challenge statuses
                this.updateChallengeStatus(1);
                this.updateChallengeStatus(2);
                this.updateChallengeStatus(3);
                this.updateChallengeStatus(4);
                
                // Calculate total points
                const totalPoints = Object.values(this.data.challenges.scores || {}).reduce((a, b) => a + b, 0);
                document.getElementById('totalPoints').textContent = totalPoints;
                
                // Update progress bar
                const progressBar = document.querySelector('.progress-bar');
                if (progressBar) {
                    const progress = Math.min(100, (totalPoints / 850) * 100); // 850 = max points
                    progressBar.style.width = `${progress}%`;
                }
            }

            updateChallengeStatus(challengeId) {
                const statusElement = document.getElementById(`challenge${challengeId}Status`);
                if (!statusElement) return;
                
                const progress = this.data.challenges.progress?.[challengeId] || {};
                const score = this.data.challenges.scores?.[challengeId] || 0;
                
                if (score > 0) {
                    statusElement.textContent = `Completed (${score} pts)`;
                    statusElement.className = 'text-success';
                } else if (Object.keys(progress).length > 0) {
                    statusElement.textContent = 'In Progress';
                    statusElement.className = 'text-warning';
                } else {
                    statusElement.textContent = 'Not Started';
                    statusElement.className = 'text-muted';
                }
            }

            startChallenge(challengeId) {
                this.switchTab('dashboard');
                this.showToast(`Starting Challenge ${challengeId}...`, 'info');
                
                // Set initial progress
                if (!this.data.challenges.progress) this.data.challenges.progress = {};
                if (!this.data.challenges.progress[challengeId]) {
                    this.data.challenges.progress[challengeId] = { started: new Date().toISOString() };
                }
                
                this.saveData('challenges', this.data.challenges);
                
                // Auto-load demo data for challenge 1
                if (challengeId === 1 && this.data.assets.length === 0) {
                    setTimeout(() => {
                        if (confirm('Load demo data for this challenge?')) {
                            this.loadDemoScenario();
                        }
                    }, 1000);
                }
            }

            resetChallenges() {
                if (confirm('Reset all challenge progress? This cannot be undone.')) {
                    this.data.challenges = { progress: {}, scores: {} };
                    this.saveData('challenges', this.data.challenges);
                    this.renderChallenges();
                    this.showToast('Challenge progress reset', 'info');
                }
            }

            // ===== DATA MANAGEMENT =====
            loadDemoScenario() {
                if (!confirm('Load demo scenario? This will replace your current data.')) {
                    return;
                }

                // Load comprehensive demo data
                this.data.assets = [
                    {
                        id: 'AST_001',
                        name: 'Customer Database',
                        type: 'Database',
                        criticality: 'High',
                        owner: 'IT Department',
                        description: 'Primary customer information database containing PII and financial data.',
                        dataTypes: ['PII', 'Financial'],
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    },
                    {
                        id: 'AST_002',
                        name: 'Web Application',
                        type: 'Application',
                        criticality: 'High',
                        owner: 'Development Team',
                        description: 'Customer-facing web portal for account management.',
                        dataTypes: ['PII', 'Credentials'],
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    },
                    {
                        id: 'AST_003',
                        name: 'Internal File Server',
                        type: 'Server',
                        criticality: 'Medium',
                        owner: 'IT Operations',
                        description: 'File server for internal documents and collaboration.',
                        dataTypes: ['Internal'],
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    }
                ];

                this.data.vendors = [
                    {
                        id: 'VDR_001',
                        name: 'Cloud Provider Inc.',
                        serviceType: 'Cloud Services',
                        riskLevel: 'Medium',
                        contractStatus: 'Active',
                        nextReviewDate: new Date(Date.now() + 180 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                        compliance: 'Compliant',
                        description: 'Primary cloud infrastructure provider for production workloads.',
                        contact: 'John Smith - Account Manager',
                        email: 'john.smith@cloudprovider.com',
                        assessment: 'Annual security assessment completed. Minor findings addressed.',
                        hasSLA: true,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    }
                ];

                this.data.risks = [
                    {
                        id: 'RISK_001',
                        title: 'Data Breach via SQL Injection',
                        category: 'Cybersecurity',
                        status: 'Open',
                        likelihood: 4,
                        impact: 5,
                        score: 20,
                        severity: 'High',
                        description: 'Potential SQL injection vulnerability in web application could lead to data breach.',
                        owner: 'CISO',
                        dueDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                        mitigation: 'Implement WAF and regular security testing.',
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    },
                    {
                        id: 'RISK_002',
                        title: 'Insider Data Theft',
                        category: 'People',
                        status: 'In Progress',
                        likelihood: 3,
                        impact: 4,
                        score: 12,
                        severity: 'Medium',
                        description: 'Unauthorized access by privileged users could lead to data theft.',
                        owner: 'HR Director',
                        dueDate: new Date(Date.now() + 45 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                        mitigation: 'Implement privileged access management and monitoring.',
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    },
                    {
                        id: 'RISK_003',
                        title: 'Ransomware Attack',
                        category: 'Cybersecurity',
                        status: 'Open',
                        likelihood: 4,
                        impact: 4,
                        score: 16,
                        severity: 'High',
                        description: 'Ransomware could encrypt critical systems and data.',
                        owner: 'Security Team',
                        dueDate: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                        mitigation: 'Implement endpoint protection and backup strategy.',
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    }
                ];

                this.data.controls = [
                    {
                        id: 'CTL_001',
                        name: 'Multi-Factor Authentication',
                        type: 'Technical',
                        status: 'Implemented',
                        framework: 'ISO 27001',
                        owner: 'Security Team',
                        implementationDate: new Date().toISOString().split('T')[0],
                        description: 'MFA enforced for all administrative accounts.',
                        evidence: 'Okta dashboard configuration

                                                evidence: 'Okta dashboard configuration',
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    },
                    {
                        id: 'CTL_002',
                        name: 'Web Application Firewall',
                        type: 'Technical',
                        status: 'Implemented',
                        framework: 'ISO 27001',
                        owner: 'Network Team',
                        implementationDate: new Date().toISOString().split('T')[0],
                        description: 'WAF protecting all web applications.',
                        evidence: 'Cloudflare WAF logs',
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    },
                    {
                        id: 'CTL_003',
                        name: 'Security Awareness Training',
                        type: 'Administrative',
                        status: 'Planned',
                        framework: 'ISO 27001',
                        owner: 'HR Department',
                        implementationDate: new Date(Date.now() + 14 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                        description: 'Quarterly security awareness training for all employees.',
                        evidence: 'Training schedule and materials',
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    }
                ];

                this.data.issues = [
                    {
                        id: 'ISS_001',
                        title: 'Missing encryption on backup storage',
                        source: 'Audit',
                        severity: 'High',
                        status: 'Open',
                        dueDate: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                        owner: 'Storage Team',
                        assetId: 'AST_003',
                        description: 'Backup storage does not have encryption at rest enabled, exposing sensitive data.',
                        remediation: 'Enable AES-256 encryption on all backup storage volumes.',
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    }
                ];

                this.data.incidents = [
                    {
                        id: 'INC_001',
                        title: 'Phishing campaign targeting finance department',
                        type: 'Phishing',
                        severity: 'Medium',
                        status: 'Resolved',
                        detected: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().slice(0, 16),
                        owner: 'SOC Team',
                        affectedSystems: ['AST_002'],
                        description: 'Targeted phishing emails sent to finance employees pretending to be from CEO.',
                        response: 'Blocked malicious domains, conducted user awareness training.',
                        lessons: 'Need to implement advanced email filtering and regular phishing simulations.',
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    }
                ];

                this.data.treatments = [
                    {
                        id: 'TRT_001',
                        title: 'Implement MFA for all admin accounts',
                        type: 'Mitigate',
                        riskId: 'RISK_002',
                        status: 'In Progress',
                        owner: 'Security Team',
                        dueDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                        progress: 65,
                        cost: 5000,
                        actions: '1. Evaluate MFA solutions\n2. Configure MFA for admin accounts\n3. Test and deploy\n4. Train users',
                        criteria: 'All admin accounts require MFA for authentication.',
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    }
                ];

                // Save all data
                this.saveData('assets', this.data.assets);
                this.saveData('vendors', this.data.vendors);
                this.saveData('risks', this.data.risks);
                this.saveData('controls', this.data.controls);
                this.saveData('issues', this.data.issues);
                this.saveData('incidents', this.data.incidents);
                this.saveData('treatments', this.data.treatments);

                // Update all views
                this.renderDashboard();
                this.renderRisks();
                this.renderAssets();
                this.renderControls();
                this.renderVendors();
                this.renderIssues();
                this.renderIncidents();
                this.renderTreatments();
                this.renderFrameworks();
                this.renderRiskMatrix();
                this.renderSOA();
                
                this.showToast('Demo scenario loaded successfully!', 'success');
            }

            exportAllData() {
                const exportData = {
                    version: this.version,
                    exportedAt: new Date().toISOString(),
                    data: this.data,
                    frameworks: this.frameworks
                };

                const dataStr = JSON.stringify(exportData, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `grc_lab_export_${new Date().toISOString().slice(0,10)}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                document.body.appendChild(linkElement);
                linkElement.click();
                document.body.removeChild(linkElement);
                
                this.showToast('All data exported successfully', 'success');
            }

            importData(event) {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        
                        // Validate and merge data
                        if (importedData.data) {
                            Object.keys(importedData.data).forEach(key => {
                                if (this.data.hasOwnProperty(key)) {
                                    this.data[key] = importedData.data[key];
                                    this.saveData(key, this.data[key]);
                                }
                            });
                        }
                        
                        // Update all views
                        this.renderDashboard();
                        this.renderRisks();
                        this.renderAssets();
                        this.renderControls();
                        this.renderVendors();
                        this.renderIssues();
                        this.renderIncidents();
                        this.renderTreatments();
                        this.renderFrameworks();
                        this.renderRiskMatrix();
                        this.renderSOA();
                        
                        this.showToast('Data imported successfully', 'success');
                    } catch (error) {
                        this.showToast('Error importing data. Invalid file format.', 'error');
                    }
                };
                reader.readAsText(file);
            }

            // ===== UTILITIES =====
            deleteItem(type, id) {
                if (!confirm(`Are you sure you want to delete this ${type}?`)) return;
                
                let collection = this.data[type + 's'];
                if (collection) {
                    this.data[type + 's'] = collection.filter(item => item.id !== id);
                    this.saveData(type + 's', this.data[type + 's']);
                    
                    // Update UI
                    this.renderDashboard();
                    if (this.currentTab === type + 's') {
                        this.renderTabContent(this.currentTab);
                    }
                    
                    this.showToast(`${type} deleted successfully`, 'info');
                }
            }

            showToast(message, type = 'info') {
                const toastEl = document.getElementById('liveToast');
                const toastMessage = document.getElementById('toastMessage');
                
                if (!toastEl || !toastMessage) return;
                
                // Set message
                toastMessage.textContent = message;
                
                // Set color based on type
                toastEl.className = 'toast';
                switch(type) {
                    case 'success':
                        toastEl.classList.add('bg-success', 'text-white');
                        break;
                    case 'error':
                        toastEl.classList.add('bg-danger', 'text-white');
                        break;
                    case 'warning':
                        toastEl.classList.add('bg-warning', 'text-dark');
                        break;
                    default:
                        toastEl.classList.add('bg-info', 'text-white');
                }
                
                // Show toast
                const toast = new bootstrap.Toast(toastEl, { delay: 3000 });
                toast.show();
            }

            showFirstTimeSetup() {
                const setupHTML = `
                    <div class="modal fade" id="firstTimeModal" tabindex="-1">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content bg-dark border border-light">
                                <div class="modal-header">
                                    <h5 class="modal-title">Welcome to GRC Practice Lab! 👋</h5>
                                </div>
                                <div class="modal-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="card-glass mb-3">
                                                <h6><i class="bi bi-rocket-takeoff me-2"></i> Quick Start</h6>
                                                <p>Load the demo scenario to see how the lab works with sample data.</p>
                                                <button class="btn btn-sm btn-primary w-100" onclick="app.loadDemoScenario(); safeHideModal('firstTimeModal');">
                                                    Load Demo
                                                </button>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="card-glass mb-3">
                                                <h6><i class="bi bi-plus-circle me-2"></i> Start Fresh</h6>
                                                <p>Begin with a clean slate and add your own data from scratch.</p>
                                                <button class="btn btn-sm btn-outline-light w-100" data-bs-dismiss="modal">
                                                    Start Fresh
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="alert alert-info bg-dark border-info mt-3">
                                        <h6><i class="bi bi-lightbulb me-2"></i> Tips for Getting Started:</h6>
                                        <ol class="mb-0">
                                            <li>Add your organization's assets first</li>
                                            <li>Identify risks for each asset</li>
                                            <li>Implement controls to mitigate risks</li>
                                            <li>Use the Risk Matrix to visualize risk levels</li>
                                            <li>Generate reports for stakeholders</li>
                                        </ol>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <small class="text-muted">This tool runs entirely in your browser. No data is sent to any server.</small>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.insertAdjacentHTML('beforeend', setupHTML);
                const modal = new bootstrap.Modal(document.getElementById('firstTimeModal'));
                modal.show();
            }
        }

        // ===== INITIALIZE APPLICATION =====
        let app;
        document.addEventListener('DOMContentLoaded', () => {
            app = new GRCApplication();
            window.app = app; // Make available globally
            
            // Initialize tooltips
            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });
            
            // File import handler
            document.getElementById('fileInput')?.addEventListener('change', (e) => app.importData(e));
        });

        // ===== GLOBAL HELPER FUNCTIONS =====
        function switchTab(tabName) {
            if (app) app.switchTab(tabName);
        }

        function loadDemoScenario() {
            if (app) app.loadDemoScenario();
        }

        function exportAllData() {
            if (app) app.exportAllData();
        }

        function generateReport() {
            if (app) app.generateReport();
        }

        function copyReport() {
            if (app) app.copyReport();
        }

        function exportReport() {
            if (app) app.exportReport();
        }

        function startChallenge(challengeId) {
            if (app) app.startChallenge(challengeId);
        }

        function resetChallenges() {
            if (app) app.resetChallenges();
        }

        // Make app available globally for inline event handlers
        window.GRCApp = app;
    </script>
</div>

<script>
function resetLabData() {
  const ok = confirm(
    "Reset Lab will clear all demo/entered data stored locally in this browser and reset the dashboard to zeros." +
    "This does NOT remove the built-in framework library." +
    "Continue?"
  );
  if (!ok) return;

  // Prefer the real app instance (covers both const app and window.app)
  const inst = (window.app && typeof window.app.saveData === "function") ? window.app :
              (typeof app !== "undefined" && app && typeof app.saveData === "function" ? app : null);

  // If we can use the app instance, clear datasets and persist empties using its own storage prefix.
  if (inst) {
    inst.data.assets = [];
    inst.data.vendors = [];
    inst.data.risks = [];
    inst.data.controls = [];
    inst.data.issues = [];
    inst.data.incidents = [];
    inst.data.treatments = [];
    inst.data.soa = [];
    inst.saveData("assets", inst.data.assets);
    inst.saveData("vendors", inst.data.vendors);
    inst.saveData("risks", inst.data.risks);
    inst.saveData("controls", inst.data.controls);
    inst.saveData("issues", inst.data.issues);
    inst.saveData("incidents", inst.data.incidents);
    inst.saveData("treatments", inst.data.treatments);
    inst.saveData("soa", inst.data.soa);
    inst.saveData("challenges", { progress: {}, scores: {} });
    inst.saveData("firstRun", true);

    // Also wipe any other keys under the app's prefix to guarantee demo data is gone
    const prefix = inst.storagePrefix || "grc_lab_v2_";
    Object.keys(localStorage).forEach(k => {
      if (k.startsWith(prefix) && !k.endsWith("firstRun")) localStorage.removeItem(k);
    });

    // Re-render dashboard immediately (no reload required)
    try { if (typeof inst.renderDashboard === "function") inst.renderDashboard(); } catch(e){}
    try { if (typeof inst.switchTab === "function") inst.switchTab("dashboard"); } catch(e){}
    if (typeof inst.showToast === "function") inst.showToast("Lab reset complete. Dashboard cleared.", "success");

    // Force a reload to ensure all tabs and UI fully reflect the changes (added for reliability)
    setTimeout(() => location.reload(), 500);  // Short delay to allow toast to show
    return;
  }

  // Fallback: clear likely keys and reload
  Object.keys(localStorage).forEach(key => {
    if (key.startsWith("grc_lab_v2_")) localStorage.removeItem(key);
  });
  // keep onboarding from re-triggering endlessly
  localStorage.setItem("grc_lab_v2_firstRun", "true");
  alert("Lab reset complete. Reloading…");
  location.reload();
}
</script>

<script>
function cleanupStuckModalUI(){
  try{
    document.querySelectorAll('.modal-backdrop').forEach(b => b.remove());
    document.body.classList.remove('modal-open');
    document.body.style.removeProperty('padding-right');
    document.documentElement.style.removeProperty('overflow');
    document.body.style.removeProperty('overflow');
  }catch(e){}
}
window.addEventListener('DOMContentLoaded', cleanupStuckModalUI);
document.addEventListener('hidden.bs.modal', cleanupStuckModalUI);
document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') cleanupStuckModalUI(); });
</script>


<script>
(function(){
  function hardCleanup(){
    try{
      document.querySelectorAll('.modal-backdrop').forEach(b=>b.remove());
      document.body.classList.remove('modal-open');
      document.body.style.removeProperty('padding-right');
      document.documentElement.style.removeProperty('overflow');
      document.body.style.removeProperty('overflow');
    }catch(e){}
  }
  // run often for safety
  window.addEventListener('click', hardCleanup, true);
  window.setInterval(hardCleanup, 1500);
})();
</script>

</body>
</html>
