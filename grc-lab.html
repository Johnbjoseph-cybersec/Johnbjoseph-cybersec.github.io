<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>GRC Practice Lab | Cyber Readiness Assessment</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Styles -->
    <style>
        :root {
            --bg0:#070A12;
            --bg1:#0B1226;
            --card: rgba(255,255,255,.06);
            --card2: rgba(255,255,255,.085);
            --stroke: rgba(255,255,255,.10);
            --text: rgba(255,255,255,.92);
            --muted: rgba(255,255,255,.62);
            --muted2: rgba(255,255,255,.44);
            --brand:#7C3AED;
            --brand2:#22D3EE;
            --good:#34D399;
            --warn:#FBBF24;
            --bad:#FB7185;
            --shadow: 0 24px 70px rgba(0,0,0,.55);
            --shadow2: 0 14px 40px rgba(0,0,0,.35);
            --radius: 12px;
            --radius2: 16px;
            --ease: cubic-bezier(.2,.8,.2,1);
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html, body { height: 100%; }
        
        body {
            margin: 0;
            font-family: 'Manrope', system-ui, sans-serif;
            color: var(--text);
            background:
                radial-gradient(1200px 800px at 20% 10%, rgba(124,58,237,.28), transparent 60%),
                radial-gradient(900px 600px at 80% 20%, rgba(34,211,238,.18), transparent 55%),
                radial-gradient(800px 600px at 50% 90%, rgba(251,113,133,.12), transparent 55%),
                linear-gradient(180deg, var(--bg0), var(--bg1));
            overflow-x: hidden;
            line-height: 1.6;
        }

        /* Subtle animated grid */
        .gridfx {
            position: fixed;
            inset: 0;
            background-image:
                linear-gradient(to right, rgba(255,255,255,.045) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(255,255,255,.045) 1px, transparent 1px);
            background-size: 42px 42px;
            mask-image: radial-gradient(800px 600px at 50% 20%, black 35%, transparent 85%);
            pointer-events: none;
            opacity: .55;
            animation: drift 14s var(--ease) infinite alternate;
        }
        
        @keyframes drift {
            from { transform: translate3d(0,0,0); }
            to { transform: translate3d(0,-14px,0); }
        }

        /* Floating orbs */
        .orb {
            position: fixed;
            width: 520px;
            height: 520px;
            border-radius: 999px;
            filter: blur(18px);
            opacity: .55;
            pointer-events: none;
            mix-blend-mode: screen;
            animation: float 9s var(--ease) infinite alternate;
        }
        
        .orb.one {
            left: -140px;
            top: -140px;
            background: radial-gradient(circle at 35% 30%, rgba(124,58,237,.75), transparent 55%);
        }
        
        .orb.two {
            right: -180px;
            top: 80px;
            background: radial-gradient(circle at 40% 35%, rgba(34,211,238,.55), transparent 60%);
            animation-duration: 11s;
        }
        
        .orb.three {
            left: 40%;
            bottom: -220px;
            background: radial-gradient(circle at 45% 45%, rgba(251,113,133,.45), transparent 62%);
            animation-duration: 13s;
        }
        
        @keyframes float {
            from { transform: translate3d(0,0,0) scale(1); }
            to { transform: translate3d(0,24px,0) scale(1.02); }
        }

        /* Main container */
        .wrap {
            max-width: 1200px;
            margin: 0 auto;
            padding: 28px 24px 60px;
            position: relative;
            width: 100%;
        }

        /* Top Navigation */
        .topbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
            padding: 16px 20px;
            margin-bottom: 24px;
            border-radius: var(--radius2);
            background: rgba(10,14,26,.85);
            border: 1px solid rgba(255,255,255,.12);
            backdrop-filter: blur(20px);
            box-shadow: 0 10px 40px rgba(0,0,0,.45);
        }
        
        .brand {
            display: flex;
            align-items: center;
            gap: 14px;
            user-select: none;
        }
        
        .logo {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            background: conic-gradient(from 210deg, rgba(124,58,237,.9), rgba(34,211,238,.9), rgba(251,113,133,.7), rgba(124,58,237,.9));
            box-shadow: 0 12px 32px rgba(124,58,237,.3);
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
        }
        
        .logo:after {
            content: "";
            position: absolute;
            inset: -40%;
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.55), transparent 60%);
            transform: rotate(18deg);
        }
        
        .brand-text h1 {
            font-size: 16px;
            margin: 0;
            letter-spacing: .2px;
            line-height: 1.2;
            font-weight: 700;
        }
        
        .brand-text .sub {
            font-size: 12.5px;
            color: var(--muted);
            margin-top: 4px;
            line-height: 1.3;
        }
        
        .actions {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: flex-end;
        }
        
        .pill {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            border-radius: 999px;
            background: rgba(255,255,255,.07);
            border: 1px solid rgba(255,255,255,.12);
            color: var(--text);
            cursor: pointer;
            transition: all .2s var(--ease);
            user-select: none;
            font-size: 13px;
            font-weight: 600;
            white-space: nowrap;
        }
        
        .pill:hover {
            transform: translateY(-2px);
            background: rgba(255,255,255,.1);
            border-color: rgba(255,255,255,.18);
            box-shadow: 0 8px 24px rgba(0,0,0,.3);
        }
        
        .pill:active {
            transform: translateY(0px) scale(.98);
        }
        
        .pill.primary {
            background: linear-gradient(135deg, rgba(124,58,237,.92), rgba(34,211,238,.65));
            border: 1px solid rgba(255,255,255,.15);
            box-shadow: 0 12px 32px rgba(124,58,237,.3);
        }
        
        .pill.danger {
            background: rgba(251,113,133,.12);
            border-color: rgba(251,113,133,.22);
        }

        /* Main Container */
        .main-container {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        /* Hero Section */
        .hero-grid {
            display: grid;
            grid-template-columns: 1.1fr 0.9fr;
            gap: 24px;
            align-items: start;
        }
        
        @media (max-width: 900px) {
            .hero-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .card {
            background: var(--card);
            border: 1px solid var(--stroke);
            border-radius: var(--radius2);
            box-shadow: var(--shadow2);
            backdrop-filter: blur(16px);
            overflow: hidden;
            position: relative;
            height: 100%;
        }
        
        .card .inner {
            padding: 28px;
            position: relative;
            z-index: 1;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .glow {
            position: absolute;
            inset: -1px;
            z-index: 0;
            pointer-events: none;
            background:
                radial-gradient(700px 380px at 20% 15%, rgba(124,58,237,.20), transparent 55%),
                radial-gradient(650px 360px at 90% 30%, rgba(34,211,238,.14), transparent 55%);
            opacity: .95;
        }
        
        .hero-title {
            font-size: 28px;
            margin: 0 0 12px;
            letter-spacing: -.4px;
            line-height: 1.1;
            font-weight: 800;
        }
        
        .hero-title .grad {
            background: linear-gradient(90deg, rgba(255,255,255,.95), rgba(34,211,238,.85), rgba(124,58,237,.95));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .hero-desc {
            margin: 0 0 20px;
            color: var(--muted);
            font-size: 14px;
            line-height: 1.6;
            flex-grow: 1;
        }
        
        .chip-row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        
        .chip {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 14px;
            border-radius: 999px;
            background: rgba(255,255,255,.07);
            border: 1px solid rgba(255,255,255,.12);
            color: rgba(255,255,255,.86);
            font-size: 12.5px;
            font-weight: 500;
        }
        
        .meta-grid {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 14px;
            margin-bottom: 20px;
        }
        
        .meta {
            padding: 16px;
            border-radius: 18px;
            background: rgba(255,255,255,.06);
            border: 1px solid rgba(255,255,255,.1);
        }
        
        .meta .k {
            color: var(--muted2);
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 6px;
        }
        
        .meta .v {
            font-weight: 700;
            font-size: 16px;
            letter-spacing: .2px;
            color: var(--text);
        }
        
        .info-card {
            border-radius: var(--radius);
            background: rgba(255,255,255,.05);
            border: 1px solid rgba(255,255,255,.1);
            padding: 18px;
            margin-bottom: 20px;
        }
        
        .info-card .title {
            font-weight: 700;
            font-size: 14px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .info-card .content {
            color: var(--muted);
            font-size: 13px;
            line-height: 1.6;
        }

        /* Tab Navigation */
        .tab-nav {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding: 16px 0;
            margin-bottom: 20px;
            scrollbar-width: thin;
        }
        
        .tab-nav::-webkit-scrollbar {
            height: 4px;
        }
        
        .tab-nav::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,.2);
            border-radius: 2px;
        }
        
        .tab-btn {
            background: rgba(255,255,255,.07);
            border: 1px solid rgba(255,255,255,.12);
            color: rgba(255,255,255,.86);
            padding: 12px 20px;
            border-radius: 14px;
            font-weight: 600;
            white-space: nowrap;
            cursor: pointer;
            transition: all .2s var(--ease);
        }
        
        .tab-btn:hover {
            background: rgba(255,255,255,.1);
            border-color: rgba(255,255,255,.18);
            transform: translateY(-2px);
        }
        
        .tab-btn.active {
            background: linear-gradient(135deg, rgba(124,58,237,.92), rgba(34,211,238,.65));
            border-color: rgba(255,255,255,.18);
            box-shadow: 0 8px 24px rgba(124,58,237,.25);
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Buttons */
        .btn-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 20px;
            border-radius: 14px;
            border: 1px solid rgba(255,255,255,.12);
            background: rgba(255,255,255,.07);
            color: rgba(255,255,255,.9);
            cursor: pointer;
            transition: all .2s var(--ease);
            user-select: none;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            font-weight: 600;
            text-decoration: none;
            white-space: nowrap;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            background: rgba(255,255,255,.1);
            border-color: rgba(255,255,255,.18);
            box-shadow: 0 8px 24px rgba(0,0,0,.3);
        }
        
        .btn:active {
            transform: translateY(0px) scale(.98);
        }
        
        .btn.primary {
            background: linear-gradient(135deg, rgba(124,58,237,.92), rgba(34,211,238,.65));
            border-color: rgba(255,255,255,.18);
            box-shadow: 0 12px 32px rgba(124,58,237,.3);
            font-weight: 700;
        }
        
        .btn.small {
            padding: 10px 16px;
            font-size: 13px;
        }

        /* Tables */
        .table-container {
            border-radius: var(--radius2);
            overflow: hidden;
            border: 1px solid var(--stroke);
            background: var(--card);
        }
        
        .table-header {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr 1fr 1fr;
            padding: 16px 20px;
            background: rgba(255,255,255,.05);
            border-bottom: 1px solid var(--stroke);
            font-weight: 700;
            font-size: 14px;
        }
        
        .table-row {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr 1fr 1fr;
            padding: 16px 20px;
            border-bottom: 1px solid var(--stroke);
            transition: background-color .2s var(--ease);
        }
        
        .table-row:hover {
            background: rgba(255,255,255,.03);
        }
        
        .table-row:last-child {
            border-bottom: none;
        }
        
        .table-cell {
            padding: 4px 0;
            display: flex;
            align-items: center;
        }
        
        /* Control Status Badges */
        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 6px 12px;
            border-radius: 999px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-implemented {
            background: rgba(52,211,153,.15);
            color: #34D399;
            border: 1px solid rgba(52,211,153,.3);
        }
        
        .status-planned {
            background: rgba(251,191,36,.15);
            color: #FBBF24;
            border: 1px solid rgba(251,191,36,.3);
        }
        
        .status-not-implemented {
            background: rgba(239,68,68,.15);
            color: #EF4444;
            border: 1px solid rgba(239,68,68,.3);
        }
        
        /* Framework Badges */
        .framework-badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            margin: 2px;
        }
        
        .badge-iso {
            background: rgba(59,130,246,.15);
            color: #93c5fd;
            border: 1px solid rgba(59,130,246,.3);
        }
        
        .badge-nist {
            background: rgba(16,185,129,.15);
            color: #6ee7b7;
            border: 1px solid rgba(16,185,129,.3);
        }
        
        .badge-pci {
            background: rgba(245,158,11,.15);
            color: #fcd34d;
            border: 1px solid rgba(245,158,11,.3);
        }
        
        .badge-hipaa {
            background: rgba(236,72,153,.15);
            color: #f9a8d4;
            border: 1px solid rgba(236,72,153,.3);
        }
        
        .badge-soc2 {
            background: rgba(139,92,246,.15);
            color: #c4b5fd;
            border: 1px solid rgba(139,92,246,.3);
        }

        /* Search and Filter */
        .search-filter {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .search-box {
            flex: 1;
            padding: 12px 16px;
            border-radius: 14px;
            background: rgba(255,255,255,.07);
            border: 1px solid rgba(255,255,255,.12);
            color: var(--text);
            font-size: 14px;
        }
        
        .filter-select {
            padding: 12px 16px;
            border-radius: 14px;
            background: rgba(255,255,255,.07);
            border: 1px solid rgba(255,255,255,.12);
            color: var(--text);
            font-size: 14px;
            min-width: 150px;
        }

        /* SoA Editor */
        .soa-editor {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-top: 24px;
        }
        
        @media (max-width: 900px) {
            .soa-editor {
                grid-template-columns: 1fr;
            }
        }
        
        .soa-list {
            max-height: 600px;
            overflow-y: auto;
            border-radius: var(--radius2);
            border: 1px solid var(--stroke);
            background: var(--card);
        }
        
        .soa-item {
            padding: 16px 20px;
            border-bottom: 1px solid var(--stroke);
            cursor: pointer;
            transition: background-color .2s var(--ease);
        }
        
        .soa-item:hover {
            background: rgba(255,255,255,.03);
        }
        
        .soa-item.active {
            background: rgba(124,58,237,.1);
            border-left: 3px solid var(--brand);
        }
        
        .soa-detail {
            border-radius: var(--radius2);
            border: 1px solid var(--stroke);
            background: var(--card);
            padding: 24px;
        }
        
        .soa-detail h3 {
            margin-bottom: 16px;
            color: var(--text);
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--muted);
            font-size: 14px;
            font-weight: 600;
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px 16px;
            border-radius: 14px;
            background: rgba(255,255,255,.07);
            border: 1px solid rgba(255,255,255,.12);
            color: var(--text);
            font-size: 14px;
        }
        
        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .wrap {
                padding: 20px 16px 40px;
            }
            
            .topbar {
                flex-direction: column;
                align-items: stretch;
                gap: 16px;
                padding: 16px;
            }
            
            .actions {
                justify-content: flex-start;
            }
            
            .hero-title {
                font-size: 24px;
            }
            
            .hero-desc {
                font-size: 13px;
            }
            
            .table-header, .table-row {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            .table-cell:before {
                content: attr(data-label);
                font-weight: 600;
                color: var(--muted);
                font-size: 12px;
                margin-right: 8px;
                min-width: 100px;
            }
        }
    </style>
</head>
<body>
    <!-- Background Effects -->
    <div class="gridfx"></div>
    <div class="orb one"></div>
    <div class="orb two"></div>
    <div class="orb three"></div>

    <div class="wrap">
        <!-- Top Navigation -->
        <nav class="topbar">
            <div class="brand">
                <div class="logo" aria-hidden="true"></div>
                <div class="brand-text">
                    <h1>GRC Practice Lab</h1>
                    <div class="sub">ISO 27001 ‚Ä¢ NIST CSF ‚Ä¢ PCI DSS ‚Ä¢ HIPAA ‚Ä¢ SOC 2 ‚Ä¢ 125+ Controls</div>
                </div>
            </div>
            <div class="actions">
                <div class="pill" id="pillStatus" title="Auto-saved locally in your browser">
                    <div>
                        <div style="font-weight:800;font-size:12px;line-height:1.1">Auto-saved</div>
                        <div class="hint" id="saveHint">Local storage</div>
                    </div>
                </div>
                <div class="pill" id="btnExport">
                    <span style="font-weight:800;font-size:13px">Export JSON</span>
                </div>
                <div class="pill" id="btnPrint">
                    <span style="font-weight:800;font-size:13px">Print / PDF</span>
                </div>
                <div class="pill danger" id="btnReset">
                    <span style="font-weight:800;font-size:13px">Reset All</span>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-container">
            <!-- Hero Section -->
            <div class="hero-grid">
                <!-- Left Card: Introduction -->
                <div class="card">
                    <div class="glow"></div>
                    <div class="inner">
                        <h2 class="hero-title"><span class="grad">GRC Practice Lab</span></h2>
                        <p class="hero-desc">
                            A comprehensive Governance, Risk & Compliance simulation environment with 125+ controls from major frameworks.
                            Practice control implementation, create Statements of Applicability, and manage compliance workflows.
                        </p>
                        
                        <div class="chip-row">
                            <span class="chip">ISO 27001:2022 Annex A</span>
                            <span class="chip">NIST CSF 2.0</span>
                            <span class="chip">PCI DSS v4.0</span>
                            <span class="chip">HIPAA Security Rule</span>
                            <span class="chip">SOC 2 Trust Criteria</span>
                        </div>

                        <div class="meta-grid">
                            <div class="meta">
                                <div class="k">Total Controls</div>
                                <div class="v" id="totalControls">125</div>
                            </div>
                            <div class="meta">
                                <div class="k">Frameworks</div>
                                <div class="v">5 Major Standards</div>
                            </div>
                        </div>

                        <div class="info-card">
                            <div class="title">What you can practice</div>
                            <div class="content">
                                1) Browse and filter 125+ controls from major compliance frameworks<br/>
                                2) Create and manage Statements of Applicability (SoA)<br/>
                                3) Track control implementation status and evidence<br/>
                                4) Export SoA reports in multiple formats
                            </div>
                        </div>

                        <div class="btn-group">
                            <button class="btn primary large" id="btnLoadDemo">
                                <span>Load Demo SoA</span>
                            </button>
                            <button class="btn large" id="btnStartSoA">
                                <span>Start New SoA</span>
                            </button>
                        </div>
                        
                        <div style="margin-top: 16px; color: var(--muted); font-size: 12.5px; line-height:1.5">
                            <strong>Educational Purpose:</strong> This tool is for GRC practice, portfolio demonstration, and learning about compliance frameworks.
                        </div>
                    </div>
                </div>

                <!-- Right Card: Quick Stats -->
                <div class="card">
                    <div class="glow"></div>
                    <div class="inner">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;">
                            <h3 style="font-size: 18px; font-weight: 700;">Quick Stats</h3>
                            <div class="badge" id="statsBadge">Live</div>
                        </div>
                        
                        <div class="meta-grid">
                            <div class="meta">
                                <div class="k">ISO 27001 Controls</div>
                                <div class="v">37</div>
                            </div>
                            <div class="meta">
                                <div class="k">NIST CSF Controls</div>
                                <div class="v">8</div>
                            </div>
                            <div class="meta">
                                <div class="k">PCI DSS Controls</div>
                                <div class="v">12</div>
                            </div>
                            <div class="meta">
                                <div class="k">HIPAA Controls</div>
                                <div class="v">5</div>
                            </div>
                        </div>
                        
                        <div class="info-card" style="margin-top: auto;">
                            <div class="title">Framework Coverage</div>
                            <div class="content">
                                ‚Ä¢ ISO 27001: Annex A controls (5.1-8.34)<br/>
                                ‚Ä¢ NIST CSF: Identify & Protect categories<br/>
                                ‚Ä¢ PCI DSS: Requirements 1-3<br/>
                                ‚Ä¢ HIPAA: Security Management Process<br/>
                                ‚Ä¢ SOC 2: Common Criteria 1-2
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab Navigation -->
            <div class="tab-nav">
                <button class="tab-btn active" data-tab="controls">
                    <span>Control Library</span>
                </button>
                <button class="tab-btn" data-tab="soa">
                    <span>Statement of Applicability</span>
                </button>
                <button class="tab-btn" data-tab="frameworks">
                    <span>Frameworks</span>
                </button>
                <button class="tab-btn" data-tab="reports">
                    <span>Reports</span>
                </button>
            </div>

            <!-- Tab Contents -->
            <div class="tab-content active" id="tab-controls">
                <div class="card">
                    <div class="glow"></div>
                    <div class="inner">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; flex-wrap: wrap; gap: 16px;">
                            <div>
                                <h3 style="font-size: 20px; font-weight: 700;">Control Library</h3>
                                <p style="color: var(--muted); font-size: 14px; margin-top: 4px;">125+ controls from major compliance frameworks</p>
                            </div>
                            <div class="search-filter">
                                <input type="text" class="search-box" id="controlSearch" placeholder="Search controls by ID, name, or description...">
                                <select class="filter-select" id="frameworkFilter">
                                    <option value="all">All Frameworks</option>
                                    <option value="iso">ISO 27001</option>
                                    <option value="nist">NIST CSF</option>
                                    <option value="pci">PCI DSS</option>
                                    <option value="hipaa">HIPAA</option>
                                    <option value="soc2">SOC 2</option>
                                </select>
                                <select class="filter-select" id="categoryFilter">
                                    <option value="all">All Categories</option>
                                    <option value="Organisational">Organisational</option>
                                    <option value="People">People</option>
                                    <option value="Physical">Physical</option>
                                    <option value="Technological">Technological</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="table-container">
                            <div class="table-header">
                                <div class="table-cell">Control ID</div>
                                <div class="table-cell">Name</div>
                                <div class="table-cell">Category</div>
                                <div class="table-cell">Framework</div>
                                <div class="table-cell">Status</div>
                            </div>
                            <div id="controlTable">
                                <!-- Controls will be populated by JavaScript -->
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px; color: var(--muted); font-size: 13px;">
                            Showing <span id="controlCount">0</span> of 125 controls
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="tab-soa">
                <div class="card">
                    <div class="glow"></div>
                    <div class="inner">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; flex-wrap: wrap; gap: 16px;">
                            <div>
                                <h3 style="font-size: 20px; font-weight: 700;">Statement of Applicability</h3>
                                <p style="color: var(--muted); font-size: 14px; margin-top: 4px;">Select controls and document implementation status</p>
                            </div>
                            <div class="btn-group">
                                <button class="btn primary" id="btnExportSoA">
                                    <span>Export SoA CSV</span>
                                </button>
                                <button class="btn" id="btnResetSoA">
                                    <span>Reset SoA</span>
                                </button>
                            </div>
                        </div>
                        
                        <div class="soa-editor">
                            <div class="soa-list" id="soaList">
                                <!-- SoA items will be populated by JavaScript -->
                            </div>
                            
                            <div class="soa-detail" id="soaDetail">
                                <h3>SoA Editor</h3>
                                <p style="color: var(--muted); margin-bottom: 20px;">Select a control to edit its SoA details</p>
                                <div id="soaFormPlaceholder">
                                    <div style="text-align: center; padding: 40px 0;">
                                        <div style="font-size: 48px; margin-bottom: 16px; opacity: 0.5;">üìù</div>
                                        <p style="color: var(--muted);">Select a control from the list to start editing</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="tab-frameworks">
                <div class="card">
                    <div class="glow"></div>
                    <div class="inner">
                        <h3 style="font-size: 20px; font-weight: 700; margin-bottom: 20px;">Compliance Frameworks</h3>
                        
                        <div class="meta-grid" style="margin-bottom: 30px;">
                            <div class="meta">
                                <div class="k">ISO 27001:2022</div>
                                <div class="v">37 Controls</div>
                                <div style="margin-top: 8px; font-size: 13px; color: var(--muted);">
                                    International standard for information security management
                                </div>
                            </div>
                            <div class="meta">
                                <div class="k">NIST CSF 2.0</div>
                                <div class="v">8 Controls</div>
                                <div style="margin-top: 8px; font-size: 13px; color: var(--muted);">
                                    Cybersecurity Framework by National Institute of Standards
                                </div>
                            </div>
                            <div class="meta">
                                <div class="k">PCI DSS v4.0</div>
                                <div class="v">12 Controls</div>
                                <div style="margin-top: 8px; font-size: 13px; color: var(--muted);">
                                    Payment Card Industry Data Security Standard
                                </div>
                            </div>
                            <div class="meta">
                                <div class="k">HIPAA Security</div>
                                <div class="v">5 Controls</div>
                                <div style="margin-top: 8px; font-size: 13px; color: var(--muted);">
                                    Health Insurance Portability and Accountability Act
                                </div>
                            </div>
                            <div class="meta">
                                <div class="k">SOC 2</div>
                                <div class="v">4 Controls</div>
                                <div style="margin-top: 8px; font-size: 13px; color: var(--muted);">
                                    Service Organization Control 2 - Trust Services Criteria
                                </div>
                            </div>
                        </div>
                        
                        <div class="info-card">
                            <div class="title">Framework Relationships</div>
                            <div class="content">
                                ‚Ä¢ ISO 27001 provides comprehensive ISMS requirements<br/>
                                ‚Ä¢ NIST CSF offers risk-based cybersecurity guidance<br/>
                                ‚Ä¢ PCI DSS focuses on payment card data protection<br/>
                                ‚Ä¢ HIPAA addresses healthcare data security and privacy<br/>
                                ‚Ä¢ SOC 2 covers service organization controls and reporting
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="tab-reports">
                <div class="card">
                    <div class="glow"></div>
                    <div class="inner">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; flex-wrap: wrap; gap: 16px;">
                            <div>
                                <h3 style="font-size: 20px; font-weight: 700;">Reports & Exports</h3>
                                <p style="color: var(--muted); font-size: 14px; margin-top: 4px;">Generate compliance reports and export data</p>
                            </div>
                            <div class="btn-group">
                                <button class="btn primary" id="btnGenerateReport">
                                    <span>Generate Report</span>
                                </button>
                                <button class="btn" id="btnExportAll">
                                    <span>Export All Data</span>
                                </button>
                            </div>
                        </div>
                        
                        <div class="meta-grid" style="margin-bottom: 30px;">
                            <div class="meta">
                                <div class="k">SoA Coverage</div>
                                <div class="v" id="soaCoverage">0%</div>
                                <div style="margin-top: 8px; font-size: 13px; color: var(--muted);">
                                    Controls with SoA documentation
                                </div>
                            </div>
                            <div class="meta">
                                <div class="k">Implemented</div>
                                <div class="v" id="implementedCount">0</div>
                                <div style="margin-top: 8px; font-size: 13px; color: var(--muted);">
                                    Controls marked as implemented
                                </div>
                            </div>
                            <div class="meta">
                                <div class="k">In Progress</div>
                                <div class="v" id="progressCount">0</div>
                                <div style="margin-top: 8px; font-size: 13px; color: var(--muted);">
                                    Controls in progress
                                </div>
                            </div>
                            <div class="meta">
                                <div class="k">Not Started</div>
                                <div class="v" id="notStartedCount">125</div>
                                <div style="margin-top: 8px; font-size: 13px; color: var(--muted);">
                                    Controls not yet addressed
                                </div>
                            </div>
                        </div>
                        
                        <div id="reportPreview" style="background: rgba(255,255,255,.05); border-radius: var(--radius2); padding: 24px; margin-top: 20px;">
                            <h4 style="margin-bottom: 16px;">Report Preview</h4>
                            <pre style="color: var(--muted); font-size: 13px; line-height: 1.6; white-space: pre-wrap;" id="reportContent">
Click "Generate Report" to create a compliance report.
                            </pre>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // ===== DATA =====
        const CONTROLS = [
            // ISO 27001 Controls (37)
            { id: "CTRL-5.1", name: "Policies for information security", category: "Organisational Controls", framework: "iso", status: "not-implemented", description: "Information security policy and topic-specific policies shall be defined, approved by management, published, communicated to and acknowledged by relevant personnel and relevant interested parties, and reviewed at planned intervals and if significant changes occur." },
            { id: "CTRL-5.2", name: "Information security roles and responsibilities", category: "Organisational Controls", framework: "iso", status: "not-implemented", description: "Information security roles and responsibilities shall be defined and allocated according to the organization needs." },
            { id: "CTRL-5.3", name: "Segregation of duties", category: "Organisational Controls", framework: "iso", status: "not-implemented", description: "Conflicting duties and conflicting areas of responsibility shall be segregated." },
            { id: "CTRL-5.4", name: "Management responsibilities", category: "Organisational Controls", framework: "iso", status: "not-implemented", description: "Management shall require all personnel to apply information security in accordance with the established information security policy, topic-specific policies and procedures of the organization." },
            { id: "CTRL-5.5", name: "Contact with authorities", category: "Organisational Controls", framework: "iso", status: "not-implemented", description: "The organization shall establish and maintain contact with relevant authorities." },
            { id: "CTRL-5.6", name: "Contact with special interest groups", category: "Organisational Controls", framework: "iso", status: "not-implemented", description: "The organization shall establish and maintain contact with special interest groups or other specialist security forums and professional associations." },
            { id: "CTRL-5.7", name: "Threat intelligence", category: "Organisational Controls", framework: "iso", status: "not-implemented", description: "Information relating to information security threats shall be collected and analysed to produce threat intelligence." },
            { id: "CTRL-5.8", name: "Information security in project management", category: "Organisational Controls", framework: "iso", status: "not-implemented", description: "Information security shall be integrated into project management." },
            { id: "CTRL-5.9", name: "Inventory of information and other associated assets", category: "Organisational Controls", framework: "iso", status: "not-implemented", description: "An inventory of information and other associated assets, including owners, shall be developed and maintained." },
            { id: "CTRL-5.10", name: "Acceptable use of information and other associated assets", category: "Organisational Controls", framework: "iso", status: "not-implemented", description: "Rules for the acceptable use and procedures for handling information and other associated assets shall be identified, documented and implemented." },
            { id: "CTRL-5.11", name: "Return of assets", category: "Organisational Controls", framework: "iso", status: "not-implemented", description: "Personnel and other interested parties as appropriate shall return all the organization's assets in their possession upon change or termination of their employment, contract or agreement." },
            { id: "CTRL-5.12", name: "Classification of information", category: "Organisational Controls", framework: "iso", status: "not-implemented", description: "Information shall be classified according to the information security needs of the organization based on confidentiality, integrity, availability and relevant interested party requirements." },
            { id: "CTRL-5.13", name: "Labelling of information", category: "Organisational Controls", framework: "iso", status: "not-implemented", description: "An appropriate set of procedures for information labelling shall be developed and implemented in accordance with the information classification scheme adopted by the organization." },
            { id: "CTRL-5.14", name: "Information transfer", category: "Organisational Controls", framework: "iso", status: "not-implemented", description: "Information transfer rules, procedures, or agreements shall be in place for all types of transfer facilities within the organization and between the organization and other parties." },
            { id: "CTRL-5.15", name: "Access control", category: "Organisational Controls", framework: "iso", status: "not-implemented", description: "Rules to control physical and logical access to information and other associated assets shall be established and implemented based on business and information security requirements." },
            { id: "CTRL-5.16", name: "Identity management", category: "Organisational Controls", framework: "iso", status: "not-implemented", description: "The full life cycle of identities shall be managed." },
            { id: "CTRL-5.17", name: "Authentication information", category: "Organisational Controls", framework: "iso", status: "not-implemented", description: "Allocation and management of authentication information shall be controlled by a management process, including advising personnel on appropriate handling of authentication information." },
            { id: "CTRL-5.18", name: "Access rights", category: "Organisational Controls", framework: "iso", status: "not-implemented", description: "Access rights to information and other associated assets shall be provisioned, reviewed, modified and removed in accordance with the organization's topic-specific policy on and rules for access control." },
            { id: "CTRL-5.19", name: "Information security in supplier relationships", category: "Organisational Controls", framework: "iso", status: "not-implemented", description: "Processes and procedures shall be defined and implemented to manage the information security risks associated with the use of supplier's products or services." },
            { id: "CTRL-5.20", name: "Addressing information security within supplier agreements", category: "Organisational Controls", framework: "iso", status: "not-implemented", description: "Relevant information security requirements shall be established and agreed with each supplier based on the type of supplier relationship." },
            { id: "CTRL-5.21", name: "Managing information security in the ICT supply chain", category: "Organisational Controls", framework: "iso", status: "not-implemented", description: "Processes and procedures shall be defined and implemented to manage the information security risks associated with the ICT products and services supply chain." },
            { id: "CTRL-5.22", name: "Monitoring, review and change management of supplier services", category: "Organisational Controls", framework: "iso", status: "not-implemented", description: "The organization shall regularly monitor, review, evaluate and manage change in supplier information security practices." },
            { id: "CTRL-5.23", name: "Information security for use of cloud services", category: "Organisational Controls", framework: "iso", status: "not-implemented", description: "Processes for acquisition, use, management and exit from cloud services shall be established in accordance with the organization's information security requirements." },
            { id: "CTRL-5.24", name: "Information security incident management planning and preparation", category: "Organisational Controls", framework: "iso", status: "not-implemented", description: "The organization shall plan and prepare for managing information security incidents by defining, establishing and communicating information security incident management processes, roles and responsibilities." },
            { id: "CTRL-5.25", name: "Assessment and decision on information security events", category: "Organisational Controls", framework: "iso", status: "not-implemented", description: "The organization shall assess information security events and decide if they are to be categorised as information security incidents." },
            { id: "CTRL-5.26", name: "Response to information security incidents", category: "Organisational Controls", framework: "iso", status: "not-implemented", description: "Information security incidents shall be responded to in accordance with the documented procedures." },
            { id: "CTRL-5.27", name: "Learning from information security incidents", category: "Organisational Controls", framework: "iso", status: "not-implemented", description: "Knowledge gained from information security incidents shall be used to strengthen and improve the information security controls." },
            { id: "CTRL-5.28", name: "Collection of evidence", category: "Organisational Controls", framework: "iso", status: "not-implemented", description: "The organization shall establish and implement procedures for the identification, collection, acquisition and preservation of evidence related to information security events." },
            { id: "CTRL-5.29", name: "Information security during disruption", category: "Organisational Controls", framework: "iso", status: "not-implemented", description: "The organization shall plan how to maintain information security at an appropriate level during disruption." },
            { id: "CTRL-5.30", name: "ICT readiness for business continuity", category: "Organisational Controls", framework: "iso", status: "not-implemented", description: "ICT readiness shall be planned, implemented, maintained and tested based on business continuity objectives and continuity requirements." },
            { id: "CTRL-5.31", name: "Legal, statutory, regulatory and contractual requirements", category: "Organisational Controls", framework: "iso", status: "not-implemented", description: "Legal, statutory, regulatory and contractual requirements relevant to information security and the organization's approach to meet these requirements shall be identified, documented and kept up to date." },
            { id: "CTRL-5.32", name: "Intellectual property rights", category: "Organisational Controls", framework: "iso", status: "not-implemented", description: "The organization shall implement appropriate procedures to protect intellectual property rights." },
            { id: "CTRL-5.33", name: "Protection of records", category: "Organisational Controls", framework: "iso", status: "not-implemented", description: "Records shall be protected from loss, destruction, falsification, unauthorized access and unauthorized release." },
            { id: "CTRL-5.34", name: "Privacy and protection of PII", category: "Organisational Controls", framework: "iso", status: "not-implemented", description: "The organization shall identify and meet the requirements regarding the preservation of privacy and protection of PII according to applicable laws and regulations and contractual requirements." },
            { id: "CTRL-5.35", name: "Independent review of information security", category: "Organisational Controls", framework: "iso", status: "not-implemented", description: "The organization's approach to managing information security and its implementation shall be reviewed independently at planned intervals, or when significant changes occur." },
            { id: "CTRL-5.36", name: "Compliance with security policies and standards", category: "Organisational Controls", framework: "iso", status: "not-implemented", description: "Managers shall regularly review the compliance of information processing and procedures within their area of responsibility with the appropriate security policies, standards and any other security requirements." },
            { id: "CTRL-5.37", name: "Documented operating procedures", category: "Organisational Controls", framework: "iso", status: "not-implemented", description: "Operating procedures for information processing facilities shall be documented and made available to personnel who need them." },
            
            // NIST CSF Controls (8)
            { id: "CTRL-ID.AM-01", name: "Physical devices and systems inventory", category: "Asset Management", framework: "nist", status: "not-implemented", description: "Inventories of physical devices and systems within the organization are maintained." },
            { id: "CTRL-ID.AM-02", name: "Software platforms and applications inventory", category: "Asset Management", framework: "nist", status: "not-implemented", description: "Inventories of software platforms and applications within the organization are maintained." },
            { id: "CTRL-ID.AM-03", name: "Organizational communication and data flows mapping", category: "Asset Management", framework: "nist", status: "not-implemented", description: "Organizational communication and data flows are mapped." },
            { id: "CTRL-ID.AM-04", name: "External information systems catalog", category: "Asset Management", framework: "nist", status: "not-implemented", description: "External information systems are catalogued." },
            { id: "CTRL-ID.AM-05", name: "Resources prioritization", category: "Asset Management", framework: "nist", status: "not-implemented", description: "Resources are prioritized based on their classification, criticality, and business value." },
            { id: "CTRL-ID.AM-06", name: "Cybersecurity roles and responsibilities definition", category: "Asset Management", framework: "nist", status: "not-implemented", description: "Cybersecurity roles and responsibilities for the entire workforce and third-party stakeholders are established." },
            { id: "CTRL-ID.BE-01", name: "Organization's role in supply chain identification", category: "Policy & Governance", framework: "nist", status: "not-implemented", description: "The organization's place in critical infrastructure and its sector is identified and communicated." },
            
            // PCI DSS Controls (12)
            { id: "CTRL-PCI-1.1", name: "Processes for network security controls", category: "Network Security", framework: "pci", status: "not-implemented", description: "Processes and mechanisms for installing and maintaining network security controls are defined and understood." },
            { id: "CTRL-PCI-1.2", name: "Network security controls implementation", category: "Network Security", framework: "pci", status: "not-implemented", description: "Network security controls are implemented." },
            { id: "CTRL-PCI-1.3", name: "Network access restriction", category: "Network Security", framework: "pci", status: "not-implemented", description: "Network access to and from the cardholder data environment is restricted." },
            { id: "CTRL-PCI-1.4", name: "External network access restriction", category: "Network Security", framework: "pci", status: "not-implemented", description: "Network access from the internet to and from the cardholder data environment is restricted." },
            { id: "CTRL-PCI-1.5", name: "Risks from wireless networks", category: "Network Security", framework: "pci", status: "not-implemented", description: "Risks to the CDE from computing devices and networks with wireless access technology are managed." },
            { id: "CTRL-PCI-2.1", name: "Secure configurations processes", category: "Access Control", framework: "pci", status: "not-implemented", description: "Processes and mechanisms for applying secure configurations to components are defined and understood." },
            { id: "CTRL-PCI-2.2", name: "System configuration standards", category: "Access Control", framework: "pci", status: "not-implemented", description: "System configuration standards are developed, documented, and implemented." },
            { id: "CTRL-PCI-2.3", name: "Wireless environment security", category: "Network Security", framework: "pci", status: "not-implemented", description: "Wireless environments are configured and managed securely." },
            { id: "CTRL-PCI-3.1", name: "Processes for protecting stored account data", category: "Encryption & Key Management", framework: "pci", status: "not-implemented", description: "Processes and mechanisms for protecting stored account data are defined and understood." },
            { id: "CTRL-PCI-3.2", name: "Sensitive authentication data storage", category: "Encryption & Key Management", framework: "pci", status: "not-implemented", description: "Sensitive authentication data is not stored and PAN is rendered unrecoverable." },
            { id: "CTRL-PCI-3.3", name: "PAN masking", category: "Encryption & Key Management", framework: "pci", status: "not-implemented", description: "Primary account number is masked when displayed." },
            
            // HIPAA Controls (5)
            { id: "CTRL-HIPAA-164.308(a)(1)(i)", name: "Security management process", category: "Policy & Governance", framework: "hipaa", status: "not-implemented", description: "Implement policies and procedures to prevent, detect, contain, and correct security violations." },
            { id: "CTRL-HIPAA-164.308(a)(1)(ii)(A)", name: "Risk analysis", category: "Policy & Governance", framework: "hipaa", status: "not-implemented", description: "Conduct an accurate and thorough assessment of the potential risks and vulnerabilities to the confidentiality, integrity, and availability of electronic protected health information held by the covered entity." },
            { id: "CTRL-HIPAA-164.308(a)(1)(ii)(B)", name: "Risk management", category: "Policy & Governance", framework: "hipaa", status: "not-implemented", description: "Implement security measures sufficient to reduce risks and vulnerabilities to a reasonable and appropriate level to comply with ¬ß164.306(a)." },
            { id: "CTRL-HIPAA-164.308(a)(1)(ii)(C)", name: "Sanction policy", category: "Policy & Governance", framework: "hipaa", status: "not-implemented", description: "Apply appropriate sanctions against workforce members who fail to comply with the security policies and procedures of the covered entity." },
            { id: "CTRL-HIPAA-164.308(a)(1)(ii)(D)", name: "Information system activity review", category: "Logging & Monitoring", framework: "hipaa", status: "not-implemented", description: "Implement procedures to regularly review records of information system activity, such as audit logs, access reports, and security incident tracking reports." },
            
            // SOC 2 Controls (4)
            { id: "CTRL-SOC-CC1.1", name: "Commitment to integrity and ethical values", category: "Policy & Governance", framework: "soc2", status: "not-implemented", description: "The entity demonstrates a commitment to integrity and ethical values." },
            { id: "CTRL-SOC-CC1.2", name: "Board independence", category: "Policy & Governance", framework: "soc2", status: "not-implemented", description: "The board of directors demonstrates independence from management and exercises oversight of the development and performance of internal control." },
            { id: "CTRL-SOC-CC1.3", name: "Management roles and responsibilities", category: "Policy & Governance", framework: "soc2", status: "not-implemented", description: "Management establishes, with board oversight, structures, reporting lines, and appropriate authorities and responsibilities in the pursuit of objectives." },
            { id: "CTRL-SOC-CC1.4", name: "Commitment to competent personnel", category: "Policy & Governance", framework: "soc2", status: "not-implemented", description: "The entity demonstrates a commitment to attract, develop, and retain competent individuals in alignment with objectives." }
        ];

        const FRAMEWORKS = {
            iso: { name: "ISO 27001", color: "badge-iso" },
            nist: { name: "NIST CSF", color: "badge-nist" },
            pci: { name: "PCI DSS", color: "badge-pci" },
            hipaa: { name: "HIPAA", color: "badge-hipaa" },
            soc2: { name: "SOC 2", color: "badge-soc2" }
        };

        const CATEGORIES = {
            "Organisational Controls": "Organisational",
            "People Controls": "People",
            "Physical Controls": "Physical",
            "Technological Controls": "Technological",
            "Asset Management": "Asset Management",
            "Policy & Governance": "Policy & Governance",
            "Network Security": "Network Security",
            "Access Control": "Access Control",
            "Encryption & Key Management": "Encryption & Key Management",
            "Logging & Monitoring": "Logging & Monitoring",
            "Change Management": "Change Management"
        };

        // ===== STATE =====
        const state = {
            controls: [...CONTROLS],
            soa: JSON.parse(localStorage.getItem('grc_soa')) || {},
            activeTab: 'controls',
            activeControl: null,
            searchTerm: '',
            frameworkFilter: 'all',
            categoryFilter: 'all'
        };

        // ===== UTILITIES =====
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function getFrameworkName(code) {
            return FRAMEWORKS[code]?.name || code;
        }

        function getFrameworkColor(code) {
            return FRAMEWORKS[code]?.color || 'badge-iso';
        }

        function getStatusClass(status) {
            switch(status) {
                case 'implemented': return 'status-implemented';
                case 'planned': return 'status-planned';
                case 'not-implemented': return 'status-not-implemented';
                default: return '';
            }
        }

        function getStatusText(status) {
            switch(status) {
                case 'implemented': return 'Implemented';
                case 'planned': return 'Planned';
                case 'not-implemented': return 'Not Implemented';
                default: return status;
            }
        }

        // ===== RENDER FUNCTIONS =====
        function renderControlTable() {
            const container = document.getElementById('controlTable');
            const searchTerm = state.searchTerm.toLowerCase();
            const frameworkFilter = state.frameworkFilter;
            const categoryFilter = state.categoryFilter;
            
            let filteredControls = state.controls;
            
            // Apply filters
            if (searchTerm) {
                filteredControls = filteredControls.filter(control =>
                    control.id.toLowerCase().includes(searchTerm) ||
                    control.name.toLowerCase().includes(searchTerm) ||
                    control.description.toLowerCase().includes(searchTerm)
                );
            }
            
            if (frameworkFilter !== 'all') {
                filteredControls = filteredControls.filter(control => control.framework === frameworkFilter);
            }
            
            if (categoryFilter !== 'all') {
                filteredControls = filteredControls.filter(control => control.category === categoryFilter);
            }
            
            // Update count
            document.getElementById('controlCount').textContent = filteredControls.length;
            
            // Render table
            if (filteredControls.length === 0) {
                container.innerHTML = `
                    <div class="table-row">
                        <div class="table-cell" data-label="Message" style="grid-column: 1 / -1; text-align: center; padding: 40px 0; color: var(--muted);">
                            No controls found matching your filters.
                        </div>
                    </div>
                `;
            } else {
                container.innerHTML = filteredControls.map(control => `
                    <div class="table-row" data-control-id="${control.id}">
                        <div class="table-cell" data-label="Control ID">
                            <code style="font-size: 12px; background: rgba(255,255,255,.05); padding: 4px 8px; border-radius: 6px;">${escapeHtml(control.id)}</code>
                        </div>
                        <div class="table-cell" data-label="Name">
                            <div style="font-weight: 600;">${escapeHtml(control.name)}</div>
                            <div style="font-size: 12px; color: var(--muted); margin-top: 4px;">${escapeHtml(control.description.substring(0, 100))}...</div>
                        </div>
                        <div class="table-cell" data-label="Category">
                            <span style="font-size: 12px; color: var(--muted);">${escapeHtml(control.category)}</span>
                        </div>
                        <div class="table-cell" data-label="Framework">
                            <span class="framework-badge ${getFrameworkColor(control.framework)}">${getFrameworkName(control.framework)}</span>
                        </div>
                        <div class="table-cell" data-label="Status">
                            <span class="status-badge ${getStatusClass(control.status)}">${getStatusText(control.status)}</span>
                        </div>
                    </div>
                `).join('');
                
                // Add click handlers
                container.querySelectorAll('.table-row').forEach(row => {
                    row.addEventListener('click', () => {
                        const controlId = row.getAttribute('data-control-id');
                        const control = state.controls.find(c => c.id === controlId);
                        if (control) {
                            switchToSoA();
                            selectControlForSoA(control);
                        }
                    });
                });
            }
        }

        function renderSoAList() {
            const container = document.getElementById('soaList');
            const soaEntries = Object.entries(state.soa);
            
            if (soaEntries.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: var(--muted);">
                        <div style="font-size: 48px; margin-bottom: 16px; opacity: 0.5;">üìã</div>
                        <p>No controls added to SoA yet.</p>
                        <p style="font-size: 13px; margin-top: 8px;">Select controls from the Control Library to add them.</p>
                    </div>
                `;
            } else {
                container.innerHTML = soaEntries.map(([controlId, soaData]) => {
                    const control = state.controls.find(c => c.id === controlId);
                    if (!control) return '';
                    
                    const isActive = state.activeControl?.id === controlId;
                    
                    return `
                        <div class="soa-item ${isActive ? 'active' : ''}" data-control-id="${controlId}">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                                <div>
                                    <div style="font-weight: 600; font-size: 14px;">${escapeHtml(control.name)}</div>
                                    <div style="font-size: 12px; color: var(--muted);">${escapeHtml(control.id)}</div>
                                </div>
                                <span class="framework-badge ${getFrameworkColor(control.framework)}" style="font-size: 10px;">${getFrameworkName(control.framework)}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 12px;">
                                <span class="status-badge ${getStatusClass(soaData.status || control.status)}" style="font-size: 11px;">
                                    ${getStatusText(soaData.status || control.status)}
                                </span>
                                <span style="font-size: 11px; color: var(--muted);">
                                    ${soaData.applicability || 'Not set'}
                                </span>
                            </div>
                        </div>
                    `;
                }).join('');
                
                // Add click handlers
                container.querySelectorAll('.soa-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const controlId = item.getAttribute('data-control-id');
                        const control = state.controls.find(c => c.id === controlId);
                        if (control) {
                            selectControlForSoA(control);
                        }
                    });
                });
            }
            
            // Update stats
            updateSoAStats();
        }

        function renderSoAForm(control) {
            const container = document.getElementById('soaDetail');
            const soaData = state.soa[control.id] || {
                applicability: 'Applicable',
                status: control.status,
                owner: '',
                rationale: '',
                evidence: ''
            };
            
            container.innerHTML = `
                <h3>${escapeHtml(control.name)}</h3>
                <div style="display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: wrap;">
                    <span class="framework-badge ${getFrameworkColor(control.framework)}">${getFrameworkName(control.framework)}</span>
                    <span style="font-size: 12px; color: var(--muted);">${escapeHtml(control.id)}</span>
                </div>
                
                <div style="margin-bottom: 24px; padding: 16px; background: rgba(255,255,255,.03); border-radius: var(--radius);">
                    <div style="font-size: 13px; color: var(--muted); line-height: 1.6;">${escapeHtml(control.description)}</div>
                </div>
                
                <form id="soaForm">
                    <input type="hidden" id="controlId" value="${control.id}">
                    
                    <div class="form-group">
                        <label class="form-label" for="applicability">Applicability</label>
                        <select class="form-select" id="applicability">
                            <option value="Applicable" ${soaData.applicability === 'Applicable' ? 'selected' : ''}>Applicable</option>
                            <option value="Not Applicable" ${soaData.applicability === 'Not Applicable' ? 'selected' : ''}>Not Applicable</option>
                            <option value="Partially Applicable" ${soaData.applicability === 'Partially Applicable' ? 'selected' : ''}>Partially Applicable</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="status">Implementation Status</label>
                        <select class="form-select" id="status">
                            <option value="implemented" ${soaData.status === 'implemented' ? 'selected' : ''}>Implemented</option>
                            <option value="planned" ${soaData.status === 'planned' ? 'selected' : ''}>Planned</option>
                            <option value="not-implemented" ${soaData.status === 'not-implemented' ? 'selected' : ''}>Not Implemented</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="owner">Owner / Team</label>
                        <input type="text" class="form-input" id="owner" value="${soaData.owner || ''}" placeholder="e.g., Security Team, IT Department">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="rationale">Rationale / Justification</label>
                        <textarea class="form-textarea" id="rationale" placeholder="Why is this control applicable/not applicable?">${soaData.rationale || ''}</textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="evidence">Evidence / Implementation Details</label>
                        <textarea class="form-textarea" id="evidence" placeholder="Links to documentation, policies, screenshots, or other evidence...">${soaData.evidence || ''}</textarea>
                    </div>
                    
                    <div class="btn-group" style="margin-top: 24px;">
                        <button type="button" class="btn" id="btnRemoveFromSoA">
                            <span>Remove from SoA</span>
                        </button>
                        <button type="submit" class="btn primary">
                            <span>Save Changes</span>
                        </button>
                    </div>
                </form>
            `;
            
            // Add form handler
            document.getElementById('soaForm').addEventListener('submit', handleSoASave);
            document.getElementById('btnRemoveFromSoA').addEventListener('click', handleRemoveFromSoA);
        }

        function updateSoAStats() {
            const soaCount = Object.keys(state.soa).length;
            const implementedCount = Object.values(state.soa).filter(s => s.status === 'implemented').length;
            const plannedCount = Object.values(state.soa).filter(s => s.status === 'planned').length;
            const notStartedCount = CONTROLS.length - soaCount;
            
            const coverage = Math.round((soaCount / CONTROLS.length) * 100);
            
            document.getElementById('soaCoverage').textContent = `${coverage}%`;
            document.getElementById('implementedCount').textContent = implementedCount;
            document.getElementById('progressCount').textContent = plannedCount;
            document.getElementById('notStartedCount').textContent = notStartedCount;
        }

        function generateReport() {
            const soaEntries = Object.entries(state.soa);
            const reportDate = new Date().toLocaleDateString();
            
            let report = `STATEMENT OF APPLICABILITY REPORT
Generated: ${reportDate}

SUMMARY
-------
Total Controls in Scope: ${soaEntries.length}
Controls Implemented: ${soaEntries.filter(([_, s]) => s.status === 'implemented').length}
Controls Planned: ${soaEntries.filter(([_, s]) => s.status === 'planned').length}
Controls Not Implemented: ${soaEntries.filter(([_, s]) => s.status === 'not-implemented').length}

DETAILED CONTROL LIST
---------------------

`;
            
            soaEntries.forEach(([controlId, soaData]) => {
                const control = state.controls.find(c => c.id === controlId);
                if (!control) return;
                
                report += `Control ID: ${controlId}
Name: ${control.name}
Framework: ${getFrameworkName(control.framework)}
Category: ${control.category}
Applicability: ${soaData.applicability || 'Not set'}
Status: ${getStatusText(soaData.status)}
Owner: ${soaData.owner || 'Not assigned'}
Rationale: ${soaData.rationale || 'Not provided'}
Evidence: ${soaData.evidence || 'Not provided'}

`;
            });
            
            document.getElementById('reportContent').textContent = report;
        }

        // ===== EVENT HANDLERS =====
        function handleTabSwitch(e) {
            const tab = e.target.getAttribute('data-tab');
            if (!tab) return;
            
            // Update active tab
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            e.target.classList.add('active');
            
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(`tab-${tab}`).classList.add('active');
            
            state.activeTab = tab;
            
            // Refresh content if needed
            if (tab === 'controls') {
                renderControlTable();
            } else if (tab === 'soa') {
                renderSoAList();
            } else if (tab === 'reports') {
                generateReport();
            }
        }

        function handleSearch() {
            state.searchTerm = document.getElementById('controlSearch').value;
            renderControlTable();
        }

        function handleFilter() {
            state.frameworkFilter = document.getElementById('frameworkFilter').value;
            state.categoryFilter = document.getElementById('categoryFilter').value;
            renderControlTable();
        }

        function switchToSoA() {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector('[data-tab="soa"]').classList.add('active');
            
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById('tab-soa').classList.add('active');
            
            state.activeTab = 'soa';
            renderSoAList();
        }

        function selectControlForSoA(control) {
            state.activeControl = control;
            
            // If control not in SoA, add it
            if (!state.soa[control.id]) {
                state.soa[control.id] = {
                    applicability: 'Applicable',
                    status: control.status,
                    owner: '',
                    rationale: '',
                    evidence: ''
                };
                saveSoA();
            }
            
            renderSoAList();
            renderSoAForm(control);
        }

        function handleSoASave(e) {
            e.preventDefault();
            
            const controlId = document.getElementById('controlId').value;
            const soaData = {
                applicability: document.getElementById('applicability').value,
                status: document.getElementById('status').value,
                owner: document.getElementById('owner').value.trim(),
                rationale: document.getElementById('rationale').value.trim(),
                evidence: document.getElementById('evidence').value.trim()
            };
            
            state.soa[controlId] = soaData;
            saveSoA();
            
            // Update control status
            const controlIndex = state.controls.findIndex(c => c.id === controlId);
            if (controlIndex !== -1) {
                state.controls[controlIndex].status = soaData.status;
            }
            
            renderSoAList();
            renderControlTable();
            updateSoAStats();
            
            showToast('SoA updated successfully', 'success');
        }

        function handleRemoveFromSoA() {
            if (!state.activeControl) return;
            
            if (confirm(`Remove ${state.activeControl.name} from SoA?`)) {
                delete state.soa[state.activeControl.id];
                saveSoA();
                
                state.activeControl = null;
                renderSoAList();
                updateSoAStats();
                
                document.getElementById('soaDetail').innerHTML = `
                    <h3>SoA Editor</h3>
                    <p style="color: var(--muted); margin-bottom: 20px;">Select a control to edit its SoA details</p>
                    <div style="text-align: center; padding: 40px 0;">
                        <div style="font-size: 48px; margin-bottom: 16px; opacity: 0.5;">üìù</div>
                        <p style="color: var(--muted);">Select a control from the list to start editing</p>
                    </div>
                `;
                
                showToast('Control removed from SoA', 'info');
            }
        }

        function loadDemoSoA() {
            if (confirm('Load demo SoA data? This will replace your current SoA.')) {
                // Add some demo controls to SoA with sample data
                const demoControls = [
                    'CTRL-5.1',
                    'CTRL-5.15',
                    'CTRL-5.17',
                    'CTRL-6.3',
                    'CTRL-8.5',
                    'CTRL-8.15',
                    'CTRL-8.16',
                    'CTRL-8.24',
                    'CTRL-ID.AM-01',
                    'CTRL-PCI-1.1'
                ];
                
                state.soa = {};
                
                demoControls.forEach(controlId => {
                    const control = state.controls.find(c => c.id === controlId);
                    if (control) {
                        state.soa[controlId] = {
                            applicability: 'Applicable',
                            status: Math.random() > 0.5 ? 'implemented' : 'planned',
                            owner: 'Security Team',
                            rationale: 'Required for basic security posture and compliance with industry standards.',
                            evidence: 'Policy documents, configuration screenshots, audit logs.'
                        };
                        
                        // Update control status
                        const controlIndex = state.controls.findIndex(c => c.id === controlId);
                        if (controlIndex !== -1) {
                            state.controls[controlIndex].status = state.soa[controlId].status;
                        }
                    }
                });
                
                saveSoA();
                renderSoAList();
                renderControlTable();
                updateSoAStats();
                
                showToast('Demo SoA loaded successfully', 'success');
            }
        }

        function exportSoA() {
            const data = {
                version: '1.0',
                generatedAt: new Date().toISOString(),
                controls: Object.entries(state.soa).map(([controlId, soaData]) => {
                    const control = state.controls.find(c => c.id === controlId);
                    return {
                        id: controlId,
                        name: control?.name || '',
                        framework: control?.framework || '',
                        category: control?.category || '',
                        ...soaData
                    };
                })
            };
            
            // Convert to CSV
            let csv = 'Control ID,Name,Framework,Category,Applicability,Status,Owner,Rationale,Evidence\n';
            
            data.controls.forEach(control => {
                csv += `"${control.id}","${control.name}","${getFrameworkName(control.framework)}","${control.category}","${control.applicability}","${getStatusText(control.status)}","${control.owner}","${control.rationale}","${control.evidence}"\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `soa_export_${new Date().toISOString().slice(0,10)}.csv`;
            a.click();
            URL.revokeObjectURL(url);
            
            showToast('SoA exported as CSV', 'success');
        }

        function exportAllData() {
            const data = {
                version: '1.0',
                generatedAt: new Date().toISOString(),
                controls: state.controls,
                soa: state.soa
            };
            
            const json = JSON.stringify(data, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `grc_lab_export_${new Date().toISOString().slice(0,10)}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            showToast('All data exported as JSON', 'success');
        }

        function resetAll() {
            if (confirm('Reset all data? This will clear your SoA and reset all controls.')) {
                state.soa = {};
                state.controls = [...CONTROLS]; // Reset to original
                saveSoA();
                
                renderSoAList();
                renderControlTable();
                updateSoAStats();
                
                showToast('All data reset successfully', 'info');
            }
        }

        function saveSoA() {
            localStorage.setItem('grc_soa', JSON.stringify(state.soa));
        }

        function showToast(message, type = 'info') {
            // Create toast if it doesn't exist
            let toast = document.getElementById('toast');
            if (!toast) {
                toast = document.createElement('div');
                toast.id = 'toast';
                toast.style.cssText = `
                    position: fixed;
                    bottom: 24px;
                    right: 24px;
                    padding: 16px 20px;
                    border-radius: 18px;
                    background: rgba(10,14,26,.85);
                    border: 1px solid rgba(255,255,255,.15);
                    box-shadow: 0 20px 60px rgba(0,0,0,.5);
                    backdrop-filter: blur(20px);
                    color: rgba(255,255,255,.95);
                    max-width: 400px;
                    opacity: 0;
                    transform: translateY(20px);
                    pointer-events: none;
                    transition: opacity .3s var(--ease), transform .3s var(--ease);
                    z-index: 1000;
                `;
                document.body.appendChild(toast);
            }
            
            // Set color based on type
            if (type === 'success') {
                toast.style.borderColor = 'rgba(52,211,153,.3)';
            } else if (type === 'error') {
                toast.style.borderColor = 'rgba(251,113,133,.3)';
            } else {
                toast.style.borderColor = 'rgba(255,255,255,.15)';
            }
            
            toast.innerHTML = `
                <div style="font-weight: 900; font-size: 14px; margin-bottom: 4px;">${escapeHtml(message)}</div>
            `;
            
            // Show toast
            toast.style.opacity = '1';
            toast.style.transform = 'translateY(0px)';
            
            // Hide after 3 seconds
            clearTimeout(toast.timeout);
            toast.timeout = setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateY(20px)';
            }, 3000);
        }

        // ===== INITIALIZATION =====
        function init() {
            // Set up tab switching
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', handleTabSwitch);
            });
            
            // Set up search and filter
            document.getElementById('controlSearch').addEventListener('input', handleSearch);
            document.getElementById('frameworkFilter').addEventListener('change', handleFilter);
            document.getElementById('categoryFilter').addEventListener('change', handleFilter);
            
            // Set up buttons
            document.getElementById('btnLoadDemo').addEventListener('click', loadDemoSoA);
            document.getElementById('btnStartSoA').addEventListener('click', () => switchToSoA());
            document.getElementById('btnExportSoA').addEventListener('click', exportSoA);
            document.getElementById('btnResetSoA').addEventListener('click', () => {
                if (confirm('Reset SoA? This will remove all controls from your Statement of Applicability.')) {
                    state.soa = {};
                    saveSoA();
                    renderSoAList();
                    updateSoAStats();
                    showToast('SoA reset successfully', 'info');
                }
            });
            document.getElementById('btnGenerateReport').addEventListener('click', generateReport);
            document.getElementById('btnExportAll').addEventListener('click', exportAllData);
            document.getElementById('btnExport').addEventListener('click', exportAllData);
            document.getElementById('btnReset').addEventListener('click', resetAll);
            document.getElementById('btnPrint').addEventListener('click', () => window.print());
            
            // Initial render
            renderControlTable();
            updateSoAStats();
            
            showToast('GRC Practice Lab loaded successfully', 'success');
        }

        // Start the application
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
