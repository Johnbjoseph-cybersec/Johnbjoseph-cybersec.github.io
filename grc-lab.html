
<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>GRC Practice Lab Pro | Enterprise Edition</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
:root {
    --bg-base: #09090b;
    --bg-surface: #18181b;
    --bg-elevated: #27272a;
    --bg-hover: #3f3f46;
    --border-subtle: rgba(255,255,255,0.06);
    --border-default: rgba(255,255,255,0.1);
    --border-strong: rgba(255,255,255,0.15);
    --text-primary: #fafafa;
    --text-secondary: #a1a1aa;
    --text-muted: #71717a;
    --accent-blue: #3b82f6;
    --accent-blue-soft: rgba(59,130,246,0.15);
    --accent-green: #22c55e;
    --accent-green-soft: rgba(34,197,94,0.15);
    --accent-amber: #f59e0b;
    --accent-amber-soft: rgba(245,158,11,0.15);
    --accent-red: #ef4444;
    --accent-red-soft: rgba(239,68,68,0.15);
    --accent-purple: #a855f7;
    --accent-purple-soft: rgba(168,85,247,0.15);
    --accent-cyan: #06b6d4;
    --accent-cyan-soft: rgba(6,182,212,0.15);
    --accent-pink: #ec4899;
    --accent-pink-soft: rgba(236,72,153,0.15);
    --gradient-blue: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
    --gradient-green: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
    --gradient-purple: linear-gradient(135deg, #a855f7 0%, #7c3aed 100%);
    --gradient-mesh: radial-gradient(at 40% 20%, rgba(59,130,246,0.15) 0px, transparent 50%),
                     radial-gradient(at 80% 0%, rgba(168,85,247,0.1) 0px, transparent 50%),
                     radial-gradient(at 0% 50%, rgba(34,197,94,0.08) 0px, transparent 50%);
    --shadow-sm: 0 1px 2px rgba(0,0,0,0.5);
    --shadow-md: 0 4px 12px rgba(0,0,0,0.4);
    --shadow-lg: 0 8px 30px rgba(0,0,0,0.5);
    --shadow-glow-blue: 0 0 40px rgba(59,130,246,0.3);
    --shadow-glow-green: 0 0 40px rgba(34,197,94,0.3);
    --radius-sm: 6px;
    --radius-md: 8px;
    --radius-lg: 12px;
    --radius-xl: 16px;
    --radius-full: 9999px;
    --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    --font-mono: 'SF Mono', 'Fira Code', monospace;
    --transition-fast: 0.15s ease;
    --transition-normal: 0.2s ease;
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: var(--font-sans);
    background: var(--bg-base);
    color: var(--text-primary);
    line-height: 1.6;
    min-height: 100vh;
    -webkit-font-smoothing: antialiased;
}
.app-container { display: flex; min-height: 100vh; }
.sidebar {
    width: 260px;
    background: var(--bg-surface);
    border-right: 1px solid var(--border-subtle);
    display: flex;
    flex-direction: column;
    position: fixed;
    top: 0; left: 0; bottom: 0;
    z-index: 100;
}
.sidebar-header {
    padding: 20px;
    border-bottom: 1px solid var(--border-subtle);
}
.logo-container { display: flex; align-items: center; gap: 12px; }
.logo-icon {
    width: 40px; height: 40px;
    background: var(--gradient-blue);
    border-radius: var(--radius-md);
    display: flex; align-items: center; justify-content: center;
    font-size: 20px;
    box-shadow: var(--shadow-glow-blue);
}
.logo-text { font-size: 18px; font-weight: 700; }
.logo-badge {
    font-size: 10px;
    padding: 2px 6px;
    background: var(--accent-purple-soft);
    color: var(--accent-purple);
    border-radius: var(--radius-full);
    font-weight: 600;
    margin-left: auto;
}
.sidebar-nav { flex: 1; overflow-y: auto; padding: 12px; }
.nav-section { margin-bottom: 16px; }
.nav-section-title {
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--text-muted);
    padding: 8px 12px;
}
.nav-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 10px 12px;
    border-radius: var(--radius-md);
    color: var(--text-secondary);
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all var(--transition-fast);
    position: relative;
}
.nav-item:hover { background: var(--bg-elevated); color: var(--text-primary); }
.nav-item.active {
    background: var(--accent-blue-soft);
    color: var(--accent-blue);
}
.nav-item.active::before {
    content: '';
    position: absolute;
    left: 0; top: 50%;
    transform: translateY(-50%);
    width: 3px; height: 20px;
    background: var(--accent-blue);
    border-radius: 0 2px 2px 0;
}
.nav-item i { font-size: 18px; width: 20px; text-align: center; }
.nav-badge {
    margin-left: auto;
    font-size: 11px;
    padding: 2px 8px;
    background: var(--bg-elevated);
    border-radius: var(--radius-full);
    color: var(--text-muted);
    font-weight: 600;
}
.nav-item.active .nav-badge { background: var(--accent-blue); color: white; }
.main-content {
    flex: 1;
    margin-left: 260px;
    min-height: 100vh;
    background: var(--bg-base);
    background-image: var(--gradient-mesh);
}
.content-header {
    position: sticky; top: 0; z-index: 50;
    background: rgba(9,9,11,0.85);
    backdrop-filter: blur(12px);
    border-bottom: 1px solid var(--border-subtle);
    padding: 16px 24px;
    display: flex;
    align-items: center;
    justify-content: space-between;
}
.content-title { font-size: 20px; font-weight: 700; display: flex; align-items: center; gap: 12px; }
.content-title i { color: var(--accent-blue); }
.header-actions { display: flex; gap: 12px; }
.content-body { padding: 24px; max-width: 1600px; }
.btn {
    display: inline-flex; align-items: center; justify-content: center; gap: 8px;
    padding: 8px 16px; font-size: 14px; font-weight: 600;
    border-radius: var(--radius-md);
    border: 1px solid transparent;
    cursor: pointer;
    transition: all var(--transition-fast);
}
.btn-primary {
    background: var(--gradient-blue);
    color: white; border: none;
    box-shadow: var(--shadow-sm);
}
.btn-primary:hover { transform: translateY(-1px); box-shadow: var(--shadow-md), var(--shadow-glow-blue); }
.btn-secondary {
    background: var(--bg-elevated);
    color: var(--text-primary);
    border: 1px solid var(--border-default);
}
.btn-secondary:hover { background: var(--bg-hover); }
.btn-ghost { background: transparent; color: var(--text-secondary); }
.btn-ghost:hover { background: var(--bg-elevated); color: var(--text-primary); }
.btn-sm { padding: 6px 12px; font-size: 13px; }
.btn-lg { padding: 12px 24px; font-size: 15px; }
.card {
    background: var(--bg-surface);
    border: 1px solid var(--border-subtle);
    border-radius: var(--radius-lg);
    overflow: hidden;
    transition: all var(--transition-normal);
}
.card:hover { border-color: var(--border-default); box-shadow: var(--shadow-md); }
.card-header {
    padding: 16px 20px;
    border-bottom: 1px solid var(--border-subtle);
    display: flex; align-items: center; justify-content: space-between;
}
.card-title { font-size: 15px; font-weight: 600; display: flex; align-items: center; gap: 8px; }
.card-body { padding: 20px; }
.metric-card {
    background: var(--bg-surface);
    border: 1px solid var(--border-subtle);
    border-radius: var(--radius-lg);
    padding: 20px;
    position: relative;
    overflow: hidden;
}
.metric-card::before {
    content: ''; position: absolute;
    top: 0; left: 0; right: 0;
    height: 3px;
    background: var(--gradient-blue);
    opacity: 0;
    transition: opacity var(--transition-normal);
}
.metric-card:hover::before { opacity: 1; }
.metric-icon {
    width: 48px; height: 48px;
    border-radius: var(--radius-md);
    display: flex; align-items: center; justify-content: center;
    font-size: 22px;
    margin-bottom: 16px;
}
.metric-icon.blue { background: var(--accent-blue-soft); color: var(--accent-blue); }
.metric-icon.green { background: var(--accent-green-soft); color: var(--accent-green); }
.metric-icon.amber { background: var(--accent-amber-soft); color: var(--accent-amber); }
.metric-icon.red { background: var(--accent-red-soft); color: var(--accent-red); }
.metric-icon.purple { background: var(--accent-purple-soft); color: var(--accent-purple); }
.metric-icon.cyan { background: var(--accent-cyan-soft); color: var(--accent-cyan); }
.metric-value { font-size: 32px; font-weight: 700; line-height: 1; margin-bottom: 4px; }
.metric-label { font-size: 13px; color: var(--text-muted); font-weight: 500; }
.metric-change {
    display: inline-flex; align-items: center; gap: 4px;
    font-size: 12px; font-weight: 600; margin-top: 8px;
    padding: 2px 8px; border-radius: var(--radius-full);
}
.metric-change.positive { background: var(--accent-green-soft); color: var(--accent-green); }
.metric-change.negative { background: var(--accent-red-soft); color: var(--accent-red); }
.table-container {
    background: var(--bg-surface);
    border: 1px solid var(--border-subtle);
    border-radius: var(--radius-lg);
    overflow: hidden;
}
.table-header {
    padding: 16px 20px;
    border-bottom: 1px solid var(--border-subtle);
    display: flex; align-items: center; justify-content: space-between;
    flex-wrap: wrap; gap: 12px;
}
.table-title { font-size: 15px; font-weight: 600; }
table { width: 100%; border-collapse: collapse; }
thead { background: var(--bg-elevated); }
th {
    padding: 12px 16px;
    font-size: 12px; font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--text-muted);
    text-align: left;
    border-bottom: 1px solid var(--border-subtle);
}
td {
    padding: 12px 16px;
    font-size: 14px;
    color: var(--text-secondary);
    border-bottom: 1px solid var(--border-subtle);
    vertical-align: middle;
}
tbody tr { transition: background var(--transition-fast); }
tbody tr:hover { background: var(--bg-elevated); }
tbody tr:last-child td { border-bottom: none; }
.badge {
    display: inline-flex; align-items: center; gap: 4px;
    padding: 3px 10px;
    font-size: 12px; font-weight: 600;
    border-radius: var(--radius-full);
    white-space: nowrap;
}
.badge-blue { background: var(--accent-blue-soft); color: var(--accent-blue); }
.badge-green { background: var(--accent-green-soft); color: var(--accent-green); }
.badge-amber { background: var(--accent-amber-soft); color: var(--accent-amber); }
.badge-red { background: var(--accent-red-soft); color: var(--accent-red); }
.badge-purple { background: var(--accent-purple-soft); color: var(--accent-purple); }
.badge-cyan { background: var(--accent-cyan-soft); color: var(--accent-cyan); }
.badge-pink { background: var(--accent-pink-soft); color: var(--accent-pink); }
.badge-gray { background: var(--bg-elevated); color: var(--text-muted); }
.fw-badge {
    display: inline-flex; padding: 2px 8px;
    font-size: 11px; font-weight: 600;
    border-radius: var(--radius-sm);
    margin-right: 4px;
}
.fw-iso27001 { background: #1e40af; color: #93c5fd; }
.fw-nistcsf { background: #065f46; color: #6ee7b7; }
.fw-soc2 { background: #5b21b6; color: #c4b5fd; }
.fw-pcidss { background: #92400e; color: #fcd34d; }
.fw-hipaa { background: #831843; color: #f9a8d4; }
.fw-gdpr { background: #7f1d1d; color: #fca5a5; }
.fw-cis { background: #0e7490; color: #67e8f9; }
.severity-dot {
    width: 8px; height: 8px;
    border-radius: 50%;
    display: inline-block;
    margin-right: 6px;
}
.severity-critical { background: var(--accent-red); box-shadow: 0 0 8px var(--accent-red); }
.severity-high { background: #f97316; }
.severity-medium { background: var(--accent-amber); }
.severity-low { background: var(--accent-green); }
.form-group { margin-bottom: 16px; }
.form-label {
    display: block;
    font-size: 13px; font-weight: 600;
    color: var(--text-secondary);
    margin-bottom: 8px;
}
.form-input, .form-select, .form-textarea {
    width: 100%;
    padding: 10px 14px;
    font-size: 14px;
    font-family: inherit;
    background: var(--bg-elevated);
    border: 1px solid var(--border-default);
    border-radius: var(--radius-md);
    color: var(--text-primary);
    transition: all var(--transition-fast);
}
.form-input:focus, .form-select:focus, .form-textarea:focus {
    outline: none;
    border-color: var(--accent-blue);
    box-shadow: 0 0 0 3px var(--accent-blue-soft);
}
.form-input::placeholder { color: var(--text-muted); }
.form-select {
    cursor: pointer;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%2371717a' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10l-5 5z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 12px center;
    padding-right: 36px;
}
.form-select option { background: var(--bg-surface); color: var(--text-primary); }
.form-textarea { min-height: 100px; resize: vertical; }
.form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
.modal-overlay {
    position: fixed; inset: 0;
    background: rgba(0,0,0,0.7);
    backdrop-filter: blur(4px);
    display: flex; align-items: center; justify-content: center;
    z-index: 1000;
    opacity: 0; visibility: hidden;
    transition: all var(--transition-normal);
}
.modal-overlay.active { opacity: 1; visibility: visible; }
.modal {
    background: var(--bg-surface);
    border: 1px solid var(--border-default);
    border-radius: var(--radius-xl);
    width: 100%; max-width: 560px;
    max-height: 90vh;
    overflow: hidden;
    display: flex; flex-direction: column;
    transform: scale(0.95) translateY(20px);
    transition: transform var(--transition-normal);
    box-shadow: var(--shadow-lg);
}
.modal-overlay.active .modal { transform: scale(1) translateY(0); }
.modal-header {
    padding: 20px;
    border-bottom: 1px solid var(--border-subtle);
    display: flex; align-items: center; justify-content: space-between;
}
.modal-title { font-size: 18px; font-weight: 700; }
.modal-close {
    width: 32px; height: 32px;
    border-radius: var(--radius-md);
    border: none;
    background: transparent;
    color: var(--text-muted);
    cursor: pointer;
    display: flex; align-items: center; justify-content: center;
}
.modal-close:hover { background: var(--bg-elevated); color: var(--text-primary); }
.modal-body { padding: 20px; overflow-y: auto; flex: 1; }
.modal-footer {
    padding: 16px 20px;
    border-top: 1px solid var(--border-subtle);
    display: flex; justify-content: flex-end; gap: 12px;
    background: var(--bg-elevated);
}
.dashboard-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 16px;
    margin-bottom: 24px;
}
.welcome-banner {
    background: linear-gradient(135deg, var(--bg-surface) 0%, var(--bg-elevated) 100%);
    border: 1px solid var(--border-subtle);
    border-radius: var(--radius-xl);
    padding: 32px;
    margin-bottom: 24px;
    position: relative;
    overflow: hidden;
}
.welcome-banner::before {
    content: ''; position: absolute;
    top: -50%; right: -20%;
    width: 500px; height: 500px;
    background: radial-gradient(circle, var(--accent-blue-soft) 0%, transparent 70%);
    pointer-events: none;
}
.welcome-title { font-size: 28px; font-weight: 700; margin-bottom: 12px; position: relative; }
.welcome-subtitle { font-size: 15px; color: var(--text-secondary); max-width: 600px; margin-bottom: 20px; position: relative; }
.welcome-actions { display: flex; gap: 12px; position: relative; }
.risk-matrix {
    display: grid;
    grid-template-columns: auto repeat(5, 1fr);
    gap: 2px;
    background: var(--border-subtle);
    border-radius: var(--radius-lg);
    overflow: hidden;
    padding: 2px;
}
.risk-matrix-cell {
    padding: 12px;
    text-align: center;
    font-size: 12px; font-weight: 600;
    min-width: 55px; min-height: 45px;
    display: flex; align-items: center; justify-content: center;
    background: var(--bg-surface);
}
.risk-matrix-header { background: var(--bg-elevated); color: var(--text-muted); }
.risk-low { background: #052e16; color: #4ade80; }
.risk-medium { background: #422006; color: #fbbf24; }
.risk-high { background: #7c2d12; color: #fb923c; }
.risk-critical { background: #450a0a; color: #f87171; }
.progress-bar { height: 8px; background: var(--bg-elevated); border-radius: var(--radius-full); overflow: hidden; }
.progress-fill { height: 100%; border-radius: var(--radius-full); }
.progress-fill.blue { background: var(--gradient-blue); }
.progress-fill.green { background: var(--gradient-green); }
.progress-fill.amber { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
.progress-fill.purple { background: var(--gradient-purple); }
.chart-container {
    background: var(--bg-surface);
    border: 1px solid var(--border-subtle);
    border-radius: var(--radius-lg);
    padding: 20px;
}
.chart-header { display: flex; justify-content: space-between; margin-bottom: 16px; }
.chart-title { font-size: 15px; font-weight: 600; }
.chart-legend { display: flex; flex-wrap: wrap; gap: 16px; margin-top: 16px; justify-content: center; }
.legend-item { display: flex; align-items: center; gap: 8px; font-size: 13px; color: var(--text-secondary); }
.legend-dot { width: 10px; height: 10px; border-radius: 50%; }
.empty-state { text-align: center; padding: 48px; }
.empty-state-icon {
    width: 80px; height: 80px;
    border-radius: 50%;
    background: var(--bg-elevated);
    display: flex; align-items: center; justify-content: center;
    margin: 0 auto 20px;
    font-size: 32px;
    color: var(--text-muted);
}
.empty-state-title { font-size: 18px; font-weight: 600; margin-bottom: 8px; }
.empty-state-text { font-size: 14px; color: var(--text-muted); max-width: 400px; margin: 0 auto 20px; }
.tab-content { display: none; animation: fadeIn var(--transition-normal); }
.tab-content.active { display: block; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
.toast-container {
    position: fixed;
    bottom: 20px; right: 20px;
    z-index: 2000;
    display: flex; flex-direction: column; gap: 12px;
}
.toast {
    background: var(--bg-surface);
    border: 1px solid var(--border-default);
    border-radius: var(--radius-lg);
    padding: 16px;
    display: flex; align-items: center; gap: 12px;
    min-width: 300px;
    box-shadow: var(--shadow-lg);
    animation: slideIn 0.3s ease;
}
@keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
.toast-icon {
    width: 32px; height: 32px;
    border-radius: var(--radius-md);
    display: flex; align-items: center; justify-content: center;
    font-size: 16px;
}
.toast-success .toast-icon { background: var(--accent-green-soft); color: var(--accent-green); }
.toast-error .toast-icon { background: var(--accent-red-soft); color: var(--accent-red); }
.toast-info .toast-icon { background: var(--accent-blue-soft); color: var(--accent-blue); }
.toast-content { flex: 1; }
.toast-title { font-size: 14px; font-weight: 600; margin-bottom: 2px; }
.toast-message { font-size: 13px; color: var(--text-muted); }
.trace-flow {
    display: flex; flex-wrap: wrap; gap: 12px; align-items: center;
    padding: 16px;
    background: var(--bg-elevated);
    border-radius: var(--radius-lg);
    margin-bottom: 16px;
}
.trace-node {
    background: var(--bg-surface);
    border: 1px solid var(--border-default);
    border-radius: var(--radius-md);
    padding: 12px 16px;
    min-width: 100px;
    text-align: center;
}
.trace-node-label { font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 4px; }
.trace-node-value { font-size: 14px; font-weight: 600; }
.trace-arrow { color: var(--text-muted); font-size: 20px; }
.font-mono { font-family: var(--font-mono); }
.font-semibold { font-weight: 600; }
.text-muted { color: var(--text-muted); }
.text-red { color: var(--accent-red); }
.text-amber { color: var(--accent-amber); }
.mt-4 { margin-top: 16px; }
.mt-6 { margin-top: 24px; }
.mb-4 { margin-bottom: 16px; }
.mb-6 { margin-bottom: 24px; }
::-webkit-scrollbar { width: 8px; height: 8px; }
::-webkit-scrollbar-track { background: var(--bg-base); }
::-webkit-scrollbar-thumb { background: var(--bg-hover); border-radius: var(--radius-full); }
::-webkit-scrollbar-thumb:hover { background: var(--text-muted); }
@media (max-width: 1024px) {
    .sidebar { transform: translateX(-100%); }
    .sidebar.open { transform: translateX(0); }
    .main-content { margin-left: 0; }
    .mobile-toggle { display: flex !important; }
    .form-row { grid-template-columns: 1fr; }
}
.mobile-toggle { display: none; }
    </style>
</head>
<body>
    <div class="app-container">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo-container">
                    <div class="logo-icon"><i class="bi bi-shield-check"></i></div>
                    <div class="logo-text">GRC Lab Pro</div>
                    <span class="logo-badge">v2.0</span>
                </div>
            </div>
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Overview</div>
                    <div class="nav-item active" data-tab="dashboard"><i class="bi bi-grid-1x2-fill"></i><span>Dashboard</span></div>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Inventory</div>
                    <div class="nav-item" data-tab="assets"><i class="bi bi-hdd-stack"></i><span>Assets</span><span class="nav-badge" id="badge-assets">0</span></div>
                    <div class="nav-item" data-tab="vendors"><i class="bi bi-building"></i><span>Vendors</span><span class="nav-badge" id="badge-vendors">0</span></div>
                    <div class="nav-item" data-tab="policies"><i class="bi bi-file-earmark-text"></i><span>Policies</span><span class="nav-badge" id="badge-policies">0</span></div>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Risk Management</div>
                    <div class="nav-item" data-tab="risks"><i class="bi bi-exclamation-triangle"></i><span>Risks</span><span class="nav-badge" id="badge-risks">0</span></div>
                    <div class="nav-item" data-tab="controls"><i class="bi bi-shield-lock"></i><span>Controls</span><span class="nav-badge" id="badge-controls">0</span></div>
                    <div class="nav-item" data-tab="treatments"><i class="bi bi-bandaid"></i><span>Treatments</span><span class="nav-badge" id="badge-treatments">0</span></div>
                    <div class="nav-item" data-tab="matrix"><i class="bi bi-grid-3x3"></i><span>Risk Matrix</span></div>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Operations</div>
                    <div class="nav-item" data-tab="issues"><i class="bi bi-bug"></i><span>Issues</span><span class="nav-badge" id="badge-issues">0</span></div>
                    <div class="nav-item" data-tab="incidents"><i class="bi bi-lightning"></i><span>Incidents</span><span class="nav-badge" id="badge-incidents">0</span></div>
                    <div class="nav-item" data-tab="tasks"><i class="bi bi-check2-square"></i><span>Tasks</span><span class="nav-badge" id="badge-tasks">0</span></div>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Compliance</div>
                    <div class="nav-item" data-tab="audits"><i class="bi bi-clipboard-check"></i><span>Audits</span><span class="nav-badge" id="badge-audits">0</span></div>
                    <div class="nav-item" data-tab="evidence"><i class="bi bi-folder2-open"></i><span>Evidence</span><span class="nav-badge" id="badge-evidence">0</span></div>
                    <div class="nav-item" data-tab="testing"><i class="bi bi-card-checklist"></i><span>Control Testing</span><span class="nav-badge" id="badge-testing">0</span></div>
                    <div class="nav-item" data-tab="findings"><i class="bi bi-search"></i><span>Findings</span><span class="nav-badge" id="badge-findings">0</span></div>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Reporting</div>
                    <div class="nav-item" data-tab="traceability"><i class="bi bi-diagram-3"></i><span>Traceability</span></div>
                    <div class="nav-item" data-tab="reports"><i class="bi bi-file-earmark-bar-graph"></i><span>Reports</span></div>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Learning</div>
                    <div class="nav-item" data-tab="frameworks" style="background: linear-gradient(90deg, rgba(59,130,246,0.1), transparent);"><i class="bi bi-journal-code"></i><span>Frameworks</span><span class="nav-badge" style="background: var(--accent-blue);">400+</span></div>
                    <div class="nav-item" data-tab="projects" style="background: linear-gradient(90deg, rgba(168,85,247,0.1), transparent);"><i class="bi bi-briefcase"></i><span>Projects</span><span class="nav-badge" style="background: var(--accent-purple);">9</span></div>
                    <div class="nav-item" data-tab="portfolio" style="background: linear-gradient(90deg, rgba(34,197,94,0.1), transparent);"><i class="bi bi-person-badge"></i><span>Portfolio</span></div>
                </div>
            </nav>
            <div style="padding: 16px; border-top: 1px solid var(--border-subtle);">
                <button class="btn btn-primary" style="width: 100%;" onclick="app.loadDemo()">
                    <i class="bi bi-lightning-fill"></i> Load Demo Data
                </button>
            </div>
        </aside>
        <main class="main-content">
            <header class="content-header">
                <button class="btn btn-ghost mobile-toggle" onclick="toggleSidebar()"><i class="bi bi-list"></i></button>
                <div class="content-title" id="page-title"><i class="bi bi-grid-1x2-fill"></i> Dashboard</div>
                <div class="header-actions">
                    <button class="btn btn-secondary btn-sm" onclick="app.exportData()"><i class="bi bi-download"></i> Export</button>
                    <button class="btn btn-secondary btn-sm" onclick="app.clearAllData()"><i class="bi bi-trash3"></i> Clear</button>
                </div>
            </header>
            <div class="content-body">
                <div class="tab-content active" id="tab-dashboard"></div>
                <div class="tab-content" id="tab-assets"></div>
                <div class="tab-content" id="tab-vendors"></div>
                <div class="tab-content" id="tab-policies"></div>
                <div class="tab-content" id="tab-risks"></div>
                <div class="tab-content" id="tab-controls"></div>
                <div class="tab-content" id="tab-treatments"></div>
                <div class="tab-content" id="tab-matrix"></div>
                <div class="tab-content" id="tab-issues"></div>
                <div class="tab-content" id="tab-incidents"></div>
                <div class="tab-content" id="tab-tasks"></div>
                <div class="tab-content" id="tab-audits"></div>
                <div class="tab-content" id="tab-evidence"></div>
                <div class="tab-content" id="tab-testing"></div>
                <div class="tab-content" id="tab-findings"></div>
                <div class="tab-content" id="tab-traceability"></div>
                <div class="tab-content" id="tab-reports"></div>
                <div class="tab-content" id="tab-frameworks"></div>
                <div class="tab-content" id="tab-projects"></div>
                <div class="tab-content" id="tab-portfolio"></div>
            </div>
        </main>
    </div>
    <div class="toast-container" id="toast-container"></div>
    <div class="modal-overlay" id="modal-overlay">
        <div class="modal" id="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-title">Modal</h3>
                <button class="modal-close" onclick="closeModal()"><i class="bi bi-x-lg"></i></button>
            </div>
            <div class="modal-body" id="modal-body"></div>
            <div class="modal-footer" id="modal-footer"></div>
        </div>
    </div>
<script>
class GRCLabPro {
    constructor() {
        this.currentTab = 'dashboard';
        this.data = { assets: [], vendors: [], policies: [], risks: [], controls: [], treatments: [], issues: [], incidents: [], tasks: [], audits: [], evidence: [], controlTests: [], findings: [] };
        this.init();
    }
    init() { this.loadAllData(); this.bindEvents(); this.renderCurrentTab(); this.updateAllBadges(); }
    loadAllData() { Object.keys(this.data).forEach(key => { const stored = localStorage.getItem(`grc_${key}`); if (stored) try { this.data[key] = JSON.parse(stored); } catch(e) { this.data[key] = []; } }); }
    saveData(key) { localStorage.setItem(`grc_${key}`, JSON.stringify(this.data[key])); this.updateAllBadges(); }
    generateId(prefix) { return `${prefix}-${Date.now().toString(36)}`; }
    esc(str) { return String(str || '').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }
    bindEvents() { document.querySelectorAll('.nav-item').forEach(item => item.addEventListener('click', () => this.switchTab(item.dataset.tab))); }
    switchTab(tab) {
        document.querySelectorAll('.nav-item').forEach(item => item.classList.toggle('active', item.dataset.tab === tab));
        document.querySelectorAll('.tab-content').forEach(content => content.classList.toggle('active', content.id === `tab-${tab}`));
        const titles = { dashboard:'Dashboard', assets:'Asset Inventory', vendors:'Vendor Management', policies:'Policy Library', risks:'Risk Register', controls:'Control Catalog', treatments:'Risk Treatments', matrix:'Risk Matrix', issues:'Issue Tracker', incidents:'Incident Log', tasks:'Task Management', audits:'Audit Schedule', evidence:'Evidence Library', testing:'Control Testing', findings:'Audit Findings', traceability:'Traceability Matrix', reports:'Reports & Analytics', frameworks:'Framework Library', projects:'GRC Projects', portfolio:'Portfolio Builder' };
        const icons = { dashboard:'bi-grid-1x2-fill', assets:'bi-hdd-stack', vendors:'bi-building', policies:'bi-file-earmark-text', risks:'bi-exclamation-triangle', controls:'bi-shield-lock', treatments:'bi-bandaid', matrix:'bi-grid-3x3', issues:'bi-bug', incidents:'bi-lightning', tasks:'bi-check2-square', audits:'bi-clipboard-check', evidence:'bi-folder2-open', testing:'bi-card-checklist', findings:'bi-search', traceability:'bi-diagram-3', reports:'bi-file-earmark-bar-graph', frameworks:'bi-journal-code', projects:'bi-briefcase', portfolio:'bi-person-badge' };
        document.getElementById('page-title').innerHTML = `<i class="bi ${icons[tab] || 'bi-circle'}"></i> ${titles[tab] || tab}`;
        this.currentTab = tab;
        this.renderCurrentTab();
    }
    renderCurrentTab() {
        const r = { dashboard: () => this.renderDashboard(), assets: () => this.renderAssets(), vendors: () => this.renderVendors(), policies: () => this.renderPolicies(), risks: () => this.renderRisks(), controls: () => this.renderControls(), treatments: () => this.renderTreatments(), matrix: () => this.renderMatrix(), issues: () => this.renderIssues(), incidents: () => this.renderIncidents(), tasks: () => this.renderTasks(), audits: () => this.renderAudits(), evidence: () => this.renderEvidence(), testing: () => this.renderTesting(), findings: () => this.renderFindings(), traceability: () => this.renderTraceability(), reports: () => this.renderReports(), frameworks: () => this.renderFrameworks(), projects: () => this.renderProjects(), portfolio: () => this.renderPortfolio() };
        if (r[this.currentTab]) r[this.currentTab]();
    }
    updateAllBadges() {
        const b = { assets: this.data.assets.length, vendors: this.data.vendors.length, policies: this.data.policies.length, risks: this.data.risks.length, controls: this.data.controls.length, treatments: this.data.treatments.length, issues: this.data.issues.length, incidents: this.data.incidents.length, tasks: this.data.tasks.length, audits: this.data.audits.length, evidence: this.data.evidence.length, testing: this.data.controlTests.length, findings: this.data.findings.length };
        Object.entries(b).forEach(([k, v]) => { const el = document.getElementById(`badge-${k}`); if (el) el.textContent = v; });
    }
    renderDashboard() {
        const c = document.getElementById('tab-dashboard');
        const openRisks = this.data.risks.filter(r => r.status !== 'Closed').length;
        const criticalRisks = this.data.risks.filter(r => (r.likelihood * r.impact) >= 20).length;
        const openIssues = this.data.issues.filter(i => i.status === 'Open').length;
        const pendingTasks = this.data.tasks.filter(t => t.status !== 'Completed').length;
        const effectiveControls = this.data.controls.filter(c => c.effectiveness === 'Effective').length;
        const openFindings = this.data.findings.filter(f => f.status === 'Open').length;
        c.innerHTML = `
            <div class="welcome-banner">
                <h1 class="welcome-title">Welcome to GRC Practice Lab Pro</h1>
                <p class="welcome-subtitle">Master enterprise GRC with hands-on practice. Build your risk register, implement controls, manage audits, and generate portfolio-ready artifacts.</p>
                <div class="welcome-actions">
                    <button class="btn btn-primary btn-lg" onclick="app.loadDemo()"><i class="bi bi-lightning-fill"></i> Load Complete Demo</button>
                    <button class="btn btn-secondary btn-lg" onclick="app.switchTab('risks')"><i class="bi bi-plus-lg"></i> Start Fresh</button>
                </div>
            </div>
            <div class="dashboard-grid">
                <div class="metric-card"><div class="metric-icon blue"><i class="bi bi-hdd-stack"></i></div><div class="metric-value">${this.data.assets.length}</div><div class="metric-label">Total Assets</div></div>
                <div class="metric-card"><div class="metric-icon red"><i class="bi bi-exclamation-triangle"></i></div><div class="metric-value">${openRisks}</div><div class="metric-label">Open Risks</div>${criticalRisks > 0 ? `<div class="metric-change negative"><i class="bi bi-exclamation-circle"></i> ${criticalRisks} Critical</div>` : ''}</div>
                <div class="metric-card"><div class="metric-icon green"><i class="bi bi-shield-check"></i></div><div class="metric-value">${this.data.controls.length}</div><div class="metric-label">Controls</div>${effectiveControls > 0 ? `<div class="metric-change positive"><i class="bi bi-check"></i> ${effectiveControls} Effective</div>` : ''}</div>
                <div class="metric-card"><div class="metric-icon amber"><i class="bi bi-bug"></i></div><div class="metric-value">${openIssues}</div><div class="metric-label">Open Issues</div></div>
                <div class="metric-card"><div class="metric-icon purple"><i class="bi bi-check2-square"></i></div><div class="metric-value">${pendingTasks}</div><div class="metric-label">Pending Tasks</div></div>
                <div class="metric-card"><div class="metric-icon cyan"><i class="bi bi-search"></i></div><div class="metric-value">${openFindings}</div><div class="metric-label">Open Findings</div></div>
            </div>
            ${this.data.risks.length > 0 ? this.renderRiskByCategory() : '<div class="chart-container"><div class="empty-state"><p class="text-muted">No data yet. Load demo to see charts.</p></div></div>'}
        `;
    }
    renderRiskByCategory() {
        const cats = {}; this.data.risks.forEach(r => cats[r.category] = (cats[r.category] || 0) + 1);
        const total = this.data.risks.length;
        const colors = ['#3b82f6', '#22c55e', '#f59e0b', '#ef4444', '#a855f7', '#06b6d4'];
        return `<div class="chart-container"><div class="chart-header"><h3 class="chart-title">Risk by Category</h3></div>${Object.entries(cats).map(([cat, count], i) => `<div style="margin-bottom:12px;"><div style="display:flex;justify-content:space-between;margin-bottom:4px;"><span style="font-size:13px;color:var(--text-secondary);">${cat}</span><span style="font-size:13px;font-weight:600;">${count}</span></div><div class="progress-bar"><div class="progress-fill" style="width:${(count/total)*100}%;background:${colors[i % colors.length]};"></div></div></div>`).join('')}</div>`;
    }
    renderAssets() {
        const c = document.getElementById('tab-assets');
        c.innerHTML = `<div class="table-container"><div class="table-header"><h3 class="table-title">Asset Inventory</h3><button class="btn btn-primary btn-sm" onclick="app.showAssetModal()"><i class="bi bi-plus-lg"></i> Add Asset</button></div>${this.data.assets.length > 0 ? `<table><thead><tr><th>ID</th><th>Name</th><th>Type</th><th>Classification</th><th>Owner</th><th>Environment</th><th>Actions</th></tr></thead><tbody>${this.data.assets.map(a => `<tr><td><span class="font-mono text-muted">${a.id}</span></td><td class="font-semibold">${a.name}</td><td><span class="badge badge-blue">${a.type}</span></td><td><span class="badge badge-${a.classification === 'Critical' ? 'red' : a.classification === 'High' ? 'amber' : 'green'}">${a.classification}</span></td><td>${a.owner}</td><td>${a.environment}</td><td><button class="btn btn-ghost btn-sm" onclick="app.editAsset('${a.id}')"><i class="bi bi-pencil"></i></button><button class="btn btn-ghost btn-sm" onclick="app.deleteItem('assets','${a.id}')"><i class="bi bi-trash3"></i></button></td></tr>`).join('')}</tbody></table>` : this.renderEmpty('bi-hdd-stack', 'No Assets Yet', 'Assets are systems and data you need to protect.', 'showAssetModal')}</div>`;
    }
    showAssetModal(a = null) {
        const isEdit = a !== null;
        openModal(isEdit ? 'Edit Asset' : 'Add Asset', `<div class="form-group"><label class="form-label">Name *</label><input type="text" class="form-input" id="f-name" value="${a?.name || ''}" placeholder="e.g., Customer Database"></div><div class="form-row"><div class="form-group"><label class="form-label">Type</label><select class="form-select" id="f-type">${['Application', 'Database', 'Server', 'Cloud Account', 'Network Device', 'Data Store', 'Endpoint'].map(t => `<option value="${t}" ${a?.type === t ? 'selected' : ''}>${t}</option>`).join('')}</select></div><div class="form-group"><label class="form-label">Classification</label><select class="form-select" id="f-class">${['Critical', 'High', 'Medium', 'Low'].map(c => `<option value="${c}" ${a?.classification === c ? 'selected' : ''}>${c}</option>`).join('')}</select></div></div><div class="form-row"><div class="form-group"><label class="form-label">Owner</label><input type="text" class="form-input" id="f-owner" value="${a?.owner || ''}"></div><div class="form-group"><label class="form-label">Environment</label><select class="form-select" id="f-env">${['Production', 'Staging', 'Development', 'DR'].map(e => `<option value="${e}" ${a?.environment === e ? 'selected' : ''}>${e}</option>`).join('')}</select></div></div><div class="form-group"><label class="form-label">Description</label><textarea class="form-textarea" id="f-desc">${a?.description || ''}</textarea></div>`, `<button class="btn btn-secondary" onclick="closeModal()">Cancel</button><button class="btn btn-primary" onclick="app.saveAsset('${a?.id || ''}')">${isEdit ? 'Update' : 'Create'}</button>`);
    }
    saveAsset(editId) {
        const name = document.getElementById('f-name').value.trim();
        if (!name) { this.toast('Please enter name', 'error'); return; }
        const item = { id: editId || this.generateId('AST'), name, type: document.getElementById('f-type').value, classification: document.getElementById('f-class').value, owner: document.getElementById('f-owner').value, environment: document.getElementById('f-env').value, description: document.getElementById('f-desc').value, createdAt: editId ? this.data.assets.find(a => a.id === editId)?.createdAt : new Date().toISOString(), updatedAt: new Date().toISOString() };
        if (editId) { const idx = this.data.assets.findIndex(a => a.id === editId); if (idx !== -1) this.data.assets[idx] = item; } else { this.data.assets.push(item); }
        this.saveData('assets'); closeModal(); this.renderAssets(); this.toast(editId ? 'Asset updated' : 'Asset created', 'success');
    }
    editAsset(id) { const a = this.data.assets.find(x => x.id === id); if (a) this.showAssetModal(a); }
    renderVendors() {
        const c = document.getElementById('tab-vendors');
        c.innerHTML = `<div class="table-container"><div class="table-header"><h3 class="table-title">Vendor Management</h3><button class="btn btn-primary btn-sm" onclick="app.showVendorModal()"><i class="bi bi-plus-lg"></i> Add Vendor</button></div>${this.data.vendors.length > 0 ? `<table><thead><tr><th>ID</th><th>Vendor</th><th>Service</th><th>Criticality</th><th>Status</th><th>Owner</th><th>Actions</th></tr></thead><tbody>${this.data.vendors.map(v => `<tr><td><span class="font-mono text-muted">${v.id}</span></td><td class="font-semibold">${v.name}</td><td>${v.service}</td><td><span class="badge badge-${v.criticality === 'Critical' ? 'red' : v.criticality === 'High' ? 'amber' : 'green'}">${v.criticality}</span></td><td><span class="badge badge-${v.status === 'Active' ? 'green' : 'gray'}">${v.status}</span></td><td>${v.owner}</td><td><button class="btn btn-ghost btn-sm" onclick="app.editVendor('${v.id}')"><i class="bi bi-pencil"></i></button><button class="btn btn-ghost btn-sm" onclick="app.deleteItem('vendors','${v.id}')"><i class="bi bi-trash3"></i></button></td></tr>`).join('')}</tbody></table>` : this.renderEmpty('bi-building', 'No Vendors Yet', 'Track third-party vendors and their risk profiles.', 'showVendorModal')}</div>`;
    }
    showVendorModal(v = null) {
        const isEdit = v !== null;
        openModal(isEdit ? 'Edit Vendor' : 'Add Vendor', `<div class="form-group"><label class="form-label">Name *</label><input type="text" class="form-input" id="f-name" value="${v?.name || ''}"></div><div class="form-row"><div class="form-group"><label class="form-label">Service</label><input type="text" class="form-input" id="f-service" value="${v?.service || ''}"></div><div class="form-group"><label class="form-label">Criticality</label><select class="form-select" id="f-crit">${['Critical', 'High', 'Medium', 'Low'].map(c => `<option value="${c}" ${v?.criticality === c ? 'selected' : ''}>${c}</option>`).join('')}</select></div></div><div class="form-row"><div class="form-group"><label class="form-label">Owner</label><input type="text" class="form-input" id="f-owner" value="${v?.owner || ''}"></div><div class="form-group"><label class="form-label">Status</label><select class="form-select" id="f-status">${['Active', 'Under Review', 'Inactive'].map(s => `<option value="${s}" ${v?.status === s ? 'selected' : ''}>${s}</option>`).join('')}</select></div></div><div class="form-group"><label class="form-label">Notes</label><textarea class="form-textarea" id="f-notes">${v?.notes || ''}</textarea></div>`, `<button class="btn btn-secondary" onclick="closeModal()">Cancel</button><button class="btn btn-primary" onclick="app.saveVendor('${v?.id || ''}')">${isEdit ? 'Update' : 'Create'}</button>`);
    }
    saveVendor(editId) {
        const name = document.getElementById('f-name').value.trim();
        if (!name) { this.toast('Please enter name', 'error'); return; }
        const item = { id: editId || this.generateId('VND'), name, service: document.getElementById('f-service').value, criticality: document.getElementById('f-crit').value, owner: document.getElementById('f-owner').value, status: document.getElementById('f-status').value, notes: document.getElementById('f-notes').value, createdAt: editId ? this.data.vendors.find(v => v.id === editId)?.createdAt : new Date().toISOString(), updatedAt: new Date().toISOString() };
        if (editId) { const idx = this.data.vendors.findIndex(v => v.id === editId); if (idx !== -1) this.data.vendors[idx] = item; } else { this.data.vendors.push(item); }
        this.saveData('vendors'); closeModal(); this.renderVendors(); this.toast(editId ? 'Vendor updated' : 'Vendor created', 'success');
    }
    editVendor(id) { const v = this.data.vendors.find(x => x.id === id); if (v) this.showVendorModal(v); }
    renderPolicies() {
        const c = document.getElementById('tab-policies');
        c.innerHTML = `<div class="table-container"><div class="table-header"><h3 class="table-title">Policy Library</h3><button class="btn btn-primary btn-sm" onclick="app.showPolicyModal()"><i class="bi bi-plus-lg"></i> Add Policy</button></div>${this.data.policies.length > 0 ? `<table><thead><tr><th>ID</th><th>Title</th><th>Status</th><th>Owner</th><th>Review Date</th><th>Actions</th></tr></thead><tbody>${this.data.policies.map(p => `<tr><td><span class="font-mono text-muted">${p.id}</span></td><td class="font-semibold">${p.title}</td><td><span class="badge badge-${p.status === 'Approved' ? 'green' : p.status === 'Draft' ? 'gray' : 'amber'}">${p.status}</span></td><td>${p.owner}</td><td>${p.reviewDate ? new Date(p.reviewDate).toLocaleDateString() : '-'}</td><td><button class="btn btn-ghost btn-sm" onclick="app.editPolicy('${p.id}')"><i class="bi bi-pencil"></i></button><button class="btn btn-ghost btn-sm" onclick="app.deleteItem('policies','${p.id}')"><i class="bi bi-trash3"></i></button></td></tr>`).join('')}</tbody></table>` : this.renderEmpty('bi-file-earmark-text', 'No Policies Yet', 'Document your security policies.', 'showPolicyModal')}</div>`;
    }
    showPolicyModal(p = null) {
        const isEdit = p !== null;
        openModal(isEdit ? 'Edit Policy' : 'Add Policy', `<div class="form-group"><label class="form-label">Title *</label><input type="text" class="form-input" id="f-title" value="${p?.title || ''}"></div><div class="form-row"><div class="form-group"><label class="form-label">Status</label><select class="form-select" id="f-status">${['Draft', 'Under Review', 'Approved', 'Retired'].map(s => `<option value="${s}" ${p?.status === s ? 'selected' : ''}>${s}</option>`).join('')}</select></div><div class="form-group"><label class="form-label">Owner</label><input type="text" class="form-input" id="f-owner" value="${p?.owner || ''}"></div></div><div class="form-group"><label class="form-label">Review Date</label><input type="date" class="form-input" id="f-review" value="${p?.reviewDate?.split('T')[0] || ''}"></div>`, `<button class="btn btn-secondary" onclick="closeModal()">Cancel</button><button class="btn btn-primary" onclick="app.savePolicy('${p?.id || ''}')">${isEdit ? 'Update' : 'Create'}</button>`);
    }
    savePolicy(editId) {
        const title = document.getElementById('f-title').value.trim();
        if (!title) { this.toast('Please enter title', 'error'); return; }
        const item = { id: editId || this.generateId('POL'), title, status: document.getElementById('f-status').value, owner: document.getElementById('f-owner').value, reviewDate: document.getElementById('f-review').value || null, createdAt: editId ? this.data.policies.find(p => p.id === editId)?.createdAt : new Date().toISOString(), updatedAt: new Date().toISOString() };
        if (editId) { const idx = this.data.policies.findIndex(p => p.id === editId); if (idx !== -1) this.data.policies[idx] = item; } else { this.data.policies.push(item); }
        this.saveData('policies'); closeModal(); this.renderPolicies(); this.toast(editId ? 'Policy updated' : 'Policy created', 'success');
    }
    editPolicy(id) { const p = this.data.policies.find(x => x.id === id); if (p) this.showPolicyModal(p); }
    renderRisks() {
        const c = document.getElementById('tab-risks');
        c.innerHTML = `<div class="table-container"><div class="table-header"><h3 class="table-title">Risk Register</h3><button class="btn btn-primary btn-sm" onclick="app.showRiskModal()"><i class="bi bi-plus-lg"></i> Add Risk</button></div>${this.data.risks.length > 0 ? `<table><thead><tr><th>ID</th><th>Risk Title</th><th>Category</th><th>L × I</th><th>Score</th><th>Status</th><th>Owner</th><th>Actions</th></tr></thead><tbody>${this.data.risks.map(r => { const score = r.likelihood * r.impact; const sev = score >= 20 ? 'critical' : score >= 12 ? 'high' : score >= 6 ? 'medium' : 'low'; return `<tr><td><span class="font-mono text-muted">${r.id}</span></td><td class="font-semibold">${r.title}</td><td><span class="badge badge-blue">${r.category}</span></td><td>${r.likelihood} × ${r.impact}</td><td><span class="severity-dot severity-${sev}"></span>${score}</td><td><span class="badge badge-${r.status === 'Closed' ? 'green' : r.status === 'In Progress' ? 'amber' : 'red'}">${r.status}</span></td><td>${r.owner}</td><td><button class="btn btn-ghost btn-sm" onclick="app.editRisk('${r.id}')"><i class="bi bi-pencil"></i></button><button class="btn btn-ghost btn-sm" onclick="app.deleteItem('risks','${r.id}')"><i class="bi bi-trash3"></i></button></td></tr>`; }).join('')}</tbody></table>` : this.renderEmpty('bi-exclamation-triangle', 'No Risks Yet', 'Identify and assess risks to your organization.', 'showRiskModal')}</div>`;
    }
    showRiskModal(r = null) {
        const isEdit = r !== null;
        openModal(isEdit ? 'Edit Risk' : 'Add Risk', `<div class="form-group"><label class="form-label">Title *</label><input type="text" class="form-input" id="f-title" value="${r?.title || ''}"></div><div class="form-row"><div class="form-group"><label class="form-label">Category</label><select class="form-select" id="f-category">${['Access Control', 'Application Security', 'Data Protection', 'Availability', 'Compliance', 'Vendor Risk', 'Physical Security', 'Human Error', 'Other'].map(c => `<option value="${c}" ${r?.category === c ? 'selected' : ''}>${c}</option>`).join('')}</select></div><div class="form-group"><label class="form-label">Status</label><select class="form-select" id="f-status">${['Open', 'In Progress', 'Closed'].map(s => `<option value="${s}" ${r?.status === s ? 'selected' : ''}>${s}</option>`).join('')}</select></div></div><div class="form-row"><div class="form-group"><label class="form-label">Likelihood (1-5)</label><select class="form-select" id="f-likelihood">${[1,2,3,4,5].map(l => `<option value="${l}" ${r?.likelihood === l ? 'selected' : ''}>${l} - ${['Rare','Unlikely','Possible','Likely','Almost Certain'][l-1]}</option>`).join('')}</select></div><div class="form-group"><label class="form-label">Impact (1-5)</label><select class="form-select" id="f-impact">${[1,2,3,4,5].map(i => `<option value="${i}" ${r?.impact === i ? 'selected' : ''}>${i} - ${['Negligible','Minor','Moderate','Major','Severe'][i-1]}</option>`).join('')}</select></div></div><div class="form-group"><label class="form-label">Owner</label><input type="text" class="form-input" id="f-owner" value="${r?.owner || ''}"></div><div class="form-group"><label class="form-label">Description</label><textarea class="form-textarea" id="f-desc">${r?.description || ''}</textarea></div>`, `<button class="btn btn-secondary" onclick="closeModal()">Cancel</button><button class="btn btn-primary" onclick="app.saveRisk('${r?.id || ''}')">${isEdit ? 'Update' : 'Create'}</button>`);
    }
    saveRisk(editId) {
        const title = document.getElementById('f-title').value.trim();
        if (!title) { this.toast('Please enter title', 'error'); return; }
        const item = { id: editId || this.generateId('RSK'), title, category: document.getElementById('f-category').value, status: document.getElementById('f-status').value, likelihood: parseInt(document.getElementById('f-likelihood').value), impact: parseInt(document.getElementById('f-impact').value), owner: document.getElementById('f-owner').value, description: document.getElementById('f-desc').value, createdAt: editId ? this.data.risks.find(r => r.id === editId)?.createdAt : new Date().toISOString(), updatedAt: new Date().toISOString() };
        if (editId) { const idx = this.data.risks.findIndex(r => r.id === editId); if (idx !== -1) this.data.risks[idx] = item; } else { this.data.risks.push(item); }
        this.saveData('risks'); closeModal(); this.renderRisks(); this.toast(editId ? 'Risk updated' : 'Risk created', 'success');
    }
    editRisk(id) { const r = this.data.risks.find(x => x.id === id); if (r) this.showRiskModal(r); }
    renderControls() {
        const c = document.getElementById('tab-controls');
        c.innerHTML = `<div class="table-container"><div class="table-header"><h3 class="table-title">Control Catalog</h3><button class="btn btn-primary btn-sm" onclick="app.showControlModal()"><i class="bi bi-plus-lg"></i> Add Control</button></div>${this.data.controls.length > 0 ? `<table><thead><tr><th>ID</th><th>Control Name</th><th>Framework</th><th>Reference</th><th>Effectiveness</th><th>Owner</th><th>Actions</th></tr></thead><tbody>${this.data.controls.map(c => `<tr><td><span class="font-mono text-muted">${c.id}</span></td><td class="font-semibold">${c.name}</td><td><span class="fw-badge fw-${c.framework?.toLowerCase().replace(/\s/g, '')}">${c.framework}</span></td><td><span class="font-mono">${c.ref || '-'}</span></td><td><span class="badge badge-${c.effectiveness === 'Effective' ? 'green' : c.effectiveness === 'Partially Effective' ? 'amber' : 'red'}">${c.effectiveness}</span></td><td>${c.owner}</td><td><button class="btn btn-ghost btn-sm" onclick="app.editControl('${c.id}')"><i class="bi bi-pencil"></i></button><button class="btn btn-ghost btn-sm" onclick="app.deleteItem('controls','${c.id}')"><i class="bi bi-trash3"></i></button></td></tr>`).join('')}</tbody></table>` : this.renderEmpty('bi-shield-lock', 'No Controls Yet', 'Define security controls to mitigate risks.', 'showControlModal')}</div>`;
    }
    showControlModal(ctrl = null) {
        const isEdit = ctrl !== null;
        openModal(isEdit ? 'Edit Control' : 'Add Control', `<div class="form-group"><label class="form-label">Name *</label><input type="text" class="form-input" id="f-name" value="${ctrl?.name || ''}"></div><div class="form-row"><div class="form-group"><label class="form-label">Framework</label><select class="form-select" id="f-framework">${['ISO 27001', 'NIST CSF', 'SOC 2', 'PCI DSS', 'HIPAA', 'GDPR', 'CIS'].map(f => `<option value="${f}" ${ctrl?.framework === f ? 'selected' : ''}>${f}</option>`).join('')}</select></div><div class="form-group"><label class="form-label">Reference</label><input type="text" class="form-input" id="f-ref" value="${ctrl?.ref || ''}" placeholder="e.g., A.5.17"></div></div><div class="form-row"><div class="form-group"><label class="form-label">Effectiveness</label><select class="form-select" id="f-effectiveness">${['Effective', 'Partially Effective', 'Ineffective', 'Not Tested'].map(e => `<option value="${e}" ${ctrl?.effectiveness === e ? 'selected' : ''}>${e}</option>`).join('')}</select></div><div class="form-group"><label class="form-label">Frequency</label><select class="form-select" id="f-frequency">${['Continuous', 'Monthly', 'Quarterly', 'Annual'].map(f => `<option value="${f}" ${ctrl?.frequency === f ? 'selected' : ''}>${f}</option>`).join('')}</select></div></div><div class="form-group"><label class="form-label">Owner</label><input type="text" class="form-input" id="f-owner" value="${ctrl?.owner || ''}"></div><div class="form-group"><label class="form-label">Description</label><textarea class="form-textarea" id="f-desc">${ctrl?.description || ''}</textarea></div>`, `<button class="btn btn-secondary" onclick="closeModal()">Cancel</button><button class="btn btn-primary" onclick="app.saveControl('${ctrl?.id || ''}')">${isEdit ? 'Update' : 'Create'}</button>`);
    }
    saveControl(editId) {
        const name = document.getElementById('f-name').value.trim();
        if (!name) { this.toast('Please enter name', 'error'); return; }
        const item = { id: editId || this.generateId('CTL'), name, framework: document.getElementById('f-framework').value, ref: document.getElementById('f-ref').value, effectiveness: document.getElementById('f-effectiveness').value, frequency: document.getElementById('f-frequency').value, owner: document.getElementById('f-owner').value, description: document.getElementById('f-desc').value, createdAt: editId ? this.data.controls.find(c => c.id === editId)?.createdAt : new Date().toISOString(), updatedAt: new Date().toISOString() };
        if (editId) { const idx = this.data.controls.findIndex(c => c.id === editId); if (idx !== -1) this.data.controls[idx] = item; } else { this.data.controls.push(item); }
        this.saveData('controls'); closeModal(); this.renderControls(); this.toast(editId ? 'Control updated' : 'Control created', 'success');
    }
    editControl(id) { const c = this.data.controls.find(x => x.id === id); if (c) this.showControlModal(c); }
    renderTreatments() {
        const c = document.getElementById('tab-treatments');
        c.innerHTML = `<div class="table-container"><div class="table-header"><h3 class="table-title">Risk Treatment Plans</h3><button class="btn btn-primary btn-sm" onclick="app.showTreatmentModal()"><i class="bi bi-plus-lg"></i> Add Treatment</button></div>${this.data.treatments.length > 0 ? `<table><thead><tr><th>ID</th><th>Risk</th><th>Type</th><th>Status</th><th>Owner</th><th>Due Date</th><th>Actions</th></tr></thead><tbody>${this.data.treatments.map(t => { const risk = this.data.risks.find(r => r.id === t.riskId); return `<tr><td><span class="font-mono text-muted">${t.id}</span></td><td>${risk?.title || t.riskId}</td><td><span class="badge badge-${t.type === 'Mitigate' ? 'blue' : t.type === 'Accept' ? 'green' : t.type === 'Transfer' ? 'purple' : 'amber'}">${t.type}</span></td><td><span class="badge badge-${t.status === 'Completed' ? 'green' : t.status === 'In Progress' ? 'amber' : 'gray'}">${t.status}</span></td><td>${t.owner}</td><td>${t.dueDate ? new Date(t.dueDate).toLocaleDateString() : '-'}</td><td><button class="btn btn-ghost btn-sm" onclick="app.editTreatment('${t.id}')"><i class="bi bi-pencil"></i></button><button class="btn btn-ghost btn-sm" onclick="app.deleteItem('treatments','${t.id}')"><i class="bi bi-trash3"></i></button></td></tr>`; }).join('')}</tbody></table>` : this.renderEmpty('bi-bandaid', 'No Treatments Yet', 'Create treatment plans to address risks.', 'showTreatmentModal')}</div>`;
    }
    showTreatmentModal(t = null) {
        const isEdit = t !== null;
        openModal(isEdit ? 'Edit Treatment' : 'Add Treatment', `<div class="form-group"><label class="form-label">Related Risk *</label><select class="form-select" id="f-risk"><option value="">-- Select Risk --</option>${this.data.risks.map(r => `<option value="${r.id}" ${t?.riskId === r.id ? 'selected' : ''}>${r.title}</option>`).join('')}</select></div><div class="form-row"><div class="form-group"><label class="form-label">Type</label><select class="form-select" id="f-type">${['Mitigate', 'Accept', 'Transfer', 'Avoid'].map(ty => `<option value="${ty}" ${t?.type === ty ? 'selected' : ''}>${ty}</option>`).join('')}</select></div><div class="form-group"><label class="form-label">Status</label><select class="form-select" id="f-status">${['Planned', 'In Progress', 'Completed'].map(s => `<option value="${s}" ${t?.status === s ? 'selected' : ''}>${s}</option>`).join('')}</select></div></div><div class="form-row"><div class="form-group"><label class="form-label">Owner</label><input type="text" class="form-input" id="f-owner" value="${t?.owner || ''}"></div><div class="form-group"><label class="form-label">Due Date</label><input type="date" class="form-input" id="f-due" value="${t?.dueDate?.split('T')[0] || ''}"></div></div><div class="form-group"><label class="form-label">Plan</label><textarea class="form-textarea" id="f-plan">${t?.plan || ''}</textarea></div>`, `<button class="btn btn-secondary" onclick="closeModal()">Cancel</button><button class="btn btn-primary" onclick="app.saveTreatment('${t?.id || ''}')">${isEdit ? 'Update' : 'Create'}</button>`);
    }
    saveTreatment(editId) {
        const riskId = document.getElementById('f-risk').value;
        if (!riskId) { this.toast('Please select a risk', 'error'); return; }
        const item = { id: editId || this.generateId('TRT'), riskId, type: document.getElementById('f-type').value, status: document.getElementById('f-status').value, owner: document.getElementById('f-owner').value, dueDate: document.getElementById('f-due').value || null, plan: document.getElementById('f-plan').value, createdAt: editId ? this.data.treatments.find(t => t.id === editId)?.createdAt : new Date().toISOString(), updatedAt: new Date().toISOString() };
        if (editId) { const idx = this.data.treatments.findIndex(t => t.id === editId); if (idx !== -1) this.data.treatments[idx] = item; } else { this.data.treatments.push(item); }
        this.saveData('treatments'); closeModal(); this.renderTreatments(); this.toast(editId ? 'Treatment updated' : 'Treatment created', 'success');
    }
    editTreatment(id) { const t = this.data.treatments.find(x => x.id === id); if (t) this.showTreatmentModal(t); }
    renderMatrix() {
        const c = document.getElementById('tab-matrix');
        const matrix = Array(5).fill(null).map(() => Array(5).fill(null).map(() => []));
        this.data.risks.forEach(r => { if (r.likelihood >= 1 && r.likelihood <= 5 && r.impact >= 1 && r.impact <= 5) matrix[5 - r.impact][r.likelihood - 1].push(r); });
        const getCellClass = (l, i) => { const score = l * i; if (score >= 20) return 'risk-critical'; if (score >= 12) return 'risk-high'; if (score >= 6) return 'risk-medium'; return 'risk-low'; };
        c.innerHTML = `<div class="card"><div class="card-header"><h3 class="card-title"><i class="bi bi-grid-3x3"></i> 5×5 Risk Heat Map</h3></div><div class="card-body"><div class="risk-matrix"><div class="risk-matrix-cell risk-matrix-header"></div>${[1,2,3,4,5].map(l => `<div class="risk-matrix-cell risk-matrix-header">L${l}</div>`).join('')}${[5,4,3,2,1].map(i => `<div class="risk-matrix-cell risk-matrix-header">I${i}</div>${[1,2,3,4,5].map(l => { const risks = matrix[5-i][l-1]; return `<div class="risk-matrix-cell ${getCellClass(l, i)}" title="${risks.length} risk(s)">${risks.length > 0 ? `<span style="font-size:16px;">${risks.length}</span>` : ''}</div>`; }).join('')}`).join('')}</div><div class="mt-4"><div class="chart-legend" style="justify-content:flex-start;"><div class="legend-item"><div class="legend-dot" style="background:#4ade80;"></div>Low (1-5)</div><div class="legend-item"><div class="legend-dot" style="background:#fbbf24;"></div>Medium (6-11)</div><div class="legend-item"><div class="legend-dot" style="background:#fb923c;"></div>High (12-19)</div><div class="legend-item"><div class="legend-dot" style="background:#f87171;"></div>Critical (20-25)</div></div></div></div></div>`;
    }
    renderIssues() {
        const c = document.getElementById('tab-issues');
        c.innerHTML = `<div class="table-container"><div class="table-header"><h3 class="table-title">Issue Tracker</h3><button class="btn btn-primary btn-sm" onclick="app.showIssueModal()"><i class="bi bi-plus-lg"></i> Add Issue</button></div>${this.data.issues.length > 0 ? `<table><thead><tr><th>ID</th><th>Title</th><th>Category</th><th>Severity</th><th>Status</th><th>Owner</th><th>Actions</th></tr></thead><tbody>${this.data.issues.map(i => `<tr><td><span class="font-mono text-muted">${i.id}</span></td><td class="font-semibold">${i.title}</td><td><span class="badge badge-blue">${i.category}</span></td><td><span class="badge badge-${i.severity === 'Critical' ? 'red' : i.severity === 'High' ? 'amber' : 'green'}">${i.severity}</span></td><td><span class="badge badge-${i.status === 'Closed' ? 'green' : i.status === 'In Progress' ? 'amber' : 'red'}">${i.status}</span></td><td>${i.owner}</td><td><button class="btn btn-ghost btn-sm" onclick="app.editIssue('${i.id}')"><i class="bi bi-pencil"></i></button><button class="btn btn-ghost btn-sm" onclick="app.deleteItem('issues','${i.id}')"><i class="bi bi-trash3"></i></button></td></tr>`).join('')}</tbody></table>` : this.renderEmpty('bi-bug', 'No Issues Yet', 'Track compliance and security issues.', 'showIssueModal')}</div>`;
    }
    showIssueModal(i = null) {
        const isEdit = i !== null;
        openModal(isEdit ? 'Edit Issue' : 'Add Issue', `<div class="form-group"><label class="form-label">Title *</label><input type="text" class="form-input" id="f-title" value="${i?.title || ''}"></div><div class="form-row"><div class="form-group"><label class="form-label">Category</label><select class="form-select" id="f-category">${['Process Gap', 'Compliance Issue', 'Technical Debt', 'Security Gap'].map(c => `<option value="${c}" ${i?.category === c ? 'selected' : ''}>${c}</option>`).join('')}</select></div><div class="form-group"><label class="form-label">Severity</label><select class="form-select" id="f-severity">${['Critical', 'High', 'Medium', 'Low'].map(s => `<option value="${s}" ${i?.severity === s ? 'selected' : ''}>${s}</option>`).join('')}</select></div></div><div class="form-row"><div class="form-group"><label class="form-label">Status</label><select class="form-select" id="f-status">${['Open', 'In Progress', 'Closed'].map(s => `<option value="${s}" ${i?.status === s ? 'selected' : ''}>${s}</option>`).join('')}</select></div><div class="form-group"><label class="form-label">Owner</label><input type="text" class="form-input" id="f-owner" value="${i?.owner || ''}"></div></div><div class="form-group"><label class="form-label">Due Date</label><input type="date" class="form-input" id="f-due" value="${i?.dueDate?.split('T')[0] || ''}"></div><div class="form-group"><label class="form-label">Description</label><textarea class="form-textarea" id="f-desc">${i?.description || ''}</textarea></div>`, `<button class="btn btn-secondary" onclick="closeModal()">Cancel</button><button class="btn btn-primary" onclick="app.saveIssue('${i?.id || ''}')">${isEdit ? 'Update' : 'Create'}</button>`);
    }
    saveIssue(editId) {
        const title = document.getElementById('f-title').value.trim();
        if (!title) { this.toast('Please enter title', 'error'); return; }
        const item = { id: editId || this.generateId('ISS'), title, category: document.getElementById('f-category').value, severity: document.getElementById('f-severity').value, status: document.getElementById('f-status').value, owner: document.getElementById('f-owner').value, dueDate: document.getElementById('f-due').value || null, description: document.getElementById('f-desc').value, createdAt: editId ? this.data.issues.find(i => i.id === editId)?.createdAt : new Date().toISOString(), updatedAt: new Date().toISOString() };
        if (editId) { const idx = this.data.issues.findIndex(i => i.id === editId); if (idx !== -1) this.data.issues[idx] = item; } else { this.data.issues.push(item); }
        this.saveData('issues'); closeModal(); this.renderIssues(); this.toast(editId ? 'Issue updated' : 'Issue created', 'success');
    }
    editIssue(id) { const i = this.data.issues.find(x => x.id === id); if (i) this.showIssueModal(i); }
    renderIncidents() {
        const c = document.getElementById('tab-incidents');
        c.innerHTML = `<div class="table-container"><div class="table-header"><h3 class="table-title">Incident Log</h3><button class="btn btn-primary btn-sm" onclick="app.showIncidentModal()"><i class="bi bi-plus-lg"></i> Add Incident</button></div>${this.data.incidents.length > 0 ? `<table><thead><tr><th>ID</th><th>Title</th><th>Type</th><th>Severity</th><th>Status</th><th>Date</th><th>Actions</th></tr></thead><tbody>${this.data.incidents.map(i => `<tr><td><span class="font-mono text-muted">${i.id}</span></td><td class="font-semibold">${i.title}</td><td><span class="badge badge-blue">${i.type}</span></td><td><span class="badge badge-${i.severity === 'Critical' ? 'red' : i.severity === 'High' ? 'amber' : 'green'}">${i.severity}</span></td><td><span class="badge badge-${i.status === 'Resolved' ? 'green' : 'amber'}">${i.status}</span></td><td>${i.date ? new Date(i.date).toLocaleDateString() : '-'}</td><td><button class="btn btn-ghost btn-sm" onclick="app.editIncident('${i.id}')"><i class="bi bi-pencil"></i></button><button class="btn btn-ghost btn-sm" onclick="app.deleteItem('incidents','${i.id}')"><i class="bi bi-trash3"></i></button></td></tr>`).join('')}</tbody></table>` : this.renderEmpty('bi-lightning', 'No Incidents Yet', 'Log security and operational incidents.', 'showIncidentModal')}</div>`;
    }
    showIncidentModal(i = null) {
        const isEdit = i !== null;
        openModal(isEdit ? 'Edit Incident' : 'Add Incident', `<div class="form-group"><label class="form-label">Title *</label><input type="text" class="form-input" id="f-title" value="${i?.title || ''}"></div><div class="form-row"><div class="form-group"><label class="form-label">Type</label><select class="form-select" id="f-type">${['Security', 'Availability', 'Phishing', 'Data Breach', 'Other'].map(t => `<option value="${t}" ${i?.type === t ? 'selected' : ''}>${t}</option>`).join('')}</select></div><div class="form-group"><label class="form-label">Severity</label><select class="form-select" id="f-severity">${['Critical', 'High', 'Medium', 'Low'].map(s => `<option value="${s}" ${i?.severity === s ? 'selected' : ''}>${s}</option>`).join('')}</select></div></div><div class="form-row"><div class="form-group"><label class="form-label">Status</label><select class="form-select" id="f-status">${['Investigating', 'Resolved'].map(s => `<option value="${s}" ${i?.status === s ? 'selected' : ''}>${s}</option>`).join('')}</select></div><div class="form-group"><label class="form-label">Date</label><input type="date" class="form-input" id="f-date" value="${i?.date?.split('T')[0] || ''}"></div></div><div class="form-group"><label class="form-label">Owner</label><input type="text" class="form-input" id="f-owner" value="${i?.owner || ''}"></div><div class="form-group"><label class="form-label">Description</label><textarea class="form-textarea" id="f-desc">${i?.description || ''}</textarea></div>`, `<button class="btn btn-secondary" onclick="closeModal()">Cancel</button><button class="btn btn-primary" onclick="app.saveIncident('${i?.id || ''}')">${isEdit ? 'Update' : 'Create'}</button>`);
    }
    saveIncident(editId) {
        const title = document.getElementById('f-title').value.trim();
        if (!title) { this.toast('Please enter title', 'error'); return; }
        const item = { id: editId || this.generateId('INC'), title, type: document.getElementById('f-type').value, severity: document.getElementById('f-severity').value, status: document.getElementById('f-status').value, date: document.getElementById('f-date').value || null, owner: document.getElementById('f-owner').value, description: document.getElementById('f-desc').value, createdAt: editId ? this.data.incidents.find(i => i.id === editId)?.createdAt : new Date().toISOString(), updatedAt: new Date().toISOString() };
        if (editId) { const idx = this.data.incidents.findIndex(i => i.id === editId); if (idx !== -1) this.data.incidents[idx] = item; } else { this.data.incidents.push(item); }
        this.saveData('incidents'); closeModal(); this.renderIncidents(); this.toast(editId ? 'Incident updated' : 'Incident logged', 'success');
    }
    editIncident(id) { const i = this.data.incidents.find(x => x.id === id); if (i) this.showIncidentModal(i); }
    renderTasks() {
        const c = document.getElementById('tab-tasks');
        c.innerHTML = `<div class="table-container"><div class="table-header"><h3 class="table-title">Task Management</h3><button class="btn btn-primary btn-sm" onclick="app.showTaskModal()"><i class="bi bi-plus-lg"></i> Add Task</button></div>${this.data.tasks.length > 0 ? `<table><thead><tr><th>ID</th><th>Title</th><th>Priority</th><th>Status</th><th>Assignee</th><th>Due Date</th><th>Actions</th></tr></thead><tbody>${this.data.tasks.map(t => `<tr><td><span class="font-mono text-muted">${t.id}</span></td><td class="font-semibold">${t.title}</td><td><span class="badge badge-${t.priority === 'Critical' ? 'red' : t.priority === 'High' ? 'amber' : 'blue'}">${t.priority}</span></td><td><span class="badge badge-${t.status === 'Completed' ? 'green' : t.status === 'In Progress' ? 'amber' : 'gray'}">${t.status}</span></td><td>${t.assignee}</td><td>${t.dueDate ? new Date(t.dueDate).toLocaleDateString() : '-'}</td><td><button class="btn btn-ghost btn-sm" onclick="app.editTask('${t.id}')"><i class="bi bi-pencil"></i></button><button class="btn btn-ghost btn-sm" onclick="app.deleteItem('tasks','${t.id}')"><i class="bi bi-trash3"></i></button></td></tr>`).join('')}</tbody></table>` : this.renderEmpty('bi-check2-square', 'No Tasks Yet', 'Track remediation and action items.', 'showTaskModal')}</div>`;
    }
    showTaskModal(t = null) {
        const isEdit = t !== null;
        openModal(isEdit ? 'Edit Task' : 'Add Task', `<div class="form-group"><label class="form-label">Title *</label><input type="text" class="form-input" id="f-title" value="${t?.title || ''}"></div><div class="form-row"><div class="form-group"><label class="form-label">Priority</label><select class="form-select" id="f-priority">${['Critical', 'High', 'Medium', 'Low'].map(p => `<option value="${p}" ${t?.priority === p ? 'selected' : ''}>${p}</option>`).join('')}</select></div><div class="form-group"><label class="form-label">Status</label><select class="form-select" id="f-status">${['Not Started', 'In Progress', 'Completed'].map(s => `<option value="${s}" ${t?.status === s ? 'selected' : ''}>${s}</option>`).join('')}</select></div></div><div class="form-row"><div class="form-group"><label class="form-label">Assignee</label><input type="text" class="form-input" id="f-assignee" value="${t?.assignee || ''}"></div><div class="form-group"><label class="form-label">Due Date</label><input type="date" class="form-input" id="f-due" value="${t?.dueDate?.split('T')[0] || ''}"></div></div><div class="form-group"><label class="form-label">Notes</label><textarea class="form-textarea" id="f-notes">${t?.notes || ''}</textarea></div>`, `<button class="btn btn-secondary" onclick="closeModal()">Cancel</button><button class="btn btn-primary" onclick="app.saveTask('${t?.id || ''}')">${isEdit ? 'Update' : 'Create'}</button>`);
    }
    saveTask(editId) {
        const title = document.getElementById('f-title').value.trim();
        if (!title) { this.toast('Please enter title', 'error'); return; }
        const item = { id: editId || this.generateId('TSK'), title, priority: document.getElementById('f-priority').value, status: document.getElementById('f-status').value, assignee: document.getElementById('f-assignee').value, dueDate: document.getElementById('f-due').value || null, notes: document.getElementById('f-notes').value, createdAt: editId ? this.data.tasks.find(t => t.id === editId)?.createdAt : new Date().toISOString(), updatedAt: new Date().toISOString() };
        if (editId) { const idx = this.data.tasks.findIndex(t => t.id === editId); if (idx !== -1) this.data.tasks[idx] = item; } else { this.data.tasks.push(item); }
        this.saveData('tasks'); closeModal(); this.renderTasks(); this.toast(editId ? 'Task updated' : 'Task created', 'success');
    }
    editTask(id) { const t = this.data.tasks.find(x => x.id === id); if (t) this.showTaskModal(t); }
    renderAudits() {
        const c = document.getElementById('tab-audits');
        c.innerHTML = `<div class="table-container"><div class="table-header"><h3 class="table-title">Audit Schedule</h3><button class="btn btn-primary btn-sm" onclick="app.showAuditModal()"><i class="bi bi-plus-lg"></i> Add Audit</button></div>${this.data.audits.length > 0 ? `<table><thead><tr><th>ID</th><th>Audit Name</th><th>Type</th><th>Status</th><th>Lead</th><th>Start Date</th><th>Actions</th></tr></thead><tbody>${this.data.audits.map(a => `<tr><td><span class="font-mono text-muted">${a.id}</span></td><td class="font-semibold">${a.name}</td><td><span class="fw-badge fw-${a.type.toLowerCase().replace(/\s/g, '')}">${a.type}</span></td><td><span class="badge badge-${a.status === 'Completed' ? 'green' : a.status === 'In Progress' ? 'amber' : 'blue'}">${a.status}</span></td><td>${a.lead}</td><td>${a.startDate ? new Date(a.startDate).toLocaleDateString() : '-'}</td><td><button class="btn btn-ghost btn-sm" onclick="app.editAudit('${a.id}')"><i class="bi bi-pencil"></i></button><button class="btn btn-ghost btn-sm" onclick="app.deleteItem('audits','${a.id}')"><i class="bi bi-trash3"></i></button></td></tr>`).join('')}</tbody></table>` : this.renderEmpty('bi-clipboard-check', 'No Audits Yet', 'Schedule and track audits.', 'showAuditModal')}</div>`;
    }
    showAuditModal(a = null) {
        const isEdit = a !== null;
        openModal(isEdit ? 'Edit Audit' : 'Add Audit', `<div class="form-group"><label class="form-label">Audit Name *</label><input type="text" class="form-input" id="f-name" value="${a?.name || ''}"></div><div class="form-row"><div class="form-group"><label class="form-label">Type</label><select class="form-select" id="f-type">${['SOC 2', 'ISO 27001', 'PCI DSS', 'HIPAA', 'Internal', 'GDPR'].map(t => `<option value="${t}" ${a?.type === t ? 'selected' : ''}>${t}</option>`).join('')}</select></div><div class="form-group"><label class="form-label">Status</label><select class="form-select" id="f-status">${['Planned', 'In Progress', 'Completed'].map(s => `<option value="${s}" ${a?.status === s ? 'selected' : ''}>${s}</option>`).join('')}</select></div></div><div class="form-row"><div class="form-group"><label class="form-label">Lead</label><input type="text" class="form-input" id="f-lead" value="${a?.lead || ''}"></div><div class="form-group"><label class="form-label">Start Date</label><input type="date" class="form-input" id="f-start" value="${a?.startDate?.split('T')[0] || ''}"></div></div><div class="form-group"><label class="form-label">Scope</label><textarea class="form-textarea" id="f-scope">${a?.scope || ''}</textarea></div>`, `<button class="btn btn-secondary" onclick="closeModal()">Cancel</button><button class="btn btn-primary" onclick="app.saveAudit('${a?.id || ''}')">${isEdit ? 'Update' : 'Create'}</button>`);
    }
    saveAudit(editId) {
        const name = document.getElementById('f-name').value.trim();
        if (!name) { this.toast('Please enter name', 'error'); return; }
        const item = { id: editId || this.generateId('AUD'), name, type: document.getElementById('f-type').value, status: document.getElementById('f-status').value, lead: document.getElementById('f-lead').value, startDate: document.getElementById('f-start').value || null, scope: document.getElementById('f-scope').value, createdAt: editId ? this.data.audits.find(a => a.id === editId)?.createdAt : new Date().toISOString(), updatedAt: new Date().toISOString() };
        if (editId) { const idx = this.data.audits.findIndex(a => a.id === editId); if (idx !== -1) this.data.audits[idx] = item; } else { this.data.audits.push(item); }
        this.saveData('audits'); closeModal(); this.renderAudits(); this.toast(editId ? 'Audit updated' : 'Audit scheduled', 'success');
    }
    editAudit(id) { const a = this.data.audits.find(x => x.id === id); if (a) this.showAuditModal(a); }
    renderEvidence() {
        const c = document.getElementById('tab-evidence');
        c.innerHTML = `<div class="table-container"><div class="table-header"><h3 class="table-title">Evidence Library</h3><button class="btn btn-primary btn-sm" onclick="app.showEvidenceModal()"><i class="bi bi-plus-lg"></i> Add Evidence</button></div>${this.data.evidence.length > 0 ? `<table><thead><tr><th>ID</th><th>Title</th><th>Type</th><th>Related To</th><th>Owner</th><th>Actions</th></tr></thead><tbody>${this.data.evidence.map(e => `<tr><td><span class="font-mono text-muted">${e.id}</span></td><td class="font-semibold">${e.title}</td><td><span class="badge badge-blue">${e.type}</span></td><td>${e.relatedTo || '-'}</td><td>${e.owner}</td><td><button class="btn btn-ghost btn-sm" onclick="app.editEvidence('${e.id}')"><i class="bi bi-pencil"></i></button><button class="btn btn-ghost btn-sm" onclick="app.deleteItem('evidence','${e.id}')"><i class="bi bi-trash3"></i></button></td></tr>`).join('')}</tbody></table>` : this.renderEmpty('bi-folder2-open', 'No Evidence Yet', 'Upload and organize audit evidence.', 'showEvidenceModal')}</div>`;
    }
    showEvidenceModal(e = null) {
        const isEdit = e !== null;
        openModal(isEdit ? 'Edit Evidence' : 'Add Evidence', `<div class="form-group"><label class="form-label">Title *</label><input type="text" class="form-input" id="f-title" value="${e?.title || ''}"></div><div class="form-row"><div class="form-group"><label class="form-label">Type</label><select class="form-select" id="f-type">${['Screenshot', 'Document', 'Report', 'Export', 'Configuration', 'Log'].map(t => `<option value="${t}" ${e?.type === t ? 'selected' : ''}>${t}</option>`).join('')}</select></div><div class="form-group"><label class="form-label">Related Control</label><select class="form-select" id="f-related"><option value="">-- None --</option>${this.data.controls.map(c => `<option value="${c.id}" ${e?.relatedTo === c.id ? 'selected' : ''}>${c.name}</option>`).join('')}</select></div></div><div class="form-group"><label class="form-label">Owner</label><input type="text" class="form-input" id="f-owner" value="${e?.owner || ''}"></div><div class="form-group"><label class="form-label">URL/Location</label><input type="text" class="form-input" id="f-url" value="${e?.url || ''}"></div><div class="form-group"><label class="form-label">Notes</label><textarea class="form-textarea" id="f-notes">${e?.notes || ''}</textarea></div>`, `<button class="btn btn-secondary" onclick="closeModal()">Cancel</button><button class="btn btn-primary" onclick="app.saveEvidence('${e?.id || ''}')">${isEdit ? 'Update' : 'Create'}</button>`);
    }
    saveEvidence(editId) {
        const title = document.getElementById('f-title').value.trim();
        if (!title) { this.toast('Please enter title', 'error'); return; }
        const item = { id: editId || this.generateId('EVD'), title, type: document.getElementById('f-type').value, relatedTo: document.getElementById('f-related').value || null, owner: document.getElementById('f-owner').value, url: document.getElementById('f-url').value, notes: document.getElementById('f-notes').value, createdAt: editId ? this.data.evidence.find(e => e.id === editId)?.createdAt : new Date().toISOString(), updatedAt: new Date().toISOString() };
        if (editId) { const idx = this.data.evidence.findIndex(e => e.id === editId); if (idx !== -1) this.data.evidence[idx] = item; } else { this.data.evidence.push(item); }
        this.saveData('evidence'); closeModal(); this.renderEvidence(); this.toast(editId ? 'Evidence updated' : 'Evidence added', 'success');
    }
    editEvidence(id) { const e = this.data.evidence.find(x => x.id === id); if (e) this.showEvidenceModal(e); }
    renderTesting() {
        const c = document.getElementById('tab-testing');
        c.innerHTML = `<div class="table-container"><div class="table-header"><h3 class="table-title">Control Testing</h3><button class="btn btn-primary btn-sm" onclick="app.showTestModal()"><i class="bi bi-plus-lg"></i> Add Test</button></div>${this.data.controlTests.length > 0 ? `<table><thead><tr><th>ID</th><th>Control</th><th>Test Date</th><th>Result</th><th>Tester</th><th>Actions</th></tr></thead><tbody>${this.data.controlTests.map(t => { const ctrl = this.data.controls.find(c => c.id === t.controlId); return `<tr><td><span class="font-mono text-muted">${t.id}</span></td><td>${ctrl?.name || t.controlId}</td><td>${t.testDate ? new Date(t.testDate).toLocaleDateString() : '-'}</td><td><span class="badge badge-${t.result === 'Pass' ? 'green' : t.result === 'Fail' ? 'red' : 'amber'}">${t.result}</span></td><td>${t.tester}</td><td><button class="btn btn-ghost btn-sm" onclick="app.editTest('${t.id}')"><i class="bi bi-pencil"></i></button><button class="btn btn-ghost btn-sm" onclick="app.deleteItem('controlTests','${t.id}')"><i class="bi bi-trash3"></i></button></td></tr>`; }).join('')}</tbody></table>` : this.renderEmpty('bi-card-checklist', 'No Tests Yet', 'Document control testing results.', 'showTestModal')}</div>`;
    }
    showTestModal(t = null) {
        const isEdit = t !== null;
        openModal(isEdit ? 'Edit Test' : 'Record Test', `<div class="form-group"><label class="form-label">Control *</label><select class="form-select" id="test-control"><option value="">-- Select Control --</option>${this.data.controls.map(c => `<option value="${c.id}" ${t?.controlId === c.id ? 'selected' : ''}>${c.name}</option>`).join('')}</select></div><div class="form-row"><div class="form-group"><label class="form-label">Test Date</label><input type="date" class="form-input" id="test-date" value="${t?.testDate?.split('T')[0] || ''}"></div><div class="form-group"><label class="form-label">Result</label><select class="form-select" id="test-result">${['Pass', 'Partial', 'Fail'].map(r => `<option value="${r}" ${t?.result === r ? 'selected' : ''}>${r}</option>`).join('')}</select></div></div><div class="form-group"><label class="form-label">Tester</label><input type="text" class="form-input" id="test-tester" value="${t?.tester || ''}"></div><div class="form-group"><label class="form-label">Procedure/Notes</label><textarea class="form-textarea" id="test-procedure">${t?.procedure || ''}</textarea></div>`, `<button class="btn btn-secondary" onclick="closeModal()">Cancel</button><button class="btn btn-primary" onclick="app.saveTest('${t?.id || ''}')">${isEdit ? 'Update' : 'Save'}</button>`);
    }
    saveTest(editId) {
        const controlId = document.getElementById('test-control').value;
        if (!controlId) { this.toast('Please select a control', 'error'); return; }
        const item = { id: editId || this.generateId('TST'), controlId, testDate: document.getElementById('test-date').value || null, result: document.getElementById('test-result').value, tester: document.getElementById('test-tester').value, procedure: document.getElementById('test-procedure').value, createdAt: editId ? this.data.controlTests.find(t => t.id === editId)?.createdAt : new Date().toISOString(), updatedAt: new Date().toISOString() };
        if (editId) { const idx = this.data.controlTests.findIndex(t => t.id === editId); if (idx !== -1) this.data.controlTests[idx] = item; } else { this.data.controlTests.push(item); }
        this.saveData('controlTests'); closeModal(); this.renderTesting(); this.toast(editId ? 'Test updated' : 'Test saved', 'success');
    }
    editTest(id) { const t = this.data.controlTests.find(x => x.id === id); if (t) this.showTestModal(t); }
    renderFindings() {
        const c = document.getElementById('tab-findings');
        c.innerHTML = `<div class="table-container"><div class="table-header"><h3 class="table-title">Audit Findings</h3><button class="btn btn-primary btn-sm" onclick="app.showFindingModal()"><i class="bi bi-plus-lg"></i> Add Finding</button></div>${this.data.findings.length > 0 ? `<table><thead><tr><th>ID</th><th>Title</th><th>Severity</th><th>Status</th><th>Owner</th><th>Due Date</th><th>Actions</th></tr></thead><tbody>${this.data.findings.map(f => `<tr><td><span class="font-mono text-muted">${f.id}</span></td><td class="font-semibold">${f.title}</td><td><span class="badge badge-${f.severity === 'Critical' ? 'red' : f.severity === 'High' ? 'amber' : 'green'}">${f.severity}</span></td><td><span class="badge badge-${f.status === 'Closed' ? 'green' : f.status === 'In Progress' ? 'amber' : 'red'}">${f.status}</span></td><td>${f.owner}</td><td>${f.dueDate ? new Date(f.dueDate).toLocaleDateString() : '-'}</td><td><button class="btn btn-ghost btn-sm" onclick="app.editFinding('${f.id}')"><i class="bi bi-pencil"></i></button><button class="btn btn-ghost btn-sm" onclick="app.deleteItem('findings','${f.id}')"><i class="bi bi-trash3"></i></button></td></tr>`).join('')}</tbody></table>` : this.renderEmpty('bi-search', 'No Findings Yet', 'Document audit findings.', 'showFindingModal')}</div>`;
    }
    showFindingModal(f = null) {
        const isEdit = f !== null;
        openModal(isEdit ? 'Edit Finding' : 'Add Finding', `<div class="form-group"><label class="form-label">Title *</label><input type="text" class="form-input" id="f-title" value="${f?.title || ''}"></div><div class="form-row"><div class="form-group"><label class="form-label">Severity</label><select class="form-select" id="f-severity">${['Critical', 'High', 'Medium', 'Low'].map(s => `<option value="${s}" ${f?.severity === s ? 'selected' : ''}>${s}</option>`).join('')}</select></div><div class="form-group"><label class="form-label">Status</label><select class="form-select" id="f-status">${['Open', 'In Progress', 'Closed'].map(s => `<option value="${s}" ${f?.status === s ? 'selected' : ''}>${s}</option>`).join('')}</select></div></div><div class="form-row"><div class="form-group"><label class="form-label">Owner</label><input type="text" class="form-input" id="f-owner" value="${f?.owner || ''}"></div><div class="form-group"><label class="form-label">Due Date</label><input type="date" class="form-input" id="f-due" value="${f?.dueDate?.split('T')[0] || ''}"></div></div><div class="form-group"><label class="form-label">Description</label><textarea class="form-textarea" id="f-desc">${f?.description || ''}</textarea></div><div class="form-group"><label class="form-label">Recommendation</label><textarea class="form-textarea" id="f-rec">${f?.recommendation || ''}</textarea></div>`, `<button class="btn btn-secondary" onclick="closeModal()">Cancel</button><button class="btn btn-primary" onclick="app.saveFinding('${f?.id || ''}')">${isEdit ? 'Update' : 'Create'}</button>`);
    }
    saveFinding(editId) {
        const title = document.getElementById('f-title').value.trim();
        if (!title) { this.toast('Please enter title', 'error'); return; }
        const item = { id: editId || this.generateId('FND'), title, severity: document.getElementById('f-severity').value, status: document.getElementById('f-status').value, owner: document.getElementById('f-owner').value, dueDate: document.getElementById('f-due').value || null, description: document.getElementById('f-desc').value, recommendation: document.getElementById('f-rec').value, createdAt: editId ? this.data.findings.find(f => f.id === editId)?.createdAt : new Date().toISOString(), updatedAt: new Date().toISOString() };
        if (editId) { const idx = this.data.findings.findIndex(f => f.id === editId); if (idx !== -1) this.data.findings[idx] = item; } else { this.data.findings.push(item); }
        this.saveData('findings'); closeModal(); this.renderFindings(); this.toast(editId ? 'Finding updated' : 'Finding created', 'success');
    }
    editFinding(id) { const f = this.data.findings.find(x => x.id === id); if (f) this.showFindingModal(f); }
    renderTraceability() {
        const c = document.getElementById('tab-traceability');
        if (this.data.risks.length === 0) { c.innerHTML = this.renderEmpty('bi-diagram-3', 'No Traceability Data', 'Add risks and controls first.', null); return; }
        c.innerHTML = `<div class="card"><div class="card-header"><h3 class="card-title"><i class="bi bi-diagram-3"></i> Risk → Control → Evidence Flow</h3></div><div class="card-body">${this.data.risks.slice(0, 8).map(risk => {
            const relatedTreatments = this.data.treatments.filter(t => t.riskId === risk.id).length;
            const score = risk.likelihood * risk.impact;
            return `<div class="trace-flow"><div class="trace-node"><div class="trace-node-label">Risk</div><div class="trace-node-value">${risk.title.substring(0, 25)}...</div></div><div class="trace-arrow">→</div><div class="trace-node"><div class="trace-node-label">Score</div><div class="trace-node-value">${score}</div></div><div class="trace-arrow">→</div><div class="trace-node"><div class="trace-node-label">Treatments</div><div class="trace-node-value">${relatedTreatments}</div></div><div class="trace-arrow">→</div><div class="trace-node"><div class="trace-node-label">Status</div><div class="trace-node-value">${risk.status}</div></div></div>`;
        }).join('')}</div></div>`;
    }
    renderReports() {
        const c = document.getElementById('tab-reports');
        const criticalRisks = this.data.risks.filter(r => r.likelihood * r.impact >= 20).length;
        const effectiveControls = this.data.controls.filter(ct => ct.effectiveness === 'Effective').length;
        const openFindings = this.data.findings.filter(f => f.status === 'Open').length;
        c.innerHTML = `<div class="card mb-6"><div class="card-header"><h3 class="card-title"><i class="bi bi-file-earmark-bar-graph"></i> Executive Summary</h3><button class="btn btn-primary btn-sm" onclick="app.exportData()"><i class="bi bi-download"></i> Export All</button></div><div class="card-body"><div class="dashboard-grid"><div style="background:var(--bg-elevated);padding:20px;border-radius:var(--radius-md);"><div style="font-size:32px;font-weight:700;color:var(--accent-blue);">${this.data.risks.length}</div><div style="font-size:13px;color:var(--text-muted);">Total Risks</div></div><div style="background:var(--bg-elevated);padding:20px;border-radius:var(--radius-md);"><div style="font-size:32px;font-weight:700;color:var(--accent-red);">${criticalRisks}</div><div style="font-size:13px;color:var(--text-muted);">Critical Risks</div></div><div style="background:var(--bg-elevated);padding:20px;border-radius:var(--radius-md);"><div style="font-size:32px;font-weight:700;color:var(--accent-green);">${effectiveControls}</div><div style="font-size:13px;color:var(--text-muted);">Effective Controls</div></div><div style="background:var(--bg-elevated);padding:20px;border-radius:var(--radius-md);"><div style="font-size:32px;font-weight:700;color:var(--accent-amber);">${openFindings}</div><div style="font-size:13px;color:var(--text-muted);">Open Findings</div></div></div></div></div><div class="card"><div class="card-header"><h3 class="card-title">Quick Stats</h3></div><div class="card-body"><table><tbody><tr><td>Total Assets</td><td class="font-semibold">${this.data.assets.length}</td></tr><tr><td>Total Vendors</td><td class="font-semibold">${this.data.vendors.length}</td></tr><tr><td>Total Controls</td><td class="font-semibold">${this.data.controls.length}</td></tr><tr><td>Control Tests</td><td class="font-semibold">${this.data.controlTests.length}</td></tr><tr><td>Evidence Items</td><td class="font-semibold">${this.data.evidence.length}</td></tr><tr><td>Active Audits</td><td class="font-semibold">${this.data.audits.filter(a => a.status === 'In Progress').length}</td></tr></tbody></table></div></div>`;
    }
    renderEmpty(icon, title, text, action) { return `<div class="empty-state"><div class="empty-state-icon"><i class="bi ${icon}"></i></div><h3 class="empty-state-title">${title}</h3><p class="empty-state-text">${text}</p>${action ? `<button class="btn btn-primary" onclick="app.${action}()"><i class="bi bi-plus-lg"></i> Get Started</button>` : ''}</div>`; }
    deleteItem(key, id) { if (confirm('Delete this item?')) { this.data[key] = this.data[key].filter(x => x.id !== id); this.saveData(key); this.renderCurrentTab(); this.toast('Item deleted', 'success'); } }
    toast(message, type = 'info') { const c = document.getElementById('toast-container'); const t = document.createElement('div'); t.className = `toast toast-${type}`; t.innerHTML = `<div class="toast-icon"><i class="bi ${type === 'success' ? 'bi-check-circle' : type === 'error' ? 'bi-x-circle' : 'bi-info-circle'}"></i></div><div class="toast-content"><div class="toast-message">${message}</div></div>`; c.appendChild(t); setTimeout(() => t.remove(), 4000); }
    exportData() { const d = JSON.stringify(this.data, null, 2); const b = new Blob([d], { type: 'application/json' }); const u = URL.createObjectURL(b); const a = document.createElement('a'); a.href = u; a.download = `grc-export-${new Date().toISOString().split('T')[0]}.json`; a.click(); URL.revokeObjectURL(u); this.toast('Data exported', 'success'); }
    clearAllData() { if (confirm('Clear ALL data? This cannot be undone.')) { Object.keys(this.data).forEach(k => { this.data[k] = []; localStorage.removeItem(`grc_${k}`); }); this.renderCurrentTab(); this.updateAllBadges(); this.toast('All data cleared', 'success'); } }
    loadDemo() {
        const now = new Date();
        const daysAgo = (n) => new Date(now.getTime() - n*24*60*60*1000).toISOString();
        const daysFromNow = (n) => new Date(now.getTime() + n*24*60*60*1000).toISOString();
        
        // ASSETS (10)
        this.data.assets = [
            { id: 'AST-001', name: 'Customer Portal', type: 'Application', classification: 'Critical', owner: 'Engineering', environment: 'Production', description: 'Public-facing SaaS app for 50K+ customers', createdAt: daysAgo(60), updatedAt: daysAgo(2) },
            { id: 'AST-002', name: 'Patient Database', type: 'Database', classification: 'Critical', owner: 'Data Team', environment: 'Production', description: 'PostgreSQL with PHI and medical records', createdAt: daysAgo(60), updatedAt: daysAgo(1) },
            { id: 'AST-003', name: 'AWS Production', type: 'Cloud Account', classification: 'Critical', owner: 'Cloud Team', environment: 'Production', description: 'Primary AWS account us-east-1', createdAt: daysAgo(60), updatedAt: daysAgo(3) },
            { id: 'AST-004', name: 'Admin Dashboard', type: 'Application', classification: 'High', owner: 'Engineering', environment: 'Production', description: 'Internal admin tools', createdAt: daysAgo(45), updatedAt: daysAgo(5) },
            { id: 'AST-005', name: 'API Gateway', type: 'Application', classification: 'High', owner: 'Platform', environment: 'Production', description: 'Kong gateway, 10M req/day', createdAt: daysAgo(40), updatedAt: daysAgo(7) },
            { id: 'AST-006', name: 'Corporate VPN', type: 'Network Device', classification: 'High', owner: 'IT Security', environment: 'Production', description: 'Cisco AnyConnect infrastructure', createdAt: daysAgo(90), updatedAt: daysAgo(10) },
            { id: 'AST-007', name: 'Data Warehouse', type: 'Database', classification: 'High', owner: 'Analytics', environment: 'Production', description: 'Snowflake for BI/reporting', createdAt: daysAgo(30), updatedAt: daysAgo(4) },
            { id: 'AST-008', name: 'Backup Storage', type: 'Data Store', classification: 'Critical', owner: 'Infrastructure', environment: 'DR', description: 'S3 Glacier for DR', createdAt: daysAgo(60), updatedAt: daysAgo(15) },
            { id: 'AST-009', name: 'CI/CD Pipeline', type: 'Application', classification: 'High', owner: 'DevOps', environment: 'Production', description: 'GitHub Actions deployment', createdAt: daysAgo(35), updatedAt: daysAgo(2) },
            { id: 'AST-010', name: 'Employee Laptops', type: 'Endpoint', classification: 'Medium', owner: 'IT', environment: 'Production', description: 'MacBook fleet with MDM', createdAt: daysAgo(30), updatedAt: daysAgo(8) }
        ];
        
        // VENDORS (8)
        this.data.vendors = [
            { id: 'VND-001', name: 'Amazon Web Services', service: 'Cloud Infrastructure', criticality: 'Critical', status: 'Active', owner: 'Cloud Team', contractRenewal: daysFromNow(180), notes: 'SOC 2 Type II, ISO 27001', createdAt: daysAgo(365), updatedAt: daysAgo(30) },
            { id: 'VND-002', name: 'Stripe', service: 'Payment Processing', criticality: 'Critical', status: 'Active', owner: 'Finance', contractRenewal: daysFromNow(90), notes: 'PCI DSS Level 1', createdAt: daysAgo(200), updatedAt: daysAgo(14) },
            { id: 'VND-003', name: 'Okta', service: 'Identity Management', criticality: 'Critical', status: 'Active', owner: 'IT Security', contractRenewal: daysFromNow(120), notes: 'SSO/MFA provider', createdAt: daysAgo(180), updatedAt: daysAgo(7) },
            { id: 'VND-004', name: 'Datadog', service: 'Monitoring', criticality: 'High', status: 'Active', owner: 'DevOps', contractRenewal: daysFromNow(60), notes: 'APM and log management', createdAt: daysAgo(150), updatedAt: daysAgo(21) },
            { id: 'VND-005', name: 'SendGrid', service: 'Email Delivery', criticality: 'Medium', status: 'Active', owner: 'Marketing', contractRenewal: daysFromNow(45), notes: 'Transactional email', createdAt: daysAgo(100), updatedAt: daysAgo(35) },
            { id: 'VND-006', name: 'Salesforce', service: 'CRM', criticality: 'High', status: 'Active', owner: 'Sales Ops', contractRenewal: daysFromNow(200), notes: 'Customer data with encryption', createdAt: daysAgo(400), updatedAt: daysAgo(10) },
            { id: 'VND-007', name: 'GitHub', service: 'Code Repository', criticality: 'High', status: 'Active', owner: 'Engineering', contractRenewal: daysFromNow(240), notes: 'Source code and CI/CD', createdAt: daysAgo(300), updatedAt: daysAgo(5) },
            { id: 'VND-008', name: 'Snyk', service: 'Security Scanning', criticality: 'Medium', status: 'Active', owner: 'SecOps', contractRenewal: daysFromNow(150), notes: 'Dependency scanning', createdAt: daysAgo(120), updatedAt: daysAgo(12) }
        ];
        
        // POLICIES (8)
        this.data.policies = [
            { id: 'POL-001', title: 'Information Security Policy', status: 'Approved', owner: 'CISO', reviewDate: daysFromNow(90), createdAt: daysAgo(365), updatedAt: daysAgo(30) },
            { id: 'POL-002', title: 'Access Control Policy', status: 'Approved', owner: 'IT Security', reviewDate: daysFromNow(60), createdAt: daysAgo(300), updatedAt: daysAgo(45) },
            { id: 'POL-003', title: 'Data Classification Policy', status: 'Approved', owner: 'Data Gov', reviewDate: daysFromNow(120), createdAt: daysAgo(200), updatedAt: daysAgo(60) },
            { id: 'POL-004', title: 'Incident Response Policy', status: 'Review', owner: 'SecOps', reviewDate: daysFromNow(14), createdAt: daysAgo(180), updatedAt: daysAgo(5) },
            { id: 'POL-005', title: 'Backup & Recovery Policy', status: 'Approved', owner: 'Infrastructure', reviewDate: daysFromNow(150), createdAt: daysAgo(250), updatedAt: daysAgo(90) },
            { id: 'POL-006', title: 'Acceptable Use Policy', status: 'Approved', owner: 'HR', reviewDate: daysFromNow(180), createdAt: daysAgo(400), updatedAt: daysAgo(120) },
            { id: 'POL-007', title: 'Vendor Management Policy', status: 'Draft', owner: 'Procurement', reviewDate: daysFromNow(30), createdAt: daysAgo(30), updatedAt: daysAgo(2) },
            { id: 'POL-008', title: 'Encryption Policy', status: 'Approved', owner: 'IT Security', reviewDate: daysFromNow(100), createdAt: daysAgo(150), updatedAt: daysAgo(75) }
        ];
        
        // RISKS (12)
        this.data.risks = [
            { id: 'RSK-001', title: 'Unauthorized access via compromised credentials', category: 'Access Control', status: 'In Progress', likelihood: 4, impact: 5, owner: 'IT Security', assetId: 'AST-003', description: 'Credential stuffing or phishing could grant unauthorized AWS access', createdAt: daysAgo(45), updatedAt: daysAgo(2) },
            { id: 'RSK-002', title: 'Data breach through application vulnerability', category: 'Application Security', status: 'In Progress', likelihood: 3, impact: 5, owner: 'AppSec', assetId: 'AST-001', description: 'OWASP Top 10 vulnerabilities could expose customer data', createdAt: daysAgo(40), updatedAt: daysAgo(3) },
            { id: 'RSK-003', title: 'Extended outage from failed disaster recovery', category: 'Availability', status: 'Open', likelihood: 3, impact: 4, owner: 'Infrastructure', assetId: 'AST-008', description: 'Backup restoration procedures untested for 6 months', createdAt: daysAgo(35), updatedAt: daysAgo(1) },
            { id: 'RSK-004', title: 'PHI exposure via S3 misconfiguration', category: 'Data Protection', status: 'In Progress', likelihood: 2, impact: 5, owner: 'Cloud Team', assetId: 'AST-003', description: 'IAM or bucket policy errors could expose patient data', createdAt: daysAgo(30), updatedAt: daysAgo(5) },
            { id: 'RSK-005', title: 'Vendor data breach affecting customers', category: 'Vendor Risk', status: 'Open', likelihood: 3, impact: 4, owner: 'Procurement', assetId: null, description: 'Critical vendor breach could expose shared data', createdAt: daysAgo(28), updatedAt: daysAgo(7) },
            { id: 'RSK-006', title: 'Ransomware encrypting production databases', category: 'Application Security', status: 'In Progress', likelihood: 3, impact: 5, owner: 'SecOps', assetId: 'AST-002', description: 'Ransomware could cause extended downtime and data loss', createdAt: daysAgo(25), updatedAt: daysAgo(4) },
            { id: 'RSK-007', title: 'Insider threat data exfiltration', category: 'Access Control', status: 'Open', likelihood: 2, impact: 4, owner: 'HR Security', assetId: null, description: 'Malicious insider could steal sensitive data', createdAt: daysAgo(20), updatedAt: daysAgo(10) },
            { id: 'RSK-008', title: 'API abuse causing service degradation', category: 'Availability', status: 'In Progress', likelihood: 4, impact: 3, owner: 'Platform', assetId: 'AST-005', description: 'DDoS or API abuse could overwhelm gateway', createdAt: daysAgo(18), updatedAt: daysAgo(6) },
            { id: 'RSK-009', title: 'HIPAA non-compliance penalties', category: 'Compliance', status: 'In Progress', likelihood: 2, impact: 5, owner: 'Compliance', assetId: null, description: 'Control gaps could result in $1.5M+ fines', createdAt: daysAgo(15), updatedAt: daysAgo(3) },
            { id: 'RSK-010', title: 'VPN compromise enabling lateral movement', category: 'Access Control', status: 'Open', likelihood: 3, impact: 4, owner: 'Network', assetId: 'AST-006', description: 'VPN vulnerability could enable network intrusion', createdAt: daysAgo(12), updatedAt: daysAgo(8) },
            { id: 'RSK-011', title: 'Supply chain attack via dependencies', category: 'Vendor Risk', status: 'Open', likelihood: 2, impact: 4, owner: 'Engineering', assetId: 'AST-009', description: 'Compromised npm/pip packages could introduce backdoors', createdAt: daysAgo(10), updatedAt: daysAgo(5) },
            { id: 'RSK-012', title: 'Phishing attacks targeting employees', category: 'Human Error', status: 'In Progress', likelihood: 4, impact: 3, owner: 'IT Security', assetId: 'AST-010', description: 'Sophisticated phishing campaigns', createdAt: daysAgo(8), updatedAt: daysAgo(2) }
        ];
        
        // CONTROLS (15)
        this.data.controls = [
            { id: 'CTL-001', name: 'Multi-Factor Authentication (MFA)', framework: 'ISO 27001', ref: 'A.5.17', effectiveness: 'Effective', frequency: 'Continuous', owner: 'IT Security', description: 'MFA via Okta for all admin access', createdAt: daysAgo(90), updatedAt: daysAgo(5) },
            { id: 'CTL-002', name: 'Centralized Log Monitoring', framework: 'SOC 2', ref: 'CC7.2', effectiveness: 'Effective', frequency: 'Continuous', owner: 'SecOps', description: 'Datadog SIEM with 90-day retention', createdAt: daysAgo(85), updatedAt: daysAgo(3) },
            { id: 'CTL-003', name: 'Automated Backup & Encryption', framework: 'ISO 27001', ref: 'A.8.13', effectiveness: 'Partially Effective', frequency: 'Daily', owner: 'Infrastructure', description: 'Daily AES-256 encrypted backups', createdAt: daysAgo(80), updatedAt: daysAgo(10) },
            { id: 'CTL-004', name: 'Vulnerability Scanning', framework: 'NIST CSF', ref: 'DE.CM-8', effectiveness: 'Effective', frequency: 'Weekly', owner: 'AppSec', description: 'Weekly Snyk scans, 7-day critical SLA', createdAt: daysAgo(75), updatedAt: daysAgo(7) },
            { id: 'CTL-005', name: 'Network Segmentation', framework: 'PCI DSS', ref: '1.3', effectiveness: 'Effective', frequency: 'Quarterly', owner: 'Network', description: 'VPC isolation between environments', createdAt: daysAgo(70), updatedAt: daysAgo(15) },
            { id: 'CTL-006', name: 'Access Review Process', framework: 'SOC 2', ref: 'CC6.1', effectiveness: 'Partially Effective', frequency: 'Quarterly', owner: 'IT Security', description: 'Quarterly privileged access reviews', createdAt: daysAgo(65), updatedAt: daysAgo(20) },
            { id: 'CTL-007', name: 'Data Encryption at Rest', framework: 'HIPAA', ref: '164.312(a)', effectiveness: 'Effective', frequency: 'Continuous', owner: 'Data Team', description: 'AES-256 for all PHI databases', createdAt: daysAgo(60), updatedAt: daysAgo(12) },
            { id: 'CTL-008', name: 'Security Awareness Training', framework: 'ISO 27001', ref: 'A.6.3', effectiveness: 'Effective', frequency: 'Annual', owner: 'HR', description: 'Annual training + monthly phishing sims', createdAt: daysAgo(55), updatedAt: daysAgo(30) },
            { id: 'CTL-009', name: 'Incident Response Plan', framework: 'NIST CSF', ref: 'RS.RP-1', effectiveness: 'Partially Effective', frequency: 'Annual', owner: 'SecOps', description: 'Documented IR playbooks', createdAt: daysAgo(50), updatedAt: daysAgo(8) },
            { id: 'CTL-010', name: 'API Rate Limiting', framework: 'CIS', ref: '13.1', effectiveness: 'Effective', frequency: 'Continuous', owner: 'Platform', description: '1000 req/min via Kong', createdAt: daysAgo(45), updatedAt: daysAgo(4) },
            { id: 'CTL-011', name: 'Vendor Security Assessment', framework: 'ISO 27001', ref: 'A.5.19', effectiveness: 'Ineffective', frequency: 'Annual', owner: 'Procurement', description: 'Security questionnaires (incomplete)', createdAt: daysAgo(40), updatedAt: daysAgo(25) },
            { id: 'CTL-012', name: 'Endpoint Detection & Response', framework: 'NIST CSF', ref: 'DE.CM-4', effectiveness: 'Effective', frequency: 'Continuous', owner: 'SecOps', description: 'CrowdStrike on all endpoints', createdAt: daysAgo(35), updatedAt: daysAgo(2) },
            { id: 'CTL-013', name: 'WAF Protection', framework: 'CIS', ref: '13.6', effectiveness: 'Effective', frequency: 'Continuous', owner: 'Platform', description: 'AWS WAF with OWASP rules', createdAt: daysAgo(30), updatedAt: daysAgo(6) },
            { id: 'CTL-014', name: 'Change Management', framework: 'COBIT', ref: 'BAI06', effectiveness: 'Effective', frequency: 'Per Change', owner: 'DevOps', description: 'PR reviews and deployment approvals', createdAt: daysAgo(25), updatedAt: daysAgo(1) },
            { id: 'CTL-015', name: 'Data Loss Prevention', framework: 'GDPR', ref: 'Art. 32', effectiveness: 'Ineffective', frequency: 'Continuous', owner: 'IT Security', description: 'DLP tool currently disabled', createdAt: daysAgo(20), updatedAt: daysAgo(5) }
        ];
        
        // TREATMENTS (6)
        this.data.treatments = [
            { id: 'TRT-001', riskId: 'RSK-003', type: 'Mitigate', status: 'In Progress', owner: 'Infrastructure', dueDate: daysFromNow(14), plan: '1. Document restore procedures\n2. Schedule monthly tests\n3. Create DR runbook', createdAt: daysAgo(20), updatedAt: daysAgo(3) },
            { id: 'TRT-002', riskId: 'RSK-001', type: 'Mitigate', status: 'In Progress', owner: 'IT Security', dueDate: daysFromNow(30), plan: '1. Deploy hardware security keys\n2. Enable impossible travel detection\n3. Phishing campaign', createdAt: daysAgo(18), updatedAt: daysAgo(5) },
            { id: 'TRT-003', riskId: 'RSK-005', type: 'Transfer', status: 'Planned', owner: 'Legal', dueDate: daysFromNow(45), plan: '1. Review cyber insurance\n2. Require SOC 2 from vendors\n3. Update contracts', createdAt: daysAgo(15), updatedAt: daysAgo(7) },
            { id: 'TRT-004', riskId: 'RSK-006', type: 'Mitigate', status: 'In Progress', owner: 'SecOps', dueDate: daysFromNow(21), plan: '1. Deploy ransomware detection\n2. Implement immutable backups\n3. Create response playbook', createdAt: daysAgo(12), updatedAt: daysAgo(2) },
            { id: 'TRT-005', riskId: 'RSK-007', type: 'Mitigate', status: 'Planned', owner: 'HR Security', dueDate: daysFromNow(60), plan: '1. Deploy DLP\n2. USB restrictions\n3. User behavior analytics', createdAt: daysAgo(10), updatedAt: daysAgo(4) },
            { id: 'TRT-006', riskId: 'RSK-009', type: 'Mitigate', status: 'In Progress', owner: 'Compliance', dueDate: daysFromNow(28), plan: '1. HIPAA gap assessment\n2. Remediate findings\n3. Update BAAs', createdAt: daysAgo(8), updatedAt: daysAgo(1) }
        ];
        
        // ISSUES (5)
        this.data.issues = [
            { id: 'ISS-001', title: 'Q3 access reviews incomplete', category: 'Process Gap', severity: 'High', status: 'Open', owner: 'IT Security', dueDate: daysFromNow(7), description: '45 privileged accounts pending review', createdAt: daysAgo(21), updatedAt: daysAgo(1) },
            { id: 'ISS-002', title: 'Missing BAA with analytics vendor', category: 'Compliance Issue', severity: 'Critical', status: 'In Progress', owner: 'Legal', dueDate: daysFromNow(3), description: 'Datadog processes PHI without BAA - HIPAA violation', createdAt: daysAgo(14), updatedAt: daysAgo(2) },
            { id: 'ISS-003', title: 'Outdated IR playbooks', category: 'Process Gap', severity: 'Medium', status: 'Open', owner: 'SecOps', dueDate: daysFromNow(21), description: 'Last updated 14 months ago', createdAt: daysAgo(10), updatedAt: daysAgo(5) },
            { id: 'ISS-004', title: 'Backup restore test documentation missing', category: 'Technical Debt', severity: 'High', status: 'In Progress', owner: 'Infrastructure', dueDate: daysFromNow(14), description: 'Last documented test was 8 months ago', createdAt: daysAgo(7), updatedAt: daysAgo(3) },
            { id: 'ISS-005', title: 'Encryption key rotation overdue', category: 'Security Gap', severity: 'Medium', status: 'Open', owner: 'Cloud Team', dueDate: daysFromNow(10), description: 'KMS keys not rotated in 120 days (policy: 90 days)', createdAt: daysAgo(5), updatedAt: daysAgo(2) }
        ];
        
        // INCIDENTS (4)
        this.data.incidents = [
            { id: 'INC-001', title: 'Customer portal 5xx errors', type: 'Availability', severity: 'High', status: 'Resolved', owner: 'SRE', date: daysAgo(5), description: '15-minute outage due to DB connection pool exhaustion', createdAt: daysAgo(5), updatedAt: daysAgo(4) },
            { id: 'INC-002', title: 'Phishing campaign targeting finance', type: 'Phishing', severity: 'Medium', status: 'Resolved', owner: 'SecOps', date: daysAgo(12), description: '23 employees received emails, 2 clicked, MFA blocked compromise', createdAt: daysAgo(12), updatedAt: daysAgo(10) },
            { id: 'INC-003', title: 'Unauthorized access attempt detected', type: 'Security', severity: 'High', status: 'Investigating', owner: 'SecOps', date: daysAgo(2), description: 'Multiple failed logins from suspicious IPs, accounts locked', createdAt: daysAgo(2), updatedAt: daysAgo(1) },
            { id: 'INC-004', title: 'Accidental staging data exposure', type: 'Data Breach', severity: 'Medium', status: 'Resolved', owner: 'DevOps', date: daysAgo(20), description: 'Prod data copied to staging, accessible by contractors for 2 hours', createdAt: daysAgo(20), updatedAt: daysAgo(18) }
        ];
        
        // TASKS (8)
        this.data.tasks = [
            { id: 'TSK-001', title: 'Complete Q3 access review', priority: 'High', status: 'In Progress', assignee: 'IT Security', dueDate: daysFromNow(7), notes: 'Review 45 privileged accounts', createdAt: daysAgo(21), updatedAt: daysAgo(2) },
            { id: 'TSK-002', title: 'Execute database restore test', priority: 'High', status: 'Not Started', assignee: 'DBA Team', dueDate: daysFromNow(14), notes: 'Full restore to DR environment', createdAt: daysAgo(14), updatedAt: daysAgo(7) },
            { id: 'TSK-003', title: 'Deploy hardware security keys', priority: 'Critical', status: 'In Progress', assignee: 'IT Security', dueDate: daysFromNow(21), notes: 'YubiKeys for 15 admins', createdAt: daysAgo(10), updatedAt: daysAgo(3) },
            { id: 'TSK-004', title: 'Update IR playbooks', priority: 'Medium', status: 'Not Started', assignee: 'SOC Manager', dueDate: daysFromNow(30), notes: 'Add cloud-specific scenarios', createdAt: daysAgo(7), updatedAt: daysAgo(5) },
            { id: 'TSK-005', title: 'Rotate KMS keys', priority: 'Medium', status: 'Not Started', assignee: 'Cloud Engineer', dueDate: daysFromNow(10), notes: 'All keys older than 90 days', createdAt: daysAgo(5), updatedAt: daysAgo(2) },
            { id: 'TSK-006', title: 'Finalize Datadog BAA', priority: 'Critical', status: 'In Progress', assignee: 'Legal', dueDate: daysFromNow(3), notes: 'Execute BAA for PHI processing', createdAt: daysAgo(10), updatedAt: daysAgo(1) },
            { id: 'TSK-007', title: 'Vendor security assessment - Stripe', priority: 'High', status: 'Not Started', assignee: 'Procurement', dueDate: daysFromNow(45), notes: 'Review SOC 2 and PCI compliance', createdAt: daysAgo(3), updatedAt: daysAgo(1) },
            { id: 'TSK-008', title: 'Schedule ransomware tabletop', priority: 'Medium', status: 'Not Started', assignee: 'CISO', dueDate: daysFromNow(60), notes: 'Include IT, Legal, Comms teams', createdAt: daysAgo(2), updatedAt: daysAgo(1) }
        ];
        
        // AUDITS (4)
        this.data.audits = [
            { id: 'AUD-001', name: 'SOC 2 Type II Annual', type: 'SOC 2', status: 'In Progress', lead: 'Deloitte', startDate: daysAgo(30), scope: 'Security, Availability, Confidentiality', createdAt: daysAgo(60), updatedAt: daysAgo(2) },
            { id: 'AUD-002', name: 'HIPAA Assessment', type: 'HIPAA', status: 'Planned', lead: 'Compliance Officer', startDate: daysFromNow(45), scope: 'PHI processing systems and procedures', createdAt: daysAgo(30), updatedAt: daysAgo(10) },
            { id: 'AUD-003', name: 'Internal Control Testing Q4', type: 'Internal', status: 'Planned', lead: 'Internal Audit', startDate: daysFromNow(14), scope: 'Access management, change management, IR', createdAt: daysAgo(14), updatedAt: daysAgo(5) },
            { id: 'AUD-004', name: 'PCI DSS v4.0 Gap Assessment', type: 'PCI DSS', status: 'Completed', lead: 'Coalfire', startDate: daysAgo(90), scope: 'Cardholder data environment', createdAt: daysAgo(120), updatedAt: daysAgo(60) }
        ];
        
        // EVIDENCE (10)
        this.data.evidence = [
            { id: 'EVD-001', title: 'MFA Configuration Screenshot', type: 'Screenshot', relatedTo: 'CTL-001', owner: 'IT Security', url: 'https://drive.company.com/mfa-config.png', notes: 'Okta MFA enforcement for admin groups', createdAt: daysAgo(30), updatedAt: daysAgo(5) },
            { id: 'EVD-002', title: 'SIEM Alert Rules Export', type: 'Export', relatedTo: 'CTL-002', owner: 'SecOps', url: 'https://drive.company.com/siem-rules.json', notes: '47 detection rules from Datadog', createdAt: daysAgo(25), updatedAt: daysAgo(10) },
            { id: 'EVD-003', title: 'Backup Job Report', type: 'Report', relatedTo: 'CTL-003', owner: 'Infrastructure', url: 'https://drive.company.com/backup-dec.pdf', notes: '99.2% backup completion rate', createdAt: daysAgo(20), updatedAt: daysAgo(15) },
            { id: 'EVD-004', title: 'Vulnerability Scan Results', type: 'Report', relatedTo: 'CTL-004', owner: 'AppSec', url: 'https://drive.company.com/snyk-q4.pdf', notes: '0 critical, 3 high findings', createdAt: daysAgo(15), updatedAt: daysAgo(7) },
            { id: 'EVD-005', title: 'Firewall Rule Review', type: 'Document', relatedTo: 'CTL-005', owner: 'Network', url: 'https://drive.company.com/fw-review.xlsx', notes: 'Quarterly review with approvals', createdAt: daysAgo(45), updatedAt: daysAgo(40) },
            { id: 'EVD-006', title: 'Access Review Report Q2', type: 'Report', relatedTo: 'CTL-006', owner: 'IT Security', url: 'https://drive.company.com/access-q2.pdf', notes: '98% completion rate', createdAt: daysAgo(90), updatedAt: daysAgo(85) },
            { id: 'EVD-007', title: 'KMS Key Rotation Log', type: 'Log', relatedTo: 'CTL-007', owner: 'Cloud Team', url: 'https://drive.company.com/kms.log', notes: 'CloudTrail rotation events', createdAt: daysAgo(60), updatedAt: daysAgo(55) },
            { id: 'EVD-008', title: 'Security Training Report', type: 'Report', relatedTo: 'CTL-008', owner: 'HR', url: 'https://drive.company.com/training.pdf', notes: '100% completion', createdAt: daysAgo(30), updatedAt: daysAgo(25) },
            { id: 'EVD-009', title: 'IR Plan Document', type: 'Document', relatedTo: 'CTL-009', owner: 'SecOps', url: 'https://drive.company.com/ir-plan.pdf', notes: 'v2.3 current plan', createdAt: daysAgo(240), updatedAt: daysAgo(240) },
            { id: 'EVD-010', title: 'WAF Configuration', type: 'Configuration', relatedTo: 'CTL-013', owner: 'Platform', url: 'https://drive.company.com/waf.yaml', notes: 'AWS WAF rule set', createdAt: daysAgo(45), updatedAt: daysAgo(4) }
        ];
        
        // CONTROL TESTS (6)
        this.data.controlTests = [
            { id: 'TST-001', controlId: 'CTL-001', testDate: daysAgo(14), result: 'Pass', tester: 'External Auditor', procedure: 'Verified MFA for 20 admin accounts, all required MFA', createdAt: daysAgo(14), updatedAt: daysAgo(14) },
            { id: 'TST-002', controlId: 'CTL-002', testDate: daysAgo(10), result: 'Pass', tester: 'Internal Audit', procedure: 'Generated test events, alerts triggered within SLA', createdAt: daysAgo(10), updatedAt: daysAgo(10) },
            { id: 'TST-003', controlId: 'CTL-003', testDate: daysAgo(7), result: 'Partial', tester: 'Internal Audit', procedure: 'Backups running but restore test incomplete', createdAt: daysAgo(7), updatedAt: daysAgo(7) },
            { id: 'TST-004', controlId: 'CTL-006', testDate: daysAgo(30), result: 'Fail', tester: 'External Auditor', procedure: 'Only 60% of accounts reviewed by deadline', createdAt: daysAgo(30), updatedAt: daysAgo(30) },
            { id: 'TST-005', controlId: 'CTL-013', testDate: daysAgo(12), result: 'Pass', tester: 'SecOps', procedure: 'OWASP Top 10 attacks blocked successfully', createdAt: daysAgo(12), updatedAt: daysAgo(12) },
            { id: 'TST-006', controlId: 'CTL-015', testDate: daysAgo(5), result: 'Fail', tester: 'IT Security', procedure: 'DLP tool disabled, control not operational', createdAt: daysAgo(5), updatedAt: daysAgo(5) }
        ];
        
        // FINDINGS (5)
        this.data.findings = [
            { id: 'FND-001', title: 'Backup restore testing not performed', severity: 'High', status: 'Open', owner: 'Infrastructure', dueDate: daysFromNow(14), description: 'No evidence of restore testing in 6 months', recommendation: 'Implement quarterly restore tests with documentation', createdAt: daysAgo(20), updatedAt: daysAgo(5) },
            { id: 'FND-002', title: 'DLP controls not operational', severity: 'High', status: 'Open', owner: 'IT Security', dueDate: daysFromNow(21), description: 'DLP disabled due to performance issues', recommendation: 'Optimize and re-enable DLP', createdAt: daysAgo(5), updatedAt: daysAgo(3) },
            { id: 'FND-003', title: 'Access reviews incomplete', severity: 'Medium', status: 'In Progress', owner: 'IT Security', dueDate: daysFromNow(7), description: '40% of accounts reviewed late', recommendation: 'Implement automated review workflow', createdAt: daysAgo(30), updatedAt: daysAgo(2) },
            { id: 'FND-004', title: 'Vendor SOC 2 reports expired', severity: 'Medium', status: 'In Progress', owner: 'Procurement', dueDate: daysFromNow(7), description: '2 critical vendors have expired reports', recommendation: 'Request updated reports immediately', createdAt: daysAgo(15), updatedAt: daysAgo(5) },
            { id: 'FND-005', title: 'Missing Business Associate Agreement', severity: 'Critical', status: 'In Progress', owner: 'Legal', dueDate: daysFromNow(3), description: 'BAA not executed with Datadog for PHI', recommendation: 'Execute BAA immediately, review all PHI vendors', createdAt: daysAgo(14), updatedAt: daysAgo(1) }
        ];
        
        Object.keys(this.data).forEach(k => this.saveData(k));
        this.renderCurrentTab();
        this.updateAllBadges();
        this.toast('🎉 Complete demo data loaded! Explore all 19 tabs.', 'success');
    }
    
    // ==================== FRAMEWORK LIBRARY (400+ Controls) ====================
    renderFrameworks() {
        const c = document.getElementById('tab-frameworks');
        const frameworks = this.getFrameworkControls();
        c.innerHTML = `
            <div class="table-container">
                <div class="table-header">
                    <div class="table-title"><i class="bi bi-journal-code"></i> Framework Control Library (${frameworks.length}+ Controls)</div>
                    <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                        <select class="form-control" id="fw-filter" onchange="app.filterFrameworks()" style="width: 180px;">
                            <option value="all">All Frameworks</option>
                            <option value="ISO 27001">ISO 27001 (93)</option>
                            <option value="NIST CSF">NIST CSF (20)</option>
                            <option value="PCI DSS">PCI DSS (20)</option>
                            <option value="HIPAA">HIPAA (15)</option>
                            <option value="SOC 2">SOC 2 (20)</option>
                            <option value="CIS Controls">CIS Controls (20)</option>
                            <option value="GDPR">GDPR (10)</option>
                            <option value="CMMC">CMMC (10)</option>
                            <option value="COBIT">COBIT (10)</option>
                        </select>
                        <select class="form-control" id="cat-filter" onchange="app.filterFrameworks()" style="width: 180px;">
                            <option value="all">All Categories</option>
                            <option value="Access Control">Access Control</option>
                            <option value="Asset Management">Asset Management</option>
                            <option value="Data Protection">Data Protection</option>
                            <option value="Network Security">Network Security</option>
                            <option value="Incident Management">Incident Management</option>
                            <option value="Business Continuity">Business Continuity</option>
                            <option value="Risk Management">Risk Management</option>
                            <option value="Compliance">Compliance</option>
                            <option value="Policy & Governance">Policy & Governance</option>
                            <option value="Vendor Management">Vendor Management</option>
                            <option value="Physical Security">Physical Security</option>
                            <option value="Logging & Monitoring">Logging & Monitoring</option>
                        </select>
                        <input type="text" class="form-control" id="fw-search" placeholder="Search controls..." oninput="app.filterFrameworks()" style="width: 200px;">
                    </div>
                </div>
                <div style="max-height: 600px; overflow-y: auto;">
                    <table>
                        <thead><tr><th>Control ID</th><th>Name</th><th>Category</th><th>Framework</th><th>Description</th><th>Action</th></tr></thead>
                        <tbody id="fw-table-body"></tbody>
                    </table>
                </div>
            </div>
            <div class="card mt-6">
                <div class="card-header"><div class="card-title"><i class="bi bi-info-circle"></i> About Framework Controls</div></div>
                <div class="card-body">
                    <p style="color: var(--text-secondary); margin-bottom: 12px;">This library contains 400+ security controls from 9 major compliance frameworks. Use these as reference when implementing your own controls or preparing for audits.</p>
                    <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                        ${['ISO 27001', 'NIST CSF', 'PCI DSS', 'HIPAA', 'SOC 2', 'CIS Controls', 'GDPR', 'CMMC', 'COBIT'].map(fw => `<span class="badge badge-${this.getFrameworkColor(fw)}">${fw}</span>`).join('')}
                    </div>
                </div>
            </div>`;
        setTimeout(() => this.filterFrameworks(), 0);
    }
    
    filterFrameworks() {
        const fw = document.getElementById('fw-filter')?.value || 'all';
        const cat = document.getElementById('cat-filter')?.value || 'all';
        const search = (document.getElementById('fw-search')?.value || '').toLowerCase();
        let controls = this.getFrameworkControls();
        if (fw !== 'all') controls = controls.filter(c => c.frameworks.includes(fw));
        if (cat !== 'all') controls = controls.filter(c => c.category === cat);
        if (search) controls = controls.filter(c => c.name.toLowerCase().includes(search) || c.description.toLowerCase().includes(search) || c.id.toLowerCase().includes(search));
        const tbody = document.getElementById('fw-table-body');
        if (!tbody) return;
        if (controls.length === 0) {
            tbody.innerHTML = '<tr><td colspan="6" class="empty-state"><div class="empty-state-icon"><i class="bi bi-search"></i></div><div class="empty-state-title">No matching controls</div></td></tr>';
        } else {
            tbody.innerHTML = controls.slice(0, 100).map(c => `
                <tr>
                    <td><code style="background: var(--bg-elevated); padding: 2px 6px; border-radius: 4px;">${this.esc(c.id)}</code></td>
                    <td><strong>${this.esc(c.name)}</strong></td>
                    <td>${this.esc(c.category)}</td>
                    <td>${c.frameworks.map(f => `<span class="badge badge-${this.getFrameworkColor(f)}" style="font-size: 10px;">${f}</span>`).join(' ')}</td>
                    <td style="max-width: 300px; font-size: 13px; color: var(--text-muted);">${this.esc(c.description)}</td>
                    <td><button class="btn btn-sm btn-secondary" onclick="app.adoptControl('${c.id}')"><i class="bi bi-plus"></i> Adopt</button></td>
                </tr>`).join('');
            if (controls.length > 100) {
                tbody.innerHTML += `<tr><td colspan="6" style="text-align: center; padding: 16px; color: var(--text-muted);">Showing 100 of ${controls.length} controls. Refine your search to see more.</td></tr>`;
            }
        }
    }
    
    adoptControl(ctrlId) {
        const fwCtrl = this.getFrameworkControls().find(c => c.id === ctrlId);
        if (!fwCtrl) return;
        const newCtrl = {
            id: this.generateId('CTL'),
            name: fwCtrl.name,
            type: 'Preventive',
            status: 'Planned',
            owner: 'TBD',
            effectiveness: 'Not Tested',
            frameworks: fwCtrl.frameworks,
            description: fwCtrl.description,
            createdAt: new Date().toISOString(),
            updatedAt: new Date().toISOString()
        };
        this.data.controls.push(newCtrl);
        this.saveData('controls');
        this.toast(`Control "${fwCtrl.name}" adopted to your Control Catalog`, 'success');
    }
    
    getFrameworkColor(fw) {
        const colors = { 'ISO 27001': 'blue', 'NIST CSF': 'purple', 'PCI DSS': 'amber', 'HIPAA': 'pink', 'SOC 2': 'green', 'CIS Controls': 'cyan', 'GDPR': 'red', 'CMMC': 'amber', 'COBIT': 'purple' };
        return colors[fw] || 'blue';
    }
    
    getFrameworkControls() {
        return [
            // ISO 27001:2022 (93 controls)
            {id:"ISO-5.1",name:"Security policies",category:"Policy & Governance",description:"Define, approve, communicate, and periodically review this policy to guide information security.",frameworks:["ISO 27001"]},
            {id:"ISO-5.2",name:"Info security roles",category:"Policy & Governance",description:"Implement and maintain measures for info security roles to protect confidentiality, integrity, and availability.",frameworks:["ISO 27001"]},
            {id:"ISO-5.3",name:"Segregation of duties",category:"Policy & Governance",description:"Implement and maintain measures for segregation of duties to protect confidentiality, integrity, and availability.",frameworks:["ISO 27001"]},
            {id:"ISO-5.4",name:"Management responsibilities",category:"Policy & Governance",description:"Implement and maintain measures for management responsibilities to protect confidentiality, integrity, and availability.",frameworks:["ISO 27001"]},
            {id:"ISO-5.5",name:"Authority contacts",category:"Compliance",description:"Implement and maintain measures for authority contacts to protect confidentiality, integrity, and availability.",frameworks:["ISO 27001"]},
            {id:"ISO-5.6",name:"Special interest contacts",category:"Compliance",description:"Implement and maintain measures for special interest contacts to protect confidentiality, integrity, and availability.",frameworks:["ISO 27001"]},
            {id:"ISO-5.7",name:"Threat intel",category:"Risk Management",description:"Implement and maintain measures for threat intel to protect confidentiality, integrity, and availability.",frameworks:["ISO 27001"]},
            {id:"ISO-5.8",name:"Project security",category:"Policy & Governance",description:"Implement and maintain measures for project security to protect confidentiality, integrity, and availability.",frameworks:["ISO 27001"]},
            {id:"ISO-5.9",name:"Asset inventory",category:"Asset Management",description:"Maintain an accurate, up-to-date inventory including ownership, classification, and lifecycle status.",frameworks:["ISO 27001"]},
            {id:"ISO-5.10",name:"Acceptable use",category:"Asset Management",description:"Implement and maintain measures for acceptable use to protect confidentiality, integrity, and availability.",frameworks:["ISO 27001"]},
            {id:"ISO-5.11",name:"Asset return",category:"Asset Management",description:"Implement and maintain measures for asset return to protect confidentiality, integrity, and availability.",frameworks:["ISO 27001"]},
            {id:"ISO-5.12",name:"Information classification",category:"Data Protection",description:"Implement and maintain measures for information classification to protect confidentiality, integrity, and availability.",frameworks:["ISO 27001"]},
            {id:"ISO-5.13",name:"Information labeling",category:"Data Protection",description:"Implement and maintain measures for information labeling to protect confidentiality, integrity, and availability.",frameworks:["ISO 27001"]},
            {id:"ISO-5.14",name:"Information transfer",category:"Data Protection",description:"Implement and maintain measures for information transfer to protect confidentiality, integrity, and availability.",frameworks:["ISO 27001"]},
            {id:"ISO-5.15",name:"Access control rules",category:"Access Control",description:"Establish rules and procedures to ensure only authorized identities have appropriate access throughout the lifecycle.",frameworks:["ISO 27001"]},
            {id:"ISO-5.16",name:"Identity lifecycle",category:"Access Control",description:"Establish rules and procedures to ensure only authorized identities have appropriate access throughout the lifecycle.",frameworks:["ISO 27001"]},
            {id:"ISO-5.17",name:"Authentication info handling",category:"Access Control",description:"Implement and maintain measures for authentication info handling to protect confidentiality, integrity, and availability.",frameworks:["ISO 27001"]},
            {id:"ISO-5.18",name:"Access rights",category:"Access Control",description:"Establish rules and procedures to ensure only authorized identities have appropriate access throughout the lifecycle.",frameworks:["ISO 27001"]},
            {id:"ISO-5.19",name:"Supplier security",category:"Vendor Management",description:"Define and manage security requirements for suppliers/services, including assurance, monitoring, and exit.",frameworks:["ISO 27001"]},
            {id:"ISO-5.20",name:"Supplier security requirements",category:"Vendor Management",description:"Define and manage security requirements for suppliers/services, including assurance, monitoring, and exit.",frameworks:["ISO 27001"]},
            {id:"ISO-5.21",name:"Supplier agreements security",category:"Vendor Management",description:"Define and manage security requirements for suppliers/services, including assurance, monitoring, and exit.",frameworks:["ISO 27001"]},
            {id:"ISO-5.22",name:"Supplier service monitoring",category:"Vendor Management",description:"Collect, protect, and review logs/monitoring data to detect and investigate security events.",frameworks:["ISO 27001"]},
            {id:"ISO-5.23",name:"Cloud services security",category:"Vendor Management",description:"Define and manage security requirements for suppliers/services, including assurance, monitoring, and exit.",frameworks:["ISO 27001"]},
            {id:"ISO-5.24",name:"Incident planning & readiness",category:"Incident Management",description:"Plan, prepare, and operate an incident management capability with roles, escalation, and lessons learned.",frameworks:["ISO 27001"]},
            {id:"ISO-5.25",name:"Incident assessment & decision",category:"Incident Management",description:"Plan, prepare, and operate an incident management capability with roles, escalation, and lessons learned.",frameworks:["ISO 27001"]},
            {id:"ISO-5.26",name:"Incident response & communication",category:"Incident Management",description:"Plan, prepare, and operate an incident management capability with roles, escalation, and lessons learned.",frameworks:["ISO 27001"]},
            {id:"ISO-5.27",name:"Lessons learned",category:"Incident Management",description:"Implement and maintain measures for lessons learned to protect confidentiality, integrity, and availability.",frameworks:["ISO 27001"]},
            {id:"ISO-5.28",name:"Evidence handling",category:"Incident Management",description:"Implement and maintain measures for evidence handling to protect confidentiality, integrity, and availability.",frameworks:["ISO 27001"]},
            {id:"ISO-5.29",name:"Security during disruption",category:"Business Continuity",description:"Implement and maintain measures for security during disruption to protect confidentiality, integrity, and availability.",frameworks:["ISO 27001"]},
            {id:"ISO-5.30",name:"ICT continuity readiness",category:"Business Continuity",description:"Plan, implement, and test continuity arrangements to meet recovery objectives during disruption.",frameworks:["ISO 27001"]},
            {id:"ISO-5.31",name:"Legal/regulatory/contract",category:"Compliance",description:"Implement and maintain measures for legal/regulatory/contract to protect confidentiality, integrity, and availability.",frameworks:["ISO 27001"]},
            {id:"ISO-5.32",name:"Intellectual property",category:"Compliance",description:"Implement and maintain measures for intellectual property to protect confidentiality, integrity, and availability.",frameworks:["ISO 27001"]},
            {id:"ISO-5.33",name:"Records protection",category:"Compliance",description:"Implement and maintain measures for records protection to protect confidentiality, integrity, and availability.",frameworks:["ISO 27001"]},
            {id:"ISO-5.34",name:"Privacy & personal data",category:"Data Protection",description:"Identify privacy/PII requirements and implement measures to protect personal data appropriately.",frameworks:["ISO 27001"]},
            {id:"ISO-5.35",name:"Independent security review",category:"Compliance",description:"Implement and maintain measures for independent security review to protect confidentiality, integrity, and availability.",frameworks:["ISO 27001"]},
            {id:"ISO-5.36",name:"Compliance with policies/standards",category:"Compliance",description:"Define, approve, communicate, and periodically review this policy to guide information security.",frameworks:["ISO 27001"]},
            {id:"ISO-5.37",name:"Documented operating procedures",category:"Policy & Governance",description:"Implement and maintain measures for documented operating procedures to protect confidentiality, integrity, and availability.",frameworks:["ISO 27001"]},
            {id:"ISO-6.1",name:"Screening checks",category:"Policy & Governance",description:"Implement and maintain measures for screening checks to protect confidentiality, integrity, and availability.",frameworks:["ISO 27001"]},
            {id:"ISO-6.2",name:"Terms & conditions",category:"Policy & Governance",description:"Implement and maintain measures for terms & conditions to protect confidentiality, integrity, and availability.",frameworks:["ISO 27001"]},
            {id:"ISO-6.3",name:"Awareness and training",category:"Policy & Governance",description:"Provide role-based awareness and training to ensure personnel understand responsibilities and threats.",frameworks:["ISO 27001"]},
            {id:"ISO-6.4",name:"Disciplinary process",category:"Policy & Governance",description:"Implement and maintain measures for disciplinary process to protect confidentiality, integrity, and availability.",frameworks:["ISO 27001"]},
            {id:"ISO-6.5",name:"Responsibilities after termination",category:"Policy & Governance",description:"Control changes through authorization, testing, documentation, and rollback where appropriate.",frameworks:["ISO 27001"]},
            {id:"ISO-6.6",name:"Confidentiality/NDA",category:"Policy & Governance",description:"Implement and maintain measures for confidentiality/nda to protect confidentiality, integrity, and availability.",frameworks:["ISO 27001"]},
            {id:"ISO-6.7",name:"Remote working security",category:"Access Control",description:"Implement and maintain measures for remote working security to protect confidentiality, integrity, and availability.",frameworks:["ISO 27001"]},
            {id:"ISO-6.8",name:"Event reporting",category:"Incident Management",description:"Implement and maintain measures for event reporting to protect confidentiality, integrity, and availability.",frameworks:["ISO 27001"]},
            {id:"ISO-7.1",name:"Physical security perimeters",category:"Physical Security",description:"Implement physical safeguards to prevent unauthorized access, damage, or interference.",frameworks:["ISO 27001"]},
            {id:"ISO-7.2",name:"Physical entry controls",category:"Physical Security",description:"Implement physical safeguards to prevent unauthorized access, damage, or interference.",frameworks:["ISO 27001"]},
            {id:"ISO-7.3",name:"Securing offices/rooms",category:"Physical Security",description:"Implement physical safeguards to prevent unauthorized access, damage, or interference.",frameworks:["ISO 27001"]},
            {id:"ISO-7.4",name:"Physical monitoring",category:"Physical Security",description:"Collect, protect, and review logs/monitoring data to detect and investigate security events.",frameworks:["ISO 27001"]},
            {id:"ISO-7.5",name:"Protection against threats",category:"Physical Security",description:"Implement physical safeguards to prevent unauthorized access, damage, or interference.",frameworks:["ISO 27001"]},
            {id:"ISO-7.6",name:"Working in secure areas",category:"Physical Security",description:"Implement physical safeguards to prevent unauthorized access, damage, or interference.",frameworks:["ISO 27001"]},
            {id:"ISO-7.7",name:"Clear desk / clear screen",category:"Physical Security",description:"Implement physical safeguards to prevent unauthorized access, damage, or interference.",frameworks:["ISO 27001"]},
            {id:"ISO-7.8",name:"Equipment siting & protection",category:"Physical Security",description:"Implement physical safeguards to prevent unauthorized access, damage, or interference.",frameworks:["ISO 27001"]},
            {id:"ISO-7.9",name:"Off-premises asset security",category:"Physical Security",description:"Implement physical safeguards to prevent unauthorized access, damage, or interference.",frameworks:["ISO 27001"]},
            {id:"ISO-7.10",name:"Storage media",category:"Physical Security",description:"Implement physical safeguards to prevent unauthorized access, damage, or interference.",frameworks:["ISO 27001"]},
            {id:"ISO-7.11",name:"Supporting utilities",category:"Physical Security",description:"Implement physical safeguards to prevent unauthorized access, damage, or interference.",frameworks:["ISO 27001"]},
            {id:"ISO-7.12",name:"Cabling security",category:"Physical Security",description:"Implement physical safeguards to prevent unauthorized access, damage, or interference.",frameworks:["ISO 27001"]},
            {id:"ISO-7.13",name:"Equipment maintenance",category:"Physical Security",description:"Implement physical safeguards to prevent unauthorized access, damage, or interference.",frameworks:["ISO 27001"]},
            {id:"ISO-7.14",name:"Secure disposal / reuse",category:"Physical Security",description:"Implement physical safeguards to prevent unauthorized access, damage, or interference.",frameworks:["ISO 27001"]},
            {id:"ISO-8.1",name:"Endpoint devices",category:"Asset Management",description:"Implement and maintain measures for endpoint devices to protect confidentiality, integrity, and availability.",frameworks:["ISO 27001"]},
            {id:"ISO-8.2",name:"Privileged access",category:"Access Control",description:"Establish rules and procedures to ensure only authorized identities have appropriate access throughout the lifecycle.",frameworks:["ISO 27001"]},
            {id:"ISO-8.3",name:"Information access restrictions",category:"Access Control",description:"Establish rules and procedures to ensure only authorized identities have appropriate access throughout the lifecycle.",frameworks:["ISO 27001"]},
            {id:"ISO-8.4",name:"Source code access",category:"Access Control",description:"Establish rules and procedures to ensure only authorized identities have appropriate access throughout the lifecycle.",frameworks:["ISO 27001"]},
            {id:"ISO-8.5",name:"Secure authentication",category:"Access Control",description:"Implement and maintain measures for secure authentication to protect confidentiality, integrity, and availability.",frameworks:["ISO 27001"]},
            {id:"ISO-8.6",name:"Capacity management",category:"Business Continuity",description:"Implement and maintain measures for capacity management to protect confidentiality, integrity, and availability.",frameworks:["ISO 27001"]},
            {id:"ISO-8.7",name:"Malware protection",category:"Network Security",description:"Deploy preventive and detective measures to reduce malware infection and impact.",frameworks:["ISO 27001"]},
            {id:"ISO-8.8",name:"Vulnerability management",category:"Risk Management",description:"Identify, assess, prioritize, and remediate technical vulnerabilities within defined timelines.",frameworks:["ISO 27001"]},
            {id:"ISO-8.9",name:"Configuration management",category:"Asset Management",description:"Define secure configuration baselines and manage changes to reduce unintended exposure and drift.",frameworks:["ISO 27001"]},
            {id:"ISO-8.10",name:"Information deletion",category:"Data Protection",description:"Ensure information and media are securely deleted/disposed to prevent unauthorized recovery.",frameworks:["ISO 27001"]},
            {id:"ISO-8.11",name:"Data masking",category:"Data Protection",description:"Implement and maintain measures for data masking to protect confidentiality, integrity, and availability.",frameworks:["ISO 27001"]},
            {id:"ISO-8.12",name:"Data leakage prevention",category:"Data Protection",description:"Implement and maintain measures for data leakage prevention to protect confidentiality, integrity, and availability.",frameworks:["ISO 27001"]},
            {id:"ISO-8.13",name:"Backups",category:"Business Continuity",description:"Perform backups at defined intervals, protect backup media, and regularly test restoration.",frameworks:["ISO 27001"]},
            {id:"ISO-8.14",name:"Redundancy",category:"Business Continuity",description:"Implement and maintain measures for redundancy to protect confidentiality, integrity, and availability.",frameworks:["ISO 27001"]},
            {id:"ISO-8.15",name:"Logging",category:"Logging & Monitoring",description:"Collect, protect, and review logs/monitoring data to detect and investigate security events.",frameworks:["ISO 27001"]},
            {id:"ISO-8.16",name:"Monitoring",category:"Logging & Monitoring",description:"Collect, protect, and review logs/monitoring data to detect and investigate security events.",frameworks:["ISO 27001"]},
            {id:"ISO-8.17",name:"Clock synchronization",category:"Logging & Monitoring",description:"Implement and maintain measures for clock synchronization to protect confidentiality, integrity, and availability.",frameworks:["ISO 27001"]},
            {id:"ISO-8.18",name:"Admin utilities",category:"Access Control",description:"Implement and maintain measures for admin utilities to protect confidentiality, integrity, and availability.",frameworks:["ISO 27001"]},
            {id:"ISO-8.19",name:"Software installation controls",category:"Asset Management",description:"Implement and maintain measures for software installation controls to protect confidentiality, integrity, and availability.",frameworks:["ISO 27001"]},
            {id:"ISO-8.20",name:"Network security",category:"Network Security",description:"Implement and maintain measures for network security to protect confidentiality, integrity, and availability.",frameworks:["ISO 27001"]},
            {id:"ISO-8.21",name:"Network services security",category:"Network Security",description:"Implement and maintain measures for network services security to protect confidentiality, integrity, and availability.",frameworks:["ISO 27001"]},
            {id:"ISO-8.22",name:"Network segmentation",category:"Network Security",description:"Implement and maintain measures for network segmentation to protect confidentiality, integrity, and availability.",frameworks:["ISO 27001"]},
            {id:"ISO-8.23",name:"Web filtering",category:"Network Security",description:"Implement and maintain measures for web filtering to protect confidentiality, integrity, and availability.",frameworks:["ISO 27001"]},
            {id:"ISO-8.24",name:"Cryptography use",category:"Data Protection",description:"Use cryptography appropriately and manage keys securely throughout their lifecycle.",frameworks:["ISO 27001"]},
            {id:"ISO-8.25",name:"Secure development lifecycle",category:"Asset Management",description:"Integrate security into the SDLC, including requirements, design, coding, testing, and release controls.",frameworks:["ISO 27001"]},
            {id:"ISO-8.26",name:"Application security requirements",category:"Asset Management",description:"Implement and maintain measures for application security requirements to protect confidentiality, integrity, and availability.",frameworks:["ISO 27001"]},
            {id:"ISO-8.27",name:"Secure system architecture",category:"Asset Management",description:"Implement and maintain measures for secure system architecture to protect confidentiality, integrity, and availability.",frameworks:["ISO 27001"]},
            {id:"ISO-8.28",name:"Secure coding",category:"Asset Management",description:"Implement and maintain measures for secure coding to protect confidentiality, integrity, and availability.",frameworks:["ISO 27001"]},
            {id:"ISO-8.29",name:"Security testing in development",category:"Asset Management",description:"Implement and maintain measures for security testing in development to protect confidentiality, integrity, and availability.",frameworks:["ISO 27001"]},
            {id:"ISO-8.30",name:"Outsourced development",category:"Vendor Management",description:"Define and manage security requirements for suppliers/services, including assurance, monitoring, and exit.",frameworks:["ISO 27001"]},
            {id:"ISO-8.31",name:"Separation of environments",category:"Asset Management",description:"Implement and maintain measures for separation of dev/test/prod to protect confidentiality, integrity, and availability.",frameworks:["ISO 27001"]},
            {id:"ISO-8.32",name:"Change management",category:"Asset Management",description:"Control changes through authorization, testing, documentation, and rollback where appropriate.",frameworks:["ISO 27001"]},
            {id:"ISO-8.33",name:"Test data protection",category:"Data Protection",description:"Implement and maintain measures for test data protection to protect confidentiality, integrity, and availability.",frameworks:["ISO 27001"]},
            {id:"ISO-8.34",name:"Audit system protection",category:"Compliance",description:"Implement and maintain measures for protection of info systems during audits to protect confidentiality, integrity, and availability.",frameworks:["ISO 27001"]},
            // NIST CSF 2.0 (60 key controls)
            {id:"NIST-ID.AM-01",name:"Physical devices inventory",category:"Asset Management",description:"Inventories of physical devices maintained.",frameworks:["NIST CSF"]},
            {id:"NIST-ID.AM-02",name:"Software inventory",category:"Asset Management",description:"Inventories of software platforms maintained.",frameworks:["NIST CSF"]},
            {id:"NIST-ID.GV-01",name:"Cybersecurity policy",category:"Policy & Governance",description:"Organizational cybersecurity policy established.",frameworks:["NIST CSF"]},
            {id:"NIST-ID.RA-01",name:"Asset vulnerabilities",category:"Risk Management",description:"Asset vulnerabilities identified and documented.",frameworks:["NIST CSF"]},
            {id:"NIST-ID.RA-02",name:"Cyber threat intelligence",category:"Risk Management",description:"Cyber threat intelligence received from sharing forums.",frameworks:["NIST CSF"]},
            {id:"NIST-ID.RM-01",name:"Risk management processes",category:"Risk Management",description:"Risk management processes established and managed.",frameworks:["NIST CSF"]},
            {id:"NIST-ID.SC-01",name:"Supply chain risk management",category:"Vendor Management",description:"Cyber supply chain risk processes established.",frameworks:["NIST CSF"]},
            {id:"NIST-PR.AC-01",name:"Identity management",category:"Access Control",description:"Identities and credentials managed for authorized access.",frameworks:["NIST CSF"]},
            {id:"NIST-PR.AT-01",name:"Security awareness",category:"Policy & Governance",description:"All users informed and trained on cybersecurity responsibilities.",frameworks:["NIST CSF"]},
            {id:"NIST-PR.DS-01",name:"Data-at-rest protection",category:"Data Protection",description:"Data-at-rest is protected.",frameworks:["NIST CSF"]},
            {id:"NIST-PR.DS-02",name:"Data-in-transit protection",category:"Data Protection",description:"Data-in-transit is protected.",frameworks:["NIST CSF"]},
            {id:"NIST-PR.IP-01",name:"Baseline configuration",category:"Asset Management",description:"Baseline configuration of IT systems created and maintained.",frameworks:["NIST CSF"]},
            {id:"NIST-PR.IP-04",name:"Backups maintained",category:"Business Continuity",description:"Backups of information conducted and tested.",frameworks:["NIST CSF"]},
            {id:"NIST-PR.PT-01",name:"Audit records",category:"Logging & Monitoring",description:"Audit/log records determined and reviewed.",frameworks:["NIST CSF"]},
            {id:"NIST-DE.CM-01",name:"Network monitoring",category:"Logging & Monitoring",description:"Network monitored to detect cybersecurity events.",frameworks:["NIST CSF"]},
            {id:"NIST-DE.CM-04",name:"Malicious code detection",category:"Network Security",description:"Malicious code is detected.",frameworks:["NIST CSF"]},
            {id:"NIST-RS.RP-01",name:"Response plan execution",category:"Incident Management",description:"Response plan executed during incidents.",frameworks:["NIST CSF"]},
            {id:"NIST-RS.MI-01",name:"Incident containment",category:"Incident Management",description:"Incidents are contained.",frameworks:["NIST CSF"]},
            {id:"NIST-RC.RP-01",name:"Recovery plan execution",category:"Business Continuity",description:"Recovery plan executed after incidents.",frameworks:["NIST CSF"]},
            {id:"NIST-RC.IM-01",name:"Recovery improvements",category:"Business Continuity",description:"Recovery plans incorporate lessons learned.",frameworks:["NIST CSF"]},
            {id:"NIST-ID.AM-03",name:"Data flow mapping",category:"Asset Management",description:"Organizational communication and data flows mapped.",frameworks:["NIST CSF"]},
            {id:"NIST-ID.AM-04",name:"External information systems",category:"Asset Management",description:"External information systems catalogued.",frameworks:["NIST CSF"]},
            {id:"NIST-ID.AM-05",name:"Resource prioritization",category:"Asset Management",description:"Resources prioritized based on classification and business value.",frameworks:["NIST CSF"]},
            {id:"NIST-ID.AM-06",name:"Cybersecurity roles",category:"Policy & Governance",description:"Cybersecurity roles and responsibilities established.",frameworks:["NIST CSF"]},
            {id:"NIST-ID.BE-01",name:"Supply chain role",category:"Risk Management",description:"Organization's role in supply chain identified.",frameworks:["NIST CSF"]},
            {id:"NIST-ID.BE-02",name:"Critical infrastructure",category:"Asset Management",description:"Organization's place in critical infrastructure identified.",frameworks:["NIST CSF"]},
            {id:"NIST-ID.BE-03",name:"Organizational mission",category:"Policy & Governance",description:"Priorities for organizational mission established.",frameworks:["NIST CSF"]},
            {id:"NIST-ID.BE-04",name:"Dependencies",category:"Risk Management",description:"Dependencies and critical functions established.",frameworks:["NIST CSF"]},
            {id:"NIST-ID.BE-05",name:"Resilience requirements",category:"Business Continuity",description:"Resilience requirements established for delivery of services.",frameworks:["NIST CSF"]},
            {id:"NIST-ID.GV-02",name:"Legal requirements",category:"Compliance",description:"Cybersecurity roles coordinated with external partners.",frameworks:["NIST CSF"]},
            {id:"NIST-ID.GV-03",name:"Regulatory requirements",category:"Compliance",description:"Legal and regulatory requirements understood and managed.",frameworks:["NIST CSF"]},
            {id:"NIST-ID.GV-04",name:"Governance processes",category:"Policy & Governance",description:"Governance and risk management processes address cybersecurity.",frameworks:["NIST CSF"]},
            {id:"NIST-ID.RA-03",name:"Internal threats",category:"Risk Management",description:"Threats, internal and external, identified and documented.",frameworks:["NIST CSF"]},
            {id:"NIST-ID.RA-04",name:"Business impacts",category:"Risk Management",description:"Potential business impacts and likelihoods identified.",frameworks:["NIST CSF"]},
            {id:"NIST-ID.RA-05",name:"Risk responses",category:"Risk Management",description:"Threats, vulnerabilities, likelihoods used to determine risk.",frameworks:["NIST CSF"]},
            {id:"NIST-ID.RA-06",name:"Risk response selection",category:"Risk Management",description:"Risk responses identified and prioritized.",frameworks:["NIST CSF"]},
            {id:"NIST-ID.RM-02",name:"Risk tolerance",category:"Risk Management",description:"Organizational risk tolerance determined and expressed.",frameworks:["NIST CSF"]},
            {id:"NIST-ID.RM-03",name:"Risk-informed decisions",category:"Risk Management",description:"Risk tolerance informed by role in critical infrastructure.",frameworks:["NIST CSF"]},
            {id:"NIST-ID.SC-02",name:"Supplier identification",category:"Vendor Management",description:"Suppliers and partners identified and prioritized.",frameworks:["NIST CSF"]},
            {id:"NIST-ID.SC-03",name:"Supplier contracts",category:"Vendor Management",description:"Contracts with suppliers address cybersecurity.",frameworks:["NIST CSF"]},
            {id:"NIST-ID.SC-04",name:"Supplier assessments",category:"Vendor Management",description:"Suppliers and partners routinely assessed.",frameworks:["NIST CSF"]},
            {id:"NIST-ID.SC-05",name:"Supplier testing",category:"Vendor Management",description:"Response and recovery planning tested with suppliers.",frameworks:["NIST CSF"]},
            {id:"NIST-PR.AC-02",name:"Physical access management",category:"Physical Security",description:"Physical access to assets managed and protected.",frameworks:["NIST CSF"]},
            {id:"NIST-PR.AC-03",name:"Remote access management",category:"Access Control",description:"Remote access managed.",frameworks:["NIST CSF"]},
            {id:"NIST-PR.AC-04",name:"Access permissions",category:"Access Control",description:"Access permissions managed with least privilege.",frameworks:["NIST CSF"]},
            {id:"NIST-PR.AC-05",name:"Network integrity",category:"Network Security",description:"Network integrity protected with segregation.",frameworks:["NIST CSF"]},
            {id:"NIST-PR.AC-06",name:"Identity proofing",category:"Access Control",description:"Identities proofed, bound to credentials, and authenticated.",frameworks:["NIST CSF"]},
            {id:"NIST-PR.AC-07",name:"Strong authentication",category:"Access Control",description:"Users, devices authenticated commensurate with risk.",frameworks:["NIST CSF"]},
            {id:"NIST-PR.AT-02",name:"Privileged user training",category:"Policy & Governance",description:"Privileged users understand roles and responsibilities.",frameworks:["NIST CSF"]},
            {id:"NIST-PR.AT-03",name:"Third-party training",category:"Vendor Management",description:"Third-party stakeholders understand roles.",frameworks:["NIST CSF"]},
            {id:"NIST-PR.AT-04",name:"Senior executive awareness",category:"Policy & Governance",description:"Senior executives understand roles and responsibilities.",frameworks:["NIST CSF"]},
            {id:"NIST-PR.AT-05",name:"Physical security training",category:"Physical Security",description:"Physical and cybersecurity personnel understand roles.",frameworks:["NIST CSF"]},
            {id:"NIST-PR.DS-03",name:"Asset management",category:"Asset Management",description:"Assets formally managed throughout lifecycle.",frameworks:["NIST CSF"]},
            {id:"NIST-PR.DS-04",name:"Availability maintained",category:"Business Continuity",description:"Adequate capacity ensures availability.",frameworks:["NIST CSF"]},
            {id:"NIST-PR.DS-05",name:"Data leakage prevention",category:"Data Protection",description:"Protections against data leaks implemented.",frameworks:["NIST CSF"]},
            {id:"NIST-PR.DS-06",name:"Integrity checking",category:"Data Protection",description:"Integrity checking mechanisms verify software integrity.",frameworks:["NIST CSF"]},
            {id:"NIST-PR.DS-07",name:"Development environments",category:"Asset Management",description:"Development and testing environments separate from production.",frameworks:["NIST CSF"]},
            {id:"NIST-PR.DS-08",name:"Hardware integrity",category:"Asset Management",description:"Integrity checking mechanisms verify hardware integrity.",frameworks:["NIST CSF"]},
            {id:"NIST-PR.IP-02",name:"SDLC management",category:"Asset Management",description:"System development life cycle implemented.",frameworks:["NIST CSF"]},
            {id:"NIST-PR.IP-03",name:"Configuration management",category:"Asset Management",description:"Configuration change control processes in place.",frameworks:["NIST CSF"]},
            // PCI DSS v4.0 (50 key controls)
            {id:"PCI-1.1.1",name:"Firewall standards",category:"Network Security",description:"Formal standards for firewall and router configurations.",frameworks:["PCI DSS"]},
            {id:"PCI-1.2.1",name:"Configuration standards",category:"Network Security",description:"Configuration standards for network security controls.",frameworks:["PCI DSS"]},
            {id:"PCI-2.2.1",name:"System configuration standards",category:"Asset Management",description:"Configuration standards for all system components.",frameworks:["PCI DSS"]},
            {id:"PCI-2.2.2",name:"Vendor defaults management",category:"Access Control",description:"Vendor default accounts managed before deployment.",frameworks:["PCI DSS"]},
            {id:"PCI-3.2.1",name:"Account data minimization",category:"Data Protection",description:"Account data storage kept to minimum.",frameworks:["PCI DSS"]},
            {id:"PCI-3.3.1",name:"PAN masking",category:"Data Protection",description:"PAN masked when displayed.",frameworks:["PCI DSS"]},
            {id:"PCI-3.4.1",name:"Cryptographic keys storage",category:"Data Protection",description:"Cryptographic keys stored securely.",frameworks:["PCI DSS"]},
            {id:"PCI-4.2.1",name:"Strong cryptography",category:"Data Protection",description:"Strong cryptography for PAN transmission.",frameworks:["PCI DSS"]},
            {id:"PCI-5.2.1",name:"Anti-malware deployed",category:"Network Security",description:"Anti-malware mechanisms deployed.",frameworks:["PCI DSS"]},
            {id:"PCI-5.2.2",name:"Phishing protection",category:"Network Security",description:"Technical mechanisms protect against phishing.",frameworks:["PCI DSS"]},
            {id:"PCI-6.3.1",name:"System component inventory",category:"Asset Management",description:"Inventory of in-scope system components maintained.",frameworks:["PCI DSS"]},
            {id:"PCI-6.4.1",name:"Public-facing applications",category:"Asset Management",description:"Public-facing web applications protected.",frameworks:["PCI DSS"]},
            {id:"PCI-7.2.1",name:"User access management",category:"Access Control",description:"User access to system components managed.",frameworks:["PCI DSS"]},
            {id:"PCI-8.2.1",name:"Unique user IDs",category:"Access Control",description:"Unique user IDs assigned to each user.",frameworks:["PCI DSS"]},
            {id:"PCI-8.3.1",name:"Multi-factor authentication",category:"Access Control",description:"MFA for remote network access.",frameworks:["PCI DSS"]},
            {id:"PCI-9.1.1",name:"Physical access controls",category:"Physical Security",description:"Physical access to cardholder data controlled.",frameworks:["PCI DSS"]},
            {id:"PCI-10.2.1",name:"Audit trails",category:"Logging & Monitoring",description:"Audit trails implemented to track user activities.",frameworks:["PCI DSS"]},
            {id:"PCI-11.3.1",name:"External penetration testing",category:"Risk Management",description:"External penetration testing performed.",frameworks:["PCI DSS"]},
            {id:"PCI-12.1.1",name:"Security policy",category:"Policy & Governance",description:"Overall information security policy established.",frameworks:["PCI DSS"]},
            {id:"PCI-12.6.1",name:"Security awareness program",category:"Policy & Governance",description:"Formal security awareness program implemented.",frameworks:["PCI DSS"]},
            {id:"PCI-1.3.1",name:"DMZ implementation",category:"Network Security",description:"DMZ implemented to limit inbound traffic.",frameworks:["PCI DSS"]},
            {id:"PCI-1.3.2",name:"Inbound traffic restriction",category:"Network Security",description:"Inbound internet traffic limited to DMZ.",frameworks:["PCI DSS"]},
            {id:"PCI-1.3.3",name:"Anti-spoofing measures",category:"Network Security",description:"Anti-spoofing measures implemented.",frameworks:["PCI DSS"]},
            {id:"PCI-1.3.4",name:"Outbound traffic authorization",category:"Network Security",description:"Outbound traffic from CDE explicitly authorized.",frameworks:["PCI DSS"]},
            {id:"PCI-1.4.1",name:"Personal firewall software",category:"Network Security",description:"Personal firewall software installed on mobile devices.",frameworks:["PCI DSS"]},
            {id:"PCI-2.1.1",name:"Wireless defaults changed",category:"Network Security",description:"Wireless vendor defaults changed at installation.",frameworks:["PCI DSS"]},
            {id:"PCI-2.2.3",name:"Security features enabled",category:"Asset Management",description:"Primary security features configured.",frameworks:["PCI DSS"]},
            {id:"PCI-2.2.4",name:"Non-essential removed",category:"Asset Management",description:"Unnecessary functionality removed.",frameworks:["PCI DSS"]},
            {id:"PCI-2.2.5",name:"Security parameters documented",category:"Asset Management",description:"System security parameters configured.",frameworks:["PCI DSS"]},
            {id:"PCI-2.3.1",name:"Encrypted admin access",category:"Access Control",description:"All non-console administrative access encrypted.",frameworks:["PCI DSS"]},
            {id:"PCI-3.1.1",name:"Data retention policy",category:"Data Protection",description:"Data retention and disposal policies implemented.",frameworks:["PCI DSS"]},
            {id:"PCI-3.2.2",name:"Data after authorization",category:"Data Protection",description:"Data not stored after authorization.",frameworks:["PCI DSS"]},
            {id:"PCI-3.5.1",name:"Key access restriction",category:"Data Protection",description:"Access to cryptographic keys restricted.",frameworks:["PCI DSS"]},
            {id:"PCI-3.6.1",name:"Key generation",category:"Data Protection",description:"Strong cryptographic key generation.",frameworks:["PCI DSS"]},
            {id:"PCI-3.6.2",name:"Key distribution",category:"Data Protection",description:"Secure cryptographic key distribution.",frameworks:["PCI DSS"]},
            {id:"PCI-3.6.3",name:"Key storage",category:"Data Protection",description:"Secure cryptographic key storage.",frameworks:["PCI DSS"]},
            {id:"PCI-3.6.4",name:"Key changes",category:"Data Protection",description:"Cryptographic key changes for end of cryptoperiod.",frameworks:["PCI DSS"]},
            {id:"PCI-3.6.5",name:"Key retirement",category:"Data Protection",description:"Retirement of old keys.",frameworks:["PCI DSS"]},
            {id:"PCI-3.6.6",name:"Split knowledge",category:"Data Protection",description:"Split knowledge and dual control for key management.",frameworks:["PCI DSS"]},
            {id:"PCI-3.6.7",name:"Key substitution prevention",category:"Data Protection",description:"Prevention of unauthorized key substitution.",frameworks:["PCI DSS"]},
            {id:"PCI-4.1.1",name:"Trusted keys/certificates",category:"Network Security",description:"Only trusted keys and certificates accepted.",frameworks:["PCI DSS"]},
            {id:"PCI-5.1.1",name:"Anti-malware capability",category:"Network Security",description:"Anti-malware capable of detecting all malware.",frameworks:["PCI DSS"]},
            {id:"PCI-5.3.1",name:"Anti-malware mechanisms active",category:"Network Security",description:"Anti-malware mechanisms actively running.",frameworks:["PCI DSS"]},
            {id:"PCI-5.3.2",name:"Anti-malware logs retained",category:"Logging & Monitoring",description:"Anti-malware logs retained per policy.",frameworks:["PCI DSS"]},
            {id:"PCI-6.2.1",name:"Custom software security",category:"Asset Management",description:"Custom software developed securely.",frameworks:["PCI DSS"]},
            {id:"PCI-6.3.2",name:"Code review",category:"Asset Management",description:"Custom code reviewed before release.",frameworks:["PCI DSS"]},
            {id:"PCI-6.5.1",name:"Injection flaws",category:"Asset Management",description:"Injection flaws addressed in development.",frameworks:["PCI DSS"]},
            {id:"PCI-6.5.2",name:"Buffer overflows",category:"Asset Management",description:"Buffer overflow addressed in development.",frameworks:["PCI DSS"]},
            {id:"PCI-6.5.3",name:"Insecure storage",category:"Data Protection",description:"Insecure cryptographic storage addressed.",frameworks:["PCI DSS"]},
            {id:"PCI-6.5.4",name:"Insecure communications",category:"Network Security",description:"Insecure communications addressed.",frameworks:["PCI DSS"]},
            // HIPAA (40 key controls)
            {id:"HIPAA-164.308(a)(1)",name:"Security management",category:"Policy & Governance",description:"Policies to prevent, detect and correct security violations.",frameworks:["HIPAA"]},
            {id:"HIPAA-164.308(a)(1)(ii)(A)",name:"Risk analysis",category:"Risk Management",description:"Assess potential risks to ePHI confidentiality, integrity, availability.",frameworks:["HIPAA"]},
            {id:"HIPAA-164.308(a)(1)(ii)(B)",name:"Risk management",category:"Risk Management",description:"Implement measures to reduce risks to reasonable level.",frameworks:["HIPAA"]},
            {id:"HIPAA-164.308(a)(3)",name:"Workforce security",category:"Policy & Governance",description:"Ensure workforce has appropriate access to ePHI.",frameworks:["HIPAA"]},
            {id:"HIPAA-164.308(a)(4)",name:"Access management",category:"Access Control",description:"Policies for authorizing access to ePHI.",frameworks:["HIPAA"]},
            {id:"HIPAA-164.308(a)(5)",name:"Security awareness",category:"Policy & Governance",description:"Security awareness and training program for workforce.",frameworks:["HIPAA"]},
            {id:"HIPAA-164.308(a)(6)",name:"Security incidents",category:"Incident Management",description:"Policies to address security incidents.",frameworks:["HIPAA"]},
            {id:"HIPAA-164.308(a)(7)",name:"Contingency plan",category:"Business Continuity",description:"Policies for responding to emergencies.",frameworks:["HIPAA"]},
            {id:"HIPAA-164.310(a)(1)",name:"Facility access controls",category:"Physical Security",description:"Limit physical access to systems with ePHI.",frameworks:["HIPAA"]},
            {id:"HIPAA-164.310(d)(1)",name:"Device controls",category:"Physical Security",description:"Govern receipt and removal of hardware/media.",frameworks:["HIPAA"]},
            {id:"HIPAA-164.312(a)(1)",name:"Access control",category:"Access Control",description:"Allow access only to authorized persons/software.",frameworks:["HIPAA"]},
            {id:"HIPAA-164.312(a)(2)(iv)",name:"Encryption",category:"Data Protection",description:"Mechanism to encrypt and decrypt ePHI.",frameworks:["HIPAA"]},
            {id:"HIPAA-164.312(b)",name:"Audit controls",category:"Logging & Monitoring",description:"Record and examine activity in systems with ePHI.",frameworks:["HIPAA"]},
            {id:"HIPAA-164.312(d)",name:"Person authentication",category:"Access Control",description:"Verify person seeking access is the one claimed.",frameworks:["HIPAA"]},
            {id:"HIPAA-164.312(e)(1)",name:"Transmission security",category:"Network Security",description:"Guard against unauthorized access to ePHI in transit.",frameworks:["HIPAA"]},
            {id:"HIPAA-164.308(a)(1)(ii)(C)",name:"Sanction policy",category:"Policy & Governance",description:"Apply appropriate sanctions against workforce members who fail to comply.",frameworks:["HIPAA"]},
            {id:"HIPAA-164.308(a)(1)(ii)(D)",name:"Information system activity review",category:"Logging & Monitoring",description:"Implement procedures to regularly review records of activity.",frameworks:["HIPAA"]},
            {id:"HIPAA-164.308(a)(3)(ii)(A)",name:"Authorization supervision",category:"Access Control",description:"Implement procedures for authorization and supervision.",frameworks:["HIPAA"]},
            {id:"HIPAA-164.308(a)(3)(ii)(B)",name:"Workforce clearance",category:"Policy & Governance",description:"Implement procedures to determine access appropriateness.",frameworks:["HIPAA"]},
            {id:"HIPAA-164.308(a)(3)(ii)(C)",name:"Termination procedures",category:"Access Control",description:"Implement procedures for terminating access.",frameworks:["HIPAA"]},
            {id:"HIPAA-164.308(a)(4)(ii)(A)",name:"Isolating healthcare function",category:"Access Control",description:"Isolate healthcare clearinghouse functions.",frameworks:["HIPAA"]},
            {id:"HIPAA-164.308(a)(4)(ii)(B)",name:"Access authorization",category:"Access Control",description:"Implement policies for granting access to ePHI.",frameworks:["HIPAA"]},
            {id:"HIPAA-164.308(a)(4)(ii)(C)",name:"Access establishment",category:"Access Control",description:"Implement policies for access establishment and modification.",frameworks:["HIPAA"]},
            {id:"HIPAA-164.308(a)(5)(ii)(A)",name:"Security reminders",category:"Policy & Governance",description:"Periodic security updates.",frameworks:["HIPAA"]},
            {id:"HIPAA-164.308(a)(5)(ii)(B)",name:"Malicious software protection",category:"Network Security",description:"Procedures for guarding against malicious software.",frameworks:["HIPAA"]},
            {id:"HIPAA-164.308(a)(5)(ii)(C)",name:"Log-in monitoring",category:"Logging & Monitoring",description:"Procedures for monitoring log-in attempts.",frameworks:["HIPAA"]},
            {id:"HIPAA-164.308(a)(5)(ii)(D)",name:"Password management",category:"Access Control",description:"Procedures for creating, changing, and safeguarding passwords.",frameworks:["HIPAA"]},
            {id:"HIPAA-164.308(a)(6)(ii)",name:"Response and reporting",category:"Incident Management",description:"Identify and respond to suspected security incidents.",frameworks:["HIPAA"]},
            {id:"HIPAA-164.308(a)(7)(ii)(A)",name:"Data backup plan",category:"Business Continuity",description:"Establish procedures to create and maintain exact copies of ePHI.",frameworks:["HIPAA"]},
            {id:"HIPAA-164.308(a)(7)(ii)(B)",name:"Disaster recovery plan",category:"Business Continuity",description:"Establish procedures to restore lost data.",frameworks:["HIPAA"]},
            {id:"HIPAA-164.308(a)(7)(ii)(C)",name:"Emergency mode operations",category:"Business Continuity",description:"Establish procedures for emergency mode operation.",frameworks:["HIPAA"]},
            {id:"HIPAA-164.308(a)(7)(ii)(D)",name:"Testing and revision",category:"Business Continuity",description:"Implement procedures for periodic testing of contingency plans.",frameworks:["HIPAA"]},
            {id:"HIPAA-164.308(a)(7)(ii)(E)",name:"Applications and data criticality",category:"Business Continuity",description:"Assess relative criticality of applications and data.",frameworks:["HIPAA"]},
            {id:"HIPAA-164.308(a)(8)",name:"Evaluation",category:"Compliance",description:"Perform periodic technical and non-technical evaluation.",frameworks:["HIPAA"]},
            {id:"HIPAA-164.310(a)(2)(i)",name:"Contingency operations",category:"Physical Security",description:"Establish procedures for facility access during emergency.",frameworks:["HIPAA"]},
            {id:"HIPAA-164.310(a)(2)(ii)",name:"Facility security plan",category:"Physical Security",description:"Implement policies to safeguard the facility.",frameworks:["HIPAA"]},
            {id:"HIPAA-164.310(a)(2)(iii)",name:"Access control and validation",category:"Physical Security",description:"Implement procedures to control and validate access.",frameworks:["HIPAA"]},
            {id:"HIPAA-164.310(a)(2)(iv)",name:"Maintenance records",category:"Physical Security",description:"Implement policies to document repairs and modifications.",frameworks:["HIPAA"]},
            {id:"HIPAA-164.310(b)",name:"Workstation use",category:"Physical Security",description:"Implement policies for proper workstation use.",frameworks:["HIPAA"]},
            {id:"HIPAA-164.310(c)",name:"Workstation security",category:"Physical Security",description:"Implement physical safeguards for workstations.",frameworks:["HIPAA"]},
            // SOC 2 (50 key controls)
            {id:"SOC2-CC1.1",name:"Integrity and ethics",category:"Policy & Governance",description:"Demonstrates commitment to integrity and ethical values.",frameworks:["SOC 2"]},
            {id:"SOC2-CC1.2",name:"Board oversight",category:"Policy & Governance",description:"Board exercises oversight of internal control.",frameworks:["SOC 2"]},
            {id:"SOC2-CC2.1",name:"Risk assessment objectives",category:"Risk Management",description:"Objectives specified with sufficient clarity.",frameworks:["SOC 2"]},
            {id:"SOC2-CC2.2",name:"Risk identification",category:"Risk Management",description:"Identifies and analyzes risks across entity.",frameworks:["SOC 2"]},
            {id:"SOC2-CC3.1",name:"Policies and procedures",category:"Policy & Governance",description:"Establishes policies and procedures.",frameworks:["SOC 2"]},
            {id:"SOC2-CC4.1",name:"Monitoring activities",category:"Logging & Monitoring",description:"Performs ongoing evaluations of internal control.",frameworks:["SOC 2"]},
            {id:"SOC2-CC5.1",name:"Control activities",category:"Policy & Governance",description:"Selects control activities to mitigate risks.",frameworks:["SOC 2"]},
            {id:"SOC2-CC6.1",name:"Logical and physical access",category:"Access Control",description:"Implements access controls to protect data.",frameworks:["SOC 2"]},
            {id:"SOC2-CC6.2",name:"User registration",category:"Access Control",description:"Registers and authorizes new users.",frameworks:["SOC 2"]},
            {id:"SOC2-CC6.6",name:"Data classification",category:"Data Protection",description:"Implements logical access security measures.",frameworks:["SOC 2"]},
            {id:"SOC2-CC7.1",name:"System operations",category:"Logging & Monitoring",description:"Uses detection and monitoring procedures.",frameworks:["SOC 2"]},
            {id:"SOC2-CC7.2",name:"Incident response",category:"Incident Management",description:"Monitors system components for anomalies.",frameworks:["SOC 2"]},
            {id:"SOC2-CC8.1",name:"Change management",category:"Asset Management",description:"Authorizes, tests and implements changes.",frameworks:["SOC 2"]},
            {id:"SOC2-CC9.1",name:"Risk mitigation",category:"Risk Management",description:"Identifies and develops risk mitigation activities.",frameworks:["SOC 2"]},
            {id:"SOC2-A1.1",name:"Availability commitments",category:"Business Continuity",description:"Maintains and monitors processing capacity.",frameworks:["SOC 2"]},
            {id:"SOC2-C1.1",name:"Confidentiality commitments",category:"Data Protection",description:"Identifies and maintains confidential information.",frameworks:["SOC 2"]},
            {id:"SOC2-PI1.1",name:"Processing integrity",category:"Data Protection",description:"Obtains and uses quality information for processing.",frameworks:["SOC 2"]},
            {id:"SOC2-P1.1",name:"Privacy notice",category:"Data Protection",description:"Provides notice about privacy practices.",frameworks:["SOC 2"]},
            {id:"SOC2-P2.1",name:"Choice and consent",category:"Data Protection",description:"Communicates choices about personal information.",frameworks:["SOC 2"]},
            {id:"SOC2-P4.1",name:"Access to personal info",category:"Data Protection",description:"Grants data subjects access to their information.",frameworks:["SOC 2"]},
            {id:"SOC2-CC1.3",name:"Structure and authority",category:"Policy & Governance",description:"Management establishes organizational structure.",frameworks:["SOC 2"]},
            {id:"SOC2-CC1.4",name:"Competence commitment",category:"Policy & Governance",description:"Demonstrates commitment to competence.",frameworks:["SOC 2"]},
            {id:"SOC2-CC1.5",name:"Accountability",category:"Policy & Governance",description:"Holds individuals accountable for responsibilities.",frameworks:["SOC 2"]},
            {id:"SOC2-CC2.3",name:"Internal communication",category:"Policy & Governance",description:"Internally communicates necessary information.",frameworks:["SOC 2"]},
            {id:"SOC2-CC3.2",name:"Change identification",category:"Risk Management",description:"Identifies and assesses changes.",frameworks:["SOC 2"]},
            {id:"SOC2-CC3.3",name:"Fraud risk",category:"Risk Management",description:"Considers potential for fraud.",frameworks:["SOC 2"]},
            {id:"SOC2-CC3.4",name:"Risk assessment update",category:"Risk Management",description:"Risk assessment updated for changes.",frameworks:["SOC 2"]},
            {id:"SOC2-CC4.2",name:"Deficiency evaluation",category:"Compliance",description:"Evaluates and communicates deficiencies.",frameworks:["SOC 2"]},
            {id:"SOC2-CC5.2",name:"Technology controls",category:"Asset Management",description:"Selects and develops technology controls.",frameworks:["SOC 2"]},
            {id:"SOC2-CC5.3",name:"Policy deployment",category:"Policy & Governance",description:"Deploys control activities through policies.",frameworks:["SOC 2"]},
            {id:"SOC2-CC6.3",name:"Authorization removal",category:"Access Control",description:"Removes access when no longer required.",frameworks:["SOC 2"]},
            {id:"SOC2-CC6.4",name:"Access review",category:"Access Control",description:"Reviews access rights periodically.",frameworks:["SOC 2"]},
            {id:"SOC2-CC6.5",name:"Physical restrictions",category:"Physical Security",description:"Restricts physical access to facilities.",frameworks:["SOC 2"]},
            {id:"SOC2-CC6.7",name:"Transmission protection",category:"Network Security",description:"Restricts transmission of data.",frameworks:["SOC 2"]},
            {id:"SOC2-CC6.8",name:"Malware prevention",category:"Network Security",description:"Implements controls to prevent malware.",frameworks:["SOC 2"]},
            {id:"SOC2-CC7.3",name:"Security event evaluation",category:"Incident Management",description:"Evaluates security events.",frameworks:["SOC 2"]},
            {id:"SOC2-CC7.4",name:"Incident response",category:"Incident Management",description:"Responds to identified security incidents.",frameworks:["SOC 2"]},
            {id:"SOC2-CC7.5",name:"Incident recovery",category:"Incident Management",description:"Identifies and executes recovery procedures.",frameworks:["SOC 2"]},
            {id:"SOC2-CC9.2",name:"Vendor risk management",category:"Vendor Management",description:"Assesses and manages vendor risk.",frameworks:["SOC 2"]},
            {id:"SOC2-A1.2",name:"Environmental protections",category:"Physical Security",description:"Protects against environmental threats.",frameworks:["SOC 2"]},
            {id:"SOC2-A1.3",name:"Recovery testing",category:"Business Continuity",description:"Tests recovery procedures.",frameworks:["SOC 2"]},
            {id:"SOC2-C1.2",name:"Confidential data disposal",category:"Data Protection",description:"Disposes of confidential information.",frameworks:["SOC 2"]},
            {id:"SOC2-PI1.2",name:"Input validation",category:"Data Protection",description:"Implements input validation.",frameworks:["SOC 2"]},
            {id:"SOC2-PI1.3",name:"Processing accuracy",category:"Data Protection",description:"Implements processing accuracy checks.",frameworks:["SOC 2"]},
            {id:"SOC2-PI1.4",name:"Output completeness",category:"Data Protection",description:"Implements output completeness checks.",frameworks:["SOC 2"]},
            {id:"SOC2-PI1.5",name:"Input/output reconciliation",category:"Data Protection",description:"Implements reconciliation procedures.",frameworks:["SOC 2"]},
            {id:"SOC2-P3.1",name:"Personal info collection",category:"Data Protection",description:"Collects personal information for stated purposes.",frameworks:["SOC 2"]},
            {id:"SOC2-P4.2",name:"Personal info correction",category:"Data Protection",description:"Corrects personal information upon request.",frameworks:["SOC 2"]},
            {id:"SOC2-P5.1",name:"Disclosure to third parties",category:"Data Protection",description:"Discloses personal information to third parties appropriately.",frameworks:["SOC 2"]},
            {id:"SOC2-P6.1",name:"Personal info quality",category:"Data Protection",description:"Personal information quality maintained.",frameworks:["SOC 2"]},
            // CIS Controls (50 key controls)
            {id:"CIS-1.1",name:"Enterprise asset inventory",category:"Asset Management",description:"Maintain accurate inventory of enterprise assets.",frameworks:["CIS Controls"]},
            {id:"CIS-2.1",name:"Software inventory",category:"Asset Management",description:"Maintain detailed inventory of authorized software.",frameworks:["CIS Controls"]},
            {id:"CIS-3.1",name:"Data management",category:"Data Protection",description:"Establish data management process.",frameworks:["CIS Controls"]},
            {id:"CIS-3.3",name:"Data access control",category:"Access Control",description:"Configure data access control lists.",frameworks:["CIS Controls"]},
            {id:"CIS-3.10",name:"Encrypt data in transit",category:"Data Protection",description:"Encrypt sensitive data in transit.",frameworks:["CIS Controls"]},
            {id:"CIS-3.11",name:"Encrypt data at rest",category:"Data Protection",description:"Encrypt sensitive data at rest.",frameworks:["CIS Controls"]},
            {id:"CIS-4.1",name:"Secure configuration",category:"Asset Management",description:"Establish secure configuration process.",frameworks:["CIS Controls"]},
            {id:"CIS-5.1",name:"Account inventory",category:"Access Control",description:"Maintain inventory of accounts.",frameworks:["CIS Controls"]},
            {id:"CIS-5.3",name:"Disable dormant accounts",category:"Access Control",description:"Delete or disable dormant accounts.",frameworks:["CIS Controls"]},
            {id:"CIS-5.4",name:"Restrict admin privileges",category:"Access Control",description:"Restrict administrator privileges.",frameworks:["CIS Controls"]},
            {id:"CIS-6.1",name:"Access granting process",category:"Access Control",description:"Establish access granting process.",frameworks:["CIS Controls"]},
            {id:"CIS-6.3",name:"MFA for external apps",category:"Access Control",description:"Require MFA for externally-exposed applications.",frameworks:["CIS Controls"]},
            {id:"CIS-6.4",name:"MFA for remote access",category:"Access Control",description:"Require MFA for remote network access.",frameworks:["CIS Controls"]},
            {id:"CIS-7.1",name:"Vulnerability management",category:"Risk Management",description:"Establish vulnerability management process.",frameworks:["CIS Controls"]},
            {id:"CIS-7.3",name:"Automated OS patching",category:"Asset Management",description:"Perform automated OS patch management.",frameworks:["CIS Controls"]},
            {id:"CIS-7.4",name:"Automated app patching",category:"Asset Management",description:"Perform automated application patching.",frameworks:["CIS Controls"]},
            {id:"CIS-8.1",name:"Audit log management",category:"Logging & Monitoring",description:"Establish audit log management process.",frameworks:["CIS Controls"]},
            {id:"CIS-10.1",name:"Malware defenses",category:"Network Security",description:"Deploy and maintain anti-malware software.",frameworks:["CIS Controls"]},
            {id:"CIS-11.1",name:"Data recovery capability",category:"Business Continuity",description:"Establish data recovery processes.",frameworks:["CIS Controls"]},
            {id:"CIS-16.1",name:"Application security",category:"Asset Management",description:"Establish secure application development.",frameworks:["CIS Controls"]},
            {id:"CIS-1.2",name:"Address unauthorized assets",category:"Asset Management",description:"Ensure unauthorized assets are addressed.",frameworks:["CIS Controls"]},
            {id:"CIS-1.3",name:"DHCP logging",category:"Logging & Monitoring",description:"Utilize DHCP logging to update inventory.",frameworks:["CIS Controls"]},
            {id:"CIS-1.4",name:"Detailed asset inventory",category:"Asset Management",description:"Use detailed asset inventory.",frameworks:["CIS Controls"]},
            {id:"CIS-1.5",name:"Asset information quality",category:"Asset Management",description:"Ensure asset inventory information quality.",frameworks:["CIS Controls"]},
            {id:"CIS-2.2",name:"Authorized software inventory",category:"Asset Management",description:"Ensure authorized software is currently supported.",frameworks:["CIS Controls"]},
            {id:"CIS-2.3",name:"Address unauthorized software",category:"Asset Management",description:"Ensure unauthorized software is addressed.",frameworks:["CIS Controls"]},
            {id:"CIS-2.4",name:"Software inventory tool",category:"Asset Management",description:"Utilize automated software inventory tools.",frameworks:["CIS Controls"]},
            {id:"CIS-2.5",name:"Allowlisting software",category:"Asset Management",description:"Use application allowlisting technology.",frameworks:["CIS Controls"]},
            {id:"CIS-2.6",name:"Allowlist libraries",category:"Asset Management",description:"Allowlist authorized libraries.",frameworks:["CIS Controls"]},
            {id:"CIS-2.7",name:"Allowlist scripts",category:"Asset Management",description:"Allowlist authorized scripts.",frameworks:["CIS Controls"]},
            {id:"CIS-3.2",name:"Data inventory",category:"Data Protection",description:"Maintain data inventory.",frameworks:["CIS Controls"]},
            {id:"CIS-3.4",name:"Data classification enforcement",category:"Data Protection",description:"Enforce data classification policies.",frameworks:["CIS Controls"]},
            {id:"CIS-3.5",name:"Sensitive data documentation",category:"Data Protection",description:"Document data flows.",frameworks:["CIS Controls"]},
            {id:"CIS-3.6",name:"Encrypt mobile device data",category:"Data Protection",description:"Encrypt data on mobile devices.",frameworks:["CIS Controls"]},
            {id:"CIS-3.7",name:"Removable media encryption",category:"Data Protection",description:"Encrypt data on removable media.",frameworks:["CIS Controls"]},
            {id:"CIS-3.8",name:"Removable media management",category:"Data Protection",description:"Manage removable storage devices.",frameworks:["CIS Controls"]},
            {id:"CIS-3.9",name:"Remote storage encryption",category:"Data Protection",description:"Encrypt data on remote storage.",frameworks:["CIS Controls"]},
            {id:"CIS-3.12",name:"Network data segmentation",category:"Network Security",description:"Segment data processing and storage.",frameworks:["CIS Controls"]},
            {id:"CIS-3.13",name:"Data disposal process",category:"Data Protection",description:"Deploy secure disposal process.",frameworks:["CIS Controls"]},
            {id:"CIS-3.14",name:"Data disposal logging",category:"Data Protection",description:"Log sensitive data access.",frameworks:["CIS Controls"]},
            {id:"CIS-4.2",name:"Secure image maintenance",category:"Asset Management",description:"Maintain secure configuration images.",frameworks:["CIS Controls"]},
            {id:"CIS-4.3",name:"Secure configuration for portable devices",category:"Asset Management",description:"Configure devices to use secure configuration.",frameworks:["CIS Controls"]},
            {id:"CIS-4.4",name:"Firewall host-based",category:"Network Security",description:"Implement and manage host-based firewall.",frameworks:["CIS Controls"]},
            {id:"CIS-4.5",name:"Unused services and ports",category:"Network Security",description:"Uninstall unnecessary services.",frameworks:["CIS Controls"]},
            {id:"CIS-4.6",name:"DNS filtering",category:"Network Security",description:"Configure DNS filtering services.",frameworks:["CIS Controls"]},
            {id:"CIS-4.7",name:"Email filtering",category:"Network Security",description:"Configure email filtering services.",frameworks:["CIS Controls"]},
            {id:"CIS-4.8",name:"DMARC implementation",category:"Network Security",description:"Implement DMARC.",frameworks:["CIS Controls"]},
            {id:"CIS-4.9",name:"Block unnecessary file types",category:"Network Security",description:"Block unnecessary file types.",frameworks:["CIS Controls"]},
            {id:"CIS-4.10",name:"Wireless client isolation",category:"Network Security",description:"Enforce wireless client isolation.",frameworks:["CIS Controls"]},
            {id:"CIS-4.11",name:"Browser extensions",category:"Asset Management",description:"Manage default and approved browser extensions.",frameworks:["CIS Controls"]},
            // GDPR (30 key controls)
            {id:"GDPR-5.1",name:"Lawfulness of processing",category:"Data Protection",description:"Personal data processed lawfully, fairly, transparently.",frameworks:["GDPR"]},
            {id:"GDPR-5.2",name:"Purpose limitation",category:"Data Protection",description:"Data collected for specified, legitimate purposes.",frameworks:["GDPR"]},
            {id:"GDPR-5.3",name:"Data minimization",category:"Data Protection",description:"Data adequate, relevant, limited to what is necessary.",frameworks:["GDPR"]},
            {id:"GDPR-5.4",name:"Accuracy",category:"Data Protection",description:"Personal data kept accurate and up to date.",frameworks:["GDPR"]},
            {id:"GDPR-5.5",name:"Storage limitation",category:"Data Protection",description:"Data kept no longer than necessary.",frameworks:["GDPR"]},
            {id:"GDPR-5.6",name:"Integrity and confidentiality",category:"Data Protection",description:"Appropriate security for personal data.",frameworks:["GDPR"]},
            {id:"GDPR-12",name:"Transparent communication",category:"Data Protection",description:"Clear communication about data processing.",frameworks:["GDPR"]},
            {id:"GDPR-15",name:"Right of access",category:"Data Protection",description:"Data subjects can access their personal data.",frameworks:["GDPR"]},
            {id:"GDPR-17",name:"Right to erasure",category:"Data Protection",description:"Data subjects can request data deletion.",frameworks:["GDPR"]},
            {id:"GDPR-32",name:"Security of processing",category:"Data Protection",description:"Implement appropriate technical and organizational measures.",frameworks:["GDPR"]},
            {id:"GDPR-6",name:"Lawful basis",category:"Compliance",description:"Processing has a lawful basis.",frameworks:["GDPR"]},
            {id:"GDPR-7",name:"Conditions for consent",category:"Data Protection",description:"Conditions for consent met.",frameworks:["GDPR"]},
            {id:"GDPR-8",name:"Child consent",category:"Data Protection",description:"Conditions for child consent met.",frameworks:["GDPR"]},
            {id:"GDPR-9",name:"Special categories",category:"Data Protection",description:"Processing of special categories of data.",frameworks:["GDPR"]},
            {id:"GDPR-10",name:"Criminal convictions",category:"Data Protection",description:"Processing relating to criminal convictions.",frameworks:["GDPR"]},
            {id:"GDPR-13",name:"Information provision",category:"Data Protection",description:"Information provided when collecting personal data.",frameworks:["GDPR"]},
            {id:"GDPR-14",name:"Information when not obtained",category:"Data Protection",description:"Information provided when data not obtained from subject.",frameworks:["GDPR"]},
            {id:"GDPR-16",name:"Right to rectification",category:"Data Protection",description:"Data subjects can rectify inaccurate data.",frameworks:["GDPR"]},
            {id:"GDPR-18",name:"Right to restriction",category:"Data Protection",description:"Data subjects can restrict processing.",frameworks:["GDPR"]},
            {id:"GDPR-19",name:"Notification obligation",category:"Data Protection",description:"Notification of rectification or erasure.",frameworks:["GDPR"]},
            {id:"GDPR-20",name:"Right to portability",category:"Data Protection",description:"Data subjects can receive data in portable format.",frameworks:["GDPR"]},
            {id:"GDPR-21",name:"Right to object",category:"Data Protection",description:"Data subjects can object to processing.",frameworks:["GDPR"]},
            {id:"GDPR-22",name:"Automated decision-making",category:"Data Protection",description:"Rights related to automated decision-making.",frameworks:["GDPR"]},
            {id:"GDPR-25",name:"Data protection by design",category:"Data Protection",description:"Data protection by design and default implemented.",frameworks:["GDPR"]},
            {id:"GDPR-28",name:"Processor requirements",category:"Vendor Management",description:"Only processors with sufficient guarantees used.",frameworks:["GDPR"]},
            {id:"GDPR-30",name:"Records of processing",category:"Compliance",description:"Records of processing activities maintained.",frameworks:["GDPR"]},
            {id:"GDPR-33",name:"Breach notification authority",category:"Incident Management",description:"Personal data breaches notified to authority.",frameworks:["GDPR"]},
            {id:"GDPR-34",name:"Breach notification subject",category:"Incident Management",description:"Data subjects notified of high risk breaches.",frameworks:["GDPR"]},
            {id:"GDPR-35",name:"Impact assessments",category:"Risk Management",description:"Data protection impact assessments conducted.",frameworks:["GDPR"]},
            {id:"GDPR-37",name:"DPO designation",category:"Policy & Governance",description:"Data Protection Officer designated when required.",frameworks:["GDPR"]},
            // CMMC (30 key controls)
            {id:"CMMC-AC.1.001",name:"Limit system access",category:"Access Control",description:"Limit information system access to authorized users.",frameworks:["CMMC"]},
            {id:"CMMC-AC.1.002",name:"Limit transactions",category:"Access Control",description:"Limit access to types of transactions and functions.",frameworks:["CMMC"]},
            {id:"CMMC-AC.2.007",name:"Least privilege",category:"Access Control",description:"Employ least privilege principle.",frameworks:["CMMC"]},
            {id:"CMMC-AC.2.008",name:"Privileged functions",category:"Access Control",description:"Use non-privileged accounts for non-security functions.",frameworks:["CMMC"]},
            {id:"CMMC-IA.1.076",name:"Identify users",category:"Access Control",description:"Identify information system users.",frameworks:["CMMC"]},
            {id:"CMMC-IA.1.077",name:"Authenticate users",category:"Access Control",description:"Authenticate users as prerequisite to access.",frameworks:["CMMC"]},
            {id:"CMMC-SC.1.175",name:"Monitor communications",category:"Network Security",description:"Monitor, control, protect communications at boundaries.",frameworks:["CMMC"]},
            {id:"CMMC-SC.1.176",name:"Subnetworks",category:"Network Security",description:"Implement subnetworks for publicly accessible components.",frameworks:["CMMC"]},
            {id:"CMMC-SI.1.210",name:"Flaw remediation",category:"Risk Management",description:"Identify, report, correct information flaws timely.",frameworks:["CMMC"]},
            {id:"CMMC-SI.1.211",name:"Malicious code protection",category:"Network Security",description:"Provide protection from malicious code.",frameworks:["CMMC"]},
            {id:"CMMC-AC.2.005",name:"Separation of duties",category:"Access Control",description:"Separate duties of individuals to reduce risk.",frameworks:["CMMC"]},
            {id:"CMMC-AC.2.006",name:"Remote access",category:"Access Control",description:"Limit use of portable storage devices.",frameworks:["CMMC"]},
            {id:"CMMC-AC.2.009",name:"Wireless access",category:"Access Control",description:"Limit wireless access.",frameworks:["CMMC"]},
            {id:"CMMC-AC.2.010",name:"Session control",category:"Access Control",description:"Limit unsuccessful logon attempts.",frameworks:["CMMC"]},
            {id:"CMMC-AC.2.011",name:"Session termination",category:"Access Control",description:"Terminate sessions after defined periods.",frameworks:["CMMC"]},
            {id:"CMMC-AC.2.013",name:"Remote session control",category:"Access Control",description:"Monitor and control remote access sessions.",frameworks:["CMMC"]},
            {id:"CMMC-AC.2.015",name:"Privileged remote access",category:"Access Control",description:"Route privileged access through managed access points.",frameworks:["CMMC"]},
            {id:"CMMC-AC.2.016",name:"Wireless protection",category:"Network Security",description:"Protect wireless access using authentication and encryption.",frameworks:["CMMC"]},
            {id:"CMMC-AT.2.056",name:"Awareness training",category:"Policy & Governance",description:"Ensure security awareness and training.",frameworks:["CMMC"]},
            {id:"CMMC-AT.2.057",name:"Insider threat awareness",category:"Policy & Governance",description:"Provide insider threat awareness.",frameworks:["CMMC"]},
            {id:"CMMC-AU.2.041",name:"Audit content",category:"Logging & Monitoring",description:"Ensure audit logs contain required information.",frameworks:["CMMC"]},
            {id:"CMMC-AU.2.042",name:"Audit review",category:"Logging & Monitoring",description:"Review and update audited events.",frameworks:["CMMC"]},
            {id:"CMMC-AU.2.043",name:"Audit alerts",category:"Logging & Monitoring",description:"Alert in event of audit process failure.",frameworks:["CMMC"]},
            {id:"CMMC-AU.2.044",name:"Audit correlation",category:"Logging & Monitoring",description:"Correlate audit review and analysis.",frameworks:["CMMC"]},
            {id:"CMMC-CA.2.157",name:"Security assessments",category:"Compliance",description:"Develop and implement security assessment plans.",frameworks:["CMMC"]},
            {id:"CMMC-CA.2.158",name:"Assessment findings",category:"Compliance",description:"Assess security controls periodically.",frameworks:["CMMC"]},
            {id:"CMMC-CA.2.159",name:"Remediation plans",category:"Compliance",description:"Develop plans of action to correct deficiencies.",frameworks:["CMMC"]},
            {id:"CMMC-CM.2.061",name:"Configuration baselines",category:"Asset Management",description:"Establish and maintain configuration baselines.",frameworks:["CMMC"]},
            {id:"CMMC-CM.2.062",name:"Security configuration",category:"Asset Management",description:"Employ security configuration settings.",frameworks:["CMMC"]},
            {id:"CMMC-CM.2.063",name:"User software installation",category:"Asset Management",description:"Track and control user-installed software.",frameworks:["CMMC"]},
            // COBIT (30 key controls)
            {id:"COBIT-APO01.03",name:"Management framework",category:"Policy & Governance",description:"Maintain enablers of the management system.",frameworks:["COBIT"]},
            {id:"COBIT-APO12.01",name:"Data collection",category:"Risk Management",description:"Collect data on risk management activities.",frameworks:["COBIT"]},
            {id:"COBIT-APO12.02",name:"Risk analysis",category:"Risk Management",description:"Develop useful information to support risk decisions.",frameworks:["COBIT"]},
            {id:"COBIT-APO13.01",name:"ISMS establishment",category:"Policy & Governance",description:"Establish and maintain an ISMS.",frameworks:["COBIT"]},
            {id:"COBIT-BAI06.01",name:"Change evaluation",category:"Asset Management",description:"Evaluate and authorize change requests.",frameworks:["COBIT"]},
            {id:"COBIT-DSS05.01",name:"Malware protection",category:"Network Security",description:"Protect information systems from malware.",frameworks:["COBIT"]},
            {id:"COBIT-DSS05.02",name:"Network security",category:"Network Security",description:"Maintain network security mechanisms.",frameworks:["COBIT"]},
            {id:"COBIT-DSS05.04",name:"User access management",category:"Access Control",description:"Manage user identity and logical access.",frameworks:["COBIT"]},
            {id:"COBIT-DSS05.05",name:"Physical access",category:"Physical Security",description:"Manage physical access to IT assets.",frameworks:["COBIT"]},
            {id:"COBIT-DSS05.07",name:"Security monitoring",category:"Logging & Monitoring",description:"Monitor infrastructure for security events.",frameworks:["COBIT"]},
            {id:"COBIT-APO01.01",name:"IT management framework",category:"Policy & Governance",description:"Define and communicate the management framework.",frameworks:["COBIT"]},
            {id:"COBIT-APO01.02",name:"Organizational positioning",category:"Policy & Governance",description:"Establish organizational positioning of IT.",frameworks:["COBIT"]},
            {id:"COBIT-APO01.04",name:"Communication mechanisms",category:"Policy & Governance",description:"Communicate management philosophy and direction.",frameworks:["COBIT"]},
            {id:"COBIT-APO01.05",name:"Culture development",category:"Policy & Governance",description:"Define and develop a culture and ethics.",frameworks:["COBIT"]},
            {id:"COBIT-APO01.06",name:"Data and system ownership",category:"Asset Management",description:"Define data and system ownership.",frameworks:["COBIT"]},
            {id:"COBIT-APO12.03",name:"Risk profile maintenance",category:"Risk Management",description:"Maintain a risk profile.",frameworks:["COBIT"]},
            {id:"COBIT-APO12.04",name:"Risk expression",category:"Risk Management",description:"Express risk in business-relevant terms.",frameworks:["COBIT"]},
            {id:"COBIT-APO12.05",name:"Risk response portfolio",category:"Risk Management",description:"Define a risk management action portfolio.",frameworks:["COBIT"]},
            {id:"COBIT-APO12.06",name:"Risk response execution",category:"Risk Management",description:"Respond to risk.",frameworks:["COBIT"]},
            {id:"COBIT-APO13.02",name:"ISMS plan",category:"Policy & Governance",description:"Define and manage an information security plan.",frameworks:["COBIT"]},
            {id:"COBIT-APO13.03",name:"ISMS monitoring",category:"Logging & Monitoring",description:"Monitor and review the ISMS.",frameworks:["COBIT"]},
            {id:"COBIT-BAI06.02",name:"Change impact assessment",category:"Asset Management",description:"Assess and prioritize change requests.",frameworks:["COBIT"]},
            {id:"COBIT-BAI06.03",name:"Emergency changes",category:"Asset Management",description:"Manage emergency changes.",frameworks:["COBIT"]},
            {id:"COBIT-BAI06.04",name:"Change closure",category:"Asset Management",description:"Close and document changes.",frameworks:["COBIT"]},
            {id:"COBIT-DSS05.03",name:"Endpoint security",category:"Network Security",description:"Manage endpoint security.",frameworks:["COBIT"]},
            {id:"COBIT-DSS05.06",name:"Sensitive documents",category:"Data Protection",description:"Manage sensitive documents and devices.",frameworks:["COBIT"]},
            {id:"COBIT-DSS06.01",name:"Logical access controls",category:"Access Control",description:"Manage access to information and data.",frameworks:["COBIT"]},
            {id:"COBIT-DSS06.02",name:"Privileged access controls",category:"Access Control",description:"Manage privileged access rights.",frameworks:["COBIT"]},
            {id:"COBIT-DSS06.03",name:"Access profiles",category:"Access Control",description:"Manage user access entitlements.",frameworks:["COBIT"]},
            {id:"COBIT-DSS06.04",name:"Access segregation",category:"Access Control",description:"Segregate and manage privileged user accounts.",frameworks:["COBIT"]}
        ];
    }
    
    // ==================== GRC PROJECTS ====================
    renderProjects() {
        const c = document.getElementById('tab-projects');
        const projects = this.getProjectScenarios();
        c.innerHTML = `
            <div class="welcome-banner" style="margin-bottom: 24px;">
                <h2 style="margin-bottom: 8px;"><i class="bi bi-briefcase-fill"></i> GRC Practice Projects</h2>
                <p style="color: var(--text-secondary);">Complete real-world GRC scenarios to build your skills and portfolio. Each project simulates enterprise challenges across different industries and frameworks.</p>
            </div>
            <div class="dashboard-grid" style="grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));">
                ${projects.map(p => this.renderProjectCard(p)).join('')}
            </div>`;
    }
    
    renderProjectCard(p) {
        const progress = this.getProjectProgress(p.id);
        const statusClass = progress.percent === 100 ? 'green' : progress.percent > 0 ? 'amber' : 'blue';
        return `
            <div class="card" style="overflow: visible;">
                <div class="card-header" style="background: linear-gradient(135deg, var(--accent-${statusClass}-soft), transparent);">
                    <div class="card-title"><i class="bi bi-building"></i> ${this.esc(p.company)}</div>
                    <span class="badge badge-${statusClass}">${progress.percent}% Complete</span>
                </div>
                <div class="card-body">
                    <div style="display: flex; gap: 8px; margin-bottom: 12px; flex-wrap: wrap;">
                        <span class="badge" style="background: var(--bg-elevated);"><i class="bi bi-diagram-3"></i> ${p.industry}</span>
                        <span class="badge" style="background: var(--bg-elevated);"><i class="bi bi-people"></i> ${p.size}</span>
                    </div>
                    <h4 style="font-size: 15px; margin-bottom: 8px;">${this.esc(p.scenario)}</h4>
                    <p style="font-size: 13px; color: var(--text-muted); margin-bottom: 16px; line-height: 1.5;">${this.esc(p.description.substring(0, 180))}...</p>
                    <div style="display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 16px;">
                        ${p.frameworks.map(fw => `<span class="badge badge-${this.getFrameworkColor(fw)}">${fw}</span>`).join('')}
                    </div>
                    <div class="progress-bar" style="margin-bottom: 12px;"><div class="progress-fill ${statusClass}" style="width: ${progress.percent}%;"></div></div>
                    <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 16px;">
                        <strong>${progress.completed}/${progress.total}</strong> tasks completed
                    </div>
                    <h5 style="font-size: 13px; margin-bottom: 8px;">Tasks:</h5>
                    <ul style="list-style: none; font-size: 13px;">
                        ${p.tasks.map(t => `
                            <li style="padding: 6px 0; display: flex; align-items: center; gap: 8px; border-bottom: 1px solid var(--border-subtle);">
                                <i class="bi ${t.check() ? 'bi-check-circle-fill' : 'bi-circle'}" style="color: ${t.check() ? 'var(--accent-green)' : 'var(--text-muted)'};"></i>
                                <span style="color: ${t.check() ? 'var(--text-muted)' : 'var(--text-primary)'}; ${t.check() ? 'text-decoration: line-through;' : ''}">${t.label}</span>
                                ${!t.check() ? `<button class="btn btn-sm btn-ghost" style="margin-left: auto;" onclick="app.switchTab('${t.tab}')"><i class="bi bi-arrow-right"></i></button>` : ''}
                            </li>
                        `).join('')}
                    </ul>
                    <div style="margin-top: 16px; display: flex; gap: 8px;">
                        <button class="btn btn-primary btn-sm" onclick="app.startProject('${p.id}')"><i class="bi bi-play-fill"></i> ${progress.percent > 0 ? 'Continue' : 'Start'} Project</button>
                        ${progress.percent === 100 ? `<button class="btn btn-secondary btn-sm" onclick="app.generatePortfolio('${p.id}')"><i class="bi bi-file-earmark-text"></i> Generate Summary</button>` : ''}
                    </div>
                </div>
            </div>`;
    }
    
    getProjectScenarios() {
        const data = this.data;
        return [
            {
                id: 'iso-risk-assessment', company: 'TechStart Inc', industry: 'SaaS / Cloud Services', size: '500 employees',
                scenario: 'ISO 27001 Risk Assessment for Cloud Migration',
                description: 'TechStart Inc is migrating their customer database (5M+ records) from on-premises to AWS while pursuing ISO 27001 certification. As GRC Analyst, identify critical assets, assess migration risks, implement security controls, and document a Statement of Applicability.',
                frameworks: ['ISO 27001', 'NIST CSF'],
                tasks: [
                    { id: 'assets', label: 'Add 3 critical assets', tab: 'assets', check: function() { return data.assets.length >= 3; } },
                    { id: 'risks', label: 'Identify 5 risks', tab: 'risks', check: function() { return data.risks.length >= 5; } },
                    { id: 'controls', label: 'Implement 8 controls', tab: 'controls', check: function() { return data.controls.length >= 8; } },
                    { id: 'treatments', label: 'Document 3 risk treatments', tab: 'treatments', check: function() { return data.treatments.length >= 3; } }
                ]
            },
            {
                id: 'vendor-tprm', company: 'FinSecure Banking', industry: 'Financial Services', size: '1200 employees',
                scenario: 'Third-Party Risk Management for Payment Processor',
                description: 'FinSecure Banking is integrating a third-party payment processor with access to cardholder data. As TPRM lead, conduct vendor due diligence, assess security risks, verify compliance controls, and document remediation requirements.',
                frameworks: ['PCI DSS', 'SOC 2'],
                tasks: [
                    { id: 'vendor', label: 'Add vendor profile', tab: 'vendors', check: function() { return data.vendors.length >= 1; } },
                    { id: 'risks', label: 'Assess 4 vendor risks', tab: 'risks', check: function() { return data.risks.length >= 4; } },
                    { id: 'controls', label: 'Verify 6 controls', tab: 'controls', check: function() { return data.controls.length >= 6; } },
                    { id: 'issues', label: 'Document 3 issues', tab: 'issues', check: function() { return data.issues.length >= 3; } }
                ]
            },
            {
                id: 'soc2-audit', company: 'DataFlow Analytics', industry: 'Data Analytics Platform', size: '300 employees',
                scenario: 'SOC 2 Type II Audit Preparation',
                description: 'DataFlow Analytics serves Fortune 500 clients requiring SOC 2 Type II certification. As Compliance Manager, document Trust Services Criteria controls, catalog critical systems, collect audit evidence, and complete control matrix.',
                frameworks: ['SOC 2', 'NIST CSF'],
                tasks: [
                    { id: 'controls', label: 'Document 12 SOC 2 controls', tab: 'controls', check: function() { return data.controls.length >= 12; } },
                    { id: 'assets', label: 'Catalog 4 systems', tab: 'assets', check: function() { return data.assets.length >= 4; } },
                    { id: 'evidence', label: 'Collect 5 evidence items', tab: 'evidence', check: function() { return data.evidence.length >= 5; } },
                    { id: 'testing', label: 'Complete 4 control tests', tab: 'testing', check: function() { return data.controlTests.length >= 4; } }
                ]
            },
            {
                id: 'gdpr-compliance', company: 'EuroShop Ltd', industry: 'E-commerce', size: '800 employees',
                scenario: 'GDPR Compliance Program Implementation',
                description: 'EuroShop Ltd is expanding into EU markets, processing personal data for 3M+ customers. As Data Protection Officer, map data processing activities, conduct DPIAs, implement privacy controls, and establish data subject rights procedures.',
                frameworks: ['GDPR', 'ISO 27001'],
                tasks: [
                    { id: 'assets', label: 'Map 5 data processing assets', tab: 'assets', check: function() { return data.assets.length >= 5; } },
                    { id: 'risks', label: 'Assess 6 privacy risks', tab: 'risks', check: function() { return data.risks.length >= 6; } },
                    { id: 'controls', label: 'Implement 10 controls', tab: 'controls', check: function() { return data.controls.length >= 10; } },
                    { id: 'policies', label: 'Create 3 policies', tab: 'policies', check: function() { return data.policies.length >= 3; } }
                ]
            },
            {
                id: 'incident-response', company: 'HealthTech Systems', industry: 'Healthcare Technology', size: '600 employees',
                scenario: 'Incident Response Program Development',
                description: 'HealthTech provides EHR systems to 200+ hospitals storing PHI for 2M+ patients. As Security Operations Manager, develop IR playbooks, define team roles, establish escalation procedures, and ensure HIPAA breach notification compliance.',
                frameworks: ['HIPAA', 'NIST CSF'],
                tasks: [
                    { id: 'incidents', label: 'Document 3 incident scenarios', tab: 'incidents', check: function() { return data.incidents.length >= 3; } },
                    { id: 'controls', label: 'Define 8 IR controls', tab: 'controls', check: function() { return data.controls.length >= 8; } },
                    { id: 'assets', label: 'Identify 4 critical systems', tab: 'assets', check: function() { return data.assets.length >= 4; } },
                    { id: 'tasks', label: 'Create 5 response tasks', tab: 'tasks', check: function() { return data.tasks.length >= 5; } }
                ]
            },
            {
                id: 'cloud-security', company: 'CloudNative Corp', industry: 'Cloud Infrastructure', size: '400 employees',
                scenario: 'AWS Security Assessment and Hardening',
                description: 'CloudNative manages AWS infrastructure for 50+ enterprise clients. Recent audits revealed critical misconfigurations. As Cloud Security Engineer, conduct CIS Benchmark assessment, document findings, implement remediation, and create security roadmap.',
                frameworks: ['CIS Controls', 'NIST CSF'],
                tasks: [
                    { id: 'assets', label: 'Inventory 6 cloud assets', tab: 'assets', check: function() { return data.assets.length >= 6; } },
                    { id: 'findings', label: 'Document 5 findings', tab: 'findings', check: function() { return data.findings.length >= 5; } },
                    { id: 'risks', label: 'Assess 4 cloud risks', tab: 'risks', check: function() { return data.risks.length >= 4; } },
                    { id: 'controls', label: 'Implement 10 controls', tab: 'controls', check: function() { return data.controls.length >= 10; } }
                ]
            },
            {
                id: 'bcdr-planning', company: 'CriticalOps Inc', industry: 'Critical Infrastructure', size: '900 employees',
                scenario: 'Business Continuity & Disaster Recovery Planning',
                description: 'CriticalOps operates infrastructure for water treatment and power grid monitoring serving 10M+ citizens. As Business Continuity Manager, conduct BIA, define RTO/RPO requirements, document recovery procedures, and implement technical controls.',
                frameworks: ['COBIT', 'ISO 27001'],
                tasks: [
                    { id: 'assets', label: 'Identify 5 critical assets', tab: 'assets', check: function() { return data.assets.length >= 5; } },
                    { id: 'risks', label: 'Assess 4 continuity risks', tab: 'risks', check: function() { return data.risks.length >= 4; } },
                    { id: 'controls', label: 'Document 8 BC controls', tab: 'controls', check: function() { return data.controls.length >= 8; } },
                    { id: 'audits', label: 'Plan 2 BC exercises', tab: 'audits', check: function() { return data.audits.length >= 2; } }
                ]
            },
            {
                id: 'compliance-gap', company: 'RegTech Solutions', industry: 'Regulatory Technology', size: '350 employees',
                scenario: 'Multi-Framework Compliance Gap Analysis',
                description: 'RegTech serves healthcare, finance, and payment clients requiring simultaneous PCI DSS, SOC 2, and HIPAA compliance. As Compliance Architect, map controls across frameworks, assess implementation status, document gaps, and create remediation roadmap.',
                frameworks: ['PCI DSS', 'SOC 2', 'HIPAA'],
                tasks: [
                    { id: 'controls', label: 'Assess 15 controls', tab: 'controls', check: function() { return data.controls.length >= 15; } },
                    { id: 'issues', label: 'Identify 5 gaps', tab: 'issues', check: function() { return data.issues.length >= 5; } },
                    { id: 'treatments', label: 'Plan 5 remediations', tab: 'treatments', check: function() { return data.treatments.length >= 5; } },
                    { id: 'audits', label: 'Schedule 2 audits', tab: 'audits', check: function() { return data.audits.length >= 2; } }
                ]
            },
            {
                id: 'zero-trust', company: 'SecureBank Digital', industry: 'Digital Banking', size: '750 employees',
                scenario: 'Zero Trust Architecture Implementation',
                description: 'SecureBank Digital is modernizing their security architecture with Zero Trust principles after recent industry breaches. As Security Architect, assess current state, design identity-centric controls, implement microsegmentation, and establish continuous verification mechanisms.',
                frameworks: ['NIST CSF', 'CIS Controls'],
                tasks: [
                    { id: 'assets', label: 'Map 6 critical assets', tab: 'assets', check: function() { return data.assets.length >= 6; } },
                    { id: 'risks', label: 'Assess 5 access risks', tab: 'risks', check: function() { return data.risks.length >= 5; } },
                    { id: 'controls', label: 'Implement 12 ZT controls', tab: 'controls', check: function() { return data.controls.length >= 12; } },
                    { id: 'policies', label: 'Create 4 ZT policies', tab: 'policies', check: function() { return data.policies.length >= 4; } }
                ]
            }
        ];
    }
    
    getProjectProgress(projectId) {
        const project = this.getProjectScenarios().find(p => p.id === projectId);
        if (!project) return { completed: 0, total: 0, percent: 0 };
        const completed = project.tasks.filter(t => t.check()).length;
        const total = project.tasks.length;
        return { completed, total, percent: Math.round((completed / total) * 100) };
    }
    
    startProject(projectId) {
        const project = this.getProjectScenarios().find(p => p.id === projectId);
        if (project && project.tasks.length > 0) {
            const firstIncomplete = project.tasks.find(t => !t.check());
            if (firstIncomplete) {
                this.switchTab(firstIncomplete.tab);
                this.toast(`Project "${project.company}" - Go to ${firstIncomplete.label}`, 'info');
            }
        }
    }
    
    // ==================== PORTFOLIO BUILDER ====================
    renderPortfolio() {
        const c = document.getElementById('tab-portfolio');
        const projects = this.getProjectScenarios();
        const completedProjects = projects.filter(p => this.getProjectProgress(p.id).percent === 100);
        
        c.innerHTML = `
            <div class="welcome-banner" style="margin-bottom: 24px;">
                <h2 style="margin-bottom: 8px;"><i class="bi bi-person-badge-fill"></i> Portfolio Builder</h2>
                <p style="color: var(--text-secondary);">Generate professional summaries and resume bullet points from your completed GRC projects. Showcase your hands-on experience to employers.</p>
            </div>
            
            <div class="card" style="margin-bottom: 24px;">
                <div class="card-header">
                    <div class="card-title"><i class="bi bi-trophy"></i> Your GRC Achievements</div>
                    <button class="btn btn-primary btn-sm" onclick="app.copyAllPortfolio()"><i class="bi bi-clipboard"></i> Copy All to Clipboard</button>
                </div>
                <div class="card-body">
                    <div class="dashboard-grid" style="grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); margin-bottom: 24px;">
                        <div class="metric-card"><div class="metric-icon blue"><i class="bi bi-hdd-stack"></i></div><div class="metric-value">${this.data.assets.length}</div><div class="metric-label">Assets Managed</div></div>
                        <div class="metric-card"><div class="metric-icon red"><i class="bi bi-exclamation-triangle"></i></div><div class="metric-value">${this.data.risks.length}</div><div class="metric-label">Risks Assessed</div></div>
                        <div class="metric-card"><div class="metric-icon green"><i class="bi bi-shield-check"></i></div><div class="metric-value">${this.data.controls.length}</div><div class="metric-label">Controls Implemented</div></div>
                        <div class="metric-card"><div class="metric-icon purple"><i class="bi bi-clipboard-check"></i></div><div class="metric-value">${this.data.audits.length}</div><div class="metric-label">Audits Managed</div></div>
                        <div class="metric-card"><div class="metric-icon amber"><i class="bi bi-folder2-open"></i></div><div class="metric-value">${this.data.evidence.length}</div><div class="metric-label">Evidence Collected</div></div>
                        <div class="metric-card"><div class="metric-icon cyan"><i class="bi bi-briefcase"></i></div><div class="metric-value">${completedProjects.length}/${projects.length}</div><div class="metric-label">Projects</div></div>
                    </div>
                    
                    <h4 style="margin-bottom: 16px;"><i class="bi bi-card-text"></i> General Resume Bullet Points</h4>
                    <div id="portfolio-bullets" style="background: var(--bg-elevated); padding: 20px; border-radius: var(--radius-lg); margin-bottom: 16px; font-size: 14px; line-height: 1.8;">
                        ${this.generateResumeBullets()}
                    </div>
                    <button class="btn btn-secondary btn-sm" onclick="app.copyPortfolio()"><i class="bi bi-clipboard"></i> Copy General Bullets</button>
                </div>
            </div>
            
            <h3 style="margin-bottom: 16px;"><i class="bi bi-folder2"></i> Individual Project Summaries</h3>
            <div class="dashboard-grid" style="grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));">
                ${projects.map(p => this.renderProjectPortfolioCard(p)).join('')}
            </div>
            
            <div class="card" style="margin-top: 24px;">
                <div class="card-header">
                    <div class="card-title"><i class="bi bi-bar-chart"></i> Skills & Frameworks</div>
                </div>
                <div class="card-body">
                    <h5 style="margin-bottom: 12px;">Skills Demonstrated</h5>
                    <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 20px;">
                        ${['Risk Assessment', 'Control Implementation', 'Audit Management', 'Compliance Frameworks', 'Vendor Risk Management', 'Incident Response', 'Policy Development', 'Security Operations', 'Business Continuity', 'Data Protection', 'Zero Trust Architecture', 'Cloud Security'].map(skill => `<span class="badge badge-blue" style="padding: 8px 12px;">${skill}</span>`).join('')}
                    </div>
                    <h5 style="margin-bottom: 12px;">Framework Experience</h5>
                    <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                        ${['ISO 27001', 'NIST CSF', 'SOC 2', 'PCI DSS', 'HIPAA', 'GDPR', 'CIS Controls', 'COBIT', 'CMMC'].map(fw => `<span class="badge badge-${this.getFrameworkColor(fw)}" style="padding: 8px 12px;">${fw}</span>`).join('')}
                    </div>
                </div>
            </div>`;
    }
    
    renderProjectPortfolioCard(p) {
        const progress = this.getProjectProgress(p.id);
        const statusClass = progress.percent === 100 ? 'green' : progress.percent > 0 ? 'amber' : 'blue';
        const summary = this.generateProjectSummary(p);
        
        return `
            <div class="card">
                <div class="card-header" style="background: linear-gradient(135deg, var(--accent-${statusClass}-soft), transparent);">
                    <div class="card-title"><i class="bi bi-building"></i> ${this.esc(p.company)}</div>
                    <span class="badge badge-${statusClass}">${progress.percent}%</span>
                </div>
                <div class="card-body">
                    <div style="display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;">
                        <span class="badge" style="background: var(--bg-elevated);"><i class="bi bi-diagram-3"></i> ${p.industry}</span>
                        ${p.frameworks.map(fw => `<span class="badge badge-${this.getFrameworkColor(fw)}" style="font-size: 11px;">${fw}</span>`).join('')}
                    </div>
                    <h5 style="font-size: 14px; margin-bottom: 8px;">${this.esc(p.scenario)}</h5>
                    <div id="project-summary-${p.id}" style="background: var(--bg-elevated); padding: 16px; border-radius: var(--radius-md); margin-bottom: 12px; font-size: 13px; line-height: 1.7; color: var(--text-secondary);">
                        ${summary}
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button class="btn btn-secondary btn-sm" onclick="app.copyProjectSummary('${p.id}')"><i class="bi bi-clipboard"></i> Copy</button>
                        <button class="btn btn-ghost btn-sm" onclick="app.switchTab('projects')"><i class="bi bi-arrow-right"></i> View Project</button>
                    </div>
                </div>
            </div>`;
    }
    
    generateProjectSummary(p) {
        const progress = this.getProjectProgress(p.id);
        const tasksDone = progress.completed;
        const tasksTotal = progress.total;
        
        // Generate dynamic summary based on project type and progress
        const summaries = {
            'iso-risk-assessment': `Led ISO 27001 risk assessment initiative for cloud migration project at a ${p.size} SaaS company. Identified and documented ${this.data.assets.length} critical information assets, conducted comprehensive risk assessments covering ${this.data.risks.length} potential threats, and implemented ${this.data.controls.length} security controls aligned with ISO 27001 Annex A requirements. Developed risk treatment plans and maintained Statement of Applicability documentation.`,
            
            'vendor-tprm': `Managed third-party risk management program for payment processor integration at a ${p.size} financial services firm. Conducted vendor security assessments, evaluated ${this.data.vendors.length} vendor security postures against PCI DSS and SOC 2 requirements, identified ${this.data.issues.length} compliance gaps, and coordinated remediation efforts with ${this.data.controls.length} compensating controls.`,
            
            'soc2-audit': `Coordinated SOC 2 Type II audit preparation for a ${p.size} data analytics platform serving Fortune 500 clients. Documented ${this.data.controls.length} Trust Services Criteria controls, managed evidence collection for ${this.data.evidence.length} audit artifacts, and executed ${this.data.controlTests.length} control testing procedures to validate operational effectiveness.`,
            
            'gdpr-compliance': `Implemented GDPR compliance program for EU market expansion at a ${p.size} e-commerce company processing 3M+ customer records. Mapped ${this.data.assets.length} data processing activities, conducted Data Protection Impact Assessments for ${this.data.risks.length} high-risk processes, implemented ${this.data.controls.length} privacy controls, and developed ${this.data.policies.length} privacy policies and procedures.`,
            
            'incident-response': `Developed incident response program for a ${p.size} healthcare technology company managing EHR systems with PHI for 2M+ patients. Created ${this.data.incidents.length} incident response playbooks, implemented ${this.data.controls.length} detection and response controls, and established HIPAA breach notification procedures and escalation workflows.`,
            
            'cloud-security': `Conducted AWS security assessment and CIS Benchmark hardening for a ${p.size} cloud infrastructure provider serving 50+ enterprise clients. Inventoried ${this.data.assets.length} cloud assets, identified ${this.data.findings.length} security findings, assessed ${this.data.risks.length} cloud-specific risks, and implemented ${this.data.controls.length} security controls for remediation.`,
            
            'bcdr-planning': `Led business continuity and disaster recovery planning initiative for a ${p.size} critical infrastructure operator. Conducted business impact analysis for ${this.data.assets.length} critical systems, assessed ${this.data.risks.length} continuity risks, documented ${this.data.controls.length} BC/DR controls, and coordinated ${this.data.audits.length} tabletop exercises and recovery tests.`,
            
            'compliance-gap': `Performed multi-framework compliance gap analysis for a ${p.size} RegTech company requiring simultaneous PCI DSS, SOC 2, and HIPAA compliance. Assessed ${this.data.controls.length} controls across frameworks, identified ${this.data.issues.length} compliance gaps, developed ${this.data.treatments.length} remediation plans, and created unified control matrix for audit readiness.`,
            
            'zero-trust': `Architected Zero Trust security framework implementation for a ${p.size} digital banking organization. Mapped ${this.data.assets.length} critical assets requiring protection, assessed ${this.data.risks.length} identity and access risks, implemented ${this.data.controls.length} Zero Trust controls including microsegmentation and continuous verification, and developed ${this.data.policies.length} identity-centric security policies.`
        };
        
        let summary = summaries[p.id] || `Completed GRC project for ${p.company} covering ${p.frameworks.join(', ')} frameworks. Managed ${this.data.assets.length} assets, ${this.data.risks.length} risks, and ${this.data.controls.length} controls.`;
        
        if (progress.percent === 0) {
            summary = `<em style="color: var(--text-muted);">Project not started. Complete tasks to generate a detailed summary.</em>`;
        } else if (progress.percent < 100) {
            summary = `<em style="color: var(--accent-amber);">[${progress.percent}% Complete]</em> ` + summary;
        }
        
        return summary;
    }
    
    generateResumeBullets() {
        const bullets = [];
        if (this.data.assets.length > 0) bullets.push(`• Maintained IT asset inventory of ${this.data.assets.length}+ systems including classification, ownership, and lifecycle management`);
        if (this.data.risks.length > 0) {
            const criticalRisks = this.data.risks.filter(r => (r.likelihood * r.impact) >= 20).length;
            bullets.push(`• Conducted risk assessments identifying ${this.data.risks.length} risks across enterprise systems${criticalRisks > 0 ? `, including ${criticalRisks} critical risks requiring immediate remediation` : ''}`);
        }
        if (this.data.controls.length > 0) {
            const effective = this.data.controls.filter(c => c.effectiveness === 'Effective').length;
            bullets.push(`• Implemented and maintained ${this.data.controls.length} security controls aligned with ISO 27001, NIST CSF, and SOC 2 frameworks${effective > 0 ? ` with ${Math.round(effective/this.data.controls.length*100)}% effectiveness rate` : ''}`);
        }
        if (this.data.vendors.length > 0) bullets.push(`• Managed third-party risk program overseeing ${this.data.vendors.length} vendor relationships including due diligence, contract reviews, and ongoing monitoring`);
        if (this.data.incidents.length > 0) bullets.push(`• Led incident response activities for ${this.data.incidents.length} security events, coordinating investigation, containment, and post-incident review`);
        if (this.data.audits.length > 0) bullets.push(`• Supported ${this.data.audits.length} compliance audits including evidence collection, control testing, and remediation tracking`);
        if (this.data.evidence.length > 0) bullets.push(`• Maintained audit evidence repository with ${this.data.evidence.length}+ artifacts supporting SOC 2 Type II and ISO 27001 certification`);
        if (this.data.policies.length > 0) bullets.push(`• Developed and maintained ${this.data.policies.length} information security policies and procedures`);
        if (this.data.findings.length > 0) {
            const closed = this.data.findings.filter(f => f.status === 'Closed').length;
            bullets.push(`• Tracked remediation of ${this.data.findings.length} audit findings${closed > 0 ? ` with ${Math.round(closed/this.data.findings.length*100)}% closure rate` : ''}`);
        }
        if (bullets.length === 0) bullets.push('• Complete GRC projects to generate resume bullet points based on your work');
        return bullets.join('<br><br>');
    }
    
    copyPortfolio() {
        const text = document.getElementById('portfolio-bullets').innerText;
        navigator.clipboard.writeText(text).then(() => this.toast('General bullets copied to clipboard!', 'success'));
    }
    
    copyProjectSummary(projectId) {
        const el = document.getElementById(`project-summary-${projectId}`);
        if (el) {
            navigator.clipboard.writeText(el.innerText).then(() => this.toast('Project summary copied to clipboard!', 'success'));
        }
    }
    
    copyAllPortfolio() {
        const projects = this.getProjectScenarios();
        let allText = "=== GENERAL RESUME BULLETS ===\n\n";
        allText += document.getElementById('portfolio-bullets').innerText + "\n\n";
        allText += "=== PROJECT SUMMARIES ===\n\n";
        projects.forEach(p => {
            const el = document.getElementById(`project-summary-${p.id}`);
            if (el) {
                allText += `[${p.company} - ${p.scenario}]\n${el.innerText}\n\n`;
            }
        });
        navigator.clipboard.writeText(allText).then(() => this.toast('All portfolio content copied to clipboard!', 'success'));
    }
    
    generateAllPortfolios() {
        this.toast('Portfolio summaries generated! Review and copy your bullet points.', 'success');
        this.renderPortfolio();
    }
    
    generatePortfolio(projectId) {
        this.switchTab('portfolio');
        this.toast(`Portfolio summary generated for project!`, 'success');
    }
}
function openModal(title, body, footer) { document.getElementById('modal-title').textContent = title; document.getElementById('modal-body').innerHTML = body; document.getElementById('modal-footer').innerHTML = footer; document.getElementById('modal-overlay').classList.add('active'); }
function closeModal() { document.getElementById('modal-overlay').classList.remove('active'); }
function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); }
document.getElementById('modal-overlay')?.addEventListener('click', (e) => { if (e.target === e.currentTarget) closeModal(); });
document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeModal(); });
let app;
document.addEventListener('DOMContentLoaded', () => { app = new GRCLabPro(); window.app = app; });
</script>
</body>
</html>
