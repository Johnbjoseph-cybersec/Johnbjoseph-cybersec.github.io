
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>GRC Practice Lab | John Bommeraveni Joseph | Cybersecurity GRC Portfolio</title>
    <meta name="description" content="Interactive GRC simulation lab for practicing cybersecurity governance, risk & compliance concepts. 200+ controls from ISO 27001, NIST CSF, PCI DSS, HIPAA, SOC 2.">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    
    <!-- Custom CSS -->
    <style>
        :root {
            /* Professional color palette */
            --bg-primary: #0a0e17;
            --bg-secondary: #0f172a;
            --bg-card: rgba(30, 41, 59, 0.7);
            --bg-surface: rgba(255, 255, 255, 0.05);
            
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            
            --border-light: rgba(255, 255, 255, 0.1);
            --border-medium: rgba(255, 255, 255, 0.15);
            
            --accent-primary: #3b82f6;
            --accent-success: #10b981;
            --accent-warning: #f59e0b;
            --accent-danger: #ef4444;
            --accent-info: #06b6d4;
            
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
            
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.2);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 10px 30px rgba(0, 0, 0, 0.4);
            --shadow-xl: 0 20px 50px rgba(0, 0, 0, 0.5);
            
            --transition-fast: 150ms ease;
            --transition-normal: 250ms ease;
            --transition-slow: 350ms ease;
        }
        
        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            scroll-behavior: smooth;
            height: 100%;
        }
        
        body {
            font-family: 'Manrope', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, 
                var(--bg-primary) 0%,
                var(--bg-secondary) 100%);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Professional Typography */
        h1, h2, h3, h4, h5, h6 {
            font-weight: 700;
            line-height: 1.2;
            margin-bottom: 1rem;
        }
        
        h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-info));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        h2 {
            font-size: 1.75rem;
            margin-top: 2rem;
        }
        
        h3 {
            font-size: 1.5rem;
        }
        
        .lead {
            font-size: 1.125rem;
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
        }
        
        .text-muted {
            color: var(--text-muted) !important;
        }
        
        /* Layout Components */
        .container-glass {
            background: var(--bg-surface);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            padding: 2rem;
            box-shadow: var(--shadow-lg);
        }
        
        .card-glass {
            background: var(--bg-card);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-md);
            padding: 1.5rem;
            transition: all var(--transition-normal);
        }
        
        .card-glass:hover {
            border-color: var(--border-medium);
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        }
        
        /* Navigation */
        .main-nav {
            background: rgba(10, 14, 23, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-light);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .nav-brand {
            font-weight: 800;
            font-size: 1.25rem;
            color: var(--text-primary);
            text-decoration: none;
        }
        
        .nav-brand .subtitle {
            font-size: 0.875rem;
            color: var(--text-muted);
            font-weight: 500;
        }
        
        .nav-link {
            color: var(--text-secondary);
            font-weight: 600;
            padding: 0.5rem 1rem;
            border-radius: var(--radius-md);
            transition: all var(--transition-fast);
        }
        
        .nav-link:hover,
        .nav-link.active {
            color: var(--text-primary);
            background: var(--bg-surface);
        }
        
        /* Tabs System */
        .tab-nav {
            display: flex;
            gap: 0.5rem;
            overflow-x: auto;
            padding: 1rem 0;
            margin-bottom: 2rem;
            scrollbar-width: thin;
        }
        
        .tab-nav::-webkit-scrollbar {
            height: 4px;
        }
        
        .tab-nav::-webkit-scrollbar-thumb {
            background: var(--border-medium);
            border-radius: 2px;
        }
        
        .tab-btn {
            background: var(--bg-surface);
            border: 1px solid var(--border-light);
            color: var(--text-secondary);
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-md);
            font-weight: 600;
            white-space: nowrap;
            transition: all var(--transition-fast);
        }
        
        .tab-btn:hover {
            background: rgba(59, 130, 246, 0.1);
            border-color: var(--accent-primary);
            color: var(--accent-primary);
        }
        
        .tab-btn.active {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Forms */
        .form-control, .form-select {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-light);
            color: var(--text-primary);
            border-radius: var(--radius-sm);
            padding: 0.75rem 1rem;
            transition: all var(--transition-fast);
        }
        
        .form-control:focus, .form-select:focus {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            color: var(--text-primary);
        }
        
        .form-label {
            color: var(--text-secondary);
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }
        
        /* Tables */
        .table-container {
            background: var(--bg-surface);
            border-radius: var(--radius-md);
            overflow: hidden;
        }
        
        .table-dark {
            --bs-table-bg: transparent;
            --bs-table-color: var(--text-primary);
            --bs-table-border-color: var(--border-light);
        }
        
        .table-dark thead th {
            background: rgba(30, 41, 59, 0.8);
            border-bottom: 2px solid var(--border-medium);
            font-weight: 700;
            color: var(--text-secondary);
            padding: 1rem;
        }
        
        .table-dark tbody tr {
            transition: background-color var(--transition-fast);
        }
        
        .table-dark tbody tr:hover {
            background: rgba(59, 130, 246, 0.05);
        }
        
        .table-dark td {
            padding: 1rem;
            vertical-align: middle;
            border-color: var(--border-light);
        }
        
        /* Buttons */
        .btn {
            font-weight: 600;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-md);
            transition: all var(--transition-fast);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--accent-primary), #1d4ed8);
            border: none;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.3);
        }
        
        .btn-outline-light {
            border-color: var(--border-medium);
            color: var(--text-secondary);
        }
        
        .btn-outline-light:hover {
            background: var(--bg-surface);
            border-color: var(--accent-primary);
            color: var(--text-primary);
        }
        
        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }
        
        /* Status Indicators */
        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 100px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .status-open { background: rgba(239, 68, 68, 0.15); color: #fca5a5; }
        .status-in-progress { background: rgba(245, 158, 11, 0.15); color: #fcd34d; }
        .status-closed { background: rgba(16, 185, 129, 0.15); color: #6ee7b7; }
        .status-mitigated { background: rgba(6, 182, 212, 0.15); color: #67e8f9; }
        
        .severity-high { background: rgba(239, 68, 68, 0.15); color: #fca5a5; }
        .severity-medium { background: rgba(245, 158, 11, 0.15); color: #fcd34d; }
        .severity-low { background: rgba(16, 185, 129, 0.15); color: #6ee7b7; }
        
        /* Risk Matrix */
        .matrix-container {
            background: var(--bg-surface);
            border-radius: var(--radius-md);
            padding: 2rem;
            position: relative;
            overflow: hidden;
        }
        
        .matrix-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(5, 1fr);
            gap: 2px;
            height: 400px;
            margin: 2rem auto;
        }
        
        .matrix-cell {
            position: relative;
            border: 1px solid var(--border-light);
            transition: all var(--transition-fast);
        }
        
        .matrix-cell.high { background: rgba(239, 68, 68, 0.3); }
        .matrix-cell.medium { background: rgba(245, 158, 11, 0.3); }
        .matrix-cell.low { background: rgba(16, 185, 129, 0.3); }
        
        .matrix-cell:hover {
            transform: scale(1.05);
            z-index: 10;
        }
        
        /* Dashboard Cards */
        .metric-card {
            background: var(--bg-card);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-md);
            padding: 1.5rem;
            text-align: center;
            transition: all var(--transition-normal);
        }
        
        .metric-card:hover {
            border-color: var(--accent-primary);
            transform: translateY(-4px);
        }
        
        .metric-value {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-info));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .metric-label {
            color: var(--text-muted);
            font-size: 0.875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        /* Progress Bars */
        .progress {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 100px;
            height: 8px;
            overflow: hidden;
        }
        
        .progress-bar {
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-info));
        }
        
        /* Tooltips */
        [data-tooltip] {
            position: relative;
            cursor: help;
        }
        
        [data-tooltip]:before {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-secondary);
            border: 1px solid var(--border-light);
            color: var(--text-primary);
            padding: 0.5rem 0.75rem;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-fast);
            z-index: 1000;
        }
        
        [data-tooltip]:hover:before {
            opacity: 1;
            visibility: visible;
            bottom: calc(100% + 8px);
        }
        
        /* Loading States */
        .loading {
            position: relative;
            pointer-events: none;
            opacity: 0.7;
        }
        
        .loading:after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-light);
            border-top-color: var(--accent-primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }
        
        /* Framework Badges */
        .framework-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 100px;
            font-size: 0.75rem;
            font-weight: 600;
            margin: 0.125rem;
        }
        
        .badge-iso { background: rgba(59, 130, 246, 0.15); color: #93c5fd; }
        .badge-nist { background: rgba(16, 185, 129, 0.15); color: #6ee7b7; }
        .badge-pci { background: rgba(245, 158, 11, 0.15); color: #fcd34d; }
        .badge-hipaa { background: rgba(236, 72, 153, 0.15); color: #f9a8d4; }
        .badge-soc2 { background: rgba(139, 92, 246, 0.15); color: #c4b5fd; }
        
        /* Alert Messages */
        .alert-glass {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-md);
            padding: 1rem 1.25rem;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            h1 { font-size: 2rem; }
            h2 { font-size: 1.5rem; }
            
            .container-glass {
                padding: 1.5rem;
            }
            
            .tab-nav {
                padding: 0.5rem 0;
            }
            
            .tab-btn {
                padding: 0.5rem 1rem;
                font-size: 0.875rem;
            }
            
            .table-responsive {
                font-size: 0.875rem;
            }
            
            /* Stack table rows on mobile */
            .stack-table tbody tr {
                display: block;
                border: 1px solid var(--border-light);
                border-radius: var(--radius-sm);
                margin-bottom: 1rem;
                padding: 1rem;
            }
            
            .stack-table thead {
                display: none;
            }
            
            .stack-table td {
                display: block;
                border: none;
                padding: 0.5rem 0;
            }
            
            .stack-table td:before {
                content: attr(data-label);
                display: block;
                font-weight: 600;
                color: var(--text-muted);
                font-size: 0.75rem;
                text-transform: uppercase;
                margin-bottom: 0.25rem;
            }
            
            .matrix-grid {
                height: 300px;
            }
        }
        
        /* Print Styles */
        @media print {
            .no-print {
                display: none !important;
            }
            
            body {
                background: white;
                color: black;
            }
            
            .container-glass {
                box-shadow: none;
                border: 1px solid #ddd;
            }
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-surface);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--border-medium);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-primary);
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="main-nav">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <a href="#" class="nav-brand d-block">
                        John Bommeraveni Joseph
                        <div class="subtitle">Cybersecurity GRC | AI Governance | ISO Lead Auditor</div>
                    </a>
                </div>
                <div class="d-flex gap-2">
                    <a href="index.html" class="nav-link">Portfolio</a>
                    <a href="#" class="nav-link active">GRC Lab</a>
                    <a href="cyber-readiness.html" class="nav-link">Cyber Readiness</a>
                    <a href="https://github.com" target="_blank" class="nav-link">
                        <i class="bi bi-github"></i> GitHub
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="py-5">
        <div class="container">
            <div class="container-glass">
                <div class="row align-items-center">
                    <div class="col-lg-8">
                        <h1>GRC Practice Lab</h1>
                        <p class="lead">Interactive simulation environment for practicing Governance, Risk & Compliance concepts. Everything runs locally in your browser - no data leaves your device.</p>
                        
                        <div class="alert alert-glass d-inline-block mb-4" style="background: rgba(245, 158, 11, 0.1); border-color: rgba(245, 158, 11, 0.3);">
                            <small class="d-flex align-items-center">
                                <i class="bi bi-book me-2"></i>
                                <span><strong>Educational Use Only:</strong> Controls are paraphrased for practice & portfolio demonstration.</span>
                            </small>
                        </div>
                        
                        <div class="d-flex flex-wrap gap-2 mt-4">
                            <span class="framework-badge badge-iso">ISO 27001:2022</span>
                            <span class="framework-badge badge-nist">NIST CSF 2.0</span>
                            <span class="framework-badge badge-pci">PCI DSS v4.0</span>
                            <span class="framework-badge badge-hipaa">HIPAA</span>
                            <span class="framework-badge badge-soc2">SOC 2</span>
                            <span class="badge bg-secondary">200+ Controls</span>
                        </div>
                    </div>
                    <div class="col-lg-4 text-lg-end">
                        <div class="mt-4 mt-lg-0">
                            <button class="btn btn-primary me-2" onclick="app.loadDemoScenario()">
                                <i class="bi bi-rocket-takeoff me-2"></i> Load Demo
                            </button>
                            <button class="btn btn-outline-light" onclick="app.exportAllData()">
                                <i class="bi bi-download me-2"></i> Export All
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <section class="py-4">
        <div class="container">
            <!-- Tab Navigation -->
            <div class="tab-nav no-print">
                <button class="tab-btn active" onclick="app.switchTab('dashboard')">
                    <i class="bi bi-speedometer2 me-2"></i> Dashboard
                </button>
                <button class="tab-btn" onclick="app.switchTab('frameworks')">
                    <i class="bi bi-building me-2"></i> Frameworks
                </button>
                <button class="tab-btn" onclick="app.switchTab('assets')">
                    <i class="bi bi-hdd-stack me-2"></i> Assets
                </button>
                <button class="tab-btn" onclick="app.switchTab('vendors')">
                    <i class="bi bi-people me-2"></i> Vendors
                </button>
                <button class="tab-btn" onclick="app.switchTab('risks')">
                    <i class="bi bi-exclamation-triangle me-2"></i> Risks
                </button>
                <button class="tab-btn" onclick="app.switchTab('controls')">
                    <i class="bi bi-shield-check me-2"></i> Controls
                </button>
                <button class="tab-btn" onclick="app.switchTab('soa')">
                    <i class="bi bi-file-text me-2"></i> SoA
                </button>
                <button class="tab-btn" onclick="app.switchTab('matrix')">
                    <i class="bi bi-grid-3x3 me-2"></i> Risk Matrix
                </button>
                <button class="tab-btn" onclick="app.switchTab('reports')">
                    <i class="bi bi-file-earmark-text me-2"></i> Reports
                </button>
                <button class="tab-btn" onclick="app.switchTab('challenges')">
                    <i class="bi bi-trophy me-2"></i> Challenges
                </button>
            </div>

            <!-- Tab Contents -->
            <div id="tabDashboard" class="tab-content active">
                <div class="container-glass">
                    <h2>Dashboard Overview</h2>
                    <div class="row g-4 mb-5">
                        <div class="col-md-3 col-6">
                            <div class="metric-card">
                                <div class="metric-value" id="metricAssets">0</div>
                                <div class="metric-label">Assets</div>
                            </div>
                        </div>
                        <div class="col-md-3 col-6">
                            <div class="metric-card">
                                <div class="metric-value" id="metricRisks">0</div>
                                <div class="metric-label">Risks</div>
                            </div>
                        </div>
                        <div class="col-md-3 col-6">
                            <div class="metric-card">
                                <div class="metric-value" id="metricControls">0</div>
                                <div class="metric-label">Controls</div>
                            </div>
                        </div>
                        <div class="col-md-3 col-6">
                            <div class="metric-card">
                                <div class="metric-value" id="metricCoverage">0%</div>
                                <div class="metric-label">Compliance</div>
                            </div>
                        </div>
                    </div>

                    <div class="row g-4">
                        <div class="col-lg-8">
                            <div class="card-glass">
                                <h4>Recent Risks</h4>
                                <div class="table-responsive">
                                    <table class="table table-dark">
                                        <thead>
                                            <tr>
                                                <th>Risk</th>
                                                <th>Severity</th>
                                                <th>Status</th>
                                                <th>Action</th>
                                            </tr>
                                        </thead>
                                        <tbody id="recentRisks">
                                            <tr>
                                                <td colspan="4" class="text-center text-muted">No risks yet. Add some to get started!</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="card-glass">
                                <h4>Quick Actions</h4>
                                <div class="d-grid gap-2">
                                    <button class="btn btn-outline-light" onclick="app.switchTab('risks'); app.showRiskForm()">
                                        <i class="bi bi-plus-circle me-2"></i> Add New Risk
                                    </button>
                                    <button class="btn btn-outline-light" onclick="app.generateReport()">
                                        <i class="bi bi-file-earmark-text me-2"></i> Generate Report
                                    </button>
                                    <button class="btn btn-outline-light" onclick="app.loadDemoScenario()">
                                        <i class="bi bi-play-circle me-2"></i> Practice Scenario
                                    </button>
                                    <button class="btn btn-outline-light" onclick="app.exportAllData()">
                                        <i class="bi bi-box-arrow-up me-2"></i> Export Data
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Risks Tab -->
            <div id="tabRisks" class="tab-content">
                <div class="container-glass">
                    <h2>Risk Register</h2>
                    <div class="row mb-4">
                        <div class="col-md-8">
                            <div class="input-group">
                                <input type="text" class="form-control" id="riskSearch" placeholder="Search risks...">
                                <select class="form-select" style="max-width: 150px;" id="riskFilter">
                                    <option value="all">All Status</option>
                                    <option value="open">Open</option>
                                    <option value="in-progress">In Progress</option>
                                    <option value="mitigated">Mitigated</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4 text-end">
                            <button class="btn btn-primary" onclick="app.showRiskForm()">
                                <i class="bi bi-plus-circle me-2"></i> Add Risk
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-dark stack-table">
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Category</th>
                                    <th>Likelihood</th>
                                    <th>Impact</th>
                                    <th>Severity</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="riskTableBody">
                                <tr>
                                    <td colspan="7" class="text-center text-muted">No risks recorded yet. Add your first risk!</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Assets Tab -->
            <div id="tabAssets" class="tab-content">
                <div class="container-glass">
                    <h2>Asset Inventory</h2>
                    <div class="row mb-4">
                        <div class="col-md-8">
                            <input type="text" class="form-control" id="assetSearch" placeholder="Search assets...">
                        </div>
                        <div class="col-md-4 text-end">
                            <button class="btn btn-primary" onclick="app.showAssetForm()">
                                <i class="bi bi-plus-circle me-2"></i> Add Asset
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-dark stack-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Type</th>
                                    <th>Criticality</th>
                                    <th>Data Types</th>
                                    <th>Owner</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="assetTableBody">
                                <tr>
                                    <td colspan="6" class="text-center text-muted">No assets recorded yet.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Controls Tab -->
            <div id="tabControls" class="tab-content">
                <div class="container-glass">
                    <h2>Control Library</h2>
                    <div class="row mb-4">
                        <div class="col-md-8">
                            <div class="input-group">
                                <input type="text" class="form-control" id="controlSearch" placeholder="Search controls...">
                                <select class="form-select" style="max-width: 150px;" id="controlStatusFilter">
                                    <option value="all">All Status</option>
                                    <option value="implemented">Implemented</option>
                                    <option value="planned">Planned</option>
                                    <option value="not-implemented">Not Implemented</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4 text-end">
                            <button class="btn btn-primary" onclick="app.showControlForm()">
                                <i class="bi bi-plus-circle me-2"></i> Add Control
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-dark stack-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Type</th>
                                    <th>Framework</th>
                                    <th>Status</th>
                                    <th>Owner</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="controlTableBody">
                                <tr>
                                    <td colspan="6" class="text-center text-muted">No controls recorded yet.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Frameworks Tab -->
            <div id="tabFrameworks" class="tab-content">
                <div class="container-glass">
                    <h2>Framework Library</h2>
                    <div class="row mb-4">
                        <div class="col-md-4">
                            <select class="form-select" id="frameworkSelect">
                                <option value="all">All Frameworks</option>
                                <option value="iso">ISO 27001</option>
                                <option value="nist">NIST CSF</option>
                                <option value="pci">PCI DSS</option>
                                <option value="hipaa">HIPAA</option>
                                <option value="soc2">SOC 2</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <select class="form-select" id="categorySelect">
                                <option value="all">All Categories</option>
                                <option value="access">Access Control</option>
                                <option value="crypto">Encryption</option>
                                <option value="monitoring">Monitoring</option>
                                <option value="incident">Incident Response</option>
                                <option value="governance">Governance</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <input type="text" class="form-control" id="frameworkSearch" placeholder="Search controls...">
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-dark stack-table">
                            <thead>
                                <tr>
                                    <th>Control ID</th>
                                    <th>Name</th>
                                    <th>Category</th>
                                    <th>Framework</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody id="frameworkTableBody">
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Risk Matrix Tab -->
            <div id="tabMatrix" class="tab-content">
                <div class="container-glass">
                    <h2>Risk Matrix</h2>
                    <div class="row mb-4">
                        <div class="col-md-8">
                            <div class="btn-group" role="group">
                                <input type="radio" class="btn-check" name="matrixView" id="inherentView" autocomplete="off" checked>
                                <label class="btn btn-outline-light" for="inherentView">Inherent Risk</label>
                                
                                <input type="radio" class="btn-check" name="matrixView" id="residualView" autocomplete="off">
                                <label class="btn btn-outline-light" for="residualView">Residual Risk</label>
                            </div>
                        </div>
                        <div class="col-md-4 text-end">
                            <button class="btn btn-outline-light" onclick="app.exportMatrix()">
                                <i class="bi bi-download me-2"></i> Export
                            </button>
                        </div>
                    </div>
                    
                    <div class="matrix-container">
                        <div class="matrix-grid" id="riskMatrix">
                            <!-- 5x5 grid will be generated by JavaScript -->
                        </div>
                        <div class="text-center mt-4">
                            <div class="d-inline-flex gap-4">
                                <div><span class="badge bg-danger me-2">High</span> ≥ 15</div>
                                <div><span class="badge bg-warning me-2">Medium</span> 6-14</div>
                                <div><span class="badge bg-success me-2">Low</span> ≤ 5</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SoA Tab -->
            <div id="tabSoa" class="tab-content">
                <div class="container-glass">
                    <h2>Statement of Applicability</h2>
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <select class="form-select" id="soaFrameworkFilter">
                                <option value="all">All Frameworks</option>
                                <option value="iso">ISO 27001</option>
                                <option value="nist">NIST CSF</option>
                                <option value="pci">PCI DSS</option>
                                <option value="hipaa">HIPAA</option>
                                <option value="soc2">SOC 2</option>
                            </select>
                        </div>
                        <div class="col-md-6 text-end">
                            <button class="btn btn-primary" onclick="app.exportSoA()">
                                <i class="bi bi-download me-2"></i> Export SoA
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-dark stack-table">
                            <thead>
                                <tr>
                                    <th>Control ID</th>
                                    <th>Control Name</th>
                                    <th>Framework</th>
                                    <th>Applicability</th>
                                    <th>Implementation</th>
                                    <th>Rationale</th>
                                    <th>Evidence</th>
                                </tr>
                            </thead>
                            <tbody id="soaTableBody">
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Reports Tab -->
            <div id="tabReports" class="tab-content">
                <div class="container-glass">
                    <h2>Reports & Analytics</h2>
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <select class="form-select" id="reportType">
                                <option value="executive">Executive Summary</option>
                                <option value="risk">Risk Register</option>
                                <option value="compliance">Compliance Gap</option>
                                <option value="vendor">Vendor Risk</option>
                                <option value="incident">Incident Report</option>
                            </select>
                        </div>
                        <div class="col-md-6 text-end">
                            <button class="btn btn-primary me-2" onclick="app.generateReport()">
                                <i class="bi bi-file-earmark-text me-2"></i> Generate
                            </button>
                            <button class="btn btn-outline-light" onclick="app.exportReport()">
                                <i class="bi bi-download me-2"></i> Export PDF
                            </button>
                        </div>
                    </div>
                    
                    <div class="card-glass">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="mb-0" id="reportTitle">Report Preview</h5>
                            <button class="btn btn-sm btn-outline-light" onclick="app.copyReport()">
                                <i class="bi bi-clipboard me-1"></i> Copy
                            </button>
                        </div>
                        <div class="p-3 bg-dark rounded" style="min-height: 300px;">
                            <pre id="reportContent" class="text-light mb-0">Select a report type and click Generate to create a report.</pre>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Challenges Tab -->
            <div id="tabChallenges" class="tab-content">
                <div class="container-glass">
                    <h2>GRC Challenges</h2>
                    <p class="lead mb-4">Test your GRC skills with these hands-on challenges. Complete tasks to earn points!</p>
                    
                    <div class="row g-4">
                        <div class="col-md-6">
                            <div class="card-glass">
                                <div class="d-flex justify-content-between align-items-start mb-3">
                                    <h5 class="mb-0">Beginner Challenge</h5>
                                    <span class="badge bg-success">100 Points</span>
                                </div>
                                <p>Complete a basic risk assessment for a small e-commerce company.</p>
                                <ul class="mb-3">
                                    <li>Add 3 assets</li>
                                    <li>Identify 5 risks</li>
                                    <li>Add 3 controls</li>
                                    <li>Generate a report</li>
                                </ul>
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="text-muted">Status: <span id="challenge1Status">Not Started</span></small>
                                    <button class="btn btn-sm btn-primary" onclick="app.startChallenge(1)">
                                        <i class="bi bi-play me-1"></i> Start
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="card-glass">
                                <div class="d-flex justify-content-between align-items-start mb-3">
                                    <h5 class="mb-0">ISO 27001 Certification</h5>
                                    <span class="badge bg-warning">250 Points</span>
                                </div>
                                <p>Prepare for ISO 27001 certification with comprehensive controls.</p>
                                <ul class="mb-3">
                                    <li>Load ISO template</li>
                                    <li>Map 20+ controls</li>
                                    <li>Complete SoA</li>
                                    <li>Achieve 80% coverage</li>
                                </ul>
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="text-muted">Status: <span id="challenge2Status">Not Started</span></small>
                                    <button class="btn btn-sm btn-primary" onclick="app.startChallenge(2)">
                                        <i class="bi bi-play me-1"></i> Start
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="card-glass">
                                <div class="d-flex justify-content-between align-items-start mb-3">
                                    <h5 class="mb-0">Incident Response</h5>
                                    <span class="badge bg-danger">300 Points</span>
                                </div>
                                <p>Handle a simulated data breach incident.</p>
                                <ul class="mb-3">
                                    <li>Log the incident</li>
                                    <li>Link to risks/controls</li>
                                    <li>Add treatments</li>
                                    <li>Generate incident report</li>
                                </ul>
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="text-muted">Status: <span id="challenge3Status">Not Started</span></small>
                                    <button class="btn btn-sm btn-primary" onclick="app.startChallenge(3)">
                                        <i class="bi bi-play me-1"></i> Start
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="card-glass">
                                <div class="d-flex justify-content-between align-items-start mb-3">
                                    <h5 class="mb-0">Vendor Risk Management</h5>
                                    <span class="badge bg-info">200 Points</span>
                                </div>
                                <p>Assess and manage third-party vendor risks.</p>
                                <ul class="mb-3">
                                    <li>Add 5 vendors</li>
                                    <li>Assess criticality</li>
                                    <li>Review contracts</li>
                                    <li>Generate vendor report</li>
                                </ul>
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="text-muted">Status: <span id="challenge4Status">Not Started</span></small>
                                    <button class="btn btn-sm btn-primary" onclick="app.startChallenge(4)">
                                        <i class="bi bi-play me-1"></i> Start
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card-glass mt-4">
                        <h5>Your Progress</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <div class="d-flex justify-content-between mb-1">
                                        <span>Total Points:</span>
                                        <span id="totalPoints">0</span>
                                    </div>
                                    <div class="progress">
                                        <div class="progress-bar" style="width: 25%;"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="text-end">
                                    <button class="btn btn-outline-light" onclick="app.resetChallenges()">
                                        <i class="bi bi-arrow-clockwise me-1"></i> Reset Progress
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="py-4 mt-5 border-top border-light">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <p class="text-muted mb-0">
                        © 2024 John Bommeraveni Joseph. GRC Practice Lab v2.0
                    </p>
                    <small class="text-muted">Built for educational & portfolio demonstration purposes</small>
                </div>
                <div class="col-md-6 text-md-end">
                    <div class="d-flex gap-3 justify-content-md-end">
                        <a href="#" class="text-muted text-decoration-none">
                            <i class="bi bi-github"></i> GitHub
                        </a>
                        <a href="#" class="text-muted text-decoration-none">
                            <i class="bi bi-linkedin"></i> LinkedIn
                        </a>
                        <a href="#" class="text-muted text-decoration-none">
                            <i class="bi bi-envelope"></i> Contact
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- Modals -->
    <div class="modal fade" id="riskModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content bg-dark border border-light">
                <div class="modal-header">
                    <h5 class="modal-title">Add/Edit Risk</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="riskModalBody">
                    <!-- Risk form will be inserted here -->
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="assetModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content bg-dark border border-light">
                <div class="modal-header">
                    <h5 class="modal-title">Add/Edit Asset</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="assetModalBody">
                    <!-- Asset form will be inserted here -->
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="controlModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content bg-dark border border-light">
                <div class="modal-header">
                    <h5 class="modal-title">Add/Edit Control</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="controlModalBody">
                    <!-- Control form will be inserted here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="liveToast" class="toast" role="alert">
            <div class="toast-body bg-dark border border-light d-flex align-items-center">
                <span id="toastMessage"></span>
                <button type="button" class="btn-close btn-close-white ms-auto" data-bs-dismiss="toast"></button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script>
        // ===== CORE APPLICATION =====

        // ---------- Expanded Framework library (over 200 paraphrased controls) ----------
        const FRAMEWORK_CONTROLS = [
    // ISO 27001 Annex A
    {id:"CTRL-5.1",name:"Policies for information security",category:"Organisational Controls",
      description:"Information security policy and topic-specific policies shall be defined, approved by management, published, communicated to and acknowledged by relevant personnel and relevant interested parties, and reviewed at planned intervals and if significant changes occur.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.5.1"]},
    {id:"CTRL-5.2",name:"Information security roles and responsibilities",category:"Organisational Controls",
      description:"Information security roles and responsibilities shall be defined and allocated according to the organization needs.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.5.2"]},
    {id:"CTRL-5.3",name:"Segregation of duties",category:"Organisational Controls",
      description:"Conflicting duties and conflicting areas of responsibility shall be segregated.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.5.3"]},
    {id:"CTRL-5.4",name:"Management responsibilities",category:"Organisational Controls",
      description:"Management shall require all personnel to apply information security in accordance with the established information security policy, topic-specific policies and procedures of the organization.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.5.4"]},
    {id:"CTRL-5.5",name:"Contact with authorities",category:"Organisational Controls",
      description:"The organization shall establish and maintain contact with relevant authorities.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.5.5"]},
    {id:"CTRL-5.6",name:"Contact with special interest groups",category:"Organisational Controls",
      description:"The organization shall establish and maintain contact with special interest groups or other specialist security forums and professional associations.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.5.6"]},
    {id:"CTRL-5.7",name:"Threat intelligence",category:"Organisational Controls",
      description:"Information relating to information security threats shall be collected and analysed to produce threat intelligence.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.5.7"]},
    {id:"CTRL-5.8",name:"Information security in project management",category:"Organisational Controls",
      description:"Information security shall be integrated into project management.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.5.8"]},
    {id:"CTRL-5.9",name:"Inventory of information and other associated assets",category:"Organisational Controls",
      description:"An inventory of information and other associated assets, including owners, shall be developed and maintained.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.5.9"]},
    {id:"CTRL-5.10",name:"Acceptable use of information and other associated assets",category:"Organisational Controls",
      description:"Rules for the acceptable use and procedures for handling information and other associated assets shall be identified, documented and implemented.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.5.10"]},
    {id:"CTRL-5.11",name:"Return of assets",category:"Organisational Controls",
      description:"Personnel and other interested parties as appropriate shall return all the organization's assets in their possession upon change or termination of their employment, contract or agreement.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.5.11"]},
    {id:"CTRL-5.12",name:"Classification of information",category:"Organisational Controls",
      description:"Information shall be classified according to the information security needs of the organization based on confidentiality, integrity, availability and relevant interested party requirements.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.5.12"]},
    {id:"CTRL-5.13",name:"Labelling of information",category:"Organisational Controls",
      description:"An appropriate set of procedures for information labelling shall be developed and implemented in accordance with the information classification scheme adopted by the organization.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.5.13"]},
    {id:"CTRL-5.14",name:"Information transfer",category:"Organisational Controls",
      description:"Information transfer rules, procedures, or agreements shall be in place for all types of transfer facilities within the organization and between the organization and other parties.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.5.14"]},
    {id:"CTRL-5.15",name:"Access control",category:"Organisational Controls",
      description:"Rules to control physical and logical access to information and other associated assets shall be established and implemented based on business and information security requirements.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.5.15"]},
    {id:"CTRL-5.16",name:"Identity management",category:"Organisational Controls",
      description:"The full life cycle of identities shall be managed.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.5.16"]},
    {id:"CTRL-5.17",name:"Authentication information",category:"Organisational Controls",
      description:"Allocation and management of authentication information shall be controlled by a management process, including advising personnel on appropriate handling of authentication information.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.5.17"]},
    {id:"CTRL-5.18",name:"Access rights",category:"Organisational Controls",
      description:"Access rights to information and other associated assets shall be provisioned, reviewed, modified and removed in accordance with the organization's topic-specific policy on and rules for access control.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.5.18"]},
    {id:"CTRL-5.19",name:"Information security in supplier relationships",category:"Organisational Controls",
      description:"Processes and procedures shall be defined and implemented to manage the information security risks associated with the use of supplier's products or services.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.5.19"]},
    {id:"CTRL-5.20",name:"Addressing information security within supplier agreements",category:"Organisational Controls",
      description:"Relevant information security requirements shall be established and agreed with each supplier based on the type of supplier relationship.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.5.20"]},
    {id:"CTRL-5.21",name:"Managing information security in the ICT supply chain",category:"Organisational Controls",
      description:"Processes and procedures shall be defined and implemented to manage the information security risks associated with the ICT products and services supply chain.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.5.21"]},
    {id:"CTRL-5.22",name:"Monitoring, review and change management of supplier services",category:"Organisational Controls",
      description:"The organization shall regularly monitor, review, evaluate and manage change in supplier information security practices.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.5.22"]},
    {id:"CTRL-5.23",name:"Information security for use of cloud services",category:"Organisational Controls",
      description:"Processes for acquisition, use, management and exit from cloud services shall be established in accordance with the organization's information security requirements.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.5.23"]},
    {id:"CTRL-5.24",name:"Information security incident management planning and preparation",category:"Organisational Controls",
      description:"The organization shall plan and prepare for managing information security incidents by defining, establishing and communicating information security incident management processes, roles and responsibilities.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.5.24"]},
    {id:"CTRL-5.25",name:"Assessment and decision on information security events",category:"Organisational Controls",
      description:"The organization shall assess information security events and decide if they are to be categorised as information security incidents.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.5.25"]},
    {id:"CTRL-5.26",name:"Response to information security incidents",category:"Organisational Controls",
      description:"Information security incidents shall be responded to in accordance with the documented procedures.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.5.26"]},
    {id:"CTRL-5.27",name:"Learning from information security incidents",category:"Organisational Controls",
      description:"Knowledge gained from information security incidents shall be used to strengthen and improve the information security controls.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.5.27"]},
    {id:"CTRL-5.28",name:"Collection of evidence",category:"Organisational Controls",
      description:"The organization shall establish and implement procedures for the identification, collection, acquisition and preservation of evidence related to information security events.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.5.28"]},
    {id:"CTRL-5.29",name:"Information security during disruption",category:"Organisational Controls",
      description:"The organization shall plan how to maintain information security at an appropriate level during disruption.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.5.29"]},
    {id:"CTRL-5.30",name:"ICT readiness for business continuity",category:"Organisational Controls",
      description:"ICT readiness shall be planned, implemented, maintained and tested based on business continuity objectives and continuity requirements.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.5.30"]},
    {id:"CTRL-5.31",name:"Legal, statutory, regulatory and contractual requirements",category:"Organisational Controls",
      description:"Legal, statutory, regulatory and contractual requirements relevant to information security and the organization's approach to meet these requirements shall be identified, documented and kept up to date.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.5.31"]},
    {id:"CTRL-5.32",name:"Intellectual property rights",category:"Organisational Controls",
      description:"The organization shall implement appropriate procedures to protect intellectual property rights.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.5.32"]},
    {id:"CTRL-5.33",name:"Protection of records",category:"Organisational Controls",
      description:"Records shall be protected from loss, destruction, falsification, unauthorized access and unauthorized release.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.5.33"]},
    {id:"CTRL-5.34",name:"Privacy and protection of PII",category:"Organisational Controls",
      description:"The organization shall identify and meet the requirements regarding the preservation of privacy and protection of PII according to applicable laws and regulations and contractual requirements.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.5.34"]},
    {id:"CTRL-5.35",name:"Independent review of information security",category:"Organisational Controls",
      description:"The organization's approach to managing information security and its implementation shall be reviewed independently at planned intervals, or when significant changes occur.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.5.35"]},
    {id:"CTRL-5.36",name:"Compliance with security policies and standards",category:"Organisational Controls",
      description:"Managers shall regularly review the compliance of information processing and procedures within their area of responsibility with the appropriate security policies, standards and any other security requirements.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.5.36"]},
    {id:"CTRL-5.37",name:"Documented operating procedures",category:"Organisational Controls",
      description:"Operating procedures for information processing facilities shall be documented and made available to personnel who need them.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.5.37"]},
    // A.6 People Controls (8)
    {id:"CTRL-6.1",name:"Screening",category:"People Controls",
      description:"Background verification checks on all candidates to become personnel shall be carried out prior to joining the organization and on an ongoing basis taking into consideration applicable laws, regulations and ethics and be proportional to the business requirements, the classification of the information to be accessed and the perceived risks.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.6.1"]},
    {id:"CTRL-6.2",name:"Terms and conditions of employment",category:"People Controls",
      description:"Personnel shall agree to terms and conditions of employment, which includes the organization's information security policy and appropriate topic-specific policies.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.6.2"]},
    {id:"CTRL-6.3",name:"Information security awareness, education and training",category:"People Controls",
      description:"Personnel of the organization and relevant interested parties shall receive appropriate information security awareness, education and training and regular updates of the organization's information security policy and topic-specific policies, as relevant for their job function.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.6.3"]},
    {id:"CTRL-6.4",name:"Disciplinary process",category:"People Controls",
      description:"A disciplinary process shall be formalized and communicated to take actions against personnel and other relevant interested parties who have committed an information security policy violation.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.6.4"]},
    {id:"CTRL-6.5",name:"Responsibilities after termination or change of employment",category:"People Controls",
      description:"Information security responsibilities and duties that remain valid after termination or change of employment shall be defined, enforced and communicated to relevant personnel and other interested parties.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.6.5"]},
    {id:"CTRL-6.6",name:"Confidentiality or non-disclosure agreements",category:"People Controls",
      description:"Confidentiality or non-disclosure agreements reflecting the organization's needs for the protection of information shall be identified, documented, regularly reviewed and signed by personnel and other relevant interested parties.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.6.6"]},
    {id:"CTRL-6.7",name:"Remote working",category:"People Controls",
      description:"Security measures shall be implemented when personnel are working remotely to protect information accessed, processed or stored outside the organization's premises.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.6.7"]},
    {id:"CTRL-6.8",name:"Information security event reporting",category:"People Controls",
      description:"The organization shall provide a mechanism for personnel to report observed or suspected information security events through appropriate channels in a timely manner.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.6.8"]},
    // A.7 Physical Controls (14)
    {id:"CTRL-7.1",name:"Physical security perimeters",category:"Physical Controls",
      description:"Security perimeters shall be defined and used to protect areas that contain information and other associated assets.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.7.1"]},
    {id:"CTRL-7.2",name:"Physical entry",category:"Physical Controls",
      description:"Secure areas shall be protected by appropriate entry controls and access points.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.7.2"]},
    {id:"CTRL-7.3",name:"Securing offices, rooms and facilities",category:"Physical Controls",
      description:"Physical security for offices, rooms and facilities shall be designed and implemented.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.7.3"]},
    {id:"CTRL-7.4",name:"Physical security monitoring",category:"Physical Controls",
      description:"Premises shall be continuously monitored for unauthorized physical access.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.7.4"]},
    {id:"CTRL-7.5",name:"Protecting against physical and environmental threats",category:"Physical Controls",
      description:"Protection against physical and environmental threats, such as natural disasters and other intentional or accidental physical threats to infrastructure, shall be designed and implemented.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.7.5"]},
    {id:"CTRL-7.6",name:"Working in secure areas",category:"Physical Controls",
      description:"Security measures for working in secure areas shall be designed and implemented.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.7.6"]},
    {id:"CTRL-7.7",name:"Clear desk and clear screen",category:"Physical Controls",
      description:"Clear desk rules for papers and removable storage media and clear screen rules for information processing facilities shall be defined and appropriately enforced.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.7.7"]},
    {id:"CTRL-7.8",name:"Equipment siting and protection",category:"Physical Controls",
      description:"Equipment shall be sited securely and protected against environmental threats.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.7.8"]},
    {id:"CTRL-7.9",name:"Security of assets off-premises",category:"Physical Controls",
      description:"Off-premise assets shall be protected.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.7.9"]},
    {id:"CTRL-7.10",name:"Storage media",category:"Physical Controls",
      description:"Storage media shall be managed in accordance with the organization's classification scheme and media handling procedures.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.7.10"]},
    {id:"CTRL-7.11",name:"Supporting utilities",category:"Physical Controls",
      description:"Information processing facilities shall be protected from power failures and other disruptions caused by failures in supporting utilities.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.7.11"]},
    {id:"CTRL-7.12",name:"Cabling security",category:"Physical Controls",
      description:"Cables carrying power, data or supporting information services shall be protected from interception, interference or damage.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.7.12"]},
    {id:"CTRL-7.13",name:"Equipment maintenance",category:"Physical Controls",
      description:"Equipment shall be maintained to ensure continued availability and integrity.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.7.13"]},
    {id:"CTRL-7.14",name:"Secure disposal or re-use of equipment",category:"Physical Controls",
      description:"Items of equipment containing storage media shall be verified to ensure that any sensitive data and licensed software has been removed or securely overwritten prior to disposal or re-use.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.7.14"]},
    // A.8 Technological Controls (34)
    {id:"CTRL-8.1",name:"User endpoint devices",category:"Technological Controls",
      description:"Information stored on, processed by or accessible via user endpoint devices shall be protected.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.8.1"]},
    {id:"CTRL-8.2",name:"Privileged access rights",category:"Technological Controls",
      description:"The allocation and use of privileged access rights shall be restricted and managed.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.8.2"]},
    {id:"CTRL-8.3",name:"Information access restriction",category:"Technological Controls",
      description:"Access to information and other associated assets shall be restricted in accordance with the established topic-specific policy on access control.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.8.3"]},
    {id:"CTRL-8.4",name:"Access to source code",category:"Technological Controls",
      description:"Read and write access to source code, development tools and software libraries shall be appropriately managed.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.8.4"]},
    {id:"CTRL-8.5",name:"Secure authentication",category:"Technological Controls",
      description:"Secure authentication technologies and procedures shall be implemented based on information access restrictions and the topic-specific policy on access control.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.8.5"]},
    {id:"CTRL-8.6",name:"Capacity management",category:"Technological Controls",
      description:"The use of resources shall be monitored and adjusted in accordance with current and expected capacity requirements.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.8.6"]},
    {id:"CTRL-8.7",name:"Protection against malware",category:"Technological Controls",
      description:"Protection against malware shall be implemented and supported by appropriate user awareness.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.8.7"]},
    {id:"CTRL-8.8",name:"Management of technical vulnerabilities",category:"Technological Controls",
      description:"Information about technical vulnerabilities of information systems in use shall be obtained, the organization's exposure to such vulnerabilities shall be evaluated and appropriate measures shall be taken.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.8.8"]},
    {id:"CTRL-8.9",name:"Configuration management",category:"Technological Controls",
      description:"Configurations, including security configurations, of hardware, software, services and networks shall be established, documented, implemented, monitored and reviewed.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.8.9"]},
    {id:"CTRL-8.10",name:"Information deletion",category:"Technological Controls",
      description:"Information stored in information systems, devices or in any other storage media shall be deleted when no longer required.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.8.10"]},
    {id:"CTRL-8.11",name:"Data masking",category:"Technological Controls",
      description:"Data masking shall be used in accordance with the organization's topic-specific policy on access control and other related topic-specific policies, and business requirements, taking applicable legislation into consideration.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.8.11"]},
    {id:"CTRL-8.12",name:"Data leakage prevention",category:"Technological Controls",
      description:"Data leakage prevention measures shall be applied to systems, networks and any other devices that process, store or transmit sensitive information.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.8.12"]},
    {id:"CTRL-8.13",name:"Information backup",category:"Technological Controls",
      description:"Backup facilities and a defined and documented backup procedure shall be provided to maintain availability and integrity of information.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.8.13"]},
    {id:"CTRL-8.14",name:"Redundancy of information processing facilities",category:"Technological Controls",
      description:"Information processing facilities shall be implemented with redundancy sufficient to meet availability requirements.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.8.14"]},
    {id:"CTRL-8.15",name:"Logging",category:"Technological Controls",
      description:"Logs that record activities, exceptions, faults and other relevant events shall be produced, stored, protected and analysed.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.8.15"]},
    {id:"CTRL-8.16",name:"Monitoring activities",category:"Technological Controls",
      description:"Networks, systems and applications shall be monitored for anomalous behaviour and appropriate actions taken to evaluate potential information security incidents.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.8.16"]},
    {id:"CTRL-8.17",name:"Clock synchronization",category:"Technological Controls",
      description:"The clocks of information processing systems used by the organization shall be synchronized to approved time sources.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.8.17"]},
    {id:"CTRL-8.18",name:"Use of privileged utility programs",category:"Technological Controls",
      description:"The use of utility programs that can be capable of overriding system and application controls shall be restricted and tightly controlled.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.8.18"]},
    {id:"CTRL-8.19",name:"Installation of software on operational systems",category:"Technological Controls",
      description:"Procedures and measures shall be implemented to securely manage software installation on operational systems.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.8.19"]},
    {id:"CTRL-8.20",name:"Networks security",category:"Technological Controls",
      description:"Networks and network devices shall be secured, managed and controlled to protect information in systems and applications.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.8.20"]},
    {id:"CTRL-8.21",name:"Security of network services",category:"Technological Controls",
      description:"Security mechanisms, service levels and service requirements of network services shall be identified, implemented and monitored.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.8.21"]},
    {id:"CTRL-8.22",name:"Segregation of networks",category:"Technological Controls",
      description:"Groups of information services, users and information systems shall be segregated in the organization's networks.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.8.22"]},
    {id:"CTRL-8.23",name:"Web filtering",category:"Technological Controls",
      description:"Access to external websites shall be managed to reduce exposure to malicious content.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.8.23"]},
    {id:"CTRL-8.24",name:"Use of cryptography",category:"Technological Controls",
      description:"Rules for the effective use of cryptography, including cryptographic key management, shall be defined and implemented.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.8.24"]},
    {id:"CTRL-8.25",name:"Secure development life cycle",category:"Technological Controls",
      description:"Rules for the secure development of software and systems shall be established and applied.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.8.25"]},
    {id:"CTRL-8.26",name:"Application security requirements",category:"Technological Controls",
      description:"Information security requirements shall be identified, specified and approved when developing or acquiring applications.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.8.26"]},
    {id:"CTRL-8.27",name:"Secure system architecture and engineering principles",category:"Technological Controls",
      description:"Principles for engineering secure systems shall be established, documented, maintained and applied to any information system development activities.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.8.27"]},
    {id:"CTRL-8.28",name:"Secure coding",category:"Technological Controls",
      description:"Secure coding principles shall be applied to software development.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.8.28"]},
    {id:"CTRL-8.29",name:"Security testing in development and acceptance",category:"Technological Controls",
      description:"Security testing processes shall be defined and implemented in the development life cycle.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.8.29"]},
    {id:"CTRL-8.30",name:"Outsourced development",category:"Technological Controls",
      description:"The organization shall direct, monitor and review the activities related to outsourced system development.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.8.30"]},
    {id:"CTRL-8.31",name:"Separation of development, test and production environments",category:"Technological Controls",
      description:"Development, testing and production environments shall be separated and secured.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.8.31"]},
    {id:"CTRL-8.32",name:"Change management",category:"Technological Controls",
      description:"Changes to information processing facilities and information systems shall be subject to change management procedures.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.8.32"]},
    {id:"CTRL-8.33",name:"Test information",category:"Technological Controls",
      description:"Test information shall be appropriately selected, protected and managed.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.8.33"]},
    {id:"CTRL-8.34",name:"Protection of information systems during audit testing",category:"Technological Controls",
      description:"Audit tests and other assurance activities involving assessment of operational systems shall be planned and agreed between the tester and appropriate management.",
      frameworks:["ISO 27001"],references:["ISO 27001 A.8.34"]},
    // Add more from NIST CSF subcategories
    {id:"CTRL-ID.AM-01",name:"Physical devices and systems inventory",category:"Asset Management",
      description:"Inventories of physical devices and systems within the organization are maintained.",
      frameworks:["NIST CSF"],references:["NIST ID.AM-01"]},
    {id:"CTRL-ID.AM-02",name:"Software platforms and applications inventory",category:"Asset Management",
      description:"Inventories of software platforms and applications within the organization are maintained.",
      frameworks:["NIST CSF"],references:["NIST ID.AM-02"]},
    {id:"CTRL-ID.AM-03",name:"Organizational communication and data flows mapping",category:"Asset Management",
      description:"Organizational communication and data flows are mapped.",
      frameworks:["NIST CSF"],references:["NIST ID.AM-03"]},
    {id:"CTRL-ID.AM-04",name:"External information systems catalog",category:"Asset Management",
      description:"External information systems are catalogued.",
      frameworks:["NIST CSF"],references:["NIST ID.AM-04"]},
    {id:"CTRL-ID.AM-05",name:"Resources prioritization",category:"Asset Management",
      description:"Resources are prioritized based on their classification, criticality, and business value.",
      frameworks:["NIST CSF"],references:["NIST ID.AM-05"]},
    {id:"CTRL-ID.AM-06",name:"Cybersecurity roles and responsibilities definition",category:"Asset Management",
      description:"Cybersecurity roles and responsibilities for the entire workforce and third-party stakeholders are established.",
      frameworks:["NIST CSF"],references:["NIST ID.AM-06"]},
    {id:"CTRL-ID.BE-01",name:"Organization's role in supply chain identification",category:"Policy & Governance",
      description:"The organization's place in critical infrastructure and its sector is identified and communicated.",
      frameworks:["NIST CSF"],references:["NIST ID.BE-01"]},
    // Add more NIST...
    // From PCI DSS v4.0
    {id:"CTRL-PCI-1.1",name:"Processes for network security controls",category:"Network Security",
      description:"Processes and mechanisms for installing and maintaining network security controls are defined and understood.",
      frameworks:["PCI DSS"],references:["PCI DSS 1.1"]},
    {id:"CTRL-PCI-1.2",name:"Network security controls implementation",category:"Network Security",
      description:"Network security controls are implemented.",
      frameworks:["PCI DSS"],references:["PCI DSS 1.2"]},
    {id:"CTRL-PCI-1.3",name:"Network access restriction",category:"Network Security",
      description:"Network access to and from the cardholder data environment is restricted.",
      frameworks:["PCI DSS"],references:["PCI DSS 1.3"]},
    {id:"CTRL-PCI-1.4",name:"External network access restriction",category:"Network Security",
      description:"Network access from the internet to and from the cardholder data environment is restricted.",
      frameworks:["PCI DSS"],references:["PCI DSS 1.4"]},
    {id:"CTRL-PCI-1.5",name:"Risks from wireless networks",category:"Network Security",
      description:"Risks to the CDE from computing devices and networks with wireless access technology are managed.",
      frameworks:["PCI DSS"],references:["PCI DSS 1.5"]},
    {id:"CTRL-PCI-2.1",name:"Secure configurations processes",category:"Access Control",
      description:"Processes and mechanisms for applying secure configurations to components are defined and understood.",
      frameworks:["PCI DSS"],references:["PCI DSS 2.1"]},
    {id:"CTRL-PCI-2.2",name:"System configuration standards",category:"Access Control",
      description:"System configuration standards are developed, documented, and implemented.",
      frameworks:["PCI DSS"],references:["PCI DSS 2.2"]},
    {id:"CTRL-PCI-2.3",name:"Wireless environment security",category:"Network Security",
      description:"Wireless environments are configured and managed securely.",
      frameworks:["PCI DSS"],references:["PCI DSS 2.3"]},
    {id:"CTRL-PCI-3.1",name:"Processes for protecting stored account data",category:"Encryption & Key Management",
      description:"Processes and mechanisms for protecting stored account data are defined and understood.",
      frameworks:["PCI DSS"],references:["PCI DSS 3.1"]},
    {id:"CTRL-PCI-3.2",name:"Sensitive authentication data storage",category:"Encryption & Key Management",
      description:"Sensitive authentication data is not stored and PAN is rendered unrecoverable.",
      frameworks:["PCI DSS"],references:["PCI DSS 3.2"]},
    {id:"CTRL-PCI-3.3",name:"PAN masking",category:"Encryption & Key Management",
      description:"Primary account number is masked when displayed.",
      frameworks:["PCI DSS"],references:["PCI DSS 3.3"]},
    // Add more PCI...
    // From HIPAA
    {id:"CTRL-HIPAA-164.308(a)(1)(i)",name:"Security management process",category:"Policy & Governance",
      description:"Implement policies and procedures to prevent, detect, contain, and correct security violations.",
      frameworks:["HIPAA"],references:["HIPAA 164.308(a)(1)(i)"]},
    {id:"CTRL-HIPAA-164.308(a)(1)(ii)(A)",name:"Risk analysis",category:"Policy & Governance",
      description:"Conduct an accurate and thorough assessment of the potential risks and vulnerabilities to the confidentiality, integrity, and availability of electronic protected health information held by the covered entity.",
      frameworks:["HIPAA"],references:["HIPAA 164.308(a)(1)(ii)(A)"]},
    {id:"CTRL-HIPAA-164.308(a)(1)(ii)(B)",name:"Risk management",category:"Policy & Governance",
      description:"Implement security measures sufficient to reduce risks and vulnerabilities to a reasonable and appropriate level to comply with §164.306(a).",
      frameworks:["HIPAA"],references:["HIPAA 164.308(a)(1)(ii)(B)"]},
    {id:"CTRL-HIPAA-164.308(a)(1)(ii)(C)",name:"Sanction policy",category:"Policy & Governance",
      description:"Apply appropriate sanctions against workforce members who fail to comply with the security policies and procedures of the covered entity.",
      frameworks:["HIPAA"],references:["HIPAA 164.308(a)(1)(ii)(C)"]},
    {id:"CTRL-HIPAA-164.308(a)(1)(ii)(D)",name:"Information system activity review",category:"Logging & Monitoring",
      description:"Implement procedures to regularly review records of information system activity, such as audit logs, access reports, and security incident tracking reports.",
      frameworks:["HIPAA"],references:["HIPAA 164.308(a)(1)(ii)(D)"]},
    // Add more HIPAA...
    // From SOC 2
    {id:"CTRL-SOC-CC1.1",name:"Commitment to integrity and ethical values",category:"Policy & Governance",
      description:"The entity demonstrates a commitment to integrity and ethical values.",
      frameworks:["SOC2"],references:["SOC2 CC1.1"]},
    {id:"CTRL-SOC-CC1.2",name:"Board independence",category:"Policy & Governance",
      description:"The board of directors demonstrates independence from management and exercises oversight of the development and performance of internal control.",
      frameworks:["SOC2"],references:["SOC2 CC1.2"]},
    {id:"CTRL-SOC-CC1.3",name:"Management roles and responsibilities",category:"Policy & Governance",
      description:"Management establishes, with board oversight, structures, reporting lines, and appropriate authorities and responsibilities in the pursuit of objectives.",
      frameworks:["SOC2"],references:["SOC2 CC1.3"]},
    {id:"CTRL-SOC-CC1.4",name:"Commitment to competent personnel",category:"Policy & Governance",
      description:"The entity demonstrates a commitment to attract, develop, and retain competent individuals in alignment with objectives.",
      frameworks:["SOC2"],references:["SOC2 CC1.4"]},
    {id:"CTRL-SOC-CC1.5",name:"Accountability",category:"Policy & Governance",
      description:"The entity holds individuals accountable for their internal control responsibilities in the pursuit of objectives.",
      frameworks:["SOC2"],references:["SOC2 CC1.5"]},
    {id:"CTRL-SOC-CC2.1",name:"Risk assessment objectives",category:"Policy & Governance",
      description:"The entity specifies objectives with sufficient clarity to enable the identification and assessment of risks relating to objectives.",
      frameworks:["SOC2"],references:["SOC2 CC2.1"]},
    {id:"CTRL-SOC-CC2.2",name:"Risk identification and assessment",category:"Policy & Governance",
      description:"The entity identifies risks to the achievement of its objectives across the entity and analyzes risks as a basis for determining how the risks should be managed.",
      frameworks:["SOC2"],references:["SOC2 CC2.2"]},
    {id:"CTRL-SOC-CC2.3",name:"Fraud risk",category:"Policy & Governance",
      description:"The entity considers the potential for fraud in assessing risks to the achievement of objectives.",
      frameworks:["SOC2"],references:["SOC2 CC2.3"]},
    {id:"CTRL-SOC-CC2.4",name:"Change management",category:"Change Management",
      description:"The entity identifies and assesses changes that could significantly impact the system of internal control.",
      frameworks:["SOC2"],references:["SOC2 CC2.4"]},
    // Add more SOC2...
  ];



        class GRCApplication {
            constructor() {
                this.version = '2.0.0';
                this.storagePrefix = 'grc_lab_v2_';
                this.currentTab = 'dashboard';
                this.data = this.initializeData();
                this.frameworks = this.initializeFrameworks();
                this.currentEditId = null;
                this.currentEditType = null;
                this.init();
            }

            // ===== INITIALIZATION =====
            initializeData() {
                return {
                    assets: this.loadData('assets') || [],
                    vendors: this.loadData('vendors') || [],
                    risks: this.loadData('risks') || [],
                    controls: this.loadData('controls') || [],
                    issues: this.loadData('issues') || [],
                    incidents: this.loadData('incidents') || [],
                    treatments: this.loadData('treatments') || [],
                    soa: this.loadData('soa') || [],
                    challenges: this.loadData('challenges') || {
                        progress: {},
                        scores: {}
                    },
                    settings: this.loadData('settings') || {
                        riskThresholds: { high: 15, medium: 6 },
                        companyName: 'Your Organization',
                        complianceFramework: 'ISO 27001'
                    }
                };
            }

            
            initializeFrameworks() {
                // Build full framework libraries from the unified control list.
                // NOTE: Controls are paraphrased and intended for educational practice only.
                const map = {
                    iso:   { name: 'ISO 27001',   match: ['ISO 27001','ISO/IEC 27001'], controls: [] },
                    nist:  { name: 'NIST CSF',    match: ['NIST CSF','NIST CSF 2.0','NIST'], controls: [] },
                    pci:   { name: 'PCI DSS',     match: ['PCI DSS','PCI DSS v4.0','PCI'], controls: [] },
                    hipaa: { name: 'HIPAA',       match: ['HIPAA'], controls: [] },
                    soc2:  { name: 'SOC 2',       match: ['SOC2','SOC 2'], controls: [] },
                };

                if (typeof FRAMEWORK_CONTROLS === 'undefined' || !Array.isArray(FRAMEWORK_CONTROLS)) return map;

                const norm = (s) => String(s || '').toLowerCase();

                for (const c of FRAMEWORK_CONTROLS) {
                    const fws = Array.isArray(c.frameworks) ? c.frameworks : [c.frameworks].filter(Boolean);
                    const entry = {
                        id: c.id,
                        name: c.name,
                        category: c.category || 'General',
                        description: c.description || '',
                        references: Array.isArray(c.references) ? c.references : [],
                        frameworks: fws
                    };

                    // Add to each matching framework bucket
                    for (const [k, fw] of Object.entries(map)) {
                        const hits = fw.match.some(m => fws.some(x => norm(x).includes(norm(m))));
                        if (hits) fw.controls.push(entry);
                    }
                }

                return map;
            }


            init() {
                this.bindEvents();
                this.renderDashboard();
                this.showToast('GRC Practice Lab loaded successfully', 'success');
                
                // Check for first-time setup
                if (!this.loadData('firstRun')) {
                    this.showFirstTimeSetup();
                    this.saveData('firstRun', true);
                }
            }

            // ===== DATA MANAGEMENT =====
            loadData(key) {
                try {
                    const data = localStorage.getItem(this.storagePrefix + key);
                    return data ? JSON.parse(data) : null;
                } catch (e) {
                    console.error('Error loading data:', e);
                    return null;
                }
            }

            saveData(key, data) {
                try {
                    localStorage.setItem(this.storagePrefix + key, JSON.stringify(data));
                    this.data[key] = data;
                    return true;
                } catch (e) {
                    this.showToast('Error saving data. Check storage space.', 'error');
                    return false;
                }
            }

            // ===== TAB MANAGEMENT =====
            switchTab(tabName) {
                // Update current tab
                this.currentTab = tabName;
                
                // Hide all tabs
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                // Show selected tab
                const tabElement = document.getElementById('tab' + this.capitalize(tabName));
                if (tabElement) {
                    tabElement.classList.add('active');
                }
                
                // Update tab buttons
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.remove('active');
                    if (btn.getAttribute('onclick')?.includes(`switchTab('${tabName}')`)) {
                        btn.classList.add('active');
                    }
                });
                
                // Render tab content
                this.renderTabContent(tabName);
            }

            renderTabContent(tabName) {
                switch(tabName) {
                    case 'dashboard':
                        this.renderDashboard();
                        break;
                    case 'risks':
                        this.renderRisks();
                        break;
                    case 'assets':
                        this.renderAssets();
                        break;
                    case 'controls':
                        this.renderControls();
                        break;
                    case 'frameworks':
                        this.renderFrameworks();
                        break;
                    case 'matrix':
                        this.renderRiskMatrix();
                        break;
                    case 'soa':
                        this.renderSOA();
                        break;
                    case 'reports':
                        this.renderReports();
                        break;
                    case 'challenges':
                        this.renderChallenges();
                        break;
                    case 'vendors':
                        this.renderVendors();
                        break;
                }
            }

            capitalize(str) {
                return str.charAt(0).toUpperCase() + str.slice(1);
            }

            // ===== BIND EVENTS =====
            bindEvents() {
                // Search functionality
                const searchInputs = ['riskSearch', 'assetSearch', 'controlSearch', 'frameworkSearch'];
                searchInputs.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.addEventListener('input', (e) => this.handleSearch(e, id.replace('Search', '')));
                    }
                });

                // Filter functionality
                const filterInputs = ['riskFilter', 'controlStatusFilter', 'frameworkSelect', 'categorySelect'];
                filterInputs.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.addEventListener('change', (e) => this.handleFilter(e, id));
                    }
                });

                // Risk matrix view toggle
                document.querySelectorAll('input[name="matrixView"]').forEach(radio => {
                    radio.addEventListener('change', (e) => this.toggleMatrixView(e.target.id));
                });
            }

            // ===== RISK MANAGEMENT =====
            showRiskForm(riskId = null) {
                this.currentEditId = riskId;
                this.currentEditType = 'risk';
                
                const risk = riskId ? this.data.risks.find(r => r.id === riskId) : null;
                
                const formHTML = `
                    <form id="riskForm" onsubmit="app.saveRisk(event)">
                        <input type="hidden" id="riskId" value="${risk?.id || ''}">
                        
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label class="form-label">Risk Title *</label>
                                <input type="text" class="form-control" id="riskTitle" 
                                       value="${risk?.title || ''}" required placeholder="e.g., Data breach via SQL injection">
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Category *</label>
                                <select class="form-select" id="riskCategory" required>
                                    <option value="">Select...</option>
                                    <option value="Cybersecurity" ${risk?.category === 'Cybersecurity' ? 'selected' : ''}>Cybersecurity</option>
                                    <option value="Compliance" ${risk?.category === 'Compliance' ? 'selected' : ''}>Compliance</option>
                                    <option value="Operational" ${risk?.category === 'Operational' ? 'selected' : ''}>Operational</option>
                                    <option value="Privacy" ${risk?.category === 'Privacy' ? 'selected' : ''}>Privacy</option>
                                    <option value="Third-Party" ${risk?.category === 'Third-Party' ? 'selected' : ''}>Third-Party</option>
                                    <option value="Financial" ${risk?.category === 'Financial' ? 'selected' : ''}>Financial</option>
                                </select>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Status *</label>
                                <select class="form-select" id="riskStatus" required>
                                    <option value="Open" ${risk?.status === 'Open' ? 'selected' : ''}>Open</option>
                                    <option value="In Progress" ${risk?.status === 'In Progress' ? 'selected' : ''}>In Progress</option>
                                    <option value="Mitigated" ${risk?.status === 'Mitigated' ? 'selected' : ''}>Mitigated</option>
                                    <option value="Accepted" ${risk?.status === 'Accepted' ? 'selected' : ''}>Accepted</option>
                                    <option value="Closed" ${risk?.status === 'Closed' ? 'selected' : ''}>Closed</option>
                                </select>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Likelihood (1-5) *</label>
                                <select class="form-select" id="riskLikelihood" required>
                                    <option value="">Select...</option>
                                    ${[1,2,3,4,5].map(n => `
                                        <option value="${n}" ${risk?.likelihood === n ? 'selected' : ''}>
                                            ${n} - ${this.getLikelihoodLabel(n)}
                                        </option>
                                    `).join('')}
                                </select>
                                <small class="text-muted">How likely is this risk to occur?</small>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Impact (1-5) *</label>
                                <select class="form-select" id="riskImpact" required>
                                    <option value="">Select...</option>
                                    ${[1,2,3,4,5].map(n => `
                                        <option value="${n}" ${risk?.impact === n ? 'selected' : ''}>
                                            ${n} - ${this.getImpactLabel(n)}
                                        </option>
                                    `).join('')}
                                </select>
                                <small class="text-muted">How severe would the impact be?</small>
                            </div>
                            
                            <div class="col-md-12 mb-3">
                                <label class="form-label">Description</label>
                                <textarea class="form-control" id="riskDescription" rows="3" 
                                          placeholder="Describe the risk scenario, potential causes, and business impact...">${risk?.description || ''}</textarea>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Owner</label>
                                <input type="text" class="form-control" id="riskOwner" 
                                       value="${risk?.owner || ''}" placeholder="e.g., CISO, DevOps Team">
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Due Date</label>
                                <input type="date" class="form-control" id="riskDueDate" 
                                       value="${risk?.dueDate || ''}">
                            </div>
                            
                            <div class="col-md-12 mb-3">
                                <label class="form-label">Mitigation Notes</label>
                                <textarea class="form-control" id="riskMitigation" rows="2"
                                          placeholder="Current or planned mitigation controls...">${risk?.mitigation || ''}</textarea>
                            </div>
                            
                            <div class="col-12">
                                <div class="alert alert-info bg-dark border-info">
                                    <small>
                                        <strong>Risk Score:</strong> <span id="riskScorePreview">${risk ? risk.score : '0'}</span> 
                                        <span class="ms-3"><strong>Severity:</strong> <span id="riskSeverityPreview">${risk ? risk.severity : 'None'}</span></span>
                                    </small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="text-end mt-4">
                            <button type="button" class="btn btn-outline-light me-2" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-primary">${risk ? 'Update' : 'Save'} Risk</button>
                        </div>
                    </form>
                `;
                
                document.getElementById('riskModalBody').innerHTML = formHTML;
                
                // Calculate initial score
                this.updateRiskScorePreview();
                
                // Add event listeners for score calculation
                document.getElementById('riskLikelihood')?.addEventListener('change', () => this.updateRiskScorePreview());
                document.getElementById('riskImpact')?.addEventListener('change', () => this.updateRiskScorePreview());
                
                // Show modal
                const modal = new bootstrap.Modal(document.getElementById('riskModal'));
                modal.show();
            }

            updateRiskScorePreview() {
                const likelihood = parseInt(document.getElementById('riskLikelihood')?.value) || 0;
                const impact = parseInt(document.getElementById('riskImpact')?.value) || 0;
                const score = likelihood * impact;
                const severity = this.calculateRiskSeverity(score);
                
                const scoreElement = document.getElementById('riskScorePreview');
                const severityElement = document.getElementById('riskSeverityPreview');
                
                if (scoreElement) scoreElement.textContent = score;
                if (severityElement) {
                    severityElement.textContent = severity;
                    severityElement.className = '';
                    severityElement.classList.add('badge', `bg-${severity === 'High' ? 'danger' : severity === 'Medium' ? 'warning' : 'success'}`);
                }
            }

            saveRisk(event) {
                event.preventDefault();
                
                const riskData = {
                    id: document.getElementById('riskId').value || 'RISK_' + Date.now(),
                    title: document.getElementById('riskTitle').value.trim(),
                    category: document.getElementById('riskCategory').value,
                    status: document.getElementById('riskStatus').value,
                    likelihood: parseInt(document.getElementById('riskLikelihood').value),
                    impact: parseInt(document.getElementById('riskImpact').value),
                    description: document.getElementById('riskDescription').value.trim(),
                    owner: document.getElementById('riskOwner').value.trim(),
                    dueDate: document.getElementById('riskDueDate').value,
                    mitigation: document.getElementById('riskMitigation').value.trim(),
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                // Calculate score and severity
                riskData.score = riskData.likelihood * riskData.impact;
                riskData.severity = this.calculateRiskSeverity(riskData.score);
                
                // Find index if editing
                const index = this.data.risks.findIndex(r => r.id === riskData.id);
                if (index > -1) {
                    this.data.risks[index] = riskData;
                    this.showToast('Risk updated successfully', 'success');
                } else {
                    this.data.risks.push(riskData);
                    this.showToast('Risk added successfully', 'success');
                }
                
                // Save and update UI
                this.saveData('risks', this.data.risks);
                this.renderRisks();
                this.renderDashboard();
                
                // Close modal
                bootstrap.Modal.getInstance(document.getElementById('riskModal')).hide();
            }

            calculateRiskSeverity(score) {
                const thresholds = this.data.settings.riskThresholds;
                if (score >= thresholds.high) return 'High';
                if (score >= thresholds.medium) return 'Medium';
                return 'Low';
            }

            getLikelihoodLabel(score) {
                const labels = ['Rare', 'Unlikely', 'Possible', 'Likely', 'Almost Certain'];
                return labels[score - 1] || '';
            }

            getImpactLabel(score) {
                const labels = ['Insignificant', 'Minor', 'Moderate', 'Major', 'Severe'];
                return labels[score - 1] || '';
            }

            renderRisks() {
                const tableBody = document.getElementById('riskTableBody');
                if (!tableBody) return;

                // Get search and filter values
                const searchTerm = document.getElementById('riskSearch')?.value.toLowerCase() || '';
                const filterStatus = document.getElementById('riskFilter')?.value || 'all';
                
                // Filter risks
                let filteredRisks = this.data.risks;
                
                if (searchTerm) {
                    filteredRisks = filteredRisks.filter(risk =>
                        risk.title.toLowerCase().includes(searchTerm) ||
                        risk.category.toLowerCase().includes(searchTerm) ||
                        risk.description?.toLowerCase().includes(searchTerm)
                    );
                }
                
                if (filterStatus !== 'all') {
                    filteredRisks = filteredRisks.filter(risk => 
                        risk.status.toLowerCase().replace(' ', '-') === filterStatus
                    );
                }
                
                // Sort by score (highest first)
                filteredRisks.sort((a, b) => b.score - a.score);
                
                // Render table
                if (filteredRisks.length === 0) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="7" class="text-center text-muted">
                                <div class="py-4">
                                    <i class="bi bi-exclamation-triangle fs-4 d-block mb-2"></i>
                                    No risks found. ${searchTerm ? 'Try a different search term.' : 'Add your first risk!'}
                                </div>
                            </td>
                        </tr>
                    `;
                } else {
                    tableBody.innerHTML = filteredRisks.map(risk => `
                        <tr>
                            <td data-label="Risk">
                                <strong>${risk.title}</strong><br>
                                <small class="text-muted">${risk.category}</small>
                            </td>
                            <td data-label="Category">${risk.category}</td>
                            <td data-label="Likelihood">
                                <span class="badge bg-info">${risk.likelihood}</span>
                                <small class="d-block text-muted">${this.getLikelihoodLabel(risk.likelihood)}</small>
                            </td>
                            <td data-label="Impact">
                                <span class="badge bg-warning">${risk.impact}</span>
                                <small class="d-block text-muted">${this.getImpactLabel(risk.impact)}</small>
                            </td>
                            <td data-label="Severity">
                                <span class="badge bg-${risk.severity === 'High' ? 'danger' : risk.severity === 'Medium' ? 'warning' : 'success'}">
                                    ${risk.severity} (${risk.score})
                                </span>
                            </td>
                            <td data-label="Status">
                                <span class="status-badge status-${risk.status.toLowerCase().replace(' ', '-')}">
                                    ${risk.status}
                                </span>
                            </td>
                            <td data-label="Actions">
                                <div class="btn-group btn-group-sm">
                                    <button class="btn btn-outline-light" onclick="app.showRiskForm('${risk.id}')">
                                        <i class="bi bi-pencil"></i>
                                    </button>
                                    <button class="btn btn-outline-danger" onclick="app.deleteItem('risk', '${risk.id}')">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `).join('');
                }
            }

            // ===== ASSET MANAGEMENT =====
            showAssetForm(assetId = null) {
                this.currentEditId = assetId;
                this.currentEditType = 'asset';
                
                const asset = assetId ? this.data.assets.find(a => a.id === assetId) : null;
                
                const formHTML = `
                    <form id="assetForm" onsubmit="app.saveAsset(event)">
                        <input type="hidden" id="assetId" value="${asset?.id || ''}">
                        
                        <div class="row">
                            <div class="col-md-8 mb-3">
                                <label class="form-label">Asset Name *</label>
                                <input type="text" class="form-control" id="assetName" 
                                       value="${asset?.name || ''}" required placeholder="e.g., Customer Database">
                            </div>
                            
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Type *</label>
                                <select class="form-select" id="assetType" required>
                                    <option value="">Select...</option>
                                    <option value="Application" ${asset?.type === 'Application' ? 'selected' : ''}>Application</option>
                                    <option value="Database" ${asset?.type === 'Database' ? 'selected' : ''}>Database</option>
                                    <option value="Server" ${asset?.type === 'Server' ? 'selected' : ''}>Server</option>
                                    <option value="Network Device" ${asset?.type === 'Network Device' ? 'selected' : ''}>Network Device</option>
                                    <option value="Cloud Service" ${asset?.type === 'Cloud Service' ? 'selected' : ''}>Cloud Service</option>
                                    <option value="Data Store" ${asset?.type === 'Data Store' ? 'selected' : ''}>Data Store</option>
                                    <option value="Other" ${asset?.type === 'Other' ? 'selected' : ''}>Other</option>
                                </select>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Business Criticality *</label>
                                <select class="form-select" id="assetCriticality" required>
                                    <option value="">Select...</option>
                                    <option value="High" ${asset?.criticality === 'High' ? 'selected' : ''}>High</option>
                                    <option value="Medium" ${asset?.criticality === 'Medium' ? 'selected' : ''}>Medium</option>
                                    <option value="Low" ${asset?.criticality === 'Low' ? 'selected' : ''}>Low</option>
                                </select>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Owner</label>
                                <input type="text" class="form-control" id="assetOwner" 
                                       value="${asset?.owner || ''}" placeholder="e.g., IT Department">
                            </div>
                            
                            <div class="col-md-12 mb-3">
                                <label class="form-label">Data Types</label>
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="dataPII" ${asset?.dataTypes?.includes('PII') ? 'checked' : ''}>
                                            <label class="form-check-label" for="dataPII">PII</label>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="dataPHI" ${asset?.dataTypes?.includes('PHI') ? 'checked' : ''}>
                                            <label class="form-check-label" for="dataPHI">PHI</label>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="dataFinancial" ${asset?.dataTypes?.includes('Financial') ? 'checked' : ''}>
                                            <label class="form-check-label" for="dataFinancial">Financial</label>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="dataInternal" ${asset?.dataTypes?.includes('Internal') ? 'checked' : ''}>
                                            <label class="form-check-label" for="dataInternal">Internal</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-12 mb-3">
                                <label class="form-label">Description</label>
                                <textarea class="form-control" id="assetDescription" rows="3"
                                          placeholder="Describe the asset purpose, location, and importance...">${asset?.description || ''}</textarea>
                            </div>
                        </div>
                        
                        <div class="text-end mt-4">
                            <button type="button" class="btn btn-outline-light me-2" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-primary">${asset ? 'Update' : 'Save'} Asset</button>
                        </div>
                    </form>
                `;
                
                document.getElementById('assetModalBody').innerHTML = formHTML;
                const modal = new bootstrap.Modal(document.getElementById('assetModal'));
                modal.show();
            }

            saveAsset(event) {
                event.preventDefault();
                
                // Collect data types
                const dataTypes = [];
                if (document.getElementById('dataPII')?.checked) dataTypes.push('PII');
                if (document.getElementById('dataPHI')?.checked) dataTypes.push('PHI');
                if (document.getElementById('dataFinancial')?.checked) dataTypes.push('Financial');
                if (document.getElementById('dataInternal')?.checked) dataTypes.push('Internal');
                
                const assetData = {
                    id: document.getElementById('assetId').value || 'AST_' + Date.now(),
                    name: document.getElementById('assetName').value.trim(),
                    type: document.getElementById('assetType').value,
                    criticality: document.getElementById('assetCriticality').value,
                    owner: document.getElementById('assetOwner').value.trim(),
                    description: document.getElementById('assetDescription').value.trim(),
                    dataTypes: dataTypes,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                // Find index if editing
                const index = this.data.assets.findIndex(a => a.id === assetData.id);
                if (index > -1) {
                    this.data.assets[index] = assetData;
                    this.showToast('Asset updated successfully', 'success');
                } else {
                    this.data.assets.push(assetData);
                    this.showToast('Asset added successfully', 'success');
                }
                
                // Save and update UI
                this.saveData('assets', this.data.assets);
                this.renderAssets();
                this.renderDashboard();
                
                // Close modal
                bootstrap.Modal.getInstance(document.getElementById('assetModal')).hide();
            }

            renderAssets() {
                const tableBody = document.getElementById('assetTableBody');
                if (!tableBody) return;

                const searchTerm = document.getElementById('assetSearch')?.value.toLowerCase() || '';
                let filteredAssets = this.data.assets;
                
                if (searchTerm) {
                    filteredAssets = filteredAssets.filter(asset =>
                        asset.name.toLowerCase().includes(searchTerm) ||
                        asset.type.toLowerCase().includes(searchTerm) ||
                        asset.owner?.toLowerCase().includes(searchTerm)
                    );
                }
                
                if (filteredAssets.length === 0) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="6" class="text-center text-muted">
                                <div class="py-4">
                                    <i class="bi bi-hdd-stack fs-4 d-block mb-2"></i>
                                    No assets found. ${searchTerm ? 'Try a different search term.' : 'Add your first asset!'}
                                </div>
                            </td>
                        </tr>
                    `;
                } else {
                    tableBody.innerHTML = filteredAssets.map(asset => `
                        <tr>
                            <td data-label="Name">
                                <strong>${asset.name}</strong><br>
                                <small class="text-muted">ID: ${asset.id}</small>
                            </td>
                            <td data-label="Type">
                                <span class="badge bg-secondary">${asset.type}</span>
                            </td>
                            <td data-label="Criticality">
                                <span class="badge bg-${asset.criticality === 'High' ? 'danger' : asset.criticality === 'Medium' ? 'warning' : 'success'}">
                                    ${asset.criticality}
                                </span>
                            </td>
                            <td data-label="Data Types">
                                ${asset.dataTypes?.map(type => `<span class="badge bg-info me-1">${type}</span>`).join('') || '-'}
                            </td>
                            <td data-label="Owner">${asset.owner || '-'}</td>
                            <td data-label="Actions">
                                <div class="btn-group btn-group-sm">
                                    <button class="btn btn-outline-light" onclick="app.showAssetForm('${asset.id}')">
                                        <i class="bi bi-pencil"></i>
                                    </button>
                                    <button class="btn btn-outline-danger" onclick="app.deleteItem('asset', '${asset.id}')">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `).join('');
                }
            }

            // ===== CONTROL MANAGEMENT =====
            showControlForm(controlId = null) {
                this.currentEditId = controlId;
                this.currentEditType = 'control';
                
                const control = controlId ? this.data.controls.find(c => c.id === controlId) : null;
                
                const formHTML = `
                    <form id="controlForm" onsubmit="app.saveControl(event)">
                        <input type="hidden" id="controlId" value="${control?.id || ''}">
                        
                        <div class="row">
                            <div class="col-md-8 mb-3">
                                <label class="form-label">Control Name *</label>
                                <input type="text" class="form-control" id="controlName" 
                                       value="${control?.name || ''}" required placeholder="e.g., Multi-Factor Authentication">
                            </div>
                            
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Type *</label>
                                <select class="form-select" id="controlType" required>
                                    <option value="">Select...</option>
                                    <option value="Preventive" ${control?.type === 'Preventive' ? 'selected' : ''}>Preventive</option>
                                    <option value="Detective" ${control?.type === 'Detective' ? 'selected' : ''}>Detective</option>
                                    <option value="Corrective" ${control?.type === 'Corrective' ? 'selected' : ''}>Corrective</option>
                                    <option value="Administrative" ${control?.type === 'Administrative' ? 'selected' : ''}>Administrative</option>
                                    <option value="Technical" ${control?.type === 'Technical' ? 'selected' : ''}>Technical</option>
                                    <option value="Physical" ${control?.type === 'Physical' ? 'selected' : ''}>Physical</option>
                                </select>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Status *</label>
                                <select class="form-select" id="controlStatus" required>
                                    <option value="">Select...</option>
                                    <option value="Implemented" ${control?.status === 'Implemented' ? 'selected' : ''}>Implemented</option>
                                    <option value="Planned" ${control?.status === 'Planned' ? 'selected' : ''}>Planned</option>
                                    <option value="Not Implemented" ${control?.status === 'Not Implemented' ? 'selected' : ''}>Not Implemented</option>
                                    <option value="Not Applicable" ${control?.status === 'Not Applicable' ? 'selected' : ''}>Not Applicable</option>
                                </select>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Framework Alignment</label>
                                <select class="form-select" id="controlFramework">
                                    <option value="">Select...</option>
                                    <option value="ISO 27001" ${control?.framework === 'ISO 27001' ? 'selected' : ''}>ISO 27001</option>
                                    <option value="NIST CSF" ${control?.framework === 'NIST CSF' ? 'selected' : ''}>NIST CSF</option>
                                    <option value="PCI DSS" ${control?.framework === 'PCI DSS' ? 'selected' : ''}>PCI DSS</option>
                                    <option value="HIPAA" ${control?.framework === 'HIPAA' ? 'selected' : ''}>HIPAA</option>
                                    <option value="SOC 2" ${control?.framework === 'SOC 2' ? 'selected' : ''}>SOC 2</option>
                                </select>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Owner</label>
                                <input type="text" class="form-control" id="controlOwner" 
                                       value="${control?.owner || ''}" placeholder="e.g., Security Team">
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Implementation Date</label>
                                <input type="date" class="form-control" id="controlDate" 
                                       value="${control?.implementationDate || ''}">
                            </div>
                            
                            <div class="col-md-12 mb-3">
                                <label class="form-label">Description</label>
                                <textarea class="form-control" id="controlDescription" rows="3"
                                          placeholder="Describe the control implementation, coverage, and evidence...">${control?.description || ''}</textarea>
                            </div>
                            
                            <div class="col-md-12 mb-3">
                                <label class="form-label">Evidence / Notes</label>
                                <textarea class="form-control" id="controlEvidence" rows="2"
                                          placeholder="Links to documentation, screenshots, or other evidence...">${control?.evidence || ''}</textarea>
                            </div>
                        </div>
                        
                        <div class="text-end mt-4">
                            <button type="button" class="btn btn-outline-light me-2" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-primary">${control ? 'Update' : 'Save'} Control</button>
                        </div>
                    </form>
                `;
                
                document.getElementById('controlModalBody').innerHTML = formHTML;
                const modal = new bootstrap.Modal(document.getElementById('controlModal'));
                modal.show();
            }

            saveControl(event) {
                event.preventDefault();
                
                const controlData = {
                    id: document.getElementById('controlId').value || 'CTL_' + Date.now(),
                    name: document.getElementById('controlName').value.trim(),
                    type: document.getElementById('controlType').value,
                    status: document.getElementById('controlStatus').value,
                    framework: document.getElementById('controlFramework').value,
                    owner: document.getElementById('controlOwner').value.trim(),
                    implementationDate: document.getElementById('controlDate').value,
                    description: document.getElementById('controlDescription').value.trim(),
                    evidence: document.getElementById('controlEvidence').value.trim(),
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                // Find index if editing
                const index = this.data.controls.findIndex(c => c.id === controlData.id);
                if (index > -1) {
                    this.data.controls[index] = controlData;
                    this.showToast('Control updated successfully', 'success');
                } else {
                    this.data.controls.push(controlData);
                    this.showToast('Control added successfully', 'success');
                }
                
                // Save and update UI
                this.saveData('controls', this.data.controls);
                this.renderControls();
                this.renderDashboard();
                this.renderSOA();
                
                // Close modal
                bootstrap.Modal.getInstance(document.getElementById('controlModal')).hide();
            }

            renderControls() {
                const tableBody = document.getElementById('controlTableBody');
                if (!tableBody) return;

                const searchTerm = document.getElementById('controlSearch')?.value.toLowerCase() || '';
                const filterStatus = document.getElementById('controlStatusFilter')?.value || 'all';
                
                let filteredControls = this.data.controls;
                
                if (searchTerm) {
                    filteredControls = filteredControls.filter(control =>
                        control.name.toLowerCase().includes(searchTerm) ||
                        control.type.toLowerCase().includes(searchTerm) ||
                        control.framework?.toLowerCase().includes(searchTerm)
                    );
                }
                
                if (filterStatus !== 'all') {
                    filteredControls = filteredControls.filter(control => 
                        control.status.toLowerCase().replace(' ', '-') === filterStatus
                    );
                }
                
                if (filteredControls.length === 0) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="6" class="text-center text-muted">
                                <div class="py-4">
                                    <i class="bi bi-shield-check fs-4 d-block mb-2"></i>
                                    No controls found. ${searchTerm ? 'Try a different search term.' : 'Add your first control!'}
                                </div>
                            </td>
                        </tr>
                    `;
                } else {
                    tableBody.innerHTML = filteredControls.map(control => `
                        <tr>
                            <td data-label="Name">
                                <strong>${control.name}</strong><br>
                                <small class="text-muted">${control.type}</small>
                            </td>
                            <td data-label="Type">
                                <span class="badge bg-secondary">${control.type}</span>
                            </td>
                            <td data-label="Framework">
                                ${control.framework ? `<span class="badge bg-primary">${control.framework}</span>` : '-'}
                            </td>
                            <td data-label="Status">
                                <span class="status-badge status-${control.status.toLowerCase().replace(' ', '-')}">
                                    ${control.status}
                                </span>
                            </td>
                            <td data-label="Owner">${control.owner || '-'}</td>
                            <td data-label="Actions">
                                <div class="btn-group btn-group-sm">
                                    <button class="btn btn-outline-light" onclick="app.showControlForm('${control.id}')">
                                        <i class="bi bi-pencil"></i>
                                    </button>
                                    <button class="btn btn-outline-danger" onclick="app.deleteItem('control', '${control.id}')">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `).join('');
                }
            }

            // ===== FRAMEWORK LIBRARY =====
            renderFrameworks() {
                const tableBody = document.getElementById('frameworkTableBody');
                if (!tableBody) return;

                const searchTerm = document.getElementById('frameworkSearch')?.value.toLowerCase() || '';
                const frameworkFilter = document.getElementById('frameworkSelect')?.value || 'all';
                const categoryFilter = document.getElementById('categorySelect')?.value || 'all';
                
                let allControls = [];
                
                // Combine all framework controls
                Object.values(this.frameworks).forEach(framework => {
                    framework.controls.forEach(control => {
                        allControls.push({
                            ...control,
                            framework: framework.name,
                            frameworkKey: Object.keys(this.frameworks).find(k => this.frameworks[k].name === framework.name)
                        });
                    });
                });
                
                // Apply filters
                let filteredControls = allControls;
                
                if (searchTerm) {
                    filteredControls = filteredControls.filter(control =>
                        control.name.toLowerCase().includes(searchTerm) ||
                        control.description.toLowerCase().includes(searchTerm) ||
                        control.id.toLowerCase().includes(searchTerm)
                    );
                }
                
                if (frameworkFilter !== 'all') {
                    filteredControls = filteredControls.filter(control => 
                        control.frameworkKey === frameworkFilter
                    );
                }
                
                if (categoryFilter !== 'all') {
                    filteredControls = filteredControls.filter(control => 
                        control.category.toLowerCase().includes(categoryFilter.toLowerCase())
                    );
                }
                
                if (filteredControls.length === 0) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="5" class="text-center text-muted">
                                <div class="py-4">
                                    <i class="bi bi-search fs-4 d-block mb-2"></i>
                                    No controls match your filters. Try adjusting your search.
                                </div>
                            </td>
                        </tr>
                    `;
                } else {
                    tableBody.innerHTML = filteredControls.map(control => `
                        <tr>
                            <td data-label="Control ID">
                                <code>${control.id}</code>
                            </td>
                            <td data-label="Name">
                                <strong>${control.name}</strong><br>
                                <small class="text-muted">${control.category}</small>
                            </td>
                            <td data-label="Category">
                                <span class="badge bg-info">${control.category}</span>
                            </td>
                            <td data-label="Framework">
                                <span class="framework-badge badge-${control.frameworkKey}">${control.framework}</span>
                            </td>
                            <td data-label="Description">
                                <small>${control.description}</small>
                            </td>
                        </tr>
                    `).join('');
                }
            }

            // ===== RISK MATRIX =====
            renderRiskMatrix() {
                const container = document.getElementById('riskMatrix');
                if (!container) return;
                
                // Clear and create 5x5 grid
                container.innerHTML = '';
                
                for (let i = 5; i >= 1; i--) { // Likelihood (5 to 1)
                    for (let j = 1; j <= 5; j++) { // Impact (1 to 5)
                        const score = i * j;
                        const severity = this.calculateRiskSeverity(score);
                        
                        const cell = document.createElement('div');
                        cell.className = `matrix-cell ${severity.toLowerCase()}`;
                        cell.style.gridColumn = j;
                        cell.style.gridRow = 6 - i; // Reverse for visual display
                        cell.innerHTML = `
                            <div class="text-center p-2">
                                <small class="d-block text-muted">${this.getLikelihoodLabel(i)}/${this.getImpactLabel(j)}</small>
                                <strong class="d-block">${score}</strong>
                            </div>
                        `;
                        
                        // Add risk dots if any
                        const risksInCell = this.data.risks.filter(r => r.likelihood === i && r.impact === j);
                        if (risksInCell.length > 0) {
                            const dotContainer = document.createElement('div');
                            dotContainer.className = 'position-absolute top-0 start-0 w-100 h-100 p-1';
                            dotContainer.style.pointerEvents = 'none';
                            
                            risksInCell.forEach((risk, index) => {
                                const dot = document.createElement('div');
                                dot.className = 'position-absolute rounded-circle';
                                dot.style.width = '12px';
                                dot.style.height = '12px';
                                dot.style.background = risk.severity === 'High' ? '#ef4444' : 
                                                     risk.severity === 'Medium' ? '#f59e0b' : '#10b981';
                                dot.style.border = '2px solid white';
                                
                                // Position dots in a grid within the cell
                                const row = Math.floor(index / 3);
                                const col = index % 3;
                                dot.style.top = `${20 + row * 25}%`;
                                dot.style.left = `${20 + col * 25}%`;
                                
                                dotContainer.appendChild(dot);
                            });
                            
                            cell.appendChild(dotContainer);
                        }
                        
                        cell.addEventListener('click', () => this.showRisksInCell(i, j));
                        container.appendChild(cell);
                    }
                }
                
                // Add labels
                const labels = `
                    <div class="position-absolute top-0 start-0 w-100 d-flex justify-content-between px-4">
                        <div class="text-center">
                            <small class="text-muted">Impact →</small>
                        </div>
                    </div>
                    <div class="position-absolute bottom-0 start-0 w-100 d-flex justify-content-between px-4">
                        ${[1,2,3,4,5].map(n => `<div><small class="text-muted">${n}</small></div>`).join('')}
                    </div>
                    <div class="position-absolute top-0 left-0 h-100 d-flex flex-column justify-content-between py-4">
                        <div class="text-center" style="transform: rotate(-90deg); transform-origin: center;">
                            <small class="text-muted">Likelihood →</small>
                        </div>
                    </div>
                    <div class="position-absolute top-0 left-0 h-100 d-flex flex-column justify-content-between py-4">
                        ${[5,4,3,2,1].map(n => `<div class="text-center"><small class="text-muted">${n}</small></div>`).join('')}
                    </div>
                `;
                
                container.insertAdjacentHTML('beforeend', labels);
            }

            showRisksInCell(likelihood, impact) {
                const risks = this.data.risks.filter(r => r.likelihood === likelihood && r.impact === impact);
                
                if (risks.length === 0) {
                    this.showToast(`No risks in this cell (Likelihood: ${likelihood}, Impact: ${impact})`, 'info');
                    return;
                }
                
                let message = `Risks in cell (Likelihood: ${likelihood}, Impact: ${impact}):\n\n`;
                risks.forEach(risk => {
                    message += `• ${risk.title} (${risk.severity})\n`;
                });
                
                alert(message);
            }

            toggleMatrixView(view) {
                // For now, just show inherent risk
                // Could be extended to show residual risk with controls applied
                this.renderRiskMatrix();
            }

            // ===== STATEMENT OF APPLICABILITY =====
            renderSOA() {
                const tableBody = document.getElementById('soaTableBody');
                if (!tableBody) return;

                // Combine framework controls with implementation status
                let soaItems = [];
                
                Object.values(this.frameworks).forEach(framework => {
                    framework.controls.forEach(control => {
                        // Check if control is implemented
                        const isImplemented = this.data.controls.some(c => 
                            c.framework === framework.name && 
                            c.status === 'Implemented'
                        );
                        
                        const isPlanned = this.data.controls.some(c => 
                            c.framework === framework.name && 
                            c.status === 'Planned'
                        );
                        
                        let implementationStatus = 'Not Implemented';
                        if (isImplemented) implementationStatus = 'Implemented';
                        else if (isPlanned) implementationStatus = 'Planned';
                        
                        soaItems.push({
                            id: control.id,
                            name: control.name,
                            framework: framework.name,
                            category: control.category,
                            applicability: 'Applicable',
                            implementation: implementationStatus,
                            rationale: '',
                            evidence: ''
                        });
                    });
                });
                
                // Apply filter
                const frameworkFilter = document.getElementById('soaFrameworkFilter')?.value || 'all';
                if (frameworkFilter !== 'all') {
                    soaItems = soaItems.filter(item => {
                        const frameworkKey = Object.keys(this.frameworks).find(k => 
                            this.frameworks[k].name.toLowerCase().includes(frameworkFilter.toLowerCase())
                        );
                        return item.framework.toLowerCase().includes(frameworkFilter.toLowerCase());
                    });
                }
                
                if (soaItems.length === 0) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="7" class="text-center text-muted">
                                <div class="py-4">
                                    <i class="bi bi-file-text fs-4 d-block mb-2"></i>
                                    No SoA items found. Add controls mapped to frameworks first.
                                </div>
                            </td>
                        </tr>
                    `;
                } else {
                    tableBody.innerHTML = soaItems.map(item => `
                        <tr>
                            <td data-label="Control ID">
                                <code>${item.id}</code>
                            </td>
                            <td data-label="Control Name">
                                <strong>${item.name}</strong><br>
                                <small class="text-muted">${item.category}</small>
                            </td>
                            <td data-label="Framework">
                                <span class="badge bg-primary">${item.framework}</span>
                            </td>
                            <td data-label="Applicability">
                                <span class="badge bg-info">${item.applicability}</span>
                            </td>
                            <td data-label="Implementation">
                                <span class="badge bg-${item.implementation === 'Implemented' ? 'success' : 
                                                     item.implementation === 'Planned' ? 'warning' : 'danger'}">
                                    ${item.implementation}
                                </span>
                            </td>
                            <td data-label="Rationale">
                                <small>${item.rationale || '-'}</small>
                            </td>
                            <td data-label="Evidence">
                                <small>${item.evidence || '-'}</small>
                            </td>
                        </tr>
                    `).join('');
                }
            }

            // ===== REPORTS =====
            renderReports() {
                // Initialize report preview
                document.getElementById('reportContent').textContent = 
                    'Select a report type and click Generate to create a report.';
            }

            generateReport() {
                const reportType = document.getElementById('reportType')?.value || 'executive';
                let reportContent = '';
                let reportTitle = '';
                
                switch(reportType) {
                    case 'executive':
                        reportTitle = 'Executive Summary Report';
                        reportContent = this.generateExecutiveReport();
                        break;
                    case 'risk':
                        reportTitle = 'Risk Register Report';
                        reportContent = this.generateRiskReport();
                        break;
                    case 'compliance':
                        reportTitle = 'Compliance Gap Report';
                        reportContent = this.generateComplianceReport();
                        break;
                    case 'vendor':
                        reportTitle = 'Vendor Risk Report';
                        reportContent = this.generateVendorReport();
                        break;
                    case 'incident':
                        reportTitle = 'Incident Report';
                        reportContent = this.generateIncidentReport();
                        break;
                }
                
                document.getElementById('reportTitle').textContent = reportTitle;
                document.getElementById('reportContent').textContent = reportContent;
                this.showToast(`${reportTitle} generated successfully`, 'success');
            }

            generateExecutiveReport() {
                const totalRisks = this.data.risks.length;
                const highRisks = this.data.risks.filter(r => r.severity === 'High').length;
                const mediumRisks = this.data.risks.filter(r => r.severity === 'Medium').length;
                const implementedControls = this.data.controls.filter(c => c.status === 'Implemented').length;
                const totalControls = this.data.controls.length;
                const complianceRate = totalControls > 0 ? Math.round((implementedControls / totalControls) * 100) : 0;
                
                return `EXECUTIVE SUMMARY REPORT
Generated: ${new Date().toLocaleDateString()}

OVERVIEW
--------
Total Assets: ${this.data.assets.length}
Total Risks: ${totalRisks}
Total Controls: ${totalControls}
Compliance Rate: ${complianceRate}%

RISK SUMMARY
------------
• High Risks: ${highRisks}
• Medium Risks: ${mediumRisks}
• Low Risks: ${totalRisks - highRisks - mediumRisks}

TOP RISKS
---------
${this.data.risks
    .sort((a, b) => b.score - a.score)
    .slice(0, 5)
    .map((risk, i) => `${i + 1}. ${risk.title} (Score: ${risk.score}, Severity: ${risk.severity})`)
    .join('\n')}

RECOMMENDATIONS
---------------
1. Address high-risk items immediately
2. Implement planned controls
3. Regular risk assessments
4. Continuous monitoring

NEXT STEPS
----------
• Review and update risk register
• Implement control improvements
• Schedule next assessment
• Report to stakeholders`;
            }

            generateRiskReport() {
                return `RISK REGISTER REPORT
Generated: ${new Date().toLocaleDateString()}

TOTAL RISKS: ${this.data.risks.length}

RISK DETAILS
------------
${this.data.risks.map(risk => `
RISK: ${risk.title}
ID: ${risk.id}
Category: ${risk.category}
Severity: ${risk.severity} (Score: ${risk.score})
Status: ${risk.status}
Owner: ${risk.owner || 'Not assigned'}
Due Date: ${risk.dueDate || 'Not set'}
Description: ${risk.description || 'No description'}

`).join('---\n')}`;
            }

            copyReport() {
                const reportContent = document.getElementById('reportContent').textContent;
                navigator.clipboard.writeText(reportContent)
                    .then(() => this.showToast('Report copied to clipboard', 'success'))
                    .catch(() => this.showToast('Failed to copy report', 'error'));
            }

            exportReport() {
                const reportContent = document.getElementById('reportContent').textContent;
                const reportTitle = document.getElementById('reportTitle').textContent;
                
                const blob = new Blob([reportContent], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${reportTitle.toLowerCase().replace(/ /g, '_')}_${new Date().toISOString().slice(0,10)}.txt`;
                a.click();
                URL.revokeObjectURL(url);
                
                this.showToast('Report exported successfully', 'success');
            }

            // ===== CHALLENGES =====
            renderChallenges() {
                // Update challenge statuses
                this.updateChallengeStatus(1);
                this.updateChallengeStatus(2);
                this.updateChallengeStatus(3);
                this.updateChallengeStatus(4);
                
                // Calculate total points
                const totalPoints = Object.values(this.data.challenges.scores || {}).reduce((a, b) => a + b, 0);
                document.getElementById('totalPoints').textContent = totalPoints;
                
                // Update progress bar
                const progressBar = document.querySelector('.progress-bar');
                if (progressBar) {
                    const progress = Math.min(100, (totalPoints / 850) * 100); // 850 = max points
                    progressBar.style.width = `${progress}%`;
                }
            }

            updateChallengeStatus(challengeId) {
                const statusElement = document.getElementById(`challenge${challengeId}Status`);
                if (!statusElement) return;
                
                const progress = this.data.challenges.progress?.[challengeId] || {};
                const score = this.data.challenges.scores?.[challengeId] || 0;
                
                if (score > 0) {
                    statusElement.textContent = `Completed (${score} pts)`;
                    statusElement.className = 'text-success';
                } else if (Object.keys(progress).length > 0) {
                    statusElement.textContent = 'In Progress';
                    statusElement.className = 'text-warning';
                } else {
                    statusElement.textContent = 'Not Started';
                    statusElement.className = 'text-muted';
                }
            }

            startChallenge(challengeId) {
                this.switchTab('dashboard');
                this.showToast(`Starting Challenge ${challengeId}...`, 'info');
                
                // Set initial progress
                if (!this.data.challenges.progress) this.data.challenges.progress = {};
                if (!this.data.challenges.progress[challengeId]) {
                    this.data.challenges.progress[challengeId] = { started: new Date().toISOString() };
                }
                
                this.saveData('challenges', this.data.challenges);
                
                // Auto-load demo data for challenge 1
                if (challengeId === 1 && this.data.assets.length === 0) {
                    setTimeout(() => {
                        if (confirm('Load demo data for this challenge?')) {
                            this.loadDemoScenario();
                        }
                    }, 1000);
                }
            }

            resetChallenges() {
                if (confirm('Reset all challenge progress? This cannot be undone.')) {
                    this.data.challenges = { progress: {}, scores: {} };
                    this.saveData('challenges', this.data.challenges);
                    this.renderChallenges();
                    this.showToast('Challenge progress reset', 'info');
                }
            }

            // ===== VENDORS =====
            renderVendors() {
                // Vendor management would be implemented similarly to assets
                const vendorTable = document.querySelector('#vendorTableBody');
                if (vendorTable) {
                    vendorTable.innerHTML = `
                        <tr>
                            <td colspan="6" class="text-center text-muted">
                                <div class="py-4">
                                    <i class="bi bi-people fs-4 d-block mb-2"></i>
                                    Vendor management coming soon!
                                </div>
                            </td>
                        </tr>
                    `;
                }
            }

            // ===== DASHBOARD =====
            renderDashboard() {
                // Update metrics
                document.getElementById('metricAssets').textContent = this.data.assets.length;
                document.getElementById('metricRisks').textContent = this.data.risks.length;
                document.getElementById('metricControls').textContent = this.data.controls.length;
                
                // Calculate compliance coverage
                const totalControls = this.data.controls.length;
                const implemented = this.data.controls.filter(c => c.status === 'Implemented').length;
                const coverage = totalControls > 0 ? Math.round((implemented / totalControls) * 100) : 0;
                document.getElementById('metricCoverage').textContent = `${coverage}%`;
                
                // Update recent risks
                this.renderRecentRisks();
            }

            renderRecentRisks() {
                const container = document.getElementById('recentRisks');
                if (!container) return;
                
                const recentRisks = this.data.risks
                    .sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt))
                    .slice(0, 5);
                
                if (recentRisks.length === 0) {
                    container.innerHTML = `
                        <tr>
                            <td colspan="4" class="text-center text-muted">
                                No risks yet. Add some to get started!
                            </td>
                        </tr>
                    `;
                } else {
                    container.innerHTML = recentRisks.map(risk => `
                        <tr>
                            <td>
                                <strong>${risk.title}</strong><br>
                                <small class="text-muted">${risk.category}</small>
                            </td>
                            <td>
                                <span class="badge bg-${risk.severity === 'High' ? 'danger' : risk.severity === 'Medium' ? 'warning' : 'success'}">
                                    ${risk.severity}
                                </span>
                            </td>
                            <td>
                                <span class="badge bg-${risk.status === 'Open' ? 'secondary' : 
                                                         risk.status === 'In Progress' ? 'info' : 
                                                         risk.status === 'Mitigated' ? 'success' : 'dark'}">
                                    ${risk.status}
                                </span>
                            </td>
                            <td>
                                <button class="btn btn-sm btn-outline-light" onclick="app.showRiskForm('${risk.id}')">
                                    <i class="bi bi-eye"></i>
                                </button>
                            </td>
                        </tr>
                    `).join('');
                }
            }

            // ===== DATA MANAGEMENT =====
            loadDemoScenario() {
                if (!confirm('Load demo scenario? This will replace your current data.')) {
                    return;
                }

                // Load comprehensive demo data
                this.data.assets = [
                    {
                        id: 'AST_001',
                        name: 'Customer Database',
                        type: 'Database',
                        criticality: 'High',
                        owner: 'IT Department',
                        description: 'Primary customer information database containing PII and financial data.',
                        dataTypes: ['PII', 'Financial'],
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    },
                    {
                        id: 'AST_002',
                        name: 'Web Application',
                        type: 'Application',
                        criticality: 'High',
                        owner: 'Development Team',
                        description: 'Customer-facing web portal for account management.',
                        dataTypes: ['PII', 'Credentials'],
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    },
                    {
                        id: 'AST_003',
                        name: 'Internal File Server',
                        type: 'Server',
                        criticality: 'Medium',
                        owner: 'IT Operations',
                        description: 'File server for internal documents and collaboration.',
                        dataTypes: ['Internal'],
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    }
                ];

                this.data.risks = [
                    {
                        id: 'RISK_001',
                        title: 'Data Breach via SQL Injection',
                        category: 'Cybersecurity',
                        status: 'Open',
                        likelihood: 4,
                        impact: 5,
                        score: 20,
                        severity: 'High',
                        description: 'Potential SQL injection vulnerability in web application could lead to data breach.',
                        owner: 'CISO',
                        dueDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                        mitigation: 'Implement WAF and regular security testing.',
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    },
                    {
                        id: 'RISK_002',
                        title: 'Insider Data Theft',
                        category: 'People',
                        status: 'In Progress',
                        likelihood: 3,
                        impact: 4,
                        score: 12,
                        severity: 'Medium',
                        description: 'Unauthorized access by privileged users could lead to data theft.',
                        owner: 'HR Director',
                        dueDate: new Date(Date.now() + 45 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                        mitigation: 'Implement privileged access management and monitoring.',
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    },
                    {
                        id: 'RISK_003',
                        title: 'Ransomware Attack',
                        category: 'Cybersecurity',
                        status: 'Open',
                        likelihood: 4,
                        impact: 4,
                        score: 16,
                        severity: 'High',
                        description: 'Ransomware could encrypt critical systems and data.',
                        owner: 'Security Team',
                        dueDate: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                        mitigation: 'Implement endpoint protection and backup strategy.',
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    }
                ];

                this.data.controls = [
                    {
                        id: 'CTL_001',
                        name: 'Multi-Factor Authentication',
                        type: 'Technical',
                        status: 'Implemented',
                        framework: 'ISO 27001',
                        owner: 'Security Team',
                        implementationDate: new Date().toISOString().split('T')[0],
                        description: 'MFA enforced for all administrative accounts.',
                        evidence: 'Okta dashboard configuration',
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    },
                    {
                        id: 'CTL_002',
                        name: 'Web Application Firewall',
                        type: 'Technical',
                        status: 'Implemented',
                        framework: 'ISO 27001',
                        owner: 'Network Team',
                        implementationDate: new Date().toISOString().split('T')[0],
                        description: 'WAF protecting all web applications.',
                        evidence: 'Cloudflare WAF logs',
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    },
                    {
                        id: 'CTL_003',
                        name: 'Security Awareness Training',
                        type: 'Administrative',
                        status: 'Planned',
                        framework: 'ISO 27001',
                        owner: 'HR Department',
                        implementationDate: new Date(Date.now() + 14 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                        description: 'Quarterly security awareness training for all employees.',
                        evidence: 'Training schedule and materials',
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    }
                ];

                // Save all data
                this.saveData('assets', this.data.assets);
                this.saveData('risks', this.data.risks);
                this.saveData('controls', this.data.controls);

                // Update all views
                this.renderDashboard();
                this.renderRisks();
                this.renderAssets();
                this.renderControls();
                this.renderFrameworks();
                this.renderRiskMatrix();
                this.renderSOA();
                
                this.showToast('Demo scenario loaded successfully!', 'success');
            }

            exportAllData() {
                const exportData = {
                    version: this.version,
                    exportedAt: new Date().toISOString(),
                    data: this.data,
                    frameworks: this.frameworks
                };

                const dataStr = JSON.stringify(exportData, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `grc_lab_export_${new Date().toISOString().slice(0,10)}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                document.body.appendChild(linkElement);
                linkElement.click();
                document.body.removeChild(linkElement);
                
                this.showToast('All data exported successfully', 'success');
            }

            importData(event) {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        
                        // Validate and merge data
                        if (importedData.data) {
                            Object.keys(importedData.data).forEach(key => {
                                if (this.data.hasOwnProperty(key)) {
                                    this.data[key] = importedData.data[key];
                                    this.saveData(key, this.data[key]);
                                }
                            });
                        }
                        
                        // Update all views
                        this.renderDashboard();
                        this.renderRisks();
                        this.renderAssets();
                        this.renderControls();
                        this.renderFrameworks();
                        this.renderRiskMatrix();
                        this.renderSOA();
                        
                        this.showToast('Data imported successfully', 'success');
                    } catch (error) {
                        this.showToast('Error importing data. Invalid file format.', 'error');
                    }
                };
                reader.readAsText(file);
            }

            // ===== UTILITIES =====
            deleteItem(type, id) {
                if (!confirm(`Are you sure you want to delete this ${type}?`)) return;
                
                let collection = this.data[type + 's'];
                if (collection) {
                    this.data[type + 's'] = collection.filter(item => item.id !== id);
                    this.saveData(type + 's', this.data[type + 's']);
                    
                    // Update UI
                    this.renderDashboard();
                    if (this.currentTab === type + 's') {
                        this.renderTabContent(this.currentTab);
                    }
                    
                    this.showToast(`${type} deleted successfully`, 'info');
                }
            }

            showToast(message, type = 'info') {
                const toastEl = document.getElementById('liveToast');
                const toastMessage = document.getElementById('toastMessage');
                
                if (!toastEl || !toastMessage) return;
                
                // Set message
                toastMessage.textContent = message;
                
                // Set color based on type
                toastEl.className = 'toast';
                switch(type) {
                    case 'success':
                        toastEl.classList.add('bg-success', 'text-white');
                        break;
                    case 'error':
                        toastEl.classList.add('bg-danger', 'text-white');
                        break;
                    case 'warning':
                        toastEl.classList.add('bg-warning', 'text-dark');
                        break;
                    default:
                        toastEl.classList.add('bg-info', 'text-white');
                }
                
                // Show toast
                const toast = new bootstrap.Toast(toastEl, { delay: 3000 });
                toast.show();
            }

            showFirstTimeSetup() {
                const setupHTML = `
                    <div class="modal fade" id="firstTimeModal" tabindex="-1">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content bg-dark border border-light">
                                <div class="modal-header">
                                    <h5 class="modal-title">Welcome to GRC Practice Lab! 👋</h5>
                                </div>
                                <div class="modal-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="card-glass mb-3">
                                                <h6><i class="bi bi-rocket-takeoff me-2"></i> Quick Start</h6>
                                                <p>Load the demo scenario to see how the lab works with sample data.</p>
                                                <button class="btn btn-sm btn-primary w-100" onclick="app.loadDemoScenario(); bootstrap.Modal.getInstance(document.getElementById('firstTimeModal')).hide();">
                                                    Load Demo
                                                </button>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="card-glass mb-3">
                                                <h6><i class="bi bi-plus-circle me-2"></i> Start Fresh</h6>
                                                <p>Begin with a clean slate and add your own data from scratch.</p>
                                                <button class="btn btn-sm btn-outline-light w-100" data-bs-dismiss="modal">
                                                    Start Fresh
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="alert alert-info bg-dark border-info mt-3">
                                        <h6><i class="bi bi-lightbulb me-2"></i> Tips for Getting Started:</h6>
                                        <ol class="mb-0">
                                            <li>Add your organization's assets first</li>
                                            <li>Identify risks for each asset</li>
                                            <li>Implement controls to mitigate risks</li>
                                            <li>Use the Risk Matrix to visualize risk levels</li>
                                            <li>Generate reports for stakeholders</li>
                                        </ol>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <small class="text-muted">This tool runs entirely in your browser. No data is sent to any server.</small>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.insertAdjacentHTML('beforeend', setupHTML);
                const modal = new bootstrap.Modal(document.getElementById('firstTimeModal'));
                modal.show();
            }

            handleSearch(event, type) {
                // Debounce search
                clearTimeout(this.searchTimeout);
                this.searchTimeout = setTimeout(() => {
                    this.renderTabContent(type);
                }, 300);
            }

            handleFilter(event, filterId) {
                this.renderTabContent(this.currentTab);
            }
        }

        // ===== INITIALIZE APPLICATION =====
        let app;
        document.addEventListener('DOMContentLoaded', () => {
            app = new GRCApplication();
            window.app = app; // Make available globally
            
            // Initialize tooltips
            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });
            
            // File import handler
            document.getElementById('fileInput')?.addEventListener('change', (e) => app.importData(e));
        });

        // ===== GLOBAL HELPER FUNCTIONS =====
        function switchTab(tabName) {
            if (app) app.switchTab(tabName);
        }

        function loadDemoScenario() {
            if (app) app.loadDemoScenario();
        }

        function exportAllData() {
            if (app) app.exportAllData();
        }

        function generateReport() {
            if (app) app.generateReport();
        }

        function copyReport() {
            if (app) app.copyReport();
        }

        function exportReport() {
            if (app) app.exportReport();
        }

        function startChallenge(challengeId) {
            if (app) app.startChallenge(challengeId);
        }

        function resetChallenges() {
            if (app) app.resetChallenges();
        }

        // Make app available globally for inline event handlers
        window.GRCApp = app;
    </script>
</body>
</html>
